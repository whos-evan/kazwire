Math.sign||(Math.sign=function(t){return t=Number(t),t?0>t?-1:1:t===t?t:NaN}),Math.log2||(Math.log2=function(t){return Math.log(t)/Math.LN2}),Math.trunc||(Math.trunc=function(t){return 0>t?Math.ceil(t):Math.floor(t)}),Math.tanh||(Math.tanh=function(t){if(t===1/0)return 1;if(t===-(1/0))return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}),Math.sinh||(Math.sinh=function(t){var e=Math.exp(t);return(e-1/e)/2}),Math.log1p||(Math.log1p=function(t){return Math.log(1+t)}),Math.log10||(Math.log10=function(t){return Math.log(t)/Math.LN10}),Math.imul||(Math.imul=function(t,e){var i=t>>>16&65535,n=65535&t,r=e>>>16&65535,s=65535&e;return n*s+(i*s+n*r<<16>>>0)|0}),Math.hypot||(Math.hypot=function(){for(var t,e=0,i=arguments.length;i--;){if(t=arguments[i],t===1/0||t===-(1/0))return 1/0;e+=t*t}return Math.sqrt(e)}),Math.fround||(Math.fround=function(t){var e=new Float32Array(1);return e[0]=t,e[0]}),Math.expm1||(Math.expm1=function(t){return Math.exp(t)-1}),Math.cosh||(Math.cosh=function(t){var e=Math.exp(t);return(e+1/e)/2}),Math.clz32||(Math.clz32=function(t){return t=Number(t)>>>0,t?32-t.toString(2).length:32}),Math.cbrt||(Math.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return 0>t?-e:e}),Math.atanh||(Math.atanh=function(t){return Math.log((1+t)/(1-t))/2}),Math.asinh||(Math.asinh=function(t){return t===-(1/0)?t:Math.log(t+Math.sqrt(t*t+1))}),Math.acosh||(Math.acosh=function(t){return Math.log(t+Math.sqrt(t*t-1))}),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.PIXI=t()}}(function(){var t;return function e(t,i,n){function r(o,a){if(!i[o]){if(!t[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[o]={exports:{}};t[o][0].call(u.exports,function(e){var i=t[o][1][e];return r(i?i:e)},u,u.exports,e,t,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,i,n){(function(e,n){!function(){function r(){}function s(t){return t}function o(t){return!!t}function a(t){return!t}function h(t){return function(){if(null===t)throw new Error("Callback was already called.");t.apply(this,arguments),t=null}}function l(t){return function(){null!==t&&(t.apply(this,arguments),t=null)}}function u(t){return q(t)||"number"==typeof t.length&&t.length>=0&&t.length%1===0}function c(t,e){for(var i=-1,n=t.length;++i<n;)e(t[i],i,t)}function p(t,e){for(var i=-1,n=t.length,r=Array(n);++i<n;)r[i]=e(t[i],i,t);return r}function d(t){return p(Array(t),function(t,e){return e})}function f(t,e,i){return c(t,function(t,n,r){i=e(i,t,n,r)}),i}function m(t,e){c(U(t),function(i){e(t[i],i)})}function g(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}function y(t){var e,i,n=-1;return u(t)?(e=t.length,function(){return n++,e>n?n:null}):(i=U(t),e=i.length,function(){return n++,e>n?i[n]:null})}function v(t,e){return e=null==e?t.length-1:+e,function(){for(var i=Math.max(arguments.length-e,0),n=Array(i),r=0;i>r;r++)n[r]=arguments[r+e];switch(e){case 0:return t.call(this,n);case 1:return t.call(this,arguments[0],n)}}}function x(t){return function(e,i,n){return t(e,n)}}function b(t){return function(e,i,n){n=l(n||r),e=e||[];var s=y(e);if(0>=t)return n(null);var o=!1,a=0,u=!1;!function c(){if(o&&0>=a)return n(null);for(;t>a&&!u;){var r=s();if(null===r)return o=!0,void(0>=a&&n(null));a+=1,i(e[r],r,h(function(t){a-=1,t?(n(t),u=!0):c()}))}}()}}function w(t){return function(e,i,n){return t(B.eachOf,e,i,n)}}function _(t){return function(e,i,n,r){return t(b(i),e,n,r)}}function T(t){return function(e,i,n){return t(B.eachOfSeries,e,i,n)}}function E(t,e,i,n){n=l(n||r),e=e||[];var s=u(e)?[]:{};t(e,function(t,e,n){i(t,function(t,i){s[e]=i,n(t)})},function(t){n(t,s)})}function S(t,e,i,n){var r=[];t(e,function(t,e,n){i(t,function(i){i&&r.push({index:e,value:t}),n()})},function(){n(p(r.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})}function A(t,e,i,n){S(t,e,function(t,e){i(t,function(t){e(!t)})},n)}function C(t,e,i){return function(n,r,s,o){function a(){o&&o(i(!1,void 0))}function h(t,n,r){return o?void s(t,function(n){o&&e(n)&&(o(i(!0,t)),o=s=!1),r()}):r()}arguments.length>3?t(n,r,h,a):(o=s,s=r,t(n,h,a))}}function P(t,e){return e}function M(t,e,i){i=i||r;var n=u(e)?[]:{};t(e,function(t,e,i){t(v(function(t,r){r.length<=1&&(r=r[0]),n[e]=r,i(t)}))},function(t){i(t,n)})}function O(t,e,i,n){var r=[];t(e,function(t,e,n){i(t,function(t,e){r=r.concat(e||[]),n(t)})},function(t){n(t,r)})}function R(t,e,i){function n(t,e,i,n){if(null!=n&&"function"!=typeof n)throw new Error("task callback must be a function");return t.started=!0,q(e)||(e=[e]),0===e.length&&t.idle()?B.setImmediate(function(){t.drain()}):(c(e,function(e){var s={data:e,callback:n||r};i?t.tasks.unshift(s):t.tasks.push(s),t.tasks.length===t.concurrency&&t.saturated()}),void B.setImmediate(t.process))}function s(t,e){return function(){o-=1;var i=!1,n=arguments;c(e,function(t){c(a,function(e,n){e!==t||i||(a.splice(n,1),i=!0)}),t.callback.apply(t,n)}),t.tasks.length+o===0&&t.drain(),t.process()}}if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var o=0,a=[],l={tasks:[],concurrency:e,payload:i,saturated:r,empty:r,drain:r,started:!1,paused:!1,push:function(t,e){n(l,t,!1,e)},kill:function(){l.drain=r,l.tasks=[]},unshift:function(t,e){n(l,t,!0,e)},process:function(){if(!l.paused&&o<l.concurrency&&l.tasks.length)for(;o<l.concurrency&&l.tasks.length;){var e=l.payload?l.tasks.splice(0,l.payload):l.tasks.splice(0,l.tasks.length),i=p(e,function(t){return t.data});0===l.tasks.length&&l.empty(),o+=1,a.push(e[0]);var n=h(s(l,e));t(i,n)}},length:function(){return l.tasks.length},running:function(){return o},workersList:function(){return a},idle:function(){return l.tasks.length+o===0},pause:function(){l.paused=!0},resume:function(){if(l.paused!==!1){l.paused=!1;for(var t=Math.min(l.concurrency,l.tasks.length),e=1;t>=e;e++)B.setImmediate(l.process)}}};return l}function k(t){return v(function(e,i){e.apply(null,i.concat([v(function(e,i){"object"==typeof console&&(e?console.error&&console.error(e):console[t]&&c(i,function(e){console[t](e)}))})]))})}function I(t){return function(e,i,n){t(d(e),i,n)}}function D(t){return v(function(e,i){var n=v(function(i){var n=this,r=i.pop();return t(e,function(t,e,r){t.apply(n,i.concat([r]))},r)});return i.length?n.apply(this,i):n})}function L(t){return v(function(e){var i=e.pop();e.push(function(){var t=arguments;n?B.setImmediate(function(){i.apply(null,t)}):i.apply(null,t)});var n=!0;t.apply(this,e),n=!1})}var F,B={},N="object"==typeof self&&self.self===self&&self||"object"==typeof n&&n.global===n&&n||this;null!=N&&(F=N.async),B.noConflict=function(){return N.async=F,B};var G=Object.prototype.toString,q=Array.isArray||function(t){return"[object Array]"===G.call(t)},z=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},U=Object.keys||function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e},j="function"==typeof setImmediate&&setImmediate,H=j?function(t){j(t)}:function(t){setTimeout(t,0)};"object"==typeof e&&"function"==typeof e.nextTick?B.nextTick=e.nextTick:B.nextTick=H,B.setImmediate=j?H:B.nextTick,B.forEach=B.each=function(t,e,i){return B.eachOf(t,x(e),i)},B.forEachSeries=B.eachSeries=function(t,e,i){return B.eachOfSeries(t,x(e),i)},B.forEachLimit=B.eachLimit=function(t,e,i,n){return b(e)(t,x(i),n)},B.forEachOf=B.eachOf=function(t,e,i){function n(t){a--,t?i(t):null===s&&0>=a&&i(null)}i=l(i||r),t=t||[];for(var s,o=y(t),a=0;null!=(s=o());)a+=1,e(t[s],s,h(n));0===a&&i(null)},B.forEachOfSeries=B.eachOfSeries=function(t,e,i){function n(){var r=!0;return null===o?i(null):(e(t[o],o,h(function(t){if(t)i(t);else{if(o=s(),null===o)return i(null);r?B.setImmediate(n):n()}})),void(r=!1))}i=l(i||r),t=t||[];var s=y(t),o=s();n()},B.forEachOfLimit=B.eachOfLimit=function(t,e,i,n){b(e)(t,i,n)},B.map=w(E),B.mapSeries=T(E),B.mapLimit=_(E),B.inject=B.foldl=B.reduce=function(t,e,i,n){B.eachOfSeries(t,function(t,n,r){i(e,t,function(t,i){e=i,r(t)})},function(t){n(t,e)})},B.foldr=B.reduceRight=function(t,e,i,n){var r=p(t,s).reverse();B.reduce(r,e,i,n)},B.transform=function(t,e,i,n){3===arguments.length&&(n=i,i=e,e=q(t)?[]:{}),B.eachOf(t,function(t,n,r){i(e,t,n,r)},function(t){n(t,e)})},B.select=B.filter=w(S),B.selectLimit=B.filterLimit=_(S),B.selectSeries=B.filterSeries=T(S),B.reject=w(A),B.rejectLimit=_(A),B.rejectSeries=T(A),B.any=B.some=C(B.eachOf,o,s),B.someLimit=C(B.eachOfLimit,o,s),B.all=B.every=C(B.eachOf,a,a),B.everyLimit=C(B.eachOfLimit,a,a),B.detect=C(B.eachOf,s,P),B.detectSeries=C(B.eachOfSeries,s,P),B.detectLimit=C(B.eachOfLimit,s,P),B.sortBy=function(t,e,i){function n(t,e){var i=t.criteria,n=e.criteria;return n>i?-1:i>n?1:0}B.map(t,function(t,i){e(t,function(e,n){e?i(e):i(null,{value:t,criteria:n})})},function(t,e){return t?i(t):void i(null,p(e.sort(n),function(t){return t.value}))})},B.auto=function(t,e,i){function n(t){d.unshift(t)}function s(t){var e=g(d,t);e>=0&&d.splice(e,1)}function o(){h--,c(d.slice(0),function(t){t()})}i||(i=e,e=null),i=l(i||r);var a=U(t),h=a.length;if(!h)return i(null);e||(e=h);var u={},p=0,d=[];n(function(){h||i(null,u)}),c(a,function(r){function a(){return e>p&&f(y,function(t,e){return t&&u.hasOwnProperty(e)},!0)&&!u.hasOwnProperty(r)}function h(){a()&&(p++,s(h),c[c.length-1](d,u))}for(var l,c=q(t[r])?t[r]:[t[r]],d=v(function(t,e){if(p--,e.length<=1&&(e=e[0]),t){var n={};m(u,function(t,e){n[e]=t}),n[r]=e,i(t,n)}else u[r]=e,B.setImmediate(o)}),y=c.slice(0,c.length-1),x=y.length;x--;){if(!(l=t[y[x]]))throw new Error("Has inexistant dependency");if(q(l)&&g(l,r)>=0)throw new Error("Has cyclic dependencies")}a()?(p++,c[c.length-1](d,u)):n(h)})},B.retry=function(t,e,i){function n(t,e){if("number"==typeof e)t.times=parseInt(e,10)||s;else{if("object"!=typeof e)throw new Error("Unsupported argument type for 'times': "+typeof e);t.times=parseInt(e.times,10)||s,t.interval=parseInt(e.interval,10)||o}}function r(t,e){function i(t,i){return function(n){t(function(t,e){n(!t||i,{err:t,result:e})},e)}}function n(t){return function(e){setTimeout(function(){e(null)},t)}}for(;h.times;){var r=!(h.times-=1);a.push(i(h.task,r)),!r&&h.interval>0&&a.push(n(h.interval))}B.series(a,function(e,i){i=i[i.length-1],(t||h.callback)(i.err,i.result)})}var s=5,o=0,a=[],h={times:s,interval:o},l=arguments.length;if(1>l||l>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");return 2>=l&&"function"==typeof t&&(i=e,e=t),"function"!=typeof t&&n(h,t),h.callback=i,h.task=e,h.callback?r():r},B.waterfall=function(t,e){function i(t){return v(function(n,r){if(n)e.apply(null,[n].concat(r));else{var s=t.next();s?r.push(i(s)):r.push(e),L(t).apply(null,r)}})}if(e=l(e||r),!q(t)){var n=new Error("First argument to waterfall must be an array of functions");return e(n)}return t.length?void i(B.iterator(t))():e()},B.parallel=function(t,e){M(B.eachOf,t,e)},B.parallelLimit=function(t,e,i){M(b(e),t,i)},B.series=function(t,e){M(B.eachOfSeries,t,e)},B.iterator=function(t){function e(i){function n(){return t.length&&t[i].apply(null,arguments),n.next()}return n.next=function(){return i<t.length-1?e(i+1):null},n}return e(0)},B.apply=v(function(t,e){return v(function(i){return t.apply(null,e.concat(i))})}),B.concat=w(O),B.concatSeries=T(O),B.whilst=function(t,e,i){if(i=i||r,t()){var n=v(function(r,s){r?i(r):t.apply(this,s)?e(n):i(null)});e(n)}else i(null)},B.doWhilst=function(t,e,i){var n=0;return B.whilst(function(){return++n<=1||e.apply(this,arguments)},t,i)},B.until=function(t,e,i){return B.whilst(function(){return!t.apply(this,arguments)},e,i)},B.doUntil=function(t,e,i){return B.doWhilst(t,function(){return!e.apply(this,arguments)},i)},B.during=function(t,e,i){i=i||r;var n=v(function(e,n){e?i(e):(n.push(s),t.apply(this,n))}),s=function(t,r){t?i(t):r?e(n):i(null)};t(s)},B.doDuring=function(t,e,i){var n=0;B.during(function(t){n++<1?t(null,!0):e.apply(this,arguments)},t,i)},B.queue=function(t,e){var i=R(function(e,i){t(e[0],i)},e,1);return i},B.priorityQueue=function(t,e){function i(t,e){return t.priority-e.priority}function n(t,e,i){for(var n=-1,r=t.length-1;r>n;){var s=n+(r-n+1>>>1);i(e,t[s])>=0?n=s:r=s-1}return n}function s(t,e,s,o){if(null!=o&&"function"!=typeof o)throw new Error("task callback must be a function");return t.started=!0,q(e)||(e=[e]),0===e.length?B.setImmediate(function(){t.drain()}):void c(e,function(e){var a={data:e,priority:s,callback:"function"==typeof o?o:r};t.tasks.splice(n(t.tasks,a,i)+1,0,a),t.tasks.length===t.concurrency&&t.saturated(),B.setImmediate(t.process)})}var o=B.queue(t,e);return o.push=function(t,e,i){s(o,t,e,i)},delete o.unshift,o},B.cargo=function(t,e){return R(t,1,e)},B.log=k("log"),B.dir=k("dir"),B.memoize=function(t,e){var i={},n={};e=e||s;var r=v(function(r){var s=r.pop(),o=e.apply(null,r);o in i?B.setImmediate(function(){s.apply(null,i[o])}):o in n?n[o].push(s):(n[o]=[s],t.apply(null,r.concat([v(function(t){i[o]=t;var e=n[o];delete n[o];for(var r=0,s=e.length;s>r;r++)e[r].apply(null,t)})])))});return r.memo=i,r.unmemoized=t,r},B.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},B.times=I(B.map),B.timesSeries=I(B.mapSeries),B.timesLimit=function(t,e,i,n){return B.mapLimit(d(t),e,i,n)},B.seq=function(){var t=arguments;return v(function(e){var i=this,n=e[e.length-1];"function"==typeof n?e.pop():n=r,B.reduce(t,e,function(t,e,n){e.apply(i,t.concat([v(function(t,e){n(t,e)})]))},function(t,e){n.apply(i,[t].concat(e))})})},B.compose=function(){return B.seq.apply(null,Array.prototype.reverse.call(arguments))},B.applyEach=D(B.eachOf),B.applyEachSeries=D(B.eachOfSeries),B.forever=function(t,e){function i(t){return t?n(t):void s(i)}var n=h(e||r),s=L(t);i()},B.ensureAsync=L,B.constant=v(function(t){var e=[null].concat(t);return function(t){return t.apply(this,e)}}),B.wrapSync=B.asyncify=function(t){return v(function(e){var i,n=e.pop();try{i=t.apply(this,e)}catch(r){return n(r)}z(i)&&"function"==typeof i.then?i.then(function(t){n(null,t)})["catch"](function(t){n(t.message?t:new Error(t))}):n(null,i)})},"object"==typeof i&&i.exports?i.exports=B:"function"==typeof t&&t.amd?t([],function(){return B}):N.async=B}()}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],2:[function(t,e,i){(function(t){function e(t,e){for(var i=0,n=t.length-1;n>=0;n--){var r=t[n];"."===r?t.splice(n,1):".."===r?(t.splice(n,1),i++):i&&(t.splice(n,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var i=[],n=0;n<t.length;n++)e(t[n],n,t)&&i.push(t[n]);return i}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,s=function(t){return r.exec(t).slice(1)};i.resolve=function(){for(var i="",r=!1,s=arguments.length-1;s>=-1&&!r;s--){var o=s>=0?arguments[s]:t.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(i=o+"/"+i,r="/"===o.charAt(0))}return i=e(n(i.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+i||"."},i.normalize=function(t){var r=i.isAbsolute(t),s="/"===o(t,-1);return t=e(n(t.split("/"),function(t){return!!t}),!r).join("/"),t||r||(t="."),t&&s&&(t+="/"),(r?"/":"")+t},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(n(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},i.relative=function(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var r=n(t.split("/")),s=n(e.split("/")),o=Math.min(r.length,s.length),a=o,h=0;o>h;h++)if(r[h]!==s[h]){a=h;break}for(var l=[],h=a;h<r.length;h++)l.push("..");return l=l.concat(s.slice(a)),l.join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=s(t),i=e[0],n=e[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."},i.basename=function(t,e){var i=s(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return s(t)[3]};var o="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return 0>e&&(e=t.length+e),t.substr(e,i)}}).call(this,t("_process"))},{_process:3}],3:[function(t,e,i){function n(){u=!1,a.length?l=a.concat(l):c=-1,l.length&&r()}function r(){if(!u){var t=setTimeout(n);u=!0;for(var e=l.length;e;){for(a=l,l=[];++c<e;)a&&a[c].run();c=-1,e=l.length}a=null,u=!1,clearTimeout(t)}}function s(t,e){this.fun=t,this.array=e}function o(){}var a,h=e.exports={},l=[],u=!1,c=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new s(t,e)),1!==l.length||u||setTimeout(r,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=o,h.addListener=o,h.once=o,h.off=o,h.removeListener=o,h.removeAllListeners=o,h.emit=o,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],4:[function(e,i,n){(function(e){!function(r){function s(t){throw RangeError(D[t])}function o(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}function a(t,e){var i=t.split("@"),n="";i.length>1&&(n=i[0]+"@",t=i[1]),t=t.replace(I,".");var r=t.split("."),s=o(r,e).join(".");return n+s}function h(t){for(var e,i,n=[],r=0,s=t.length;s>r;)e=t.charCodeAt(r++),e>=55296&&56319>=e&&s>r?(i=t.charCodeAt(r++),56320==(64512&i)?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),r--)):n.push(e);return n}function l(t){return o(t,function(t){var e="";return t>65535&&(t-=65536,e+=B(t>>>10&1023|55296),t=56320|1023&t),e+=B(t)}).join("")}function u(t){return 10>t-48?t-22:26>t-65?t-65:26>t-97?t-97:T}function c(t,e){return t+22+75*(26>t)-((0!=e)<<5)}function p(t,e,i){var n=0;for(t=i?F(t/C):t>>1,t+=F(t/e);t>L*S>>1;n+=T)t=F(t/L);return F(n+(L+1)*t/(t+A))}function d(t){var e,i,n,r,o,a,h,c,d,f,m=[],g=t.length,y=0,v=M,x=P;for(i=t.lastIndexOf(O),0>i&&(i=0),n=0;i>n;++n)t.charCodeAt(n)>=128&&s("not-basic"),m.push(t.charCodeAt(n));for(r=i>0?i+1:0;g>r;){for(o=y,a=1,h=T;r>=g&&s("invalid-input"),c=u(t.charCodeAt(r++)),(c>=T||c>F((_-y)/a))&&s("overflow"),y+=c*a,d=x>=h?E:h>=x+S?S:h-x,!(d>c);h+=T)f=T-d,a>F(_/f)&&s("overflow"),a*=f;e=m.length+1,x=p(y-o,e,0==o),F(y/e)>_-v&&s("overflow"),v+=F(y/e),y%=e,m.splice(y++,0,v)}return l(m)}function f(t){var e,i,n,r,o,a,l,u,d,f,m,g,y,v,x,b=[];for(t=h(t),g=t.length,e=M,i=0,o=P,a=0;g>a;++a)m=t[a],128>m&&b.push(B(m));for(n=r=b.length,r&&b.push(O);g>n;){for(l=_,a=0;g>a;++a)m=t[a],m>=e&&l>m&&(l=m);for(y=n+1,l-e>F((_-i)/y)&&s("overflow"),i+=(l-e)*y,e=l,a=0;g>a;++a)if(m=t[a],e>m&&++i>_&&s("overflow"),m==e){for(u=i,d=T;f=o>=d?E:d>=o+S?S:d-o,!(f>u);d+=T)x=u-f,v=T-f,b.push(B(c(f+x%v,0))),u=F(x/v);b.push(B(c(u,0))),o=p(i,y,n==r),i=0,++n}++i,++e}return b.join("")}function m(t){return a(t,function(t){return R.test(t)?d(t.slice(4).toLowerCase()):t})}function g(t){return a(t,function(t){return k.test(t)?"xn--"+f(t):t})}var y="object"==typeof n&&n&&!n.nodeType&&n,v="object"==typeof i&&i&&!i.nodeType&&i,x="object"==typeof e&&e;x.global!==x&&x.window!==x&&x.self!==x||(r=x);var b,w,_=2147483647,T=36,E=1,S=26,A=38,C=700,P=72,M=128,O="-",R=/^xn--/,k=/[^\x20-\x7E]/,I=/[\x2E\u3002\uFF0E\uFF61]/g,D={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},L=T-E,F=Math.floor,B=String.fromCharCode;if(b={version:"1.3.2",ucs2:{decode:h,encode:l},decode:d,encode:f,toASCII:g,toUnicode:m},"function"==typeof t&&"object"==typeof t.amd&&t.amd)t("punycode",function(){return b});else if(y&&v)if(i.exports==y)v.exports=b;else for(w in b)b.hasOwnProperty(w)&&(y[w]=b[w]);else r.punycode=b}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(t,e,i){"use strict";function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,i,s){e=e||"&",i=i||"=";var o={};if("string"!=typeof t||0===t.length)return o;var a=/\+/g;t=t.split(e);var h=1e3;s&&"number"==typeof s.maxKeys&&(h=s.maxKeys);var l=t.length;h>0&&l>h&&(l=h);for(var u=0;l>u;++u){var c,p,d,f,m=t[u].replace(a,"%20"),g=m.indexOf(i);g>=0?(c=m.substr(0,g),p=m.substr(g+1)):(c=m,p=""),d=decodeURIComponent(c),f=decodeURIComponent(p),n(o,d)?r(o[d])?o[d].push(f):o[d]=[o[d],f]:o[d]=f}return o};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],6:[function(t,e,i){"use strict";function n(t,e){if(t.map)return t.map(e);for(var i=[],n=0;n<t.length;n++)i.push(e(t[n],n));return i}var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,i,a){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?n(o(t),function(o){var a=encodeURIComponent(r(o))+i;return s(t[o])?n(t[o],function(t){return a+encodeURIComponent(r(t))}).join(e):a+encodeURIComponent(r(t[o]))}).join(e):a?encodeURIComponent(r(a))+i+encodeURIComponent(r(t)):""};var s=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}},{}],7:[function(t,e,i){"use strict";i.decode=i.parse=t("./decode"),i.encode=i.stringify=t("./encode")},{"./decode":5,"./encode":6}],8:[function(t,e,i){function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function r(t,e,i){if(t&&l(t)&&t instanceof n)return t;var r=new n;return r.parse(t,e,i),r}function s(t){return h(t)&&(t=r(t)),t instanceof n?t.format():n.prototype.format.call(t)}function o(t,e){return r(t,!1,!0).resolve(e)}function a(t,e){return t?r(t,!1,!0).resolveObject(e):e}function h(t){return"string"==typeof t}function l(t){return"object"==typeof t&&null!==t}function u(t){return null===t}function c(t){return null==t}var p=t("punycode");i.parse=r,i.resolve=o,i.resolveObject=a,i.format=s,i.Url=n;var d=/^([a-z0-9.+-]+:)/i,f=/:[0-9]*$/,m=["<",">",'"',"`"," ","\r","\n","	"],g=["{","}","|","\\","^","`"].concat(m),y=["'"].concat(g),v=["%","/","?",";","#"].concat(y),x=["/","?","#"],b=255,w=/^[a-z0-9A-Z_-]{0,63}$/,_=/^([a-z0-9A-Z_-]{0,63})(.*)$/,T={javascript:!0,"javascript:":!0},E={javascript:!0,"javascript:":!0},S={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},A=t("querystring");n.prototype.parse=function(t,e,i){if(!h(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t;n=n.trim();var r=d.exec(n);if(r){r=r[0];var s=r.toLowerCase();this.protocol=s,n=n.substr(r.length)}if(i||r||n.match(/^\/\/[^@\/]+@[^@\/]+/)){var o="//"===n.substr(0,2);!o||r&&E[r]||(n=n.substr(2),this.slashes=!0)}if(!E[r]&&(o||r&&!S[r])){for(var a=-1,l=0;l<x.length;l++){var u=n.indexOf(x[l]);-1!==u&&(-1===a||a>u)&&(a=u)}var c,f;f=-1===a?n.lastIndexOf("@"):n.lastIndexOf("@",a),-1!==f&&(c=n.slice(0,f),n=n.slice(f+1),this.auth=decodeURIComponent(c)),a=-1;for(var l=0;l<v.length;l++){var u=n.indexOf(v[l]);-1!==u&&(-1===a||a>u)&&(a=u)}-1===a&&(a=n.length),this.host=n.slice(0,a),n=n.slice(a),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var g=this.hostname.split(/\./),l=0,C=g.length;C>l;l++){var P=g[l];if(P&&!P.match(w)){for(var M="",O=0,R=P.length;R>O;O++)M+=P.charCodeAt(O)>127?"x":P[O];if(!M.match(w)){var k=g.slice(0,l),I=g.slice(l+1),D=P.match(_);D&&(k.push(D[1]),I.unshift(D[2])),I.length&&(n="/"+I.join(".")+n),this.hostname=k.join(".");break}}}if(this.hostname.length>b?this.hostname="":this.hostname=this.hostname.toLowerCase(),!m){for(var L=this.hostname.split("."),F=[],l=0;l<L.length;++l){var B=L[l];F.push(B.match(/[^A-Za-z0-9_-]/)?"xn--"+p.encode(B):B)}this.hostname=F.join(".")}var N=this.port?":"+this.port:"",G=this.hostname||"";this.host=G+N,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==n[0]&&(n="/"+n))}if(!T[s])for(var l=0,C=y.length;C>l;l++){var q=y[l],z=encodeURIComponent(q);z===q&&(z=escape(q)),n=n.split(q).join(z)}var U=n.indexOf("#");-1!==U&&(this.hash=n.substr(U),n=n.slice(0,U));var j=n.indexOf("?");if(-1!==j?(this.search=n.substr(j),this.query=n.substr(j+1),e&&(this.query=A.parse(this.query)),n=n.slice(0,j)):e&&(this.search="",this.query={}),n&&(this.pathname=n),S[s]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var N=this.pathname||"",B=this.search||"";this.path=N+B}return this.href=this.format(),this},n.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",n=this.hash||"",r=!1,s="";this.host?r=t+this.host:this.hostname&&(r=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&l(this.query)&&Object.keys(this.query).length&&(s=A.stringify(this.query));var o=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||S[e])&&r!==!1?(r="//"+(r||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):r||(r=""),n&&"#"!==n.charAt(0)&&(n="#"+n),o&&"?"!==o.charAt(0)&&(o="?"+o),i=i.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),o=o.replace("#","%23"),e+r+i+o+n},n.prototype.resolve=function(t){return this.resolveObject(r(t,!1,!0)).format()},n.prototype.resolveObject=function(t){if(h(t)){var e=new n;e.parse(t,!1,!0),t=e}var i=new n;if(Object.keys(this).forEach(function(t){i[t]=this[t]},this),i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol)return Object.keys(t).forEach(function(e){"protocol"!==e&&(i[e]=t[e])}),S[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i;if(t.protocol&&t.protocol!==i.protocol){if(!S[t.protocol])return Object.keys(t).forEach(function(e){i[e]=t[e]}),i.href=i.format(),i;if(i.protocol=t.protocol,t.host||E[t.protocol])i.pathname=t.pathname;else{for(var r=(t.pathname||"").split("/");r.length&&!(t.host=r.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==r[0]&&r.unshift(""),r.length<2&&r.unshift(""),i.pathname=r.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var s=i.pathname||"",o=i.search||"";i.path=s+o}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var a=i.pathname&&"/"===i.pathname.charAt(0),l=t.host||t.pathname&&"/"===t.pathname.charAt(0),p=l||a||i.host&&t.pathname,d=p,f=i.pathname&&i.pathname.split("/")||[],r=t.pathname&&t.pathname.split("/")||[],m=i.protocol&&!S[i.protocol];if(m&&(i.hostname="",i.port=null,i.host&&(""===f[0]?f[0]=i.host:f.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===r[0]?r[0]=t.host:r.unshift(t.host)),t.host=null),p=p&&(""===r[0]||""===f[0])),l)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,f=r;else if(r.length)f||(f=[]),f.pop(),f=f.concat(r),i.search=t.search,i.query=t.query;else if(!c(t.search)){if(m){i.hostname=i.host=f.shift();var g=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;g&&(i.auth=g.shift(),i.host=i.hostname=g.shift())}return i.search=t.search,i.query=t.query,u(i.pathname)&&u(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!f.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var y=f.slice(-1)[0],v=(i.host||t.host)&&("."===y||".."===y)||""===y,x=0,b=f.length;b>=0;b--)y=f[b],"."==y?f.splice(b,1):".."===y?(f.splice(b,1),x++):x&&(f.splice(b,1),x--);if(!p&&!d)for(;x--;x)f.unshift("..");!p||""===f[0]||f[0]&&"/"===f[0].charAt(0)||f.unshift(""),v&&"/"!==f.join("/").substr(-1)&&f.push("");var w=""===f[0]||f[0]&&"/"===f[0].charAt(0);if(m){i.hostname=i.host=w?"":f.length?f.shift():"";var g=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;g&&(i.auth=g.shift(),i.host=i.hostname=g.shift())}return p=p||i.host&&f.length,p&&!w&&f.unshift(""),f.length?i.pathname=f.join("/"):(i.pathname=null,i.path=null),u(i.pathname)&&u(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},n.prototype.parseHost=function(){var t=this.host,e=f.exec(t);e&&(e=e[0],":"!==e&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{punycode:4,querystring:7}],9:[function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n=e&&e.length,s=n?e[0]*i:t.length,a=r(t,0,s,i,!0),h=[];if(!a)return h;var l,u,p,d,f,m,g;if(n&&(a=c(t,e,a,i)),t.length>80*i){l=p=t[0],u=d=t[1];for(var y=i;s>y;y+=i)f=t[y],m=t[y+1],l>f&&(l=f),u>m&&(u=m),f>p&&(p=f),m>d&&(d=m);g=Math.max(p-l,d-u)}return o(a,h,i,l,u,g),h}function r(t,e,i,n,r){var s,o,a,h=0;for(s=e,o=i-n;i>s;s+=n)h+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;if(r===h>0)for(s=e;i>s;s+=n)a=P(s,t[s],t[s+1],a);else for(s=i-n;s>=e;s-=n)a=P(s,t[s],t[s+1],a);return a}function s(t,e){if(!t)return t;e||(e=t);var i,n=t;do if(i=!1,n.steiner||!_(n,n.next)&&0!==w(n.prev,n,n.next))n=n.next;else{if(M(n),n=e=n.prev,n===n.next)return null;i=!0}while(i||n!==e);return e}function o(t,e,i,n,r,c,p){if(t){!p&&c&&m(t,n,r,c);for(var d,f,g=t;t.prev!==t.next;)if(d=t.prev,f=t.next,c?h(t,n,r,c):a(t))e.push(d.i/i),e.push(t.i/i),e.push(f.i/i),M(t),t=f.next,g=f.next;else if(t=f,t===g){p?1===p?(t=l(t,e,i),o(t,e,i,n,r,c,2)):2===p&&u(t,e,i,n,r,c):o(s(t),e,i,n,r,c,1);break}}}function a(t){var e=t.prev,i=t,n=t.next;if(w(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(x(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&w(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function h(t,e,i,n){var r=t.prev,s=t,o=t.next;if(w(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,h=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,l=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,c=y(a,h,e,i,n),p=y(l,u,e,i,n),d=t.nextZ;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&x(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&w(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&x(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&w(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function l(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;T(r,n,n.next,s)&&S(r,s)&&S(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),M(n),M(n.next),n=t=s),n=n.next}while(n!==t);return n}function u(t,e,i,n,r,a){var h=t;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&b(h,l)){var u=C(h,l);return h=s(h,h.next),u=s(u,u.next),o(h,e,i,n,r,a),void o(u,e,i,n,r,a)}l=l.next}h=h.next}while(h!==t)}function c(t,e,i,n){var o,a,h,l,u,c=[];for(o=0,a=e.length;a>o;o++)h=e[o]*n,l=a-1>o?e[o+1]*n:t.length,u=r(t,h,l,n,!1),u===u.next&&(u.steiner=!0),c.push(v(u));for(c.sort(p),o=0;o<c.length;o++)d(c[o],i),i=s(i,i.next);return i}function p(t,e){return t.x-e.x}function d(t,e){if(e=f(t,e)){var i=C(e,t);s(i,i.next)}}function f(t,e){var i,n=e,r=t.x,s=t.y,o=-(1/0);do{if(s<=n.y&&s>=n.next.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);r>=a&&a>o&&(o=a,i=n.x<n.next.x?n:n.next)}n=n.next}while(n!==e);if(!i)return null;var h,l=i,u=1/0;for(n=i.next;n!==l;)r>=n.x&&n.x>=i.x&&x(s<i.y?r:o,s,i.x,i.y,s<i.y?o:r,s,n.x,n.y)&&(h=Math.abs(s-n.y)/(r-n.x),(u>h||h===u&&n.x>i.x)&&S(n,t)&&(i=n,u=h)),
n=n.next;return i}function m(t,e,i,n){var r=t;do null===r.z&&(r.z=y(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,g(r)}function g(t){var e,i,n,r,s,o,a,h,l=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;l>e&&(a++,n=n.nextZ,n);e++);for(h=l;a>0||h>0&&n;)0===a?(r=n,n=n.nextZ,h--):0!==h&&n?i.z<=n.z?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,h--):(r=i,i=i.nextZ,a--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,l*=2}while(o>1);return t}function y(t,e,i,n,r){return t=32767*(t-i)/r,e=32767*(e-n)/r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function v(t){var e=t,i=t;do e.x<i.x&&(i=e),e=e.next;while(e!==t);return i}function x(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function b(t,e){return _(t,e)||t.next.i!==e.i&&t.prev.i!==e.i&&!E(t,e)&&S(t,e)&&S(e,t)&&A(t,e)}function w(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function T(t,e,i,n){return w(t,e,i)>0!=w(t,e,n)>0&&w(i,n,t)>0!=w(i,n,e)>0}function E(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&T(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function S(t,e){return w(t.prev,t,t.next)<0?w(t,e,t.next)>=0&&w(t,t.prev,e)>=0:w(t,e,t.prev)<0||w(t,t.next,e)<0}function A(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do i.y>s!=i.next.y>s&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==t);return n}function C(t,e){var i=new O(t.i,t.x,t.y),n=new O(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function P(t,e,i,n){var r=new O(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function M(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function O(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}e.exports=n},{}],10:[function(t,e,i){"use strict";function n(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(){}var s="function"!=typeof Object.create?"~":!1;r.prototype._events=void 0,r.prototype.listeners=function(t,e){var i=s?s+t:t,n=this._events&&this._events[i];if(e)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);o>r;r++)a[r]=n[r].fn;return a},r.prototype.emit=function(t,e,i,n,r,o){var a=s?s+t:t;if(!this._events||!this._events[a])return!1;var h,l,u=this._events[a],c=arguments.length;if("function"==typeof u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,n),!0;case 5:return u.fn.call(u.context,e,i,n,r),!0;case 6:return u.fn.call(u.context,e,i,n,r,o),!0}for(l=1,h=new Array(c-1);c>l;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var p,d=u.length;for(l=0;d>l;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,i);break;default:if(!h)for(p=1,h=new Array(c-1);c>p;p++)h[p-1]=arguments[p];u[l].fn.apply(u[l].context,h)}}return!0},r.prototype.on=function(t,e,i){var r=new n(e,i||this),o=s?s+t:t;return this._events||(this._events=s?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):this._events[o]=r,this},r.prototype.once=function(t,e,i){var r=new n(e,i||this,!0),o=s?s+t:t;return this._events||(this._events=s?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):this._events[o]=r,this},r.prototype.removeListener=function(t,e,i,n){var r=s?s+t:t;if(!this._events||!this._events[r])return this;var o=this._events[r],a=[];if(e)if(o.fn)(o.fn!==e||n&&!o.once||i&&o.context!==i)&&a.push(o);else for(var h=0,l=o.length;l>h;h++)(o[h].fn!==e||n&&!o[h].once||i&&o[h].context!==i)&&a.push(o[h]);return a.length?this._events[r]=1===a.length?a[0]:a:delete this._events[r],this},r.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[s?s+t:t]:this._events=s?{}:Object.create(null),this):this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.prefixed=s,"undefined"!=typeof e&&(e.exports=r)},{}],11:[function(t,e,i){"use strict";function n(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;e.exports=Object.assign||function(t,e){for(var i,o,a=n(t),h=1;h<arguments.length;h++){i=Object(arguments[h]);for(var l in i)r.call(i,l)&&(a[l]=i[l]);if(Object.getOwnPropertySymbols){o=Object.getOwnPropertySymbols(i);for(var u=0;u<o.length;u++)s.call(i,o[u])&&(a[o[u]]=i[o[u]])}}return a}},{}],12:[function(t,e,i){e.exports={name:"pixi.js",version:"3.0.9",description:"Pixi.js is a fast lightweight 2D library that works across all devices.",author:"Mat Groves",contributors:["Chad Engler <chad@pantherdev.com>","Richard Davey <rdavey@gmail.com>"],main:"./src/index.js",homepage:"http://goodboydigital.com/",bugs:"https://github.com/pixijs/pixi.js/issues",license:"MIT",repository:{type:"git",url:"https://github.com/pixijs/pixi.js.git"},scripts:{start:"gulp && gulp watch",test:"gulp && testem ci",build:"gulp",docs:"jsdoc -c ./gulp/util/jsdoc.conf.json -R README.md"},files:["bin/","src/","CONTRIBUTING.md","LICENSE","package.json","README.md"],dependencies:{async:"^1.5.0",brfs:"^1.4.1",earcut:"^2.0.7",eventemitter3:"^1.1.1","object-assign":"^4.0.1","resource-loader":"^1.6.4"},devDependencies:{browserify:"^11.1.0",chai:"^3.2.0",del:"^2.0.2",gulp:"^3.9.0","gulp-cached":"^1.1.0","gulp-concat":"^2.6.0","gulp-debug":"^2.1.0","gulp-header":"^1.7.1","gulp-jshint":"^1.11.2","gulp-mirror":"^0.4.0","gulp-plumber":"^1.0.1","gulp-rename":"^1.2.2","gulp-sourcemaps":"^1.5.2","gulp-uglify":"^1.4.1","gulp-util":"^3.0.6","jaguarjs-jsdoc":"git+https://github.com/davidshimjs/jaguarjs-jsdoc.git",jsdoc:"^3.3.2","jshint-summary":"^0.4.0",minimist:"^1.2.0",mocha:"^2.3.2","require-dir":"^0.3.0","run-sequence":"^1.1.2",testem:"^0.9.4","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.4.0"},browserify:{transform:["brfs"]}}},{}],13:[function(t,e,i){function n(t){var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.zIndex=2,this.div=e,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,window.addEventListener("keydown",this._onKeyDown,!1)}var r=t("../core");Object.assign(r.DisplayObject.prototype,t("./accessibleTarget")),n.prototype.constructor=n,e.exports=n,n.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode.appendChild(this.div))},n.prototype.deactivate=function(){this.isActive&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode.removeChild(this.div))},n.prototype.updateAccessibleObjects=function(t){if(t.visible){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,i=e.length-1;i>=0;i--)this.updateAccessibleObjects(e[i])}},n.prototype.update=function(){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),e=t.width/this.renderer.width,i=t.height/this.renderer.height,n=this.div;n.style.left=t.left+"px",n.style.top=t.top+"px",n.style.width=this.renderer.width+"px",n.style.height=this.renderer.height+"px";for(var s=0;s<this.children.length;s++){var o=this.children[s];if(o.renderId!==this.renderId)o._accessibleActive=!1,r.utils.removeItems(this.children,s,1),this.div.removeChild(o._accessibleDiv),this.pool.push(o._accessibleDiv),o._accessibleDiv=null,s--,0===this.children.length&&this.deactivate();else{n=o._accessibleDiv;var a=o.hitArea,h=o.worldTransform;o.hitArea?(n.style.left=(h.tx+a.x*h.a)*e+"px",n.style.top=(h.ty+a.y*h.d)*i+"px",n.style.width=a.width*h.a*e+"px",n.style.height=a.height*h.d*i+"px"):(a=o.getBounds(),this.capHitArea(a),n.style.left=a.x*e+"px",n.style.top=a.y*i+"px",n.style.width=a.width*e+"px",n.style.height=a.height*i+"px")}}this.renderId++},n.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},n.prototype.addChild=function(t){var e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2,e.style.borderStyle="none",e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.title=t.accessibleTitle||"displayObject "+this.tabIndex,t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},n.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData)},n.prototype._onFocus=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},n.prototype._onFocusOut=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},n.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},n.prototype._onMouseMove=function(){this.deactivate()},n.prototype.destroy=function(){this.div=null;for(var t=0;t<this.children.length;t++)this.children[t].div=null;window.document.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},r.WebGLRenderer.registerPlugin("accessibility",n),r.CanvasRenderer.registerPlugin("accessibility",n)},{"../core":23,"./accessibleTarget":14}],14:[function(t,e,i){var n={accessible:!1,accessibleTitle:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1};e.exports=n},{}],15:[function(t,e,i){e.exports={accessibleTarget:t("./accessibleTarget"),AccessibilityManager:t("./AccessibilityManager")}},{"./AccessibilityManager":13,"./accessibleTarget":14}],16:[function(t,e,i){var n={VERSION:t("../../package.json").version,PI_2:2*Math.PI,RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180,TARGET_FPMS:.06,RENDERER_TYPE:{UNKNOWN:0,WEBGL:1,CANVAS:2},BLEND_MODES:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},DRAW_MODES:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},SCALE_MODES:{DEFAULT:0,LINEAR:0,NEAREST:1},RETINA_PREFIX:/@(.+)x/,RESOLUTION:1,FILTER_RESOLUTION:1,DEFAULT_RENDER_OPTIONS:{view:null,resolution:1,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1},SHAPES:{POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},SPRITE_BATCH_SIZE:2e3};e.exports=n},{"../../package.json":12}],17:[function(t,e,i){function n(){o.call(this),this.children=[]}var r=t("../math"),s=t("../utils"),o=t("./DisplayObject"),a=t("../textures/RenderTexture"),h=new r.Matrix;n.prototype=Object.create(o.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{width:{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;0!==e?this.scale.x=t/e:this.scale.x=1,this._width=t}},height:{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;0!==e?this.scale.y=t/e:this.scale.y=1,this._height=t}}}),n.prototype.onChildrenChange=function(){},n.prototype.addChild=function(t){var e=arguments.length;if(e>1)for(var i=0;e>i;i++)this.addChild(arguments[i]);else t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),this.onChildrenChange(this.children.length-1),t.emit("added",this);return t},n.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this.onChildrenChange(e),t.emit("added",this),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},n.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),n=this.getChildIndex(e);if(0>i||0>n)throw new Error("swapChildren: Both the supplied DisplayObjects must be children of the caller.");this.children[i]=e,this.children[n]=t,this.onChildrenChange(n>i?i:n)}},n.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},n.prototype.setChildIndex=function(t,e){if(0>e||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);s.removeItems(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)},n.prototype.getChildAt=function(t){if(0>t||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject is not a child of the caller");return this.children[t]},n.prototype.removeChild=function(t){var e=arguments.length;if(e>1)for(var i=0;e>i;i++)this.removeChild(arguments[i]);else{var n=this.children.indexOf(t);if(-1===n)return;t.parent=null,s.removeItems(this.children,n,1),this.onChildrenChange(n),t.emit("removed",this)}return t},n.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,s.removeItems(this.children,t,1),this.onChildrenChange(t),e.emit("removed",this),e},n.prototype.removeChildren=function(t,e){var i,n,r=t||0,s="number"==typeof e?e:this.children.length,o=s-r;if(o>0&&s>=o){for(i=this.children.splice(r,o),n=0;n<i.length;++n)i[n].parent=null;for(this.onChildrenChange(t),n=0;n<i.length;++n)i[n].emit("removed",this);return i}if(0===o&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},n.prototype.generateTexture=function(t,e,i){var n=this.getLocalBounds(),r=new a(t,0|n.width,0|n.height,i,e);return h.tx=-n.x,h.ty=-n.y,r.render(this,h),r},n.prototype.updateTransform=function(){if(this.visible){this.displayObjectUpdateTransform();for(var t=0,e=this.children.length;e>t;++t)this.children[t].updateTransform()}},n.prototype.containerUpdateTransform=n.prototype.updateTransform,n.prototype.getBounds=function(){if(!this._currentBounds){if(0===this.children.length)return r.Rectangle.EMPTY;for(var t,e,i,n=1/0,s=1/0,o=-(1/0),a=-(1/0),h=!1,l=0,u=this.children.length;u>l;++l){var c=this.children[l];c.visible&&(h=!0,t=this.children[l].getBounds(),n=n<t.x?n:t.x,s=s<t.y?s:t.y,e=t.width+t.x,i=t.height+t.y,o=o>e?o:e,a=a>i?a:i)}if(!h)return r.Rectangle.EMPTY;var p=this._bounds;p.x=n,p.y=s,p.width=o-n,p.height=a-s,this._currentBounds=p}return this._currentBounds},n.prototype.containerGetBounds=n.prototype.getBounds,n.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=r.Matrix.IDENTITY;for(var e=0,i=this.children.length;i>e;++e)this.children[e].updateTransform();return this.worldTransform=t,this._currentBounds=null,this.getBounds(r.Matrix.IDENTITY)},n.prototype.renderWebGL=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){var e,i;if(this._mask||this._filters){for(t.currentRenderer.flush(),this._filters&&this._filters.length&&t.filterManager.pushFilter(this,this._filters),this._mask&&t.maskManager.pushMask(this,this._mask),t.currentRenderer.start(),this._renderWebGL(t),e=0,i=this.children.length;i>e;e++)this.children[e].renderWebGL(t);t.currentRenderer.flush(),this._mask&&t.maskManager.popMask(this,this._mask),this._filters&&t.filterManager.popFilter(),t.currentRenderer.start()}else for(this._renderWebGL(t),e=0,i=this.children.length;i>e;++e)this.children[e].renderWebGL(t)}},n.prototype._renderWebGL=function(t){},n.prototype._renderCanvas=function(t){},n.prototype.renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.renderable){this._mask&&t.maskManager.pushMask(this._mask,t),this._renderCanvas(t);for(var e=0,i=this.children.length;i>e;++e)this.children[e].renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},n.prototype.destroy=function(t){if(o.prototype.destroy.call(this),t)for(var e=0,i=this.children.length;i>e;++e)this.children[e].destroy(t);this.removeChildren(),this.children=null}},{"../math":26,"../textures/RenderTexture":64,"../utils":70,"./DisplayObject":18}],18:[function(t,e,i){function n(){o.call(this),this.position=new r.Point,this.scale=new r.Point(1,1),this.pivot=new r.Point(0,0),this.skew=new r.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this.worldTransform=new r.Matrix,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new r.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null}var r=t("../math"),s=t("../textures/RenderTexture"),o=t("eventemitter3"),a=t("../const"),h=new r.Matrix,l={worldTransform:new r.Matrix,worldAlpha:1,children:[]};n.prototype=Object.create(o.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},worldVisible:{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}},mask:{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.renderable=!0),this._mask=t,this._mask&&(this._mask.renderable=!1)}},filters:{get:function(){return this._filters&&this._filters.slice()},set:function(t){this._filters=t&&t.slice()}}}),n.prototype.updateTransform=function(){var t,e,i,n,r,s,o=this.parent.worldTransform,l=this.worldTransform;this.skew.x||this.skew.y?(h.setTransform(this.position.x,this.position.y,this.pivot.x,this.pivot.y,this.scale.x,this.scale.y,this.rotation,this.skew.x,this.skew.y),l.a=h.a*o.a+h.b*o.c,l.b=h.a*o.b+h.b*o.d,l.c=h.c*o.a+h.d*o.c,l.d=h.c*o.b+h.d*o.d,l.tx=h.tx*o.a+h.ty*o.c+o.tx,l.ty=h.tx*o.b+h.ty*o.d+o.ty):this.rotation%a.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),t=this._cr*this.scale.x,e=this._sr*this.scale.x,i=-this._sr*this.scale.y,n=this._cr*this.scale.y,r=this.position.x,s=this.position.y,(this.pivot.x||this.pivot.y)&&(r-=this.pivot.x*t+this.pivot.y*i,s-=this.pivot.x*e+this.pivot.y*n),l.a=t*o.a+e*o.c,l.b=t*o.b+e*o.d,l.c=i*o.a+n*o.c,l.d=i*o.b+n*o.d,l.tx=r*o.a+s*o.c+o.tx,l.ty=r*o.b+s*o.d+o.ty):(t=this.scale.x,n=this.scale.y,r=this.position.x-this.pivot.x*t,s=this.position.y-this.pivot.y*n,l.a=t*o.a,l.b=t*o.b,l.c=n*o.c,l.d=n*o.d,l.tx=r*o.a+s*o.c+o.tx,l.ty=r*o.b+s*o.d+o.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._currentBounds=null},n.prototype.displayObjectUpdateTransform=n.prototype.updateTransform,n.prototype.getBounds=function(t){return r.Rectangle.EMPTY},n.prototype.getLocalBounds=function(){return this.getBounds(r.Matrix.IDENTITY)},n.prototype.toGlobal=function(t){return this.parent?this.displayObjectUpdateTransform():(this.parent=l,this.displayObjectUpdateTransform(),this.parent=null),this.worldTransform.apply(t)},n.prototype.toLocal=function(t,e,i){return e&&(t=e.toGlobal(t)),this.parent?this.displayObjectUpdateTransform():(this.parent=l,this.displayObjectUpdateTransform(),this.parent=null),this.worldTransform.applyInverse(t,i)},n.prototype.renderWebGL=function(t){},n.prototype.renderCanvas=function(t){},n.prototype.generateTexture=function(t,e,i){var n=this.getLocalBounds(),r=new s(t,0|n.width,0|n.height,e,i);return h.tx=-n.x,h.ty=-n.y,r.render(this,h),r},n.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},n.prototype.setTransform=function(t,e,i,n,r,s,o,a,h){return this.position.x=t||0,this.position.y=e||0,this.scale.x=i?i:1,this.scale.y=n?n:1,this.rotation=r||0,this.skew.x=s||0,this.skew.y=o||0,this.pivot.x=a||0,this.pivot.y=h||0,this},n.prototype.destroy=function(){this.position=null,this.scale=null,this.pivot=null,this.skew=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.worldTransform=null,this.filterArea=null}},{"../const":16,"../math":26,"../textures/RenderTexture":64,eventemitter3:10}],19:[function(t,e,i){function n(){r.call(this),this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this._prevTint=16777215,this.blendMode=u.BLEND_MODES.NORMAL,this.currentPath=null,this._webGL={},this.isMask=!1,this.boundsPadding=0,this._localBounds=new l.Rectangle(0,0,1,1),this.dirty=!0,this.glDirty=!1,this.boundsDirty=!0,this.cachedSpriteDirty=!1}var r=t("../display/Container"),s=t("../textures/Texture"),o=t("../renderers/canvas/utils/CanvasBuffer"),a=t("../renderers/canvas/utils/CanvasGraphics"),h=t("./GraphicsData"),l=t("../math"),u=t("../const"),c=new l.Point;n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.clone=function(){var t=new n;t.renderable=this.renderable,t.fillAlpha=this.fillAlpha,t.lineWidth=this.lineWidth,t.lineColor=this.lineColor,t.tint=this.tint,t.blendMode=this.blendMode,t.isMask=this.isMask,t.boundsPadding=this.boundsPadding,t.dirty=!0,t.glDirty=!0,t.cachedSpriteDirty=this.cachedSpriteDirty;for(var e=0;e<this.graphicsData.length;++e)t.graphicsData.push(this.graphicsData[e].clone());return t.currentPath=t.graphicsData[t.graphicsData.length-1],t.updateLocalBounds(),t},n.prototype.lineStyle=function(t,e,i){if(this.lineWidth=t||0,this.lineColor=e||0,this.lineAlpha=void 0===i?1:i,this.currentPath)if(this.currentPath.shape.points.length){var n=new l.Polygon(this.currentPath.shape.points.slice(-2));n.closed=!1,this.drawShape(n)}else this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha;return this},n.prototype.moveTo=function(t,e){var i=new l.Polygon([t,e]);return i.closed=!1,this.drawShape(i),this},n.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty=!0,this},n.prototype.quadraticCurveTo=function(t,e,i,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var r,s,o=20,a=this.currentPath.shape.points;0===a.length&&this.moveTo(0,0);for(var h=a[a.length-2],l=a[a.length-1],u=0,c=1;o>=c;++c)u=c/o,r=h+(t-h)*u,s=l+(e-l)*u,a.push(r+(t+(i-t)*u-r)*u,s+(e+(n-e)*u-s)*u);return this.dirty=this.boundsDirty=!0,this},n.prototype.bezierCurveTo=function(t,e,i,n,r,s){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var o,a,h,l,u,c=20,p=this.currentPath.shape.points,d=p[p.length-2],f=p[p.length-1],m=0,g=1;c>=g;++g)m=g/c,o=1-m,a=o*o,h=a*o,l=m*m,u=l*m,p.push(h*d+3*a*m*t+3*o*l*i+u*r,h*f+3*a*m*e+3*o*l*n+u*s);return this.dirty=this.boundsDirty=!0,this},n.prototype.arcTo=function(t,e,i,n,r){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var s=this.currentPath.shape.points,o=s[s.length-2],a=s[s.length-1],h=a-e,l=o-t,u=n-e,c=i-t,p=Math.abs(h*c-l*u);if(1e-8>p||0===r)s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e);else{var d=h*h+l*l,f=u*u+c*c,m=h*u+l*c,g=r*Math.sqrt(d)/p,y=r*Math.sqrt(f)/p,v=g*m/d,x=y*m/f,b=g*c+y*l,w=g*u+y*h,_=l*(y+v),T=h*(y+v),E=c*(g+x),S=u*(g+x),A=Math.atan2(T-w,_-b),C=Math.atan2(S-w,E-b);this.arc(b+t,w+e,r,A,C,l*u>c*h)}return this.dirty=this.boundsDirty=!0,this},n.prototype.arc=function(t,e,i,n,r,s){if(s=s||!1,n===r)return this;!s&&n>=r?r+=2*Math.PI:s&&r>=n&&(n+=2*Math.PI);var o=s?-1*(n-r):r-n,a=40*Math.ceil(Math.abs(o)/(2*Math.PI));if(0===o)return this;var h=t+Math.cos(n)*i,l=e+Math.sin(n)*i;this.currentPath?this.currentPath.shape.points.push(h,l):this.moveTo(h,l);for(var u=this.currentPath.shape.points,c=o/(2*a),p=2*c,d=Math.cos(c),f=Math.sin(c),m=a-1,g=m%1/m,y=0;m>=y;y++){var v=y+g*y,x=c+n+p*v,b=Math.cos(x),w=-Math.sin(x);u.push((d*b+f*w)*i+t,(d*-w+f*b)*i+e)}return this.dirty=this.boundsDirty=!0,this},n.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},n.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},n.prototype.drawRect=function(t,e,i,n){return this.drawShape(new l.Rectangle(t,e,i,n)),this},n.prototype.drawRoundedRect=function(t,e,i,n,r){return this.drawShape(new l.RoundedRectangle(t,e,i,n,r)),this},n.prototype.drawCircle=function(t,e,i){return this.drawShape(new l.Circle(t,e,i)),this},n.prototype.drawEllipse=function(t,e,i,n){return this.drawShape(new l.Ellipse(t,e,i,n)),this},n.prototype.drawPolygon=function(t){var e=t,i=!0;if(e instanceof l.Polygon&&(i=e.closed,e=e.points),!Array.isArray(e)){e=new Array(arguments.length);for(var n=0;n<e.length;++n)e[n]=arguments[n]}var r=new l.Polygon(e);return r.closed=i,this.drawShape(r),this},n.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},n.prototype.generateTexture=function(t,e,i){e=e||1;var n=this.getLocalBounds(),r=new o(n.width*e,n.height*e),h=s.fromCanvas(r.canvas,i);return h.baseTexture.resolution=e,r.context.scale(e,e),r.context.translate(-n.x,-n.y),a.renderGraphics(this,r.context),h},n.prototype._renderWebGL=function(t){this.glDirty&&(this.dirty=!0,this.glDirty=!1),t.setObjectRenderer(t.plugins.graphics),t.plugins.graphics.render(this)},n.prototype._renderCanvas=function(t){if(this.isMask!==!0){this._prevTint!==this.tint&&(this.dirty=!0);var e=t.context,i=this.worldTransform,n=t.blendModes[this.blendMode];n!==e.globalCompositeOperation&&(e.globalCompositeOperation=n);var r=t.resolution;e.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,i.tx*r,i.ty*r),a.renderGraphics(this,e)}},n.prototype.getBounds=function(t){if(!this._currentBounds){if(!this.renderable)return l.Rectangle.EMPTY;this.boundsDirty&&(this.updateLocalBounds(),this.glDirty=!0,this.cachedSpriteDirty=!0,this.boundsDirty=!1);var e=this._localBounds,i=e.x,n=e.width+e.x,r=e.y,s=e.height+e.y,o=t||this.worldTransform,a=o.a,h=o.b,u=o.c,c=o.d,p=o.tx,d=o.ty,f=a*n+u*s+p,m=c*s+h*n+d,g=a*i+u*s+p,y=c*s+h*i+d,v=a*i+u*r+p,x=c*r+h*i+d,b=a*n+u*r+p,w=c*r+h*n+d,_=f,T=m,E=f,S=m;E=E>g?g:E,E=E>v?v:E,E=E>b?b:E,S=S>y?y:S,S=S>x?x:S,S=S>w?w:S,_=g>_?g:_,_=v>_?v:_,_=b>_?b:_,T=y>T?y:T,T=x>T?x:T,T=w>T?w:T,this._bounds.x=E,this._bounds.width=_-E,this._bounds.y=S,this._bounds.height=T-S,this._currentBounds=this._bounds}return this._currentBounds},n.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,c);for(var e=this.graphicsData,i=0;i<e.length;i++){var n=e[i];if(n.fill&&n.shape&&n.shape.contains(c.x,c.y))return!0}return!1},n.prototype.updateLocalBounds=function(){var t=1/0,e=-(1/0),i=1/0,n=-(1/0);if(this.graphicsData.length)for(var r,s,o,a,h,l,c=0;c<this.graphicsData.length;c++){var p=this.graphicsData[c],d=p.type,f=p.lineWidth;if(r=p.shape,d===u.SHAPES.RECT||d===u.SHAPES.RREC)o=r.x-f/2,a=r.y-f/2,h=r.width+f,l=r.height+f,t=t>o?o:t,e=o+h>e?o+h:e,i=i>a?a:i,n=a+l>n?a+l:n;else if(d===u.SHAPES.CIRC)o=r.x,a=r.y,h=r.radius+f/2,l=r.radius+f/2,t=t>o-h?o-h:t,e=o+h>e?o+h:e,i=i>a-l?a-l:i,n=a+l>n?a+l:n;else if(d===u.SHAPES.ELIP)o=r.x,a=r.y,h=r.width+f/2,l=r.height+f/2,t=t>o-h?o-h:t,e=o+h>e?o+h:e,i=i>a-l?a-l:i,n=a+l>n?a+l:n;else{s=r.points;for(var m=0;m<s.length;m+=2)o=s[m],a=s[m+1],t=t>o-f?o-f:t,e=o+f>e?o+f:e,i=i>a-f?a-f:i,n=a+f>n?a+f:n}}else t=0,e=0,i=0,n=0;var g=this.boundsPadding;this._localBounds.x=t-g,this._localBounds.width=e-t+2*g,this._localBounds.y=i-g,this._localBounds.height=n-i+2*g},n.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var e=new h(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(e),e.type===u.SHAPES.POLY&&(e.shape.closed=e.shape.closed||this.filling,this.currentPath=e),this.dirty=this.boundsDirty=!0,e},n.prototype.destroy=function(){r.prototype.destroy.apply(this,arguments);for(var t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();for(var e in this._webgl)for(var i=0;i<this._webgl[e].data.length;++i)this._webgl[e].data[i].destroy();this.graphicsData=null,this.currentPath=null,this._webgl=null,this._localBounds=null}},{"../const":16,"../display/Container":17,"../math":26,"../renderers/canvas/utils/CanvasBuffer":38,"../renderers/canvas/utils/CanvasGraphics":39,"../textures/Texture":65,"./GraphicsData":20}],20:[function(t,e,i){function n(t,e,i,n,r,s,o){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this._lineTint=e,this.fillColor=n,this.fillAlpha=r,this._fillTint=n,this.fill=s,this.shape=o,this.type=o.type}n.prototype.constructor=n,e.exports=n,n.prototype.clone=function(){return new n(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},n.prototype.destroy=function(){this.shape=null}},{}],21:[function(t,e,i){function n(t){a.call(this,t),this.graphicsDataPool=[],this.primitiveShader=null,this.complexPrimitiveShader=null,this.maximumSimplePolySize=200}var r=t("../../utils"),s=t("../../math"),o=t("../../const"),a=t("../../renderers/webgl/utils/ObjectRenderer"),h=t("../../renderers/webgl/WebGLRenderer"),l=t("./WebGLGraphicsData"),u=t("earcut");n.prototype=Object.create(a.prototype),n.prototype.constructor=n,e.exports=n,h.registerPlugin("graphics",n),n.prototype.onContextChange=function(){},n.prototype.destroy=function(){a.prototype.destroy.call(this);for(var t=0;t<this.graphicsDataPool.length;++t)this.graphicsDataPool[t].destroy();this.graphicsDataPool=null},n.prototype.render=function(t){var e,i=this.renderer,n=i.gl,s=i.shaderManager.plugins.primitiveShader;!t.dirty&&t._webGL[n.id]||this.updateGraphics(t);var o=t._webGL[n.id];i.blendModeManager.setBlendMode(t.blendMode);for(var a=0,h=o.data.length;h>a;a++)e=o.data[a],1===o.data[a].mode?(i.stencilManager.pushStencil(t,e),n.uniform1f(i.shaderManager.complexPrimitiveShader.uniforms.alpha._location,t.worldAlpha*e.alpha),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),i.stencilManager.popStencil(t,e)):(s=i.shaderManager.primitiveShader,i.shaderManager.setShader(s),n.uniformMatrix3fv(s.uniforms.translationMatrix._location,!1,t.worldTransform.toArray(!0)),n.uniformMatrix3fv(s.uniforms.projectionMatrix._location,!1,i.currentRenderTarget.projectionMatrix.toArray(!0)),n.uniform3fv(s.uniforms.tint._location,r.hex2rgb(t.tint)),n.uniform1f(s.uniforms.alpha._location,t.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,e.buffer),n.vertexAttribPointer(s.attributes.aVertexPosition,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(s.attributes.aColor,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.indexBuffer),
n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0)),i.drawCount++},n.prototype.updateGraphics=function(t){var e=this.renderer.gl,i=t._webGL[e.id];i||(i=t._webGL[e.id]={lastIndex:0,data:[],gl:e}),t.dirty=!1;var n;if(t.clearDirty){for(t.clearDirty=!1,n=0;n<i.data.length;n++){var r=i.data[n];r.reset(),this.graphicsDataPool.push(r)}i.data=[],i.lastIndex=0}var s;for(n=i.lastIndex;n<t.graphicsData.length;n++){var a=t.graphicsData[n];if(a.type===o.SHAPES.POLY){if(a.points=a.shape.points.slice(),a.shape.closed&&(a.points[0]===a.points[a.points.length-2]&&a.points[1]===a.points[a.points.length-1]||a.points.push(a.points[0],a.points[1])),a.fill&&a.points.length>=6)if(a.points.length<2*this.maximumSimplePolySize){s=this.switchMode(i,0);var h=this.buildPoly(a,s);h||(s=this.switchMode(i,1),this.buildComplexPoly(a,s))}else s=this.switchMode(i,1),this.buildComplexPoly(a,s);a.lineWidth>0&&(s=this.switchMode(i,0),this.buildLine(a,s))}else s=this.switchMode(i,0),a.type===o.SHAPES.RECT?this.buildRectangle(a,s):a.type===o.SHAPES.CIRC||a.type===o.SHAPES.ELIP?this.buildCircle(a,s):a.type===o.SHAPES.RREC&&this.buildRoundedRectangle(a,s);i.lastIndex++}for(n=0;n<i.data.length;n++)s=i.data[n],s.dirty&&s.upload()},n.prototype.switchMode=function(t,e){var i;return t.data.length?(i=t.data[t.data.length-1],(i.points.length>32e4||i.mode!==e||1===e)&&(i=this.graphicsDataPool.pop()||new l(t.gl),i.mode=e,t.data.push(i))):(i=this.graphicsDataPool.pop()||new l(t.gl),i.mode=e,t.data.push(i)),i.dirty=!0,i},n.prototype.buildRectangle=function(t,e){var i=t.shape,n=i.x,s=i.y,o=i.width,a=i.height;if(t.fill){var h=r.hex2rgb(t.fillColor),l=t.fillAlpha,u=h[0]*l,c=h[1]*l,p=h[2]*l,d=e.points,f=e.indices,m=d.length/6;d.push(n,s),d.push(u,c,p,l),d.push(n+o,s),d.push(u,c,p,l),d.push(n,s+a),d.push(u,c,p,l),d.push(n+o,s+a),d.push(u,c,p,l),f.push(m,m,m+1,m+2,m+3,m+3)}if(t.lineWidth){var g=t.points;t.points=[n,s,n+o,s,n+o,s+a,n,s+a,n,s],this.buildLine(t,e),t.points=g}},n.prototype.buildRoundedRectangle=function(t,e){var i=t.shape,n=i.x,s=i.y,o=i.width,a=i.height,h=i.radius,l=[];if(l.push(n,s+h),this.quadraticBezierCurve(n,s+a-h,n,s+a,n+h,s+a,l),this.quadraticBezierCurve(n+o-h,s+a,n+o,s+a,n+o,s+a-h,l),this.quadraticBezierCurve(n+o,s+h,n+o,s,n+o-h,s,l),this.quadraticBezierCurve(n+h,s,n,s,n,s+h+1e-10,l),t.fill){var c=r.hex2rgb(t.fillColor),p=t.fillAlpha,d=c[0]*p,f=c[1]*p,m=c[2]*p,g=e.points,y=e.indices,v=g.length/6,x=u(l,null,2),b=0;for(b=0;b<x.length;b+=3)y.push(x[b]+v),y.push(x[b]+v),y.push(x[b+1]+v),y.push(x[b+2]+v),y.push(x[b+2]+v);for(b=0;b<l.length;b++)g.push(l[b],l[++b],d,f,m,p)}if(t.lineWidth){var w=t.points;t.points=l,this.buildLine(t,e),t.points=w}},n.prototype.quadraticBezierCurve=function(t,e,i,n,r,s,o){function a(t,e,i){var n=e-t;return t+n*i}for(var h,l,u,c,p,d,f=20,m=o||[],g=0,y=0;f>=y;y++)g=y/f,h=a(t,i,g),l=a(e,n,g),u=a(i,r,g),c=a(n,s,g),p=a(h,u,g),d=a(l,c,g),m.push(p,d);return m},n.prototype.buildCircle=function(t,e){var i,n,s=t.shape,a=s.x,h=s.y;t.type===o.SHAPES.CIRC?(i=s.radius,n=s.radius):(i=s.width,n=s.height);var l=Math.floor(30*Math.sqrt(s.radius))||Math.floor(15*Math.sqrt(s.width+s.height)),u=2*Math.PI/l,c=0;if(t.fill){var p=r.hex2rgb(t.fillColor),d=t.fillAlpha,f=p[0]*d,m=p[1]*d,g=p[2]*d,y=e.points,v=e.indices,x=y.length/6;for(v.push(x),c=0;l+1>c;c++)y.push(a,h,f,m,g,d),y.push(a+Math.sin(u*c)*i,h+Math.cos(u*c)*n,f,m,g,d),v.push(x++,x++);v.push(x-1)}if(t.lineWidth){var b=t.points;for(t.points=[],c=0;l+1>c;c++)t.points.push(a+Math.sin(u*c)*i,h+Math.cos(u*c)*n);this.buildLine(t,e),t.points=b}},n.prototype.buildLine=function(t,e){var i=0,n=t.points;if(0!==n.length){var o=new s.Point(n[0],n[1]),a=new s.Point(n[n.length-2],n[n.length-1]);if(o.x===a.x&&o.y===a.y){n=n.slice(),n.pop(),n.pop(),a=new s.Point(n[n.length-2],n[n.length-1]);var h=a.x+.5*(o.x-a.x),l=a.y+.5*(o.y-a.y);n.unshift(h,l),n.push(h,l)}var u,c,p,d,f,m,g,y,v,x,b,w,_,T,E,S,A,C,P,M,O,R,k,I=e.points,D=e.indices,L=n.length/2,F=n.length,B=I.length/6,N=t.lineWidth/2,G=r.hex2rgb(t.lineColor),q=t.lineAlpha,z=G[0]*q,U=G[1]*q,j=G[2]*q;for(p=n[0],d=n[1],f=n[2],m=n[3],v=-(d-m),x=p-f,k=Math.sqrt(v*v+x*x),v/=k,x/=k,v*=N,x*=N,I.push(p-v,d-x,z,U,j,q),I.push(p+v,d+x,z,U,j,q),i=1;L-1>i;i++)p=n[2*(i-1)],d=n[2*(i-1)+1],f=n[2*i],m=n[2*i+1],g=n[2*(i+1)],y=n[2*(i+1)+1],v=-(d-m),x=p-f,k=Math.sqrt(v*v+x*x),v/=k,x/=k,v*=N,x*=N,b=-(m-y),w=f-g,k=Math.sqrt(b*b+w*w),b/=k,w/=k,b*=N,w*=N,E=-x+d-(-x+m),S=-v+f-(-v+p),A=(-v+p)*(-x+m)-(-v+f)*(-x+d),C=-w+y-(-w+m),P=-b+f-(-b+g),M=(-b+g)*(-w+m)-(-b+f)*(-w+y),O=E*P-C*S,Math.abs(O)<.1?(O+=10.1,I.push(f-v,m-x,z,U,j,q),I.push(f+v,m+x,z,U,j,q)):(u=(S*M-P*A)/O,c=(C*A-E*M)/O,R=(u-f)*(u-f)+(c-m)*(c-m),R>19600?(_=v-b,T=x-w,k=Math.sqrt(_*_+T*T),_/=k,T/=k,_*=N,T*=N,I.push(f-_,m-T),I.push(z,U,j,q),I.push(f+_,m+T),I.push(z,U,j,q),I.push(f-_,m-T),I.push(z,U,j,q),F++):(I.push(u,c),I.push(z,U,j,q),I.push(f-(u-f),m-(c-m)),I.push(z,U,j,q)));for(p=n[2*(L-2)],d=n[2*(L-2)+1],f=n[2*(L-1)],m=n[2*(L-1)+1],v=-(d-m),x=p-f,k=Math.sqrt(v*v+x*x),v/=k,x/=k,v*=N,x*=N,I.push(f-v,m-x),I.push(z,U,j,q),I.push(f+v,m+x),I.push(z,U,j,q),D.push(B),i=0;F>i;i++)D.push(B++);D.push(B-1)}},n.prototype.buildComplexPoly=function(t,e){var i=t.points.slice();if(!(i.length<6)){var n=e.indices;e.points=i,e.alpha=t.fillAlpha,e.color=r.hex2rgb(t.fillColor);for(var s,o,a=1/0,h=-(1/0),l=1/0,u=-(1/0),c=0;c<i.length;c+=2)s=i[c],o=i[c+1],a=a>s?s:a,h=s>h?s:h,l=l>o?o:l,u=o>u?o:u;i.push(a,l,h,l,h,u,a,u);var p=i.length/2;for(c=0;p>c;c++)n.push(c)}},n.prototype.buildPoly=function(t,e){var i=t.points;if(!(i.length<6)){var n=e.points,s=e.indices,o=i.length/2,a=r.hex2rgb(t.fillColor),h=t.fillAlpha,l=a[0]*h,c=a[1]*h,p=a[2]*h,d=u(i,null,2);if(!d)return!1;var f=n.length/6,m=0;for(m=0;m<d.length;m+=3)s.push(d[m]+f),s.push(d[m]+f),s.push(d[m+1]+f),s.push(d[m+2]+f),s.push(d[m+2]+f);for(m=0;o>m;m++)n.push(i[2*m],i[2*m+1],l,c,p,h);return!0}}},{"../../const":16,"../../math":26,"../../renderers/webgl/WebGLRenderer":42,"../../renderers/webgl/utils/ObjectRenderer":56,"../../utils":70,"./WebGLGraphicsData":22,earcut:9}],22:[function(t,e,i){function n(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0,this.glPoints=null,this.glIndices=null}n.prototype.constructor=n,e.exports=n,n.prototype.reset=function(){this.points.length=0,this.indices.length=0},n.prototype.upload=function(){var t=this.gl;this.glPoints=new Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndices=new Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndices,t.STATIC_DRAW),this.dirty=!1},n.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.gl.deleteBuffer(this.buffer),this.gl.deleteBuffer(this.indexBuffer),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null}},{}],23:[function(t,e,i){var n=e.exports=Object.assign(t("./const"),t("./math"),{utils:t("./utils"),ticker:t("./ticker"),DisplayObject:t("./display/DisplayObject"),Container:t("./display/Container"),Sprite:t("./sprites/Sprite"),ParticleContainer:t("./particles/ParticleContainer"),SpriteRenderer:t("./sprites/webgl/SpriteRenderer"),ParticleRenderer:t("./particles/webgl/ParticleRenderer"),Text:t("./text/Text"),Graphics:t("./graphics/Graphics"),GraphicsData:t("./graphics/GraphicsData"),GraphicsRenderer:t("./graphics/webgl/GraphicsRenderer"),Texture:t("./textures/Texture"),BaseTexture:t("./textures/BaseTexture"),RenderTexture:t("./textures/RenderTexture"),VideoBaseTexture:t("./textures/VideoBaseTexture"),TextureUvs:t("./textures/TextureUvs"),CanvasRenderer:t("./renderers/canvas/CanvasRenderer"),CanvasGraphics:t("./renderers/canvas/utils/CanvasGraphics"),CanvasBuffer:t("./renderers/canvas/utils/CanvasBuffer"),CanvasTinter:t("./renderers/canvas/utils/CanvasTinter"),WebGLRenderer:t("./renderers/webgl/WebGLRenderer"),WebGLManager:t("./renderers/webgl/managers/WebGLManager"),ShaderManager:t("./renderers/webgl/managers/ShaderManager"),Shader:t("./renderers/webgl/shaders/Shader"),ObjectRenderer:t("./renderers/webgl/utils/ObjectRenderer"),RenderTarget:t("./renderers/webgl/utils/RenderTarget"),AbstractFilter:t("./renderers/webgl/filters/AbstractFilter"),FXAAFilter:t("./renderers/webgl/filters/FXAAFilter"),SpriteMaskFilter:t("./renderers/webgl/filters/SpriteMaskFilter"),autoDetectRenderer:function(t,e,i,r){return t=t||800,e=e||600,!r&&n.utils.isWebGLSupported()?new n.WebGLRenderer(t,e,i):new n.CanvasRenderer(t,e,i)}})},{"./const":16,"./display/Container":17,"./display/DisplayObject":18,"./graphics/Graphics":19,"./graphics/GraphicsData":20,"./graphics/webgl/GraphicsRenderer":21,"./math":26,"./particles/ParticleContainer":32,"./particles/webgl/ParticleRenderer":34,"./renderers/canvas/CanvasRenderer":37,"./renderers/canvas/utils/CanvasBuffer":38,"./renderers/canvas/utils/CanvasGraphics":39,"./renderers/canvas/utils/CanvasTinter":41,"./renderers/webgl/WebGLRenderer":42,"./renderers/webgl/filters/AbstractFilter":43,"./renderers/webgl/filters/FXAAFilter":44,"./renderers/webgl/filters/SpriteMaskFilter":45,"./renderers/webgl/managers/ShaderManager":49,"./renderers/webgl/managers/WebGLManager":51,"./renderers/webgl/shaders/Shader":54,"./renderers/webgl/utils/ObjectRenderer":56,"./renderers/webgl/utils/RenderTarget":58,"./sprites/Sprite":60,"./sprites/webgl/SpriteRenderer":61,"./text/Text":62,"./textures/BaseTexture":63,"./textures/RenderTexture":64,"./textures/Texture":65,"./textures/TextureUvs":66,"./textures/VideoBaseTexture":67,"./ticker":69,"./utils":70}],24:[function(t,e,i){function n(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}var r=t("./Point");n.prototype.constructor=n,e.exports=n,n.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},n.prototype.set=function(t,e,i,n,r,s){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this},n.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},n.prototype.apply=function(t,e){e=e||new r;var i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e},n.prototype.applyInverse=function(t,e){e=e||new r;var i=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e},n.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},n.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},n.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,s=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=s*e-this.ty*i,this.ty=s*i+this.ty*e,this},n.prototype.append=function(t){var e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},n.prototype.setTransform=function(t,e,i,n,r,s,o,a,h){var l,u,c,p,d,f,m,g,y,v;return d=Math.sin(o),f=Math.cos(o),m=Math.cos(h),g=Math.sin(h),y=-Math.sin(a),v=Math.cos(a),l=f*r,u=d*r,c=-d*s,p=f*s,this.a=m*l+g*c,this.b=m*u+g*p,this.c=y*l+v*c,this.d=y*u+v*p,this.tx=t+(i*l+n*c),this.ty=e+(i*u+n*p),this},n.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},n.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,s=t*n-e*i;return this.a=n/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-n*r)/s,this.ty=-(t*this.ty-e*r)/s,this},n.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},n.prototype.clone=function(){var t=new n;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},n.prototype.copy=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},n.IDENTITY=new n,n.TEMP_MATRIX=new n},{"./Point":25}],25:[function(t,e,i){function n(t,e){this.x=t||0,this.y=e||0}n.prototype.constructor=n,e.exports=n,n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.copy=function(t){this.set(t.x,t.y)},n.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},n.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)}},{}],26:[function(t,e,i){e.exports={Point:t("./Point"),Matrix:t("./Matrix"),Circle:t("./shapes/Circle"),Ellipse:t("./shapes/Ellipse"),Polygon:t("./shapes/Polygon"),Rectangle:t("./shapes/Rectangle"),RoundedRectangle:t("./shapes/RoundedRectangle")}},{"./Matrix":24,"./Point":25,"./shapes/Circle":27,"./shapes/Ellipse":28,"./shapes/Polygon":29,"./shapes/Rectangle":30,"./shapes/RoundedRectangle":31}],27:[function(t,e,i){function n(t,e,i){this.x=t||0,this.y=e||0,this.radius=i||0,this.type=s.SHAPES.CIRC}var r=t("./Rectangle"),s=t("../../const");n.prototype.constructor=n,e.exports=n,n.prototype.clone=function(){return new n(this.x,this.y,this.radius)},n.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.x-t,n=this.y-e,r=this.radius*this.radius;return i*=i,n*=n,r>=i+n},n.prototype.getBounds=function(){return new r(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}},{"../../const":16,"./Rectangle":30}],28:[function(t,e,i){function n(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this.type=s.SHAPES.ELIP}var r=t("./Rectangle"),s=t("../../const");n.prototype.constructor=n,e.exports=n,n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)},n.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,n=(e-this.y)/this.height;return i*=i,n*=n,1>=i+n},n.prototype.getBounds=function(){return new r(this.x-this.width,this.y-this.height,this.width,this.height)}},{"../../const":16,"./Rectangle":30}],29:[function(t,e,i){function n(t){var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var i=0;i<e.length;++i)e[i]=arguments[i]}if(e[0]instanceof r){for(var n=[],o=0,a=e.length;a>o;o++)n.push(e[o].x,e[o].y);e=n}this.closed=!0,this.points=e,this.type=s.SHAPES.POLY}var r=t("../Point"),s=t("../../const");n.prototype.constructor=n,e.exports=n,n.prototype.clone=function(){return new n(this.points.slice())},n.prototype.contains=function(t,e){for(var i=!1,n=this.points.length/2,r=0,s=n-1;n>r;s=r++){var o=this.points[2*r],a=this.points[2*r+1],h=this.points[2*s],l=this.points[2*s+1],u=a>e!=l>e&&(h-o)*(e-a)/(l-a)+o>t;u&&(i=!i)}return i}},{"../../const":16,"../Point":25}],30:[function(t,e,i){function n(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this.type=r.SHAPES.RECT}var r=t("../../const");n.prototype.constructor=n,e.exports=n,n.EMPTY=new n(0,0,0,0),n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)},n.prototype.contains=function(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}},{"../../const":16}],31:[function(t,e,i){function n(t,e,i,n,s){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this.radius=s||20,this.type=r.SHAPES.RREC}var r=t("../../const");n.prototype.constructor=n,e.exports=n,n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height,this.radius)},n.prototype.contains=function(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height}},{"../../const":16}],32:[function(t,e,i){function n(t,e,i){r.call(this),i=i||15e3,t=t||15e3;var n=16384;i>n&&(i=n),i>t&&(i=t),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=i,this._buffers=null,this._bufferToUpdate=0,this.interactiveChildren=!1,this.blendMode=s.BLEND_MODES.NORMAL,this.roundPixels=!0,this.setProperties(e)}var r=t("../display/Container"),s=t("../const");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.setProperties=function(t){t&&(this._properties[0]="scale"in t?!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="alpha"in t?!!t.alpha:this._properties[4])},n.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},n.prototype.renderWebGL=function(t){this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(t.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},n.prototype.onChildrenChange=function(t){var e=Math.floor(t/this._batchSize);e<this._bufferToUpdate&&(this._bufferToUpdate=e)},n.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var e=t.context,i=this.worldTransform,n=!0,r=0,s=0,o=0,a=0,h=t.blendModes[this.blendMode];h!==e.globalCompositeOperation&&(e.globalCompositeOperation=h),e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var l=0;l<this.children.length;++l){var u=this.children[l];if(u.visible){var c=u.texture.frame;if(e.globalAlpha=this.worldAlpha*u.alpha,u.rotation%(2*Math.PI)===0)n&&(e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),n=!1),r=u.anchor.x*(-c.width*u.scale.x)+u.position.x+.5,s=u.anchor.y*(-c.height*u.scale.y)+u.position.y+.5,o=c.width*u.scale.x,a=c.height*u.scale.y;else{n||(n=!0),u.displayObjectUpdateTransform();var p=u.worldTransform;t.roundPixels?e.setTransform(p.a,p.b,p.c,p.d,0|p.tx,0|p.ty):e.setTransform(p.a,p.b,p.c,p.d,p.tx,p.ty),r=u.anchor.x*-c.width+.5,s=u.anchor.y*-c.height+.5,o=c.width,a=c.height}e.drawImage(u.texture.baseTexture.source,c.x,c.y,c.width,c.height,r,s,o,a)}}}},n.prototype.destroy=function(){if(r.prototype.destroy.apply(this,arguments),this._buffers)for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._properties=null,this._buffers=null}},{"../const":16,"../display/Container":17}],33:[function(t,e,i){function n(t,e,i,n){this.gl=t,this.vertSize=2,this.vertByteSize=4*this.vertSize,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(var r=0;r<e.length;r++){var s=e[r];i[r]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.initBuffers()}n.prototype.constructor=n,e.exports=n,n.prototype.initBuffers=function(){var t,e,i=this.gl,n=0;for(this.dynamicStride=0,t=0;t<this.dynamicProperties.length;t++)e=this.dynamicProperties[t],e.offset=n,n+=e.size,this.dynamicStride+=e.size;this.dynamicData=new Float32Array(this.size*this.dynamicStride*4),this.dynamicBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.dynamicBuffer),i.bufferData(i.ARRAY_BUFFER,this.dynamicData,i.DYNAMIC_DRAW);var r=0;for(this.staticStride=0,t=0;t<this.staticProperties.length;t++)e=this.staticProperties[t],e.offset=r,r+=e.size,this.staticStride+=e.size;this.staticData=new Float32Array(this.size*this.staticStride*4),this.staticBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.staticBuffer),i.bufferData(i.ARRAY_BUFFER,this.staticData,i.DYNAMIC_DRAW)},n.prototype.uploadDynamic=function(t,e,i){for(var n=this.gl,r=0;r<this.dynamicProperties.length;r++){var s=this.dynamicProperties[r];s.uploadFunction(t,e,i,this.dynamicData,this.dynamicStride,s.offset)}n.bindBuffer(n.ARRAY_BUFFER,this.dynamicBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.dynamicData)},n.prototype.uploadStatic=function(t,e,i){for(var n=this.gl,r=0;r<this.staticProperties.length;r++){var s=this.staticProperties[r];s.uploadFunction(t,e,i,this.staticData,this.staticStride,s.offset)}n.bindBuffer(n.ARRAY_BUFFER,this.staticBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.staticData)},n.prototype.bind=function(){var t,e,i=this.gl;for(i.bindBuffer(i.ARRAY_BUFFER,this.dynamicBuffer),t=0;t<this.dynamicProperties.length;t++)e=this.dynamicProperties[t],i.vertexAttribPointer(e.attribute,e.size,i.FLOAT,!1,4*this.dynamicStride,4*e.offset);for(i.bindBuffer(i.ARRAY_BUFFER,this.staticBuffer),t=0;t<this.staticProperties.length;t++)e=this.staticProperties[t],i.vertexAttribPointer(e.attribute,e.size,i.FLOAT,!1,4*this.staticStride,4*e.offset)},n.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicData=null,this.gl.deleteBuffer(this.dynamicBuffer),this.staticProperties=null,this.staticData=null,this.gl.deleteBuffer(this.staticBuffer)}},{}],34:[function(t,e,i){function n(t){r.call(this,t);var e=98304;this.indices=new Uint16Array(e);for(var i=0,n=0;e>i;i+=6,n+=4)this.indices[i+0]=n+0,this.indices[i+1]=n+1,this.indices[i+2]=n+2,this.indices[i+3]=n+0,this.indices[i+4]=n+2,this.indices[i+5]=n+3;this.shader=null,this.indexBuffer=null,this.properties=null,this.tempMatrix=new h.Matrix}var r=t("../../renderers/webgl/utils/ObjectRenderer"),s=t("../../renderers/webgl/WebGLRenderer"),o=t("./ParticleShader"),a=t("./ParticleBuffer"),h=t("../../math");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,s.registerPlugin("particle",n),n.prototype.onContextChange=function(){var t=this.renderer.gl;this.shader=new o(this.renderer.shaderManager),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,uploadFunction:this.uploadAlpha,offset:0}]},n.prototype.start=function(){var t=this.renderer.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.shader;this.renderer.shaderManager.setShader(e)},n.prototype.render=function(t){var e=t.children,i=e.length,n=t._maxSize,r=t._batchSize;if(0!==i){i>n&&(i=n),t._buffers||(t._buffers=this.generateBuffers(t)),this.renderer.blendModeManager.setBlendMode(t.blendMode);var s=this.renderer.gl,o=t.worldTransform.copy(this.tempMatrix);o.prepend(this.renderer.currentRenderTarget.projectionMatrix),s.uniformMatrix3fv(this.shader.uniforms.projectionMatrix._location,!1,o.toArray(!0)),s.uniform1f(this.shader.uniforms.uAlpha._location,t.worldAlpha);var a=e[0]._texture.baseTexture;if(a._glTextures[s.id])s.bindTexture(s.TEXTURE_2D,a._glTextures[s.id]);else{if(!this.renderer.updateTexture(a))return;t._properties[0]&&t._properties[3]||(t._bufferToUpdate=0)}for(var h=0,l=0;i>h;h+=r,l+=1){var u=i-h;u>r&&(u=r);var c=t._buffers[l];c.uploadDynamic(e,h,u),t._bufferToUpdate===l&&(c.uploadStatic(e,h,u),t._bufferToUpdate=l+1),c.bind(this.shader),s.drawElements(s.TRIANGLES,6*u,s.UNSIGNED_SHORT,0),this.renderer.drawCount++}}},n.prototype.generateBuffers=function(t){var e,i=this.renderer.gl,n=[],r=t._maxSize,s=t._batchSize,o=t._properties;for(e=0;r>e;e+=s)n.push(new a(i,this.properties,o,s));return n},n.prototype.uploadVertices=function(t,e,i,n,r,s){for(var o,a,h,l,u,c,p,d,f,m=0;i>m;m++)o=t[e+m],a=o._texture,l=o.scale.x,u=o.scale.y,a.trim?(h=a.trim,p=h.x-o.anchor.x*h.width,c=p+a.crop.width,f=h.y-o.anchor.y*h.height,d=f+a.crop.height):(c=a._frame.width*(1-o.anchor.x),p=a._frame.width*-o.anchor.x,d=a._frame.height*(1-o.anchor.y),f=a._frame.height*-o.anchor.y),n[s]=p*l,n[s+1]=f*u,n[s+r]=c*l,n[s+r+1]=f*u,n[s+2*r]=c*l,n[s+2*r+1]=d*u,n[s+3*r]=p*l,n[s+3*r+1]=d*u,s+=4*r},n.prototype.uploadPosition=function(t,e,i,n,r,s){for(var o=0;i>o;o++){var a=t[e+o].position;n[s]=a.x,n[s+1]=a.y,n[s+r]=a.x,n[s+r+1]=a.y,n[s+2*r]=a.x,n[s+2*r+1]=a.y,n[s+3*r]=a.x,n[s+3*r+1]=a.y,s+=4*r}},n.prototype.uploadRotation=function(t,e,i,n,r,s){for(var o=0;i>o;o++){var a=t[e+o].rotation;n[s]=a,n[s+r]=a,n[s+2*r]=a,n[s+3*r]=a,s+=4*r}},n.prototype.uploadUvs=function(t,e,i,n,r,s){for(var o=0;i>o;o++){var a=t[e+o]._texture._uvs;a?(n[s]=a.x0,n[s+1]=a.y0,n[s+r]=a.x1,n[s+r+1]=a.y1,n[s+2*r]=a.x2,n[s+2*r+1]=a.y2,n[s+3*r]=a.x3,n[s+3*r+1]=a.y3,s+=4*r):(n[s]=0,n[s+1]=0,n[s+r]=0,n[s+r+1]=0,n[s+2*r]=0,n[s+2*r+1]=0,n[s+3*r]=0,n[s+3*r+1]=0,s+=4*r)}},n.prototype.uploadAlpha=function(t,e,i,n,r,s){for(var o=0;i>o;o++){var a=t[e+o].alpha;n[s]=a,n[s+r]=a,n[s+2*r]=a,n[s+3*r]=a,s+=4*r}},n.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),r.prototype.destroy.apply(this,arguments),this.shader.destroy(),this.indices=null,this.tempMatrix=null}},{"../../math":26,"../../renderers/webgl/WebGLRenderer":42,"../../renderers/webgl/utils/ObjectRenderer":56,"./ParticleBuffer":33,"./ParticleShader":35}],35:[function(t,e,i){function n(t){r.call(this,t,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying float vColor;","void main(void){","   vec2 v = aVertexPosition;","   v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","uniform float uAlpha;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor * uAlpha;","  if (color.a == 0.0) discard;","  gl_FragColor = color;","}"].join("\n"),{uAlpha:{type:"1f",value:1}},{aPositionCoord:0,aRotation:0})}var r=t("../../renderers/webgl/shaders/TextureShader");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n},{"../../renderers/webgl/shaders/TextureShader":55}],36:[function(t,e,i){function n(t,e,i,n){if(a.call(this),r.sayHello(t),n)for(var h in o.DEFAULT_RENDER_OPTIONS)"undefined"==typeof n[h]&&(n[h]=o.DEFAULT_RENDER_OPTIONS[h]);else n=o.DEFAULT_RENDER_OPTIONS;this.type=o.RENDERER_TYPE.UNKNOWN,this.width=e||800,this.height=i||600,this.view=n.view||document.createElement("canvas"),this.resolution=n.resolution,this.transparent=n.transparent,this.autoResize=n.autoResize||!1,this.blendModes=null,this.preserveDrawingBuffer=n.preserveDrawingBuffer,this.clearBeforeRender=n.clearBeforeRender,this.roundPixels=n.roundPixels,this._backgroundColor=0,this._backgroundColorRgb=[0,0,0],this._backgroundColorString="#000000",this.backgroundColor=n.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent={worldTransform:new s.Matrix,worldAlpha:1,children:[]},this._lastObjectRendered=this._tempDisplayObjectParent}var r=t("../utils"),s=t("../math"),o=t("../const"),a=t("eventemitter3");n.prototype=Object.create(a.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=r.hex2string(t),r.hex2rgb(t,this._backgroundColorRgb)}}}),n.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},n.prototype.destroy=function(t){t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.type=o.RENDERER_TYPE.UNKNOWN,this.width=0,this.height=0,this.view=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this.roundPixels=!1,this._backgroundColor=0,this._backgroundColorRgb=null,this._backgroundColorString=null}},{"../const":16,"../math":26,"../utils":70,eventemitter3:10}],37:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,"Canvas",t,e,i),this.type=h.RENDERER_TYPE.CANVAS,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.maskManager=new s,this.smoothProperty="imageSmoothingEnabled",this.context.imageSmoothingEnabled||(this.context.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":this.context.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":this.context.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":this.context.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")),this.initPlugins(),this._mapBlendModes(),this._tempDisplayObjectParent={worldTransform:new a.Matrix,worldAlpha:1},this.resize(t,e)}var r=t("../SystemRenderer"),s=t("./utils/CanvasMaskManager"),o=t("../../utils"),a=t("../../math"),h=t("../../const");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,o.pluginTarget.mixin(n),n.prototype.render=function(t){this.emit("prerender");var e=t.parent;this._lastObjectRendered=t,t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=e,this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.context.globalCompositeOperation=this.blendModes[h.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=this._backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t,this.context),this.emit("postrender")},n.prototype.destroy=function(t){this.destroyPlugins(),r.prototype.destroy.call(this,t),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},n.prototype.renderDisplayObject=function(t,e){var i=this.context;this.context=e,t.renderCanvas(this),this.context=i},n.prototype.resize=function(t,e){r.prototype.resize.call(this,t,e),this.smoothProperty&&(this.context[this.smoothProperty]=h.SCALE_MODES.DEFAULT===h.SCALE_MODES.LINEAR)},n.prototype._mapBlendModes=function(){this.blendModes||(this.blendModes={},o.canUseNewCanvasBlendModes()?(this.blendModes[h.BLEND_MODES.NORMAL]="source-over",this.blendModes[h.BLEND_MODES.ADD]="lighter",this.blendModes[h.BLEND_MODES.MULTIPLY]="multiply",this.blendModes[h.BLEND_MODES.SCREEN]="screen",this.blendModes[h.BLEND_MODES.OVERLAY]="overlay",this.blendModes[h.BLEND_MODES.DARKEN]="darken",this.blendModes[h.BLEND_MODES.LIGHTEN]="lighten",this.blendModes[h.BLEND_MODES.COLOR_DODGE]="color-dodge",this.blendModes[h.BLEND_MODES.COLOR_BURN]="color-burn",this.blendModes[h.BLEND_MODES.HARD_LIGHT]="hard-light",this.blendModes[h.BLEND_MODES.SOFT_LIGHT]="soft-light",this.blendModes[h.BLEND_MODES.DIFFERENCE]="difference",this.blendModes[h.BLEND_MODES.EXCLUSION]="exclusion",this.blendModes[h.BLEND_MODES.HUE]="hue",this.blendModes[h.BLEND_MODES.SATURATION]="saturate",this.blendModes[h.BLEND_MODES.COLOR]="color",this.blendModes[h.BLEND_MODES.LUMINOSITY]="luminosity"):(this.blendModes[h.BLEND_MODES.NORMAL]="source-over",this.blendModes[h.BLEND_MODES.ADD]="lighter",this.blendModes[h.BLEND_MODES.MULTIPLY]="source-over",this.blendModes[h.BLEND_MODES.SCREEN]="source-over",this.blendModes[h.BLEND_MODES.OVERLAY]="source-over",this.blendModes[h.BLEND_MODES.DARKEN]="source-over",this.blendModes[h.BLEND_MODES.LIGHTEN]="source-over",this.blendModes[h.BLEND_MODES.COLOR_DODGE]="source-over",this.blendModes[h.BLEND_MODES.COLOR_BURN]="source-over",
this.blendModes[h.BLEND_MODES.HARD_LIGHT]="source-over",this.blendModes[h.BLEND_MODES.SOFT_LIGHT]="source-over",this.blendModes[h.BLEND_MODES.DIFFERENCE]="source-over",this.blendModes[h.BLEND_MODES.EXCLUSION]="source-over",this.blendModes[h.BLEND_MODES.HUE]="source-over",this.blendModes[h.BLEND_MODES.SATURATION]="source-over",this.blendModes[h.BLEND_MODES.COLOR]="source-over",this.blendModes[h.BLEND_MODES.LUMINOSITY]="source-over"))}},{"../../const":16,"../../math":26,"../../utils":70,"../SystemRenderer":36,"./utils/CanvasMaskManager":40}],38:[function(t,e,i){function n(t,e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e}n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{width:{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}},height:{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}}}),n.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},n.prototype.resize=function(t,e){this.canvas.width=t,this.canvas.height=e},n.prototype.destroy=function(){this.context=null,this.canvas=null}},{}],39:[function(t,e,i){var n=t("../../../const"),r={};e.exports=r,r.renderGraphics=function(t,e){var i=t.worldAlpha;t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1);for(var r=0;r<t.graphicsData.length;r++){var s=t.graphicsData[r],o=s.shape,a=s._fillTint,h=s._lineTint;if(e.lineWidth=s.lineWidth,s.type===n.SHAPES.POLY){e.beginPath();var l=o.points;e.moveTo(l[0],l[1]);for(var u=1;u<l.length/2;u++)e.lineTo(l[2*u],l[2*u+1]);o.closed&&e.lineTo(l[0],l[1]),l[0]===l[l.length-2]&&l[1]===l[l.length-1]&&e.closePath(),s.fill&&(e.globalAlpha=s.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),s.lineWidth&&(e.globalAlpha=s.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke())}else if(s.type===n.SHAPES.RECT)(s.fillColor||0===s.fillColor)&&(e.globalAlpha=s.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fillRect(o.x,o.y,o.width,o.height)),s.lineWidth&&(e.globalAlpha=s.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.strokeRect(o.x,o.y,o.width,o.height));else if(s.type===n.SHAPES.CIRC)e.beginPath(),e.arc(o.x,o.y,o.radius,0,2*Math.PI),e.closePath(),s.fill&&(e.globalAlpha=s.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),s.lineWidth&&(e.globalAlpha=s.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke());else if(s.type===n.SHAPES.ELIP){var c=2*o.width,p=2*o.height,d=o.x-c/2,f=o.y-p/2;e.beginPath();var m=.5522848,g=c/2*m,y=p/2*m,v=d+c,x=f+p,b=d+c/2,w=f+p/2;e.moveTo(d,w),e.bezierCurveTo(d,w-y,b-g,f,b,f),e.bezierCurveTo(b+g,f,v,w-y,v,w),e.bezierCurveTo(v,w+y,b+g,x,b,x),e.bezierCurveTo(b-g,x,d,w+y,d,w),e.closePath(),s.fill&&(e.globalAlpha=s.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),s.lineWidth&&(e.globalAlpha=s.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke())}else if(s.type===n.SHAPES.RREC){var _=o.x,T=o.y,E=o.width,S=o.height,A=o.radius,C=Math.min(E,S)/2|0;A=A>C?C:A,e.beginPath(),e.moveTo(_,T+A),e.lineTo(_,T+S-A),e.quadraticCurveTo(_,T+S,_+A,T+S),e.lineTo(_+E-A,T+S),e.quadraticCurveTo(_+E,T+S,_+E,T+S-A),e.lineTo(_+E,T+A),e.quadraticCurveTo(_+E,T,_+E-A,T),e.lineTo(_+A,T),e.quadraticCurveTo(_,T,_,T+A),e.closePath(),(s.fillColor||0===s.fillColor)&&(e.globalAlpha=s.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),s.lineWidth&&(e.globalAlpha=s.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|h).toString(16)).substr(-6),e.stroke())}}},r.renderGraphicsMask=function(t,e){var i=t.graphicsData.length;if(0!==i){e.beginPath();for(var r=0;i>r;r++){var s=t.graphicsData[r],o=s.shape;if(s.type===n.SHAPES.POLY){var a=o.points;e.moveTo(a[0],a[1]);for(var h=1;h<a.length/2;h++)e.lineTo(a[2*h],a[2*h+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&e.closePath()}else if(s.type===n.SHAPES.RECT)e.rect(o.x,o.y,o.width,o.height),e.closePath();else if(s.type===n.SHAPES.CIRC)e.arc(o.x,o.y,o.radius,0,2*Math.PI),e.closePath();else if(s.type===n.SHAPES.ELIP){var l=2*o.width,u=2*o.height,c=o.x-l/2,p=o.y-u/2,d=.5522848,f=l/2*d,m=u/2*d,g=c+l,y=p+u,v=c+l/2,x=p+u/2;e.moveTo(c,x),e.bezierCurveTo(c,x-m,v-f,p,v,p),e.bezierCurveTo(v+f,p,g,x-m,g,x),e.bezierCurveTo(g,x+m,v+f,y,v,y),e.bezierCurveTo(v-f,y,c,x+m,c,x),e.closePath()}else if(s.type===n.SHAPES.RREC){var b=o.x,w=o.y,_=o.width,T=o.height,E=o.radius,S=Math.min(_,T)/2|0;E=E>S?S:E,e.moveTo(b,w+E),e.lineTo(b,w+T-E),e.quadraticCurveTo(b,w+T,b+E,w+T),e.lineTo(b+_-E,w+T),e.quadraticCurveTo(b+_,w+T,b+_,w+T-E),e.lineTo(b+_,w+E),e.quadraticCurveTo(b+_,w,b+_-E,w),e.lineTo(b+E,w),e.quadraticCurveTo(b,w,b,w+E),e.closePath()}}}},r.updateGraphicsTint=function(t){if(16777215!==t.tint||t._prevTint!==t.tint){t._prevTint=t.tint;for(var e=(t.tint>>16&255)/255,i=(t.tint>>8&255)/255,n=(255&t.tint)/255,r=0;r<t.graphicsData.length;r++){var s=t.graphicsData[r],o=0|s.fillColor,a=0|s.lineColor;s._fillTint=((o>>16&255)/255*e*255<<16)+((o>>8&255)/255*i*255<<8)+(255&o)/255*n*255,s._lineTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(255&a)/255*n*255}}}},{"../../../const":16}],40:[function(t,e,i){function n(){}var r=t("./CanvasGraphics");n.prototype.constructor=n,e.exports=n,n.prototype.pushMask=function(t,e){e.context.save();var i=t.alpha,n=t.worldTransform,s=e.resolution;e.context.setTransform(n.a*s,n.b*s,n.c*s,n.d*s,n.tx*s,n.ty*s),t.texture||(r.renderGraphicsMask(t,e.context),e.context.clip()),t.worldAlpha=i},n.prototype.popMask=function(t){t.context.restore()},n.prototype.destroy=function(){}},{"./CanvasGraphics":39}],41:[function(t,e,i){var n=t("../../../utils"),r={};e.exports=r,r.getTintedTexture=function(t,e){var i=t.texture;e=r.roundColor(e);var n="#"+("00000"+(0|e).toString(16)).substr(-6);if(i.tintCache=i.tintCache||{},i.tintCache[n])return i.tintCache[n];var s=r.canvas||document.createElement("canvas");if(r.tintMethod(i,e,s),r.convertTintToImage){var o=new Image;o.src=s.toDataURL(),i.tintCache[n]=o}else i.tintCache[n]=s,r.canvas=null;return s},r.tintWithMultiply=function(t,e,i){var n=i.getContext("2d"),r=t.baseTexture.resolution,s=t.crop.clone();s.x*=r,s.y*=r,s.width*=r,s.height*=r,i.width=s.width,i.height=s.height,n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,s.width,s.height),n.globalCompositeOperation="multiply",n.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height)},r.tintWithOverlay=function(t,e,i){var n=i.getContext("2d"),r=t.baseTexture.resolution,s=t.crop.clone();s.x*=r,s.y*=r,s.width*=r,s.height*=r,i.width=s.width,i.height=s.height,n.globalCompositeOperation="copy",n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,s.width,s.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height)},r.tintWithPerPixel=function(t,e,i){var r=i.getContext("2d"),s=t.baseTexture.resolution,o=t.crop.clone();o.x*=s,o.y*=s,o.width*=s,o.height*=s,i.width=o.width,i.height=o.height,r.globalCompositeOperation="copy",r.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height);for(var a=n.hex2rgb(e),h=a[0],l=a[1],u=a[2],c=r.getImageData(0,0,o.width,o.height),p=c.data,d=0;d<p.length;d+=4)p[d+0]*=h,p[d+1]*=l,p[d+2]*=u;r.putImageData(c,0,0)},r.roundColor=function(t){var e=r.cacheStepsPerColorChannel,i=n.hex2rgb(t);return i[0]=Math.min(255,i[0]/e*e),i[1]=Math.min(255,i[1]/e*e),i[2]=Math.min(255,i[2]/e*e),n.rgb2hex(i)},r.cacheStepsPerColorChannel=8,r.convertTintToImage=!1,r.canUseMultiply=n.canUseNewCanvasBlendModes(),r.tintMethod=r.canUseMultiply?r.tintWithMultiply:r.tintWithPerPixel},{"../../../utils":70}],42:[function(t,e,i){function n(t,e,i){i=i||{},r.call(this,"WebGL",t,e,i),this.type=f.RENDERER_TYPE.WEBGL,this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.handleContextLost,!1),this.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this._useFXAA=!!i.forceFXAA&&i.antialias,this._FXAAFilter=null,this._contextOptions={alpha:this.transparent,antialias:i.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer},this.drawCount=0,this.shaderManager=new s(this),this.maskManager=new o(this),this.stencilManager=new a(this),this.filterManager=new h(this),this.blendModeManager=new l(this),this.currentRenderTarget=null,this.currentRenderer=new c(this),this.initPlugins(),this._createContext(),this._initContext(),this._mapGlModes(),this._managedTextures=[],this._renderTargetStack=[]}var r=t("../SystemRenderer"),s=t("./managers/ShaderManager"),o=t("./managers/MaskManager"),a=t("./managers/StencilManager"),h=t("./managers/FilterManager"),l=t("./managers/BlendModeManager"),u=t("./utils/RenderTarget"),c=t("./utils/ObjectRenderer"),p=t("./filters/FXAAFilter"),d=t("../../utils"),f=t("../../const");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,d.pluginTarget.mixin(n),n.glContextId=0,n.prototype._createContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=n.glContextId++,t.id=this.glContextId,t.renderer=this},n.prototype._initContext=function(){var t=this.gl;t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.renderTarget=new u(t,this.width,this.height,null,this.resolution,!0),this.setRenderTarget(this.renderTarget),this.emit("context",t),this.resize(this.width,this.height),this._useFXAA||(this._useFXAA=this._contextOptions.antialias&&!t.getContextAttributes().antialias),this._useFXAA&&(window.console.warn("FXAA antialiasing being used instead of native antialiasing"),this._FXAAFilter=[new p])},n.prototype.render=function(t){if(this.emit("prerender"),!this.gl.isContextLost()){this.drawCount=0,this._lastObjectRendered=t,this._useFXAA&&(this._FXAAFilter[0].uniforms.resolution.value.x=this.width,this._FXAAFilter[0].uniforms.resolution.value.y=this.height,t.filterArea=this.renderTarget.size,t.filters=this._FXAAFilter);var e=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=e;var i=this.gl;this.setRenderTarget(this.renderTarget),this.clearBeforeRender&&(this.transparent?i.clearColor(0,0,0,0):i.clearColor(this._backgroundColorRgb[0],this._backgroundColorRgb[1],this._backgroundColorRgb[2],1),i.clear(i.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.renderTarget),this.emit("postrender")}},n.prototype.renderDisplayObject=function(t,e,i){this.setRenderTarget(e),i&&e.clear(),this.filterManager.setFilterStack(e.filterStack),t.renderWebGL(this),this.currentRenderer.flush()},n.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},n.prototype.setRenderTarget=function(t){this.currentRenderTarget!==t&&(this.currentRenderTarget=t,this.currentRenderTarget.activate(),this.stencilManager.setMaskStack(t.stencilMaskStack))},n.prototype.resize=function(t,e){r.prototype.resize.call(this,t,e),this.filterManager.resize(t,e),this.renderTarget.resize(t,e),this.currentRenderTarget===this.renderTarget&&(this.renderTarget.activate(),this.gl.viewport(0,0,this.width,this.height))},n.prototype.updateTexture=function(t){if(t=t.baseTexture||t,t.hasLoaded){var e=this.gl;return t._glTextures[e.id]||(t._glTextures[e.id]=e.createTexture(),t.on("update",this.updateTexture,this),t.on("dispose",this.destroyTexture,this),this._managedTextures.push(t)),e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===f.SCALE_MODES.LINEAR?e.LINEAR:e.NEAREST),t.mipmap&&t.isPowerOfTwo?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===f.SCALE_MODES.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===f.SCALE_MODES.LINEAR?e.LINEAR:e.NEAREST),t.isPowerOfTwo?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),t._glTextures[e.id]}},n.prototype.destroyTexture=function(t,e){if(t=t.baseTexture||t,t.hasLoaded&&t._glTextures[this.gl.id]&&(this.gl.deleteTexture(t._glTextures[this.gl.id]),delete t._glTextures[this.gl.id],!e)){var i=this._managedTextures.indexOf(t);-1!==i&&d.removeItems(this._managedTextures,i,1)}},n.prototype.handleContextLost=function(t){t.preventDefault()},n.prototype.handleContextRestored=function(){this._initContext();for(var t=0;t<this._managedTextures.length;++t){var e=this._managedTextures[t];e._glTextures[this.gl.id]&&delete e._glTextures[this.gl.id]}},n.prototype.destroy=function(t){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored);for(var e=0;e<this._managedTextures.length;++e){var i=this._managedTextures[e];this.destroyTexture(i,!0),i.off("update",this.updateTexture,this),i.off("dispose",this.destroyTexture,this)}r.prototype.destroy.call(this,t),this.uid=0,this.shaderManager.destroy(),this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.blendModeManager.destroy(),this.shaderManager=null,this.maskManager=null,this.filterManager=null,this.blendModeManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this._managedTextures=null,this.drawCount=0,this.gl.useProgram(null),this.gl=null},n.prototype._mapGlModes=function(){var t=this.gl;this.blendModes||(this.blendModes={},this.blendModes[f.BLEND_MODES.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],this.blendModes[f.BLEND_MODES.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.SCREEN]=[t.SRC_ALPHA,t.ONE],this.blendModes[f.BLEND_MODES.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],this.blendModes[f.BLEND_MODES.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA]),this.drawModes||(this.drawModes={},this.drawModes[f.DRAW_MODES.POINTS]=t.POINTS,this.drawModes[f.DRAW_MODES.LINES]=t.LINES,this.drawModes[f.DRAW_MODES.LINE_LOOP]=t.LINE_LOOP,this.drawModes[f.DRAW_MODES.LINE_STRIP]=t.LINE_STRIP,this.drawModes[f.DRAW_MODES.TRIANGLES]=t.TRIANGLES,this.drawModes[f.DRAW_MODES.TRIANGLE_STRIP]=t.TRIANGLE_STRIP,this.drawModes[f.DRAW_MODES.TRIANGLE_FAN]=t.TRIANGLE_FAN)}},{"../../const":16,"../../utils":70,"../SystemRenderer":36,"./filters/FXAAFilter":44,"./managers/BlendModeManager":46,"./managers/FilterManager":47,"./managers/MaskManager":48,"./managers/ShaderManager":49,"./managers/StencilManager":50,"./utils/ObjectRenderer":56,"./utils/RenderTarget":58}],43:[function(t,e,i){function n(t,e,i){this.shaders=[],this.padding=0,this.uniforms=i||{},this.vertexSrc=t||r.defaultVertexSrc,this.fragmentSrc=e||r.defaultFragmentSrc}var r=t("../shaders/TextureShader");n.prototype.constructor=n,e.exports=n,n.prototype.getShader=function(t){var e=t.gl,i=this.shaders[e.id];return i||(i=new r(t.shaderManager,this.vertexSrc,this.fragmentSrc,this.uniforms,this.attributes),this.shaders[e.id]=i),i},n.prototype.applyFilter=function(t,e,i,n){var r=this.getShader(t);t.filterManager.applyFilter(r,e,i,n)},n.prototype.syncUniform=function(t){for(var e=0,i=this.shaders.length;i>e;++e)this.shaders[e].syncUniform(t)}},{"../shaders/TextureShader":55}],44:[function(t,e,i){function n(){r.call(this,"\nprecision mediump float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform vec2 resolution;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\n            out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n   vResolution = resolution;\n\n   //compute the texture coords and send them to varyings\n   texcoords(aTextureCoord * resolution, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'precision lowp float;\n\n\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it\'s\nunsupported by WebGL.\n\n--\n\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\n\nCopyright (c) 2011 by Armin Ronacher.\n\nSome rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE,\n            vec2 v_rgbSW, vec2 v_rgbSE,\n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform sampler2D uSampler;\n\n\nvoid main(void){\n\n    gl_FragColor = fxaa(uSampler, vTextureCoord * vResolution, vResolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n}\n',{resolution:{type:"v2",value:{x:1,y:1}}})}var r=t("./AbstractFilter");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.applyFilter=function(t,e,i){var n=t.filterManager,r=this.getShader(t);n.applyFilter(r,e,i)}},{"./AbstractFilter":43}],45:[function(t,e,i){function n(t){var e=new s.Matrix;r.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform sampler2D mask;\n\nvoid main(void)\n{\n    // check clip! this will stop the mask bleeding out from the edges\n    vec2 text = abs( vMaskCoord - 0.5 );\n    text = step(0.5, text);\n    float clip = 1.0 - max(text.y, text.x);\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    original *= (masky.r * masky.a * alpha * clip);\n    gl_FragColor = original;\n}\n",{mask:{type:"sampler2D",value:t._texture},alpha:{type:"f",value:1},otherMatrix:{type:"mat3",value:e.toArray(!0)}}),this.maskSprite=t,this.maskMatrix=e}var r=t("./AbstractFilter"),s=t("../../../math");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.applyFilter=function(t,e,i){var n=t.filterManager;this.uniforms.mask.value=this.maskSprite._texture,n.calculateMappedMatrix(e.frame,this.maskSprite,this.maskMatrix),this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0),this.uniforms.alpha.value=this.maskSprite.worldAlpha;var r=this.getShader(t);n.applyFilter(r,e,i)},Object.defineProperties(n.prototype,{map:{get:function(){return this.uniforms.mask.value},set:function(t){this.uniforms.mask.value=t}},offset:{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}}})},{"../../../math":26,"./AbstractFilter":43}],46:[function(t,e,i){function n(t){r.call(this,t),this.currentBlendMode=99999}var r=t("./WebGLManager");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var e=this.renderer.blendModes[this.currentBlendMode];return this.renderer.gl.blendFunc(e[0],e[1]),!0}},{"./WebGLManager":51}],47:[function(t,e,i){function n(t){r.call(this,t),this.filterStack=[],this.filterStack.push({renderTarget:t.currentRenderTarget,filter:[],bounds:null}),this.texturePool=[],this.textureSize=new h.Rectangle(0,0,t.width,t.height),this.currentFrame=null}var r=t("./WebGLManager"),s=t("../utils/RenderTarget"),o=t("../../../const"),a=t("../utils/Quad"),h=t("../../../math");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.onContextChange=function(){this.texturePool.length=0;var t=this.renderer.gl;this.quad=new a(t)},n.prototype.setFilterStack=function(t){this.filterStack=t},n.prototype.pushFilter=function(t,e){var i=t.filterArea?t.filterArea.clone():t.getBounds();i.x=0|i.x,i.y=0|i.y,i.width=0|i.width,i.height=0|i.height;var n=0|e[0].padding;if(i.x-=n,i.y-=n,i.width+=2*n,i.height+=2*n,this.renderer.currentRenderTarget.transform){var r=this.renderer.currentRenderTarget.transform;i.x+=r.tx,i.y+=r.ty,this.capFilterArea(i),i.x-=r.tx,i.y-=r.ty}else this.capFilterArea(i);if(i.width>0&&i.height>0){this.currentFrame=i;var s=this.getRenderTarget();this.renderer.setRenderTarget(s),s.clear(),this.filterStack.push({renderTarget:s,filter:e})}else this.filterStack.push({renderTarget:null,filter:e})},n.prototype.popFilter=function(){var t=this.filterStack.pop(),e=this.filterStack[this.filterStack.length-1],i=t.renderTarget;if(t.renderTarget){var n=e.renderTarget,r=this.renderer.gl;this.currentFrame=i.frame,this.quad.map(this.textureSize,i.frame),r.bindBuffer(r.ARRAY_BUFFER,this.quad.vertexBuffer),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.quad.indexBuffer);var s=t.filter;if(r.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aVertexPosition,2,r.FLOAT,!1,0,0),r.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aTextureCoord,2,r.FLOAT,!1,0,32),r.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aColor,4,r.FLOAT,!1,0,64),this.renderer.blendModeManager.setBlendMode(o.BLEND_MODES.NORMAL),1===s.length)s[0].uniforms.dimensions&&(s[0].uniforms.dimensions.value[0]=this.renderer.width,s[0].uniforms.dimensions.value[1]=this.renderer.height,s[0].uniforms.dimensions.value[2]=this.quad.vertices[0],s[0].uniforms.dimensions.value[3]=this.quad.vertices[5]),s[0].applyFilter(this.renderer,i,n),this.returnRenderTarget(i);else{for(var a=i,h=this.getRenderTarget(!0),l=0;l<s.length-1;l++){var u=s[l];u.uniforms.dimensions&&(u.uniforms.dimensions.value[0]=this.renderer.width,u.uniforms.dimensions.value[1]=this.renderer.height,u.uniforms.dimensions.value[2]=this.quad.vertices[0],u.uniforms.dimensions.value[3]=this.quad.vertices[5]),u.applyFilter(this.renderer,a,h);var c=a;a=h,h=c}s[s.length-1].applyFilter(this.renderer,a,n),this.returnRenderTarget(a),this.returnRenderTarget(h)}return t.filter}},n.prototype.getRenderTarget=function(t){var e=this.texturePool.pop()||new s(this.renderer.gl,this.textureSize.width,this.textureSize.height,o.SCALE_MODES.LINEAR,this.renderer.resolution*o.FILTER_RESOLUTION);return e.frame=this.currentFrame,t&&e.clear(!0),e},n.prototype.returnRenderTarget=function(t){this.texturePool.push(t)},n.prototype.applyFilter=function(t,e,i,n){var r=this.renderer.gl;this.renderer.setRenderTarget(i),n&&i.clear(),this.renderer.shaderManager.setShader(t),t.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0),t.syncUniforms(),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,e.texture),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0),this.renderer.drawCount++},n.prototype.calculateMappedMatrix=function(t,e,i){var n=e.worldTransform.copy(h.Matrix.TEMP_MATRIX),r=e._texture.baseTexture,s=i.identity(),o=this.textureSize.height/this.textureSize.width;s.translate(t.x/this.textureSize.width,t.y/this.textureSize.height),s.scale(1,o);var a=this.textureSize.width/r.width,l=this.textureSize.height/r.height;return n.tx/=r.width*a,n.ty/=r.width*a,n.invert(),s.prepend(n),s.scale(1,1/o),s.scale(a,l),s.translate(e.anchor.x,e.anchor.y),s},n.prototype.capFilterArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.textureSize.width&&(t.width=this.textureSize.width-t.x),t.y+t.height>this.textureSize.height&&(t.height=this.textureSize.height-t.y)},n.prototype.resize=function(t,e){this.textureSize.width=t,this.textureSize.height=e;for(var i=0;i<this.texturePool.length;i++)this.texturePool[i].resize(t,e)},n.prototype.destroy=function(){this.quad.destroy(),r.prototype.destroy.call(this),this.filterStack=null,this.offsetY=0;for(var t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null}},{"../../../const":16,"../../../math":26,"../utils/Quad":57,"../utils/RenderTarget":58,"./WebGLManager":51}],48:[function(t,e,i){function n(t){r.call(this,t),this.stencilStack=[],this.reverse=!0,this.count=0,this.alphaMaskPool=[]}var r=t("./WebGLManager"),s=t("../filters/SpriteMaskFilter");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.pushMask=function(t,e){e.texture?this.pushSpriteMask(t,e):this.pushStencilMask(t,e)},n.prototype.popMask=function(t,e){e.texture?this.popSpriteMask(t,e):this.popStencilMask(t,e)},n.prototype.pushSpriteMask=function(t,e){var i=this.alphaMaskPool.pop();i||(i=[new s(e)]),i[0].maskSprite=e,this.renderer.filterManager.pushFilter(t,i)},n.prototype.popSpriteMask=function(){var t=this.renderer.filterManager.popFilter();this.alphaMaskPool.push(t)},n.prototype.pushStencilMask=function(t,e){this.renderer.stencilManager.pushMask(e)},n.prototype.popStencilMask=function(t,e){this.renderer.stencilManager.popMask(e)}},{"../filters/SpriteMaskFilter":45,"./WebGLManager":51}],49:[function(t,e,i){function n(t){r.call(this,t),this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var e=0;e<this.maxAttibs;e++)this.attribState[e]=!1;this.stack=[],this._currentId=-1,this.currentShader=null}var r=t("./WebGLManager"),s=t("../shaders/TextureShader"),o=t("../shaders/ComplexPrimitiveShader"),a=t("../shaders/PrimitiveShader"),h=t("../../../utils");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,h.pluginTarget.mixin(n),e.exports=n,n.prototype.onContextChange=function(){this.initPlugins();var t=this.renderer.gl;this.maxAttibs=t.getParameter(t.MAX_VERTEX_ATTRIBS),this.attribState=[];for(var e=0;e<this.maxAttibs;e++)this.attribState[e]=!1;this.defaultShader=new s(this),this.primitiveShader=new a(this),
this.complexPrimitiveShader=new o(this)},n.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(var i in t)this.tempAttribState[t[i]]=!0;var n=this.renderer.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.attribState[e]?n.enableVertexAttribArray(e):n.disableVertexAttribArray(e))},n.prototype.setShader=function(t){return this._currentId===t.uid?!1:(this._currentId=t.uid,this.currentShader=t,this.renderer.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},n.prototype.destroy=function(){this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),r.prototype.destroy.call(this),this.destroyPlugins(),this.attribState=null,this.tempAttribState=null}},{"../../../utils":70,"../shaders/ComplexPrimitiveShader":52,"../shaders/PrimitiveShader":53,"../shaders/TextureShader":55,"./WebGLManager":51}],50:[function(t,e,i){function n(t){r.call(this,t),this.stencilMaskStack=null}var r=t("./WebGLManager"),s=t("../../../utils");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.setMaskStack=function(t){this.stencilMaskStack=t;var e=this.renderer.gl;0===t.stencilStack.length?e.disable(e.STENCIL_TEST):e.enable(e.STENCIL_TEST)},n.prototype.pushStencil=function(t,e){this.renderer.currentRenderTarget.attachStencilBuffer();var i=this.renderer.gl,n=this.stencilMaskStack;this.bindGraphics(t,e),0===n.stencilStack.length&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT),n.reverse=!0,n.count=0),n.stencilStack.push(e);var r=n.count;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.ALWAYS,0,255),i.stencilOp(i.KEEP,i.KEEP,i.INVERT),1===e.mode?(i.drawElements(i.TRIANGLE_FAN,e.indices.length-4,i.UNSIGNED_SHORT,0),n.reverse?(i.stencilFunc(i.EQUAL,255-r,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)):(i.stencilFunc(i.EQUAL,r,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,2*(e.indices.length-4)),n.reverse?i.stencilFunc(i.EQUAL,255-(r+1),255):i.stencilFunc(i.EQUAL,r+1,255),n.reverse=!n.reverse):(n.reverse?(i.stencilFunc(i.EQUAL,r,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)):(i.stencilFunc(i.EQUAL,255-r,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)),i.drawElements(i.TRIANGLE_STRIP,e.indices.length,i.UNSIGNED_SHORT,0),n.reverse?i.stencilFunc(i.EQUAL,r+1,255):i.stencilFunc(i.EQUAL,255-(r+1),255)),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),n.count++},n.prototype.bindGraphics=function(t,e){var i,n=this.renderer.gl;1===e.mode?(i=this.renderer.shaderManager.complexPrimitiveShader,this.renderer.shaderManager.setShader(i),n.uniformMatrix3fv(i.uniforms.translationMatrix._location,!1,t.worldTransform.toArray(!0)),n.uniformMatrix3fv(i.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),n.uniform3fv(i.uniforms.tint._location,s.hex2rgb(t.tint)),n.uniform3fv(i.uniforms.color._location,e.color),n.uniform1f(i.uniforms.alpha._location,t.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,e.buffer),n.vertexAttribPointer(i.attributes.aVertexPosition,2,n.FLOAT,!1,8,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.indexBuffer)):(i=this.renderer.shaderManager.primitiveShader,this.renderer.shaderManager.setShader(i),n.uniformMatrix3fv(i.uniforms.translationMatrix._location,!1,t.worldTransform.toArray(!0)),n.uniformMatrix3fv(i.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),n.uniform3fv(i.uniforms.tint._location,s.hex2rgb(t.tint)),n.uniform1f(i.uniforms.alpha._location,t.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,e.buffer),n.vertexAttribPointer(i.attributes.aVertexPosition,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(i.attributes.aColor,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.indexBuffer))},n.prototype.popStencil=function(t,e){var i=this.renderer.gl,n=this.stencilMaskStack;if(n.stencilStack.pop(),n.count--,0===n.stencilStack.length)i.disable(i.STENCIL_TEST);else{var r=n.count;this.bindGraphics(t,e),i.colorMask(!1,!1,!1,!1),1===e.mode?(n.reverse=!n.reverse,n.reverse?(i.stencilFunc(i.EQUAL,255-(r+1),255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)):(i.stencilFunc(i.EQUAL,r+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,2*(e.indices.length-4)),i.stencilFunc(i.ALWAYS,0,255),i.stencilOp(i.KEEP,i.KEEP,i.INVERT),i.drawElements(i.TRIANGLE_FAN,e.indices.length-4,i.UNSIGNED_SHORT,0),this.renderer.drawCount+=2,n.reverse?i.stencilFunc(i.EQUAL,r,255):i.stencilFunc(i.EQUAL,255-r,255)):(n.reverse?(i.stencilFunc(i.EQUAL,r+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)):(i.stencilFunc(i.EQUAL,255-(r+1),255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)),i.drawElements(i.TRIANGLE_STRIP,e.indices.length,i.UNSIGNED_SHORT,0),this.renderer.drawCount++,n.reverse?i.stencilFunc(i.EQUAL,r,255):i.stencilFunc(i.EQUAL,255-r,255)),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}},n.prototype.destroy=function(){r.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null},n.prototype.pushMask=function(t){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),t.dirty&&this.renderer.plugins.graphics.updateGraphics(t,this.renderer.gl),t._webGL[this.renderer.gl.id].data.length&&this.pushStencil(t,t._webGL[this.renderer.gl.id].data[0])},n.prototype.popMask=function(t){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.popStencil(t,t._webGL[this.renderer.gl.id].data[0])}},{"../../../utils":70,"./WebGLManager":51}],51:[function(t,e,i){function n(t){this.renderer=t,this.renderer.on("context",this.onContextChange,this)}n.prototype.constructor=n,e.exports=n,n.prototype.onContextChange=function(){},n.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null}},{}],52:[function(t,e,i){function n(t){r.call(this,t,["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},color:{type:"3f",value:[0,0,0]},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0})}var r=t("./Shader");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n},{"./Shader":54}],53:[function(t,e,i){function n(t){r.call(this,t,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aColor:0})}var r=t("./Shader");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n},{"./Shader":54}],54:[function(t,e,i){function n(t,e,i,n,s){if(!e||!i)throw new Error("Pixi.js Error. Shader requires vertexSrc and fragmentSrc");this.uid=r.uid(),this.gl=t.renderer.gl,this.shaderManager=t,this.program=null,this.uniforms=n||{},this.attributes=s||{},this.textureCount=1,this.vertexSrc=e,this.fragmentSrc=i,this.init()}var r=t("../../../utils");n.prototype.constructor=n,e.exports=n,n.prototype.init=function(){this.compile(),this.gl.useProgram(this.program),this.cacheUniformLocations(Object.keys(this.uniforms)),this.cacheAttributeLocations(Object.keys(this.attributes))},n.prototype.cacheUniformLocations=function(t){for(var e=0;e<t.length;++e)this.uniforms[t[e]]._location=this.gl.getUniformLocation(this.program,t[e])},n.prototype.cacheAttributeLocations=function(t){for(var e=0;e<t.length;++e)this.attributes[t[e]]=this.gl.getAttribLocation(this.program,t[e])},n.prototype.compile=function(){var t=this.gl,e=this._glCompile(t.VERTEX_SHADER,this.vertexSrc),i=this._glCompile(t.FRAGMENT_SHADER,this.fragmentSrc),n=t.createProgram();return t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(n,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(n)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(n)),t.deleteProgram(n),n=null),t.deleteShader(e),t.deleteShader(i),this.program=n},n.prototype.syncUniform=function(t){var e,i,n=t._location,s=t.value,o=this.gl;switch(t.type){case"b":case"bool":case"boolean":o.uniform1i(n,s?1:0);break;case"i":case"1i":o.uniform1i(n,s);break;case"f":case"1f":o.uniform1f(n,s);break;case"2f":o.uniform2f(n,s[0],s[1]);break;case"3f":o.uniform3f(n,s[0],s[1],s[2]);break;case"4f":o.uniform4f(n,s[0],s[1],s[2],s[3]);break;case"v2":o.uniform2f(n,s.x,s.y);break;case"v3":o.uniform3f(n,s.x,s.y,s.z);break;case"v4":o.uniform4f(n,s.x,s.y,s.z,s.w);break;case"1iv":o.uniform1iv(n,s);break;case"2iv":o.uniform2iv(n,s);break;case"3iv":o.uniform3iv(n,s);break;case"4iv":o.uniform4iv(n,s);break;case"1fv":o.uniform1fv(n,s);break;case"2fv":o.uniform2fv(n,s);break;case"3fv":o.uniform3fv(n,s);break;case"4fv":o.uniform4fv(n,s);break;case"m2":case"mat2":case"Matrix2fv":o.uniformMatrix2fv(n,t.transpose,s);break;case"m3":case"mat3":case"Matrix3fv":o.uniformMatrix3fv(n,t.transpose,s);break;case"m4":case"mat4":case"Matrix4fv":o.uniformMatrix4fv(n,t.transpose,s);break;case"c":"number"==typeof s&&(s=r.hex2rgb(s)),o.uniform3f(n,s[0],s[1],s[2]);break;case"iv1":o.uniform1iv(n,s);break;case"iv":o.uniform3iv(n,s);break;case"fv1":o.uniform1fv(n,s);break;case"fv":o.uniform3fv(n,s);break;case"v2v":for(t._array||(t._array=new Float32Array(2*s.length)),e=0,i=s.length;i>e;++e)t._array[2*e]=s[e].x,t._array[2*e+1]=s[e].y;o.uniform2fv(n,t._array);break;case"v3v":for(t._array||(t._array=new Float32Array(3*s.length)),e=0,i=s.length;i>e;++e)t._array[3*e]=s[e].x,t._array[3*e+1]=s[e].y,t._array[3*e+2]=s[e].z;o.uniform3fv(n,t._array);break;case"v4v":for(t._array||(t._array=new Float32Array(4*s.length)),e=0,i=s.length;i>e;++e)t._array[4*e]=s[e].x,t._array[4*e+1]=s[e].y,t._array[4*e+2]=s[e].z,t._array[4*e+3]=s[e].w;o.uniform4fv(n,t._array);break;case"t":case"sampler2D":if(!t.value||!t.value.baseTexture.hasLoaded)break;o.activeTexture(o["TEXTURE"+this.textureCount]);var a=t.value.baseTexture._glTextures[o.id];a||(this.initSampler2D(t),a=t.value.baseTexture._glTextures[o.id]),o.bindTexture(o.TEXTURE_2D,a),o.uniform1i(t._location,this.textureCount),this.textureCount++;break;default:console.warn("Pixi.js Shader Warning: Unknown uniform type: "+t.type)}},n.prototype.syncUniforms=function(){this.textureCount=1;for(var t in this.uniforms)this.syncUniform(this.uniforms[t])},n.prototype.initSampler2D=function(t){var e=this.gl,i=t.value.baseTexture;if(i.hasLoaded)if(t.textureData){var n=t.textureData;i._glTextures[e.id]=e.createTexture(),e.bindTexture(e.TEXTURE_2D,i._glTextures[e.id]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultipliedAlpha),e.texImage2D(e.TEXTURE_2D,0,n.luminance?e.LUMINANCE:e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n.magFilter?n.magFilter:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n.wrapS?n.wrapS:e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,n.wrapS?n.wrapS:e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n.wrapT?n.wrapT:e.CLAMP_TO_EDGE)}else this.shaderManager.renderer.updateTexture(i)},n.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.gl=null,this.uniforms=null,this.attributes=null,this.vertexSrc=null,this.fragmentSrc=null},n.prototype._glCompile=function(t,e){var i=this.gl.createShader(t);return this.gl.shaderSource(i,e),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(console.log(this.gl.getShaderInfoLog(i)),null)}},{"../../../utils":70}],55:[function(t,e,i){function n(t,e,i,s,o){var a={uSampler:{type:"sampler2D",value:0},projectionMatrix:{type:"mat3",value:new Float32Array([1,0,0,0,1,0,0,0,1])}};if(s)for(var h in s)a[h]=s[h];var l={aVertexPosition:0,aTextureCoord:0,aColor:0};if(o)for(var u in o)l[u]=o[u];e=e||n.defaultVertexSrc,i=i||n.defaultFragmentSrc,r.call(this,t,e,i,a,l)}var r=t("./Shader");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.defaultVertexSrc=["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),n.defaultFragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"].join("\n")},{"./Shader":54}],56:[function(t,e,i){function n(t){r.call(this,t)}var r=t("../managers/WebGLManager");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.start=function(){},n.prototype.stop=function(){this.flush()},n.prototype.flush=function(){},n.prototype.render=function(t){}},{"../managers/WebGLManager":51}],57:[function(t,e,i){function n(t){this.gl=t,this.vertices=new Float32Array([0,0,200,0,200,200,0,200]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.colors=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),this.indices=new Uint16Array([0,1,2,0,3,2]),this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,128,t.DYNAMIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),this.upload()}n.prototype.constructor=n,n.prototype.map=function(t,e){var i=0,n=0;this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+e.width/t.width,this.uvs[3]=n,this.uvs[4]=i+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=i,this.uvs[7]=n+e.height/t.height,i=e.x,n=e.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+e.width,this.vertices[3]=n,this.vertices[4]=i+e.width,this.vertices[5]=n+e.height,this.vertices[6]=i,this.vertices[7]=n+e.height,this.upload()},n.prototype.upload=function(){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices),t.bufferSubData(t.ARRAY_BUFFER,32,this.uvs),t.bufferSubData(t.ARRAY_BUFFER,64,this.colors)},n.prototype.destroy=function(){var t=this.gl;t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.indexBuffer)},e.exports=n},{}],58:[function(t,e,i){var n=t("../../../math"),r=t("../../../utils"),s=t("../../../const"),o=t("./StencilMaskStack"),a=function(t,e,i,a,h,l){if(this.gl=t,this.frameBuffer=null,this.texture=null,this.size=new n.Rectangle(0,0,1,1),this.resolution=h||s.RESOLUTION,this.projectionMatrix=new n.Matrix,this.transform=null,this.frame=null,this.stencilBuffer=null,this.stencilMaskStack=new o,this.filterStack=[{renderTarget:this,filter:[],bounds:this.size}],this.scaleMode=a||s.SCALE_MODES.DEFAULT,this.root=l,!this.root){this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,a===s.SCALE_MODES.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,a===s.SCALE_MODES.LINEAR?t.LINEAR:t.NEAREST);var u=r.isPowerOfTwo(e,i);u?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}this.resize(e,i)};a.prototype.constructor=a,e.exports=a,a.prototype.clear=function(t){var e=this.gl;t&&e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},a.prototype.attachStencilBuffer=function(){if(!this.stencilBuffer&&!this.root){var t=this.gl;this.stencilBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.stencilBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.stencilBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.size.width*this.resolution,this.size.height*this.resolution)}},a.prototype.activate=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);var e=this.frame||this.size;this.calculateProjection(e),this.transform&&this.projectionMatrix.append(this.transform),t.viewport(0,0,e.width*this.resolution,e.height*this.resolution)},a.prototype.calculateProjection=function(t){var e=this.projectionMatrix;e.identity(),this.root?(e.a=1/t.width*2,e.d=-1/t.height*2,e.tx=-1-t.x*e.a,e.ty=1-t.y*e.d):(e.a=1/t.width*2,e.d=1/t.height*2,e.tx=-1-t.x*e.a,e.ty=-1-t.y*e.d)},a.prototype.resize=function(t,e){if(t=0|t,e=0|e,this.size.width!==t||this.size.height!==e){if(this.size.width=t,this.size.height=e,!this.root){var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t*this.resolution,e*this.resolution,0,i.RGBA,i.UNSIGNED_BYTE,null),this.stencilBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,this.stencilBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t*this.resolution,e*this.resolution))}var n=this.frame||this.size;this.calculateProjection(n)}},a.prototype.destroy=function(){var t=this.gl;t.deleteRenderbuffer(this.stencilBuffer),t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null}},{"../../../const":16,"../../../math":26,"../../../utils":70,"./StencilMaskStack":59}],59:[function(t,e,i){function n(){this.stencilStack=[],this.reverse=!0,this.count=0}n.prototype.constructor=n,e.exports=n},{}],60:[function(t,e,i){function n(t){o.call(this),this.anchor=new r.Point,this._texture=null,this._width=0,this._height=0,this.tint=16777215,this.blendMode=l.BLEND_MODES.NORMAL,this.shader=null,this.cachedTint=16777215,this.texture=t||s.EMPTY}var r=t("../math"),s=t("../textures/Texture"),o=t("../display/Container"),a=t("../renderers/canvas/utils/CanvasTinter"),h=t("../utils"),l=t("../const"),u=new r.Point;n.prototype=Object.create(o.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{width:{get:function(){return Math.abs(this.scale.x)*this.texture._frame.width},set:function(t){var e=h.sign(this.scale.x)||1;this.scale.x=e*t/this.texture._frame.width,this._width=t}},height:{get:function(){return Math.abs(this.scale.y)*this.texture._frame.height},set:function(t){var e=h.sign(this.scale.y)||1;this.scale.y=e*t/this.texture._frame.height,this._height=t}},texture:{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,this.cachedTint=16777215,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}}),n.prototype._onTextureUpdate=function(){this._width&&(this.scale.x=h.sign(this.scale.x)*this._width/this.texture.frame.width),this._height&&(this.scale.y=h.sign(this.scale.y)*this._height/this.texture.frame.height)},n.prototype._renderWebGL=function(t){t.setObjectRenderer(t.plugins.sprite),t.plugins.sprite.render(this)},n.prototype.getBounds=function(t){if(!this._currentBounds){var e,i,n,r,s=this._texture._frame.width,o=this._texture._frame.height,a=s*(1-this.anchor.x),h=s*-this.anchor.x,l=o*(1-this.anchor.y),u=o*-this.anchor.y,c=t||this.worldTransform,p=c.a,d=c.b,f=c.c,m=c.d,g=c.tx,y=c.ty,v=p*h+f*u+g,x=m*u+d*h+y,b=p*a+f*u+g,w=m*u+d*a+y,_=p*a+f*l+g,T=m*l+d*a+y,E=p*h+f*l+g,S=m*l+d*h+y;if(e=v,e=e>b?b:e,e=e>_?_:e,e=e>E?E:e,n=x,n=n>w?w:n,n=n>T?T:n,n=n>S?S:n,i=v,i=b>i?b:i,i=_>i?_:i,i=E>i?E:i,r=x,r=w>r?w:r,r=T>r?T:r,r=S>r?S:r,this.children.length){var A=this.containerGetBounds();a=A.x,h=A.x+A.width,l=A.y,u=A.y+A.height,e=a>e?e:a,n=l>n?n:l,i=i>h?i:h,r=r>u?r:u}var C=this._bounds;C.x=e,C.width=i-e,C.y=n,C.height=r-n,this._currentBounds=C}return this._currentBounds},n.prototype.getLocalBounds=function(){return this._bounds.x=-this._texture._frame.width*this.anchor.x,this._bounds.y=-this._texture._frame.height*this.anchor.y,this._bounds.width=this._texture._frame.width,this._bounds.height=this._texture._frame.height,this._bounds},n.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,u);var e,i=this._texture._frame.width,n=this._texture._frame.height,r=-i*this.anchor.x;return u.x>r&&u.x<r+i&&(e=-n*this.anchor.y,u.y>e&&u.y<e+n)},n.prototype._renderCanvas=function(t){if(!(this.texture.crop.width<=0||this.texture.crop.height<=0)){var e=t.blendModes[this.blendMode];if(e!==t.context.globalCompositeOperation&&(t.context.globalCompositeOperation=e),this.texture.valid){var i,n,r,s,o=this._texture,h=this.worldTransform;t.context.globalAlpha=this.worldAlpha;var u=o.baseTexture.scaleMode===l.SCALE_MODES.LINEAR;if(t.smoothProperty&&t.context[t.smoothProperty]!==u&&(t.context[t.smoothProperty]=u),o.rotate){r=o.crop.height,s=o.crop.width,i=o.trim?o.trim.y-this.anchor.y*o.trim.height:this.anchor.y*-o._frame.height,n=o.trim?o.trim.x-this.anchor.x*o.trim.width:this.anchor.x*-o._frame.width,i+=r,h.tx=n*h.a+i*h.c+h.tx,h.ty=n*h.b+i*h.d+h.ty;var c=h.a;h.a=-h.c,h.c=c,c=h.b,h.b=-h.d,h.d=c,i=0,n=0}else r=o.crop.width,s=o.crop.height,i=o.trim?o.trim.x-this.anchor.x*o.trim.width:this.anchor.x*-o._frame.width,n=o.trim?o.trim.y-this.anchor.y*o.trim.height:this.anchor.y*-o._frame.height;t.roundPixels?(t.context.setTransform(h.a,h.b,h.c,h.d,h.tx*t.resolution|0,h.ty*t.resolution|0),i=0|i,n=0|n):t.context.setTransform(h.a,h.b,h.c,h.d,h.tx*t.resolution,h.ty*t.resolution);var p=o.baseTexture.resolution;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=a.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,r*p,s*p,i*t.resolution,n*t.resolution,r*t.resolution,s*t.resolution)):t.context.drawImage(o.baseTexture.source,o.crop.x*p,o.crop.y*p,r*p,s*p,i*t.resolution,n*t.resolution,r*t.resolution,s*t.resolution)}}},n.prototype.destroy=function(t,e){o.prototype.destroy.call(this),this.anchor=null,t&&this._texture.destroy(e),this._texture=null,this.shader=null},n.fromFrame=function(t){var e=h.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return new n(e)},n.fromImage=function(t,e,i){return new n(s.fromImage(t,e,i))}},{"../const":16,"../display/Container":17,"../math":26,"../renderers/canvas/utils/CanvasTinter":41,"../textures/Texture":65,"../utils":70}],61:[function(t,e,i){function n(t){r.call(this,t),this.vertSize=5,this.vertByteSize=4*this.vertSize,this.size=o.SPRITE_BATCH_SIZE;var e=4*this.size*this.vertByteSize,i=6*this.size;this.vertices=new ArrayBuffer(e),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(i);for(var n=0,s=0;i>n;n+=6,s+=4)this.indices[n+0]=s+0,this.indices[n+1]=s+1,this.indices[n+2]=s+2,this.indices[n+3]=s+0,this.indices[n+4]=s+2,this.indices[n+5]=s+3;this.currentBatchSize=0,this.sprites=[],this.shader=null}var r=t("../../renderers/webgl/utils/ObjectRenderer"),s=t("../../renderers/webgl/WebGLRenderer"),o=t("../../const");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,s.registerPlugin("sprite",n),n.prototype.onContextChange=function(){var t=this.renderer.gl;this.shader=this.renderer.shaderManager.defaultShader,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999},n.prototype.render=function(t){var e=t._texture;this.currentBatchSize>=this.size&&this.flush();var i=e._uvs;if(i){var n,r,s,o,a=t.anchor.x,h=t.anchor.y;if(e.trim&&void 0===t.tileScale){var l=e.trim;r=l.x-a*l.width,n=r+e.crop.width,o=l.y-h*l.height,s=o+e.crop.height}else n=e._frame.width*(1-a),r=e._frame.width*-a,s=e._frame.height*(1-h),o=e._frame.height*-h;var u=this.currentBatchSize*this.vertByteSize,c=t.worldTransform,p=c.a,d=c.b,f=c.c,m=c.d,g=c.tx,y=c.ty,v=this.colors,x=this.positions;if(this.renderer.roundPixels){var b=this.renderer.resolution;x[u]=((p*r+f*o+g)*b|0)/b,x[u+1]=((m*o+d*r+y)*b|0)/b,x[u+5]=((p*n+f*o+g)*b|0)/b,x[u+6]=((m*o+d*n+y)*b|0)/b,x[u+10]=((p*n+f*s+g)*b|0)/b,x[u+11]=((m*s+d*n+y)*b|0)/b,x[u+15]=((p*r+f*s+g)*b|0)/b,x[u+16]=((m*s+d*r+y)*b|0)/b}else x[u]=p*r+f*o+g,x[u+1]=m*o+d*r+y,x[u+5]=p*n+f*o+g,x[u+6]=m*o+d*n+y,x[u+10]=p*n+f*s+g,x[u+11]=m*s+d*n+y,x[u+15]=p*r+f*s+g,x[u+16]=m*s+d*r+y;x[u+2]=i.x0,x[u+3]=i.y0,x[u+7]=i.x1,x[u+8]=i.y1,x[u+12]=i.x2,x[u+13]=i.y2,x[u+17]=i.x3,x[u+18]=i.y3;var w=t.tint;v[u+4]=v[u+9]=v[u+14]=v[u+19]=(w>>16)+(65280&w)+((255&w)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t}},n.prototype.flush=function(){if(0!==this.currentBatchSize){var t,e=this.renderer.gl;if(this.currentBatchSize>.5*this.size)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var i=this.positions.subarray(0,this.currentBatchSize*this.vertByteSize);e.bufferSubData(e.ARRAY_BUFFER,0,i)}for(var n,r,s,o,a=0,h=0,l=null,u=this.renderer.blendModeManager.currentBlendMode,c=null,p=!1,d=!1,f=0,m=this.currentBatchSize;m>f;f++)o=this.sprites[f],n=o._texture.baseTexture,r=o.blendMode,s=o.shader||this.shader,p=u!==r,d=c!==s,(l!==n||p||d)&&(this.renderBatch(l,a,h),h=f,a=0,l=n,p&&(u=r,this.renderer.blendModeManager.setBlendMode(u)),d&&(c=s,t=c.shaders?c.shaders[e.id]:c,t||(t=c.getShader(this.renderer)),this.renderer.shaderManager.setShader(t),t.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0),t.syncUniforms(),e.activeTexture(e.TEXTURE0))),a++;this.renderBatch(l,a,h),this.currentBatchSize=0}},n.prototype.renderBatch=function(t,e,i){if(0!==e){var n=this.renderer.gl;t._glTextures[n.id]?n.bindTexture(n.TEXTURE_2D,t._glTextures[n.id]):this.renderer.updateTexture(t),n.drawElements(n.TRIANGLES,6*e,n.UNSIGNED_SHORT,6*i*2),this.renderer.drawCount++}},n.prototype.start=function(){var t=this.renderer.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.vertByteSize;t.vertexAttribPointer(this.shader.attributes.aVertexPosition,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(this.shader.attributes.aTextureCoord,2,t.FLOAT,!1,e,8),t.vertexAttribPointer(this.shader.attributes.aColor,4,t.UNSIGNED_BYTE,!0,e,16)},n.prototype.destroy=function(){this.renderer.gl.deleteBuffer(this.vertexBuffer),this.renderer.gl.deleteBuffer(this.indexBuffer),r.prototype.destroy.call(this),this.shader.destroy(),this.renderer=null,this.vertices=null,this.positions=null,this.colors=null,this.indices=null,this.vertexBuffer=null,this.indexBuffer=null,this.sprites=null,this.shader=null}},{"../../const":16,"../../renderers/webgl/WebGLRenderer":42,"../../renderers/webgl/utils/ObjectRenderer":56}],62:[function(t,e,i){function n(t,e,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=i||h.RESOLUTION,this._text=null,this._style=null;var n=s.fromCanvas(this.canvas);n.trim=new o.Rectangle,r.call(this,n),this.text=t,this.style=e}var r=t("../sprites/Sprite"),s=t("../textures/Texture"),o=t("../math"),a=t("../utils"),h=t("../const");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.fontPropertiesCache={},n.fontPropertiesCanvas=document.createElement("canvas"),n.fontPropertiesContext=n.fontPropertiesCanvas.getContext("2d"),Object.defineProperties(n.prototype,{width:{get:function(){return this.dirty&&this.updateText(),this.scale.x*this._texture._frame.width},set:function(t){this.scale.x=t/this._texture._frame.width,this._width=t}},height:{get:function(){return this.dirty&&this.updateText(),this.scale.y*this._texture._frame.height},set:function(t){this.scale.y=t/this._texture._frame.height,this._height=t}},style:{get:function(){return this._style},set:function(t){t=t||{},"number"==typeof t.fill&&(t.fill=a.hex2string(t.fill)),"number"==typeof t.stroke&&(t.stroke=a.hex2string(t.stroke)),"number"==typeof t.dropShadowColor&&(t.dropShadowColor=a.hex2string(t.dropShadowColor)),t.font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.dropShadow=t.dropShadow||!1,t.dropShadowColor=t.dropShadowColor||"#000000",t.dropShadowAngle=void 0!==t.dropShadowAngle?t.dropShadowAngle:Math.PI/6,t.dropShadowDistance=void 0!==t.dropShadowDistance?t.dropShadowDistance:5,t.dropShadowBlur=void 0!==t.dropShadowBlur?t.dropShadowBlur:0,t.padding=t.padding||0,t.textBaseline=t.textBaseline||"alphabetic",t.lineJoin=t.lineJoin||"miter",t.miterLimit=t.miterLimit||10,this._style=t,this.dirty=!0}},text:{get:function(){return this._text},set:function(t){t=t.toString()||" ",this._text!==t&&(this._text=t,this.dirty=!0)}}}),n.prototype.updateText=function(){var t=this._style;this.context.font=t.font;for(var e=t.wordWrap?this.wordWrap(this._text):this._text,i=e.split(/(?:\r\n|\r|\n)/),n=new Array(i.length),r=0,s=this.determineFontProperties(t.font),o=0;o<i.length;o++){var a=this.context.measureText(i[o]).width;n[o]=a,r=Math.max(r,a)}var h=r+t.strokeThickness;t.dropShadow&&(h+=t.dropShadowDistance),this.canvas.width=(h+this.context.lineWidth)*this.resolution;var l=this.style.lineHeight||s.fontSize+t.strokeThickness,u=l*i.length;t.dropShadow&&(u+=t.dropShadowDistance),this.canvas.height=(u+2*this._style.padding)*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=t.font,this.context.strokeStyle=t.stroke,this.context.lineWidth=t.strokeThickness,this.context.textBaseline=t.textBaseline,this.context.lineJoin=t.lineJoin,this.context.miterLimit=t.miterLimit;var c,p;if(t.dropShadow){t.dropShadowBlur>0?(this.context.shadowColor=t.dropShadowColor,this.context.shadowBlur=t.dropShadowBlur):this.context.fillStyle=t.dropShadowColor;var d=Math.cos(t.dropShadowAngle)*t.dropShadowDistance,f=Math.sin(t.dropShadowAngle)*t.dropShadowDistance;for(o=0;o<i.length;o++)c=t.strokeThickness/2,p=t.strokeThickness/2+o*l+s.ascent,"right"===t.align?c+=r-n[o]:"center"===t.align&&(c+=(r-n[o])/2),t.fill&&this.context.fillText(i[o],c+d,p+f+this._style.padding)}for(this.context.fillStyle=t.fill,o=0;o<i.length;o++)c=t.strokeThickness/2,p=t.strokeThickness/2+o*l+s.ascent,"right"===t.align?c+=r-n[o]:"center"===t.align&&(c+=(r-n[o])/2),t.stroke&&t.strokeThickness&&this.context.strokeText(i[o],c,p+this._style.padding),t.fill&&this.context.fillText(i[o],c,p+this._style.padding);this.updateTexture()},n.prototype.updateTexture=function(){var t=this._texture;t.baseTexture.hasLoaded=!0,t.baseTexture.resolution=this.resolution,t.baseTexture.width=this.canvas.width/this.resolution,t.baseTexture.height=this.canvas.height/this.resolution,t.crop.width=t._frame.width=this.canvas.width/this.resolution,t.crop.height=t._frame.height=this.canvas.height/this.resolution,
t.trim.x=0,t.trim.y=-this._style.padding,t.trim.width=t._frame.width,t.trim.height=t._frame.height-2*this._style.padding,this._width=this.canvas.width/this.resolution,this._height=this.canvas.height/this.resolution,t.baseTexture.emit("update",t.baseTexture),this.dirty=!1},n.prototype.renderWebGL=function(t){this.dirty&&this.updateText(),r.prototype.renderWebGL.call(this,t)},n.prototype._renderCanvas=function(t){this.dirty&&this.updateText(),r.prototype._renderCanvas.call(this,t)},n.prototype.determineFontProperties=function(t){var e=n.fontPropertiesCache[t];if(!e){e={};var i=n.fontPropertiesCanvas,r=n.fontPropertiesContext;r.font=t;var s=Math.ceil(r.measureText("|Mq").width),o=Math.ceil(r.measureText("M").width),a=2*o;o=1.4*o|0,i.width=s,i.height=a,r.fillStyle="#f00",r.fillRect(0,0,s,a),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText("|Mq",0,o);var h,l,u=r.getImageData(0,0,s,a).data,c=u.length,p=4*s,d=0,f=!1;for(h=0;o>h;h++){for(l=0;p>l;l+=4)if(255!==u[d+l]){f=!0;break}if(f)break;d+=p}for(e.ascent=o-h,d=c-p,f=!1,h=a;h>o;h--){for(l=0;p>l;l+=4)if(255!==u[d+l]){f=!0;break}if(f)break;d-=p}e.descent=h-o,e.fontSize=e.ascent+e.descent,n.fontPropertiesCache[t]=e}return e},n.prototype.wordWrap=function(t){for(var e="",i=t.split("\n"),n=this._style.wordWrapWidth,r=0;r<i.length;r++){for(var s=n,o=i[r].split(" "),a=0;a<o.length;a++){var h=this.context.measureText(o[a]).width,l=h+this.context.measureText(" ").width;0===a||l>s?(a>0&&(e+="\n"),e+=o[a],s=n-h):(s-=l,e+=" "+o[a])}r<i.length-1&&(e+="\n")}return e},n.prototype.getBounds=function(t){return this.dirty&&this.updateText(),r.prototype.getBounds.call(this,t)},n.prototype.destroy=function(t){this.context=null,this.canvas=null,this._style=null,this._texture.destroy(void 0===t?!0:t)}},{"../const":16,"../math":26,"../sprites/Sprite":60,"../textures/Texture":65,"../utils":70}],63:[function(t,e,i){function n(t,e,i){o.call(this),this.uid=r.uid(),this.resolution=i||1,this.width=100,this.height=100,this.realWidth=100,this.realHeight=100,this.scaleMode=e||s.SCALE_MODES.DEFAULT,this.hasLoaded=!1,this.isLoading=!1,this.source=null,this.premultipliedAlpha=!0,this.imageUrl=null,this.isPowerOfTwo=!1,this.mipmap=!1,this._glTextures={},t&&this.loadSource(t)}var r=t("../utils"),s=t("../const"),o=t("eventemitter3");n.prototype=Object.create(o.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.update=function(){this.realWidth=this.source.naturalWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.height,this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=r.isPowerOfTwo(this.realWidth,this.realHeight),this.emit("update",this)},n.prototype.loadSource=function(t){var e=this.isLoading;if(this.hasLoaded=!1,this.isLoading=!1,e&&this.source&&(this.source.onload=null,this.source.onerror=null),this.source=t,(this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this._sourceLoaded();else if(!t.getContext){this.isLoading=!0;var i=this;t.onload=function(){t.onload=null,t.onerror=null,i.isLoading&&(i.isLoading=!1,i._sourceLoaded(),i.emit("loaded",i))},t.onerror=function(){t.onload=null,t.onerror=null,i.isLoading&&(i.isLoading=!1,i.emit("error",i))},t.complete&&t.src&&(this.isLoading=!1,t.onload=null,t.onerror=null,t.width&&t.height?(this._sourceLoaded(),e&&this.emit("loaded",this)):e&&this.emit("error",this))}},n.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},n.prototype.destroy=function(){this.imageUrl?(delete r.BaseTextureCache[this.imageUrl],delete r.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete r.BaseTextureCache[this.source._pixiId],this.source=null,this.dispose()},n.prototype.dispose=function(){this.emit("dispose",this)},n.prototype.updateSourceImage=function(t){this.source.src=t,this.loadSource(this.source)},n.fromImage=function(t,e,i){var s=r.BaseTextureCache[t];if(void 0===e&&0!==t.indexOf("data:")&&(e=!0),!s){var o=new Image;e&&(o.crossOrigin=""),s=new n(o,i),s.imageUrl=t,o.src=t,r.BaseTextureCache[t]=s,s.resolution=r.getResolutionOfUrl(t)}return s},n.fromCanvas=function(t,e){t._pixiId||(t._pixiId="canvas_"+r.uid());var i=r.BaseTextureCache[t._pixiId];return i||(i=new n(t,e),r.BaseTextureCache[t._pixiId]=i),i}},{"../const":16,"../utils":70,eventemitter3:10}],64:[function(t,e,i){function n(t,e,i,n,c){if(!t)throw new Error("Unable to create RenderTexture, you must pass a renderer into the constructor.");e=e||100,i=i||100,c=c||u.RESOLUTION;var p=new r;if(p.width=e,p.height=i,p.resolution=c,p.scaleMode=n||u.SCALE_MODES.DEFAULT,p.hasLoaded=!0,s.call(this,p,new l.Rectangle(0,0,e,i)),this.width=e,this.height=i,this.resolution=c,this.render=null,this.renderer=t,this.renderer.type===u.RENDERER_TYPE.WEBGL){var d=this.renderer.gl;this.textureBuffer=new o(d,this.width,this.height,p.scaleMode,this.resolution),this.baseTexture._glTextures[d.id]=this.textureBuffer.texture,this.filterManager=new a(this.renderer),this.filterManager.onContextChange(),this.filterManager.resize(e,i),this.render=this.renderWebGL,this.renderer.currentRenderer.start(),this.renderer.currentRenderTarget.activate()}else this.render=this.renderCanvas,this.textureBuffer=new h(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()}var r=t("./BaseTexture"),s=t("./Texture"),o=t("../renderers/webgl/utils/RenderTarget"),a=t("../renderers/webgl/managers/FilterManager"),h=t("../renderers/canvas/utils/CanvasBuffer"),l=t("../math"),u=t("../const"),c=new l.Matrix;n.prototype=Object.create(s.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.resize=function(t,e,i){t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=this._frame.width=this.crop.width=t,this.height=this._frame.height=this.crop.height=e,i&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.valid&&(this.textureBuffer.resize(this.width,this.height),this.filterManager&&this.filterManager.resize(this.width,this.height)))},n.prototype.clear=function(){this.valid&&(this.renderer.type===u.RENDERER_TYPE.WEBGL&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},n.prototype.renderWebGL=function(t,e,i,n){if(this.valid){if(n=void 0!==n?n:!0,this.textureBuffer.transform=e,this.textureBuffer.activate(),t.worldAlpha=1,n){t.worldTransform.identity(),t.currentBounds=null;var r,s,o=t.children;for(r=0,s=o.length;s>r;++r)o[r].updateTransform()}var a=this.renderer.filterManager;this.renderer.filterManager=this.filterManager,this.renderer.renderDisplayObject(t,this.textureBuffer,i),this.renderer.filterManager=a}},n.prototype.renderCanvas=function(t,e,i,n){if(this.valid){n=!!n;var r=c;r.identity(),e&&r.append(e);var s=t.worldTransform;t.worldTransform=r,t.worldAlpha=1;var o,a,h=t.children;for(o=0,a=h.length;a>o;++o)h[o].updateTransform();i&&this.textureBuffer.clear();var l=this.textureBuffer.context,u=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,l),this.renderer.resolution=u,t.worldTransform===r&&(t.worldTransform=s)}},n.prototype.destroy=function(){s.prototype.destroy.call(this,!0),this.textureBuffer.destroy(),this.filterManager&&this.filterManager.destroy(),this.renderer=null},n.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},n.prototype.getBase64=function(){return this.getCanvas().toDataURL()},n.prototype.getCanvas=function(){if(this.renderer.type===u.RENDERER_TYPE.WEBGL){var t=this.renderer.gl,e=this.textureBuffer.size.width,i=this.textureBuffer.size.height,n=new Uint8Array(4*e*i);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,e,i,t.RGBA,t.UNSIGNED_BYTE,n),t.bindFramebuffer(t.FRAMEBUFFER,null);var r=new h(e,i),s=r.context.getImageData(0,0,e,i);return s.data.set(n),r.context.putImageData(s,0,0),r.canvas}return this.textureBuffer.canvas},n.prototype.getPixels=function(){var t,e;if(this.renderer.type===u.RENDERER_TYPE.WEBGL){var i=this.renderer.gl;t=this.textureBuffer.size.width,e=this.textureBuffer.size.height;var n=new Uint8Array(4*t*e);return i.bindFramebuffer(i.FRAMEBUFFER,this.textureBuffer.frameBuffer),i.readPixels(0,0,t,e,i.RGBA,i.UNSIGNED_BYTE,n),i.bindFramebuffer(i.FRAMEBUFFER,null),n}return t=this.textureBuffer.canvas.width,e=this.textureBuffer.canvas.height,this.textureBuffer.canvas.getContext("2d").getImageData(0,0,t,e).data},n.prototype.getPixel=function(t,e){if(this.renderer.type===u.RENDERER_TYPE.WEBGL){var i=this.renderer.gl,n=new Uint8Array(4);return i.bindFramebuffer(i.FRAMEBUFFER,this.textureBuffer.frameBuffer),i.readPixels(t,e,1,1,i.RGBA,i.UNSIGNED_BYTE,n),i.bindFramebuffer(i.FRAMEBUFFER,null),n}return this.textureBuffer.canvas.getContext("2d").getImageData(t,e,1,1).data}},{"../const":16,"../math":26,"../renderers/canvas/utils/CanvasBuffer":38,"../renderers/webgl/managers/FilterManager":47,"../renderers/webgl/utils/RenderTarget":58,"./BaseTexture":63,"./Texture":65}],65:[function(t,e,i){function n(t,e,i,r,s){a.call(this),this.noFrame=!1,e||(this.noFrame=!0,e=new h.Rectangle(0,0,1,1)),t instanceof n&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=r,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=i||e,this.rotate=!!s,t.hasLoaded?(this.noFrame&&(e=new h.Rectangle(0,0,t.width,t.height),t.on("update",this.onBaseTextureUpdated,this)),this.frame=e):t.once("loaded",this.onBaseTextureLoaded,this)}var r=t("./BaseTexture"),s=t("./VideoBaseTexture"),o=t("./TextureUvs"),a=t("eventemitter3"),h=t("../math"),l=t("../utils");n.prototype=Object.create(a.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{frame:{get:function(){return this._frame},set:function(t){if(this._frame=t,this.noFrame=!1,this.width=t.width,this.height=t.height,!this.trim&&!this.rotate&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.hasLoaded,this.trim?(this.width=this.trim.width,this.height=this.trim.height,this._frame.width=this.trim.width,this._frame.height=this.trim.height):this.crop=t,this.valid&&this._updateUvs()}}}),n.prototype.update=function(){this.baseTexture.update()},n.prototype.onBaseTextureLoaded=function(t){this.noFrame?this.frame=new h.Rectangle(0,0,t.width,t.height):this.frame=this._frame,this.emit("update",this)},n.prototype.onBaseTextureUpdated=function(t){this._frame.width=t.width,this._frame.height=t.height,this.emit("update",this)},n.prototype.destroy=function(t){this.baseTexture&&(t&&this.baseTexture.destroy(),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.crop=null,this.valid=!1,this.off("dispose",this.dispose,this),this.off("update",this.update,this)},n.prototype.clone=function(){return new n(this.baseTexture,this.frame,this.crop,this.trim,this.rotate)},n.prototype._updateUvs=function(){this._uvs||(this._uvs=new o),this._uvs.set(this.crop,this.baseTexture,this.rotate)},n.fromImage=function(t,e,i){var s=l.TextureCache[t];return s||(s=new n(r.fromImage(t,e,i)),l.TextureCache[t]=s),s},n.fromFrame=function(t){var e=l.TextureCache[t];if(!e)throw new Error('The frameId "'+t+'" does not exist in the texture cache');return e},n.fromCanvas=function(t,e){return new n(r.fromCanvas(t,e))},n.fromVideo=function(t,e){return"string"==typeof t?n.fromVideoUrl(t,e):new n(s.fromVideo(t,e))},n.fromVideoUrl=function(t,e){return new n(s.fromUrl(t,e))},n.addTextureToCache=function(t,e){l.TextureCache[e]=t},n.removeTextureFromCache=function(t){var e=l.TextureCache[t];return delete l.TextureCache[t],delete l.BaseTextureCache[t],e},n.EMPTY=new n(new r)},{"../math":26,"../utils":70,"./BaseTexture":63,"./TextureUvs":66,"./VideoBaseTexture":67,eventemitter3:10}],66:[function(t,e,i){function n(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1}e.exports=n,n.prototype.set=function(t,e,i){var n=e.width,r=e.height;i?(this.x0=(t.x+t.height)/n,this.y0=t.y/r,this.x1=(t.x+t.height)/n,this.y1=(t.y+t.width)/r,this.x2=t.x/n,this.y2=(t.y+t.width)/r,this.x3=t.x/n,this.y3=t.y/r):(this.x0=t.x/n,this.y0=t.y/r,this.x1=(t.x+t.width)/n,this.y1=t.y/r,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/r,this.x3=t.x/n,this.y3=(t.y+t.height)/r)}},{}],67:[function(t,e,i){function n(t,e){if(!t)throw new Error("No video source element specified.");(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),s.call(this,t,e),this.autoUpdate=!1,this._onUpdate=this._onUpdate.bind(this),this._onCanPlay=this._onCanPlay.bind(this),t.complete||(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this))),this.__loaded=!1}function r(t,e){e||(e="video/"+t.substr(t.lastIndexOf(".")+1));var i=document.createElement("source");return i.src=t,i.type=e,i}var s=t("./BaseTexture"),o=t("../utils");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,e.exports=n,n.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this._onUpdate),this.update())},n.prototype._onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this._onUpdate),this.autoUpdate=!0)},n.prototype._onPlayStop=function(){this.autoUpdate=!1},n.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.source.play(),this.__loaded||(this.__loaded=!0,this.emit("loaded",this)))},n.prototype.destroy=function(){this.source&&this.source._pixiId&&(delete o.BaseTextureCache[this.source._pixiId],delete this.source._pixiId),s.prototype.destroy.call(this)},n.fromVideo=function(t,e){t._pixiId||(t._pixiId="video_"+o.uid());var i=o.BaseTextureCache[t._pixiId];return i||(i=new n(t,e),o.BaseTextureCache[t._pixiId]=i),i},n.fromUrl=function(t,e){var i=document.createElement("video");if(Array.isArray(t))for(var s=0;s<t.length;++s)i.appendChild(r(t[s].src||t[s],t[s].mime));else i.appendChild(r(t.src||t,t.mime));return i.load(),i.play(),n.fromVideo(i,e)},n.fromUrls=n.fromUrl},{"../utils":70,"./BaseTexture":63}],68:[function(t,e,i){function n(){var t=this;this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._emitter.listeners(o,!0)&&(t._requestId=requestAnimationFrame(t._tick)))},this._emitter=new s,this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/r.TARGET_FPMS,this.lastTime=0,this.speed=1,this.started=!1}var r=t("../const"),s=t("eventemitter3"),o="tick";Object.defineProperties(n.prototype,{FPS:{get:function(){return 1e3/this.elapsedMS}},minFPS:{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(Math.max(0,t)/1e3,r.TARGET_FPMS);this._maxElapsedMS=1/e}}}),n.prototype._requestIfNeeded=function(){null===this._requestId&&this._emitter.listeners(o,!0)&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},n.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},n.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},n.prototype.add=function(t,e){return this._emitter.on(o,t,e),this._startIfPossible(),this},n.prototype.addOnce=function(t,e){return this._emitter.once(o,t,e),this._startIfPossible(),this},n.prototype.remove=function(t,e){return this._emitter.off(o,t,e),this._emitter.listeners(o,!0)||this._cancelIfNeeded(),this},n.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},n.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},n.prototype.update=function(t){var e;t=t||performance.now(),e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),this.deltaTime=e*r.TARGET_FPMS*this.speed,this._emitter.emit(o,this.deltaTime),this.lastTime=t},e.exports=n},{"../const":16,eventemitter3:10}],69:[function(t,e,i){var n=t("./Ticker"),r=new n;r.autoStart=!0,e.exports={shared:r,Ticker:n}},{"./Ticker":68}],70:[function(t,e,i){var n=t("../const"),r=e.exports={_uid:0,_saidHello:!1,EventEmitter:t("eventemitter3"),pluginTarget:t("./pluginTarget"),async:t("async"),uid:function(){return++r._uid},hex2rgb:function(t,e){return e=e||[],e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e},hex2string:function(t){return t=t.toString(16),t="000000".substr(0,6-t.length)+t,"#"+t},rgb2hex:function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},canUseNewCanvasBlendModes:function(){if("undefined"==typeof document)return!1;var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",e="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",i=new Image;i.src=t+"AP804Oa6"+e;var n=new Image;n.src=t+"/wCKxvRF"+e;var r=document.createElement("canvas");r.width=6,r.height=1;var s=r.getContext("2d");s.globalCompositeOperation="multiply",s.drawImage(i,0,0),s.drawImage(n,2,0);var o=s.getImageData(2,0,1,1).data;return 255===o[0]&&0===o[1]&&0===o[2]},getNextPowerOfTwo:function(t){if(t>0&&0===(t&t-1))return t;for(var e=1;t>e;)e<<=1;return e},isPowerOfTwo:function(t,e){return t>0&&0===(t&t-1)&&e>0&&0===(e&e-1)},getResolutionOfUrl:function(t){var e=n.RETINA_PREFIX.exec(t);return e?parseFloat(e[1]):1},sayHello:function(t){if(!r._saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var e=["\n %c %c %c Pixi.js "+n.VERSION+" -  "+t+"   %c  %c  http://www.pixijs.com/  %c %c %c%c \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,e)}else window.console&&window.console.log("Pixi.js "+n.VERSION+" - "+t+" - http://www.pixijs.com/");r._saidHello=!0}},isWebGLSupported:function(){var t={stencil:!0};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);return!(!i||!i.getContextAttributes().stencil)}catch(n){return!1}},sign:function(t){return t?0>t?-1:1:0},removeItems:function(t,e,i){var n=t.length;if(!(e>=n||0===i)){i=e+i>n?n-e:i;for(var r=e,s=n-i;s>r;++r)t[r]=t[r+i];t.length=s}},TextureCache:{},BaseTextureCache:{}}},{"../const":16,"./pluginTarget":71,async:1,eventemitter3:10}],71:[function(t,e,i){function n(t){t.__plugins={},t.registerPlugin=function(e,i){t.__plugins[e]=i},t.prototype.initPlugins=function(){this.plugins=this.plugins||{};for(var e in t.__plugins)this.plugins[e]=new t.__plugins[e](this)},t.prototype.destroyPlugins=function(){for(var t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null;this.plugins=null}}e.exports={mixin:function(t){n(t)}}},{}],72:[function(t,e,i){var n=t("./core"),r=t("./mesh"),s=t("./extras"),o=t("./filters");n.SpriteBatch=function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")},n.AssetLoader=function(){throw new ReferenceError("The loader system was overhauled in pixi v3, please see the new PIXI.loaders.Loader class.")},Object.defineProperties(n,{Stage:{get:function(){return console.warn("You do not need to use a PIXI Stage any more, you can simply render any container."),n.Container}},DisplayObjectContainer:{get:function(){return console.warn("DisplayObjectContainer has been shortened to Container, please use Container from now on."),n.Container}},Strip:{get:function(){return console.warn("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."),r.Mesh}},Rope:{get:function(){return console.warn("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."),r.Rope}},MovieClip:{get:function(){return console.warn("The MovieClip class has been moved to extras.MovieClip, please use extras.MovieClip from now on."),s.MovieClip}},TilingSprite:{get:function(){return console.warn("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."),s.TilingSprite}},BitmapText:{get:function(){return console.warn("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."),s.BitmapText}},blendModes:{get:function(){return console.warn("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."),n.BLEND_MODES}},scaleModes:{get:function(){return console.warn("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."),n.SCALE_MODES}},BaseTextureCache:{get:function(){return console.warn("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."),n.utils.BaseTextureCache}},TextureCache:{get:function(){return console.warn("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."),n.utils.TextureCache}},math:{get:function(){return console.warn("The math namespace is deprecated, please access members already accessible on PIXI."),n}}}),n.Sprite.prototype.setTexture=function(t){this.texture=t,console.warn("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")},s.BitmapText.prototype.setText=function(t){this.text=t,console.warn("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")},n.Text.prototype.setText=function(t){this.text=t,console.warn("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")},n.Text.prototype.setStyle=function(t){this.style=t,console.warn("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")},n.Texture.prototype.setFrame=function(t){this.frame=t,console.warn("setFrame is now deprecated, please use the frame property, e.g : myTexture.frame = frame;")},Object.defineProperties(o,{AbstractFilter:{get:function(){return console.warn("filters.AbstractFilter is an undocumented alias, please use AbstractFilter from now on."),n.AbstractFilter}},FXAAFilter:{get:function(){return console.warn("filters.FXAAFilter is an undocumented alias, please use FXAAFilter from now on."),n.FXAAFilter}},SpriteMaskFilter:{get:function(){return console.warn("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."),n.SpriteMaskFilter}}}),n.utils.uuid=function(){return console.warn("utils.uuid() is deprecated, please use utils.uid() from now on."),n.utils.uid()}},{"./core":23,"./extras":79,"./filters":96,"./mesh":121}],73:[function(t,e,i){function n(t,e){r.Container.call(this),e=e||{},this.textWidth=0,this.textHeight=0,this._glyphs=[],this._font={tint:void 0!==e.tint?e.tint:16777215,align:e.align||"left",name:null,size:0},this.font=e.font,this._text=t,this.maxWidth=0,this.maxLineHeight=0,this.dirty=!1,this.updateText()}var r=t("../core");n.prototype=Object.create(r.Container.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{tint:{get:function(){return this._font.tint},set:function(t){this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0}},align:{get:function(){return this._font.align},set:function(t){this._font.align=t||"left",this.dirty=!0}},font:{get:function(){return this._font},set:function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):n.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)}},text:{get:function(){return this._text},set:function(t){t=t.toString()||" ",this._text!==t&&(this._text=t,this.dirty=!0)}}}),n.prototype.updateText=function(){for(var t=n.fonts[this._font.name],e=new r.Point,i=null,s=[],o=0,a=0,h=[],l=0,u=this._font.size/t.size,c=-1,p=0,d=0;d<this.text.length;d++){var f=this.text.charCodeAt(d);if(c=/(\s)/.test(this.text.charAt(d))?d:c,/(?:\r\n|\r|\n)/.test(this.text.charAt(d)))h.push(o),a=Math.max(a,o),l++,e.x=0,e.y+=t.lineHeight,i=null;else if(-1!==c&&this.maxWidth>0&&e.x*u>this.maxWidth)r.utils.removeItems(s,c,d-c),d=c,c=-1,h.push(o),a=Math.max(a,o),l++,e.x=0,e.y+=t.lineHeight,i=null;else{var m=t.chars[f];m&&(i&&m.kerning[i]&&(e.x+=m.kerning[i]),s.push({texture:m.texture,line:l,charCode:f,position:new r.Point(e.x+m.xOffset,e.y+m.yOffset)}),o=e.x+(m.texture.width+m.xOffset),e.x+=m.xAdvance,p=Math.max(p,m.yOffset+m.texture.height),i=f)}}h.push(o),a=Math.max(a,o);var g=[];for(d=0;l>=d;d++){var y=0;"right"===this._font.align?y=a-h[d]:"center"===this._font.align&&(y=(a-h[d])/2),g.push(y)}var v=s.length,x=this.tint;for(d=0;v>d;d++){var b=this._glyphs[d];b?b.texture=s[d].texture:(b=new r.Sprite(s[d].texture),this._glyphs.push(b)),b.position.x=(s[d].position.x+g[s[d].line])*u,b.position.y=s[d].position.y*u,b.scale.x=b.scale.y=u,b.tint=x,b.parent||this.addChild(b)}for(d=v;d<this._glyphs.length;++d)this.removeChild(this._glyphs[d]);this.textWidth=a*u,this.textHeight=(e.y+t.lineHeight)*u,this.maxLineHeight=p*u},n.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},n.prototype.getLocalBounds=function(){return this.validate(),r.Container.prototype.getLocalBounds.call(this)},n.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},n.fonts={}},{"../core":23}],74:[function(t,e,i){function n(t){r.Sprite.call(this,t[0]instanceof r.Texture?t[0]:t[0].texture),this._textures=null,this._durations=null,this.textures=t,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this._currentTime=0,this.playing=!1}var r=t("../core");n.prototype=Object.create(r.Sprite.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{totalFrames:{get:function(){return this._textures.length}},textures:{get:function(){return this._textures},set:function(t){if(t[0]instanceof r.Texture)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}}},currentFrame:{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return 0>t&&(t+=this._textures.length),t}}}),n.prototype.stop=function(){this.playing&&(this.playing=!1,r.ticker.shared.remove(this.update,this))},n.prototype.play=function(){this.playing||(this.playing=!0,r.ticker.shared.add(this.update,this))},n.prototype.gotoAndStop=function(t){this.stop(),this._currentTime=t,this._texture=this._textures[this.currentFrame]},n.prototype.gotoAndPlay=function(t){this._currentTime=t,this.play()},n.prototype.update=function(t){var e=this.animationSpeed*t;if(null!==this._durations){var i=this._currentTime%1*this._durations[this.currentFrame];for(i+=e/60*1e3;0>i;)this._currentTime--,i+=this._durations[this.currentFrame];var n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);i>=this._durations[this.currentFrame];)i-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=i/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):this._texture=this._textures[this.currentFrame]},n.prototype.destroy=function(){this.stop(),r.Sprite.prototype.destroy.call(this)},n.fromFrames=function(t){for(var e=[],i=0;i<t.length;++i)e.push(new r.Texture.fromFrame(t[i]));return new n(e)},n.fromImages=function(t){for(var e=[],i=0;i<t.length;++i)e.push(new r.Texture.fromImage(t[i]));return new n(e)}},{"../core":23}],75:[function(t,e,i){function n(t,e,i){r.Sprite.call(this,t),this.tileScale=new r.Point(1,1),this.tilePosition=new r.Point(0,0),this._width=e||100,this._height=i||100,this._uvs=new r.TextureUvs,this._canvasPattern=null,this.shader=new r.AbstractFilter(["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","uniform vec4 uFrame;","uniform vec4 uTransform;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vec2 coord = aTextureCoord;","   coord -= uTransform.xy;","   coord /= uTransform.zw;","   vTextureCoord = coord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform vec4 uFrame;","uniform vec2 uPixelSize;","void main(void){","   vec2 coord = mod(vTextureCoord, uFrame.zw);","   coord = clamp(coord, uPixelSize, uFrame.zw - uPixelSize);","   coord += uFrame.xy;","   gl_FragColor =  texture2D(uSampler, coord) * vColor ;","}"].join("\n"),{uFrame:{type:"4fv",value:[0,0,1,1]},uTransform:{type:"4fv",value:[0,0,1,1]},uPixelSize:{type:"2fv",value:[1,1]}})}var r=t("../core"),s=new r.Point,o=t("../core/renderers/canvas/utils/CanvasTinter");n.prototype=Object.create(r.Sprite.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{width:{get:function(){return this._width},set:function(t){this._width=t}},height:{get:function(){return this._height},set:function(t){this._height=t}}}),n.prototype._onTextureUpdate=function(){},n.prototype._renderWebGL=function(t){var e=this._texture;if(e&&e._uvs){var i=e._uvs,n=e._frame.width,r=e._frame.height,s=e.baseTexture.width,o=e.baseTexture.height;e._uvs=this._uvs,e._frame.width=this.width,e._frame.height=this.height,this.shader.uniforms.uPixelSize.value[0]=1/s,this.shader.uniforms.uPixelSize.value[1]=1/o,this.shader.uniforms.uFrame.value[0]=i.x0,this.shader.uniforms.uFrame.value[1]=i.y0,this.shader.uniforms.uFrame.value[2]=i.x1-i.x0,this.shader.uniforms.uFrame.value[3]=i.y2-i.y0,this.shader.uniforms.uTransform.value[0]=this.tilePosition.x%(n*this.tileScale.x)/this._width,this.shader.uniforms.uTransform.value[1]=this.tilePosition.y%(r*this.tileScale.y)/this._height,this.shader.uniforms.uTransform.value[2]=s/this._width*this.tileScale.x,this.shader.uniforms.uTransform.value[3]=o/this._height*this.tileScale.y,t.setObjectRenderer(t.plugins.sprite),t.plugins.sprite.render(this),e._uvs=i,e._frame.width=n,e._frame.height=r}},n.prototype._renderCanvas=function(t){var e=this._texture;if(e.baseTexture.hasLoaded){var i=t.context,n=this.worldTransform,s=t.resolution,a=e.baseTexture,h=this.tilePosition.x/this.tileScale.x%e._frame.width,l=this.tilePosition.y/this.tileScale.y%e._frame.height;if(!this._canvasPattern){var u=new r.CanvasBuffer(e._frame.width,e._frame.height);16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=o.getTintedTexture(this,this.tint)),u.context.drawImage(this.tintedTexture,0,0)):u.context.drawImage(a.source,-e._frame.x,-e._frame.y),this._canvasPattern=u.context.createPattern(u.canvas,"repeat")}i.globalAlpha=this.worldAlpha,i.setTransform(n.a*s,n.b*s,n.c*s,n.d*s,n.tx*s,n.ty*s),i.scale(this.tileScale.x,this.tileScale.y),i.translate(h+this.anchor.x*-this._width,l+this.anchor.y*-this._height);var c=t.blendModes[this.blendMode];c!==t.context.globalCompositeOperation&&(i.globalCompositeOperation=c),
i.fillStyle=this._canvasPattern,i.fillRect(-h,-l,this._width/this.tileScale.x,this._height/this.tileScale.y)}},n.prototype.getBounds=function(){var t,e,i,n,r=this._width,s=this._height,o=r*(1-this.anchor.x),a=r*-this.anchor.x,h=s*(1-this.anchor.y),l=s*-this.anchor.y,u=this.worldTransform,c=u.a,p=u.b,d=u.c,f=u.d,m=u.tx,g=u.ty,y=c*a+d*l+m,v=f*l+p*a+g,x=c*o+d*l+m,b=f*l+p*o+g,w=c*o+d*h+m,_=f*h+p*o+g,T=c*a+d*h+m,E=f*h+p*a+g;t=y,t=t>x?x:t,t=t>w?w:t,t=t>T?T:t,i=v,i=i>b?b:i,i=i>_?_:i,i=i>E?E:i,e=y,e=x>e?x:e,e=w>e?w:e,e=T>e?T:e,n=v,n=b>n?b:n,n=_>n?_:n,n=E>n?E:n;var S=this._bounds;return S.x=t,S.width=e-t,S.y=i,S.height=n-i,this._currentBounds=S,S},n.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,s);var e,i=this._width,n=this._height,r=-i*this.anchor.x;return s.x>r&&s.x<r+i&&(e=-n*this.anchor.y,s.y>e&&s.y<e+n)},n.prototype.destroy=function(){r.Sprite.prototype.destroy.call(this),this.tileScale=null,this._tileScaleOffset=null,this.tilePosition=null,this._uvs=null},n.fromFrame=function(t,e,i){var s=r.utils.TextureCache[t];if(!s)throw new Error('The frameId "'+t+'" does not exist in the texture cache '+this);return new n(s,e,i)},n.fromImage=function(t,e,i,s,o){return new n(r.Texture.fromImage(t,s,o),e,i)}},{"../core":23,"../core/renderers/canvas/utils/CanvasTinter":41}],76:[function(t,e,i){var n=t("../core"),r=n.DisplayObject,s=new n.Matrix;r.prototype._cacheAsBitmap=!1,r.prototype._originalRenderWebGL=null,r.prototype._originalRenderCanvas=null,r.prototype._originalUpdateTransform=null,r.prototype._originalHitTest=null,r.prototype._originalDestroy=null,r.prototype._cachedSprite=null,Object.defineProperties(r.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._originalRenderWebGL=this.renderWebGL,this._originalRenderCanvas=this.renderCanvas,this._originalUpdateTransform=this.updateTransform,this._originalGetBounds=this.getBounds,this._originalDestroy=this.destroy,this._originalContainsPoint=this.containsPoint,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(this._cachedSprite&&this._destroyCachedDisplayObject(),this.renderWebGL=this._originalRenderWebGL,this.renderCanvas=this._originalRenderCanvas,this.getBounds=this._originalGetBounds,this.destroy=this._originalDestroy,this.updateTransform=this._originalUpdateTransform,this.containsPoint=this._originalContainsPoint))}}}),r.prototype._renderCachedWebGL=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cachedSprite.worldAlpha=this.worldAlpha,t.setObjectRenderer(t.plugins.sprite),t.plugins.sprite.render(this._cachedSprite))},r.prototype._initCachedDisplayObject=function(t){if(!this._cachedSprite){t.currentRenderer.flush();var e=this.getLocalBounds().clone();if(this._filters){var i=this._filters[0].padding;e.x-=i,e.y-=i,e.width+=2*i,e.height+=2*i}var r=t.currentRenderTarget,o=t.filterManager.filterStack,a=new n.RenderTexture(t,0|e.width,0|e.height),h=s;h.tx=-e.x,h.ty=-e.y,this.renderWebGL=this._originalRenderWebGL,a.render(this,h,!0,!0),t.setRenderTarget(r),t.filterManager.filterStack=o,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this.getBounds=this._getCachedBounds,this._cachedSprite=new n.Sprite(a),this._cachedSprite.worldTransform=this.worldTransform,this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this.updateTransform(),this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}},r.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cachedSprite.worldAlpha=this.worldAlpha,this._cachedSprite.renderCanvas(t))},r.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cachedSprite){var e=this.getLocalBounds(),i=t.context,r=new n.RenderTexture(t,0|e.width,0|e.height),o=s;o.tx=-e.x,o.ty=-e.y,this.renderCanvas=this._originalRenderCanvas,r.render(this,o,!0),t.context=i,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.getBounds=this._getCachedBounds,this._cachedSprite=new n.Sprite(r),this._cachedSprite.worldTransform=this.worldTransform,this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this.updateTransform(),this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}},r.prototype._getCachedBounds=function(){return this._cachedSprite._currentBounds=null,this._cachedSprite.getBounds()},r.prototype._destroyCachedDisplayObject=function(){this._cachedSprite._texture.destroy(),this._cachedSprite=null},r.prototype._cacheAsBitmapDestroy=function(){this.cacheAsBitmap=!1,this._originalDestroy()}},{"../core":23}],77:[function(t,e,i){var n=t("../core");n.DisplayObject.prototype.name=null,n.Container.prototype.getChildByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null}},{"../core":23}],78:[function(t,e,i){var n=t("../core");n.DisplayObject.prototype.getGlobalPosition=function(t){return t=t||new n.Point,this.parent?(this.displayObjectUpdateTransform(),t.x=this.worldTransform.tx,t.y=this.worldTransform.ty):(t.x=this.position.x,t.y=this.position.y),t}},{"../core":23}],79:[function(t,e,i){t("./cacheAsBitmap"),t("./getChildByName"),t("./getGlobalPosition"),e.exports={MovieClip:t("./MovieClip"),TilingSprite:t("./TilingSprite"),BitmapText:t("./BitmapText")}},{"./BitmapText":73,"./MovieClip":74,"./TilingSprite":75,"./cacheAsBitmap":76,"./getChildByName":77,"./getGlobalPosition":78}],80:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nuniform vec4 dimensions;\nuniform float pixelSize;\nuniform sampler2D uSampler;\n\nfloat character(float n, vec2 p)\n{\n    p = floor(p*vec2(4.0, -4.0) + 2.5);\n    if (clamp(p.x, 0.0, 4.0) == p.x && clamp(p.y, 0.0, 4.0) == p.y)\n    {\n        if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;\n    }\n    return 0.0;\n}\n\nvoid main()\n{\n    vec2 uv = gl_FragCoord.xy;\n\n    vec3 col = texture2D(uSampler, floor( uv / pixelSize ) * pixelSize / dimensions.xy).rgb;\n\n    float gray = (col.r + col.g + col.b) / 3.0;\n\n    float n =  65536.0;             // .\n    if (gray > 0.2) n = 65600.0;    // :\n    if (gray > 0.3) n = 332772.0;   // *\n    if (gray > 0.4) n = 15255086.0; // o\n    if (gray > 0.5) n = 23385164.0; // &\n    if (gray > 0.6) n = 15252014.0; // 8\n    if (gray > 0.7) n = 13199452.0; // @\n    if (gray > 0.8) n = 11512810.0; // #\n\n    vec2 p = mod( uv / ( pixelSize * 0.5 ), 2.0) - vec2(1.0);\n    col = col * character(n, p);\n\n    gl_FragColor = vec4(col, 1.0);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"1f",value:8}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(t){this.uniforms.pixelSize.value=t}}})},{"../../core":23}],81:[function(t,e,i){function n(){r.AbstractFilter.call(this),this.blurXFilter=new s,this.blurYFilter=new o,this.defaultFilter=new r.AbstractFilter}var r=t("../../core"),s=t("../blur/BlurXFilter"),o=t("../blur/BlurYFilter");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.applyFilter=function(t,e,i){var n=t.filterManager.getRenderTarget(!0);this.defaultFilter.applyFilter(t,e,i),this.blurXFilter.applyFilter(t,e,n),t.blendModeManager.setBlendMode(r.BLEND_MODES.SCREEN),this.blurYFilter.applyFilter(t,n,i),t.blendModeManager.setBlendMode(r.BLEND_MODES.NORMAL),t.filterManager.returnRenderTarget(n)},Object.defineProperties(n.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t}},blurX:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}},blurY:{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t}}})},{"../../core":23,"../blur/BlurXFilter":84,"../blur/BlurYFilter":85}],82:[function(t,e,i){function n(t,e){r.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform float dirX;\nuniform float dirY;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[3];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[0] = aTextureCoord + vec2( (0.004 * strength) * dirX, (0.004 * strength) * dirY );\n    vBlurTexCoords[1] = aTextureCoord + vec2( (0.008 * strength) * dirX, (0.008 * strength) * dirY );\n    vBlurTexCoords[2] = aTextureCoord + vec2( (0.012 * strength) * dirX, (0.012 * strength) * dirY );\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[3];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vTextureCoord     ) * 0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0]) * 0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1]) * 0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2]) * 0.004431848411938341;\n}\n",{strength:{type:"1f",value:1},dirX:{type:"1f",value:t||0},dirY:{type:"1f",value:e||0}}),this.defaultFilter=new r.AbstractFilter,this.passes=1,this.dirX=t||0,this.dirY=e||0,this.strength=4}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.applyFilter=function(t,e,i,n){var r=this.getShader(t);if(this.uniforms.strength.value=this.strength/4/this.passes*(e.frame.width/e.size.width),1===this.passes)t.filterManager.applyFilter(r,e,i,n);else{var s=t.filterManager.getRenderTarget(!0);t.filterManager.applyFilter(r,e,s,n);for(var o=0;o<this.passes-2;o++)t.filterManager.applyFilter(r,s,s,n);t.filterManager.applyFilter(r,s,i,n),t.filterManager.returnRenderTarget(s)}},Object.defineProperties(n.prototype,{blur:{get:function(){return this.strength},set:function(t){this.padding=.5*t,this.strength=t}},dirX:{get:function(){return this.dirX},set:function(t){this.uniforms.dirX.value=t}},dirY:{get:function(){return this.dirY},set:function(t){this.uniforms.dirY.value=t}}})},{"../../core":23}],83:[function(t,e,i){function n(){r.AbstractFilter.call(this),this.blurXFilter=new s,this.blurYFilter=new o}var r=t("../../core"),s=t("./BlurXFilter"),o=t("./BlurYFilter");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.applyFilter=function(t,e,i){var n=t.filterManager.getRenderTarget(!0);this.blurXFilter.applyFilter(t,e,n),this.blurYFilter.applyFilter(t,n,i),t.filterManager.returnRenderTarget(n)},Object.defineProperties(n.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(t){this.padding=.5*Math.abs(t),this.blurXFilter.blur=this.blurYFilter.blur=t}},passes:{get:function(){return this.blurXFilter.passes},set:function(t){this.blurXFilter.passes=this.blurYFilter.passes=t}},blurX:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}},blurY:{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t}}})},{"../../core":23,"./BlurXFilter":84,"./BlurYFilter":85}],84:[function(t,e,i){function n(){r.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(-0.012 * strength, 0.0);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(-0.008 * strength, 0.0);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(-0.004 * strength, 0.0);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2( 0.004 * strength, 0.0);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2( 0.008 * strength, 0.0);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2( 0.012 * strength, 0.0);\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.applyFilter=function(t,e,i,n){var r=this.getShader(t);if(this.uniforms.strength.value=this.strength/4/this.passes*(e.frame.width/e.size.width),1===this.passes)t.filterManager.applyFilter(r,e,i,n);else{for(var s=t.filterManager.getRenderTarget(!0),o=e,a=s,h=0;h<this.passes-1;h++){t.filterManager.applyFilter(r,o,a,!0);var l=a;a=o,o=l}t.filterManager.applyFilter(r,o,i,n),t.filterManager.returnRenderTarget(s)}},Object.defineProperties(n.prototype,{blur:{get:function(){return this.strength},set:function(t){this.padding=.5*Math.abs(t),this.strength=t}}})},{"../../core":23}],85:[function(t,e,i){function n(){r.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.applyFilter=function(t,e,i,n){var r=this.getShader(t);if(this.uniforms.strength.value=Math.abs(this.strength)/4/this.passes*(e.frame.height/e.size.height),1===this.passes)t.filterManager.applyFilter(r,e,i,n);else{for(var s=t.filterManager.getRenderTarget(!0),o=e,a=s,h=0;h<this.passes-1;h++){t.filterManager.applyFilter(r,o,a,!0);var l=a;a=o,o=l}t.filterManager.applyFilter(r,o,i,n),t.filterManager.returnRenderTarget(s)}},Object.defineProperties(n.prototype,{blur:{get:function(){return this.strength},set:function(t){this.padding=.5*Math.abs(t),this.strength=t}}})},{"../../core":23}],86:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 delta;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta * percent);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{delta:{type:"v2",value:{x:.1,y:0}}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n},{"../../core":23}],87:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[25];\n\nvoid main(void)\n{\n\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.r = (m[0] * c.r);\n        gl_FragColor.r += (m[1] * c.g);\n        gl_FragColor.r += (m[2] * c.b);\n        gl_FragColor.r += (m[3] * c.a);\n        gl_FragColor.r += m[4];\n\n    gl_FragColor.g = (m[5] * c.r);\n        gl_FragColor.g += (m[6] * c.g);\n        gl_FragColor.g += (m[7] * c.b);\n        gl_FragColor.g += (m[8] * c.a);\n        gl_FragColor.g += m[9];\n\n     gl_FragColor.b = (m[10] * c.r);\n        gl_FragColor.b += (m[11] * c.g);\n        gl_FragColor.b += (m[12] * c.b);\n        gl_FragColor.b += (m[13] * c.a);\n        gl_FragColor.b += m[14];\n\n     gl_FragColor.a = (m[15] * c.r);\n        gl_FragColor.a += (m[16] * c.g);\n        gl_FragColor.a += (m[17] * c.b);\n        gl_FragColor.a += (m[18] * c.a);\n        gl_FragColor.a += m[19];\n\n}\n",{m:{type:"1fv",value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,n.prototype._loadMatrix=function(t,e){e=!!e;var i=t;e&&(this._multiply(i,this.uniforms.m.value,t),i=this._colorMatrix(i)),this.uniforms.m.value=i},n.prototype._multiply=function(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19],t},n.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},n.prototype.brightness=function(t,e){var i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},n.prototype.greyscale=function(t,e){var i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},n.prototype.grayscale=n.prototype.greyscale,n.prototype.blackAndWhite=function(t){var e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)},n.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var i=Math.cos(t),n=Math.sin(t),r=.213,s=.715,o=.072,a=[r+i*(1-r)+n*-r,s+i*-s+n*-s,o+i*-o+n*(1-o),0,0,r+i*-r+.143*n,s+i*(1-s)+.14*n,o+i*-o+n*-.283,0,0,r+i*-r+n*-(1-r),s+i*-s+n*s,o+i*(1-o)+n*o,0,0,0,0,0,1,0];this._loadMatrix(a,e)},n.prototype.contrast=function(t,e){var i=(t||0)+1,n=-128*(i-1),r=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(r,e)},n.prototype.saturate=function(t,e){var i=2*(t||0)/3+1,n=(i-1)*-.5,r=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(r,e)},n.prototype.desaturate=function(t){this.saturate(-1)},n.prototype.negative=function(t){var e=[0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)},n.prototype.sepia=function(t){var e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)},n.prototype.technicolor=function(t){var e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)},n.prototype.polaroid=function(t){var e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)},n.prototype.toBGR=function(t){var e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)},n.prototype.kodachrome=function(t){var e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)},n.prototype.browni=function(t){var e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)},n.prototype.vintage=function(t){var e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)},n.prototype.colorTone=function(t,e,i,n,r){t=t||.2,e=e||.15,i=i||16770432,n=n||3375104;var s=(i>>16&255)/255,o=(i>>8&255)/255,a=(255&i)/255,h=(n>>16&255)/255,l=(n>>8&255)/255,u=(255&n)/255,c=[.3,.59,.11,0,0,s,o,a,t,0,h,l,u,e,0,s-h,o-l,a-u,0,0];this._loadMatrix(c,r)},n.prototype.night=function(t,e){t=t||.1;var i=[-2*t,-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,e)},n.prototype.predator=function(t,e){var i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)},n.prototype.lsd=function(t){var e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)},n.prototype.reset=function(){var t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)},Object.defineProperties(n.prototype,{matrix:{get:function(){return this.uniforms.m.value},set:function(t){this.uniforms.m.value=t}}})},{"../../core":23}],88:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float step;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    color = floor(color * step) / step;\n\n    gl_FragColor = color;\n}\n",{step:{type:"1f",value:5}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{step:{get:function(){return this.uniforms.step.value},set:function(t){this.uniforms.step.value=t}}})},{"../../core":23}],89:[function(t,e,i){function n(t,e,i){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying mediump vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 texelSize;\nuniform float matrix[9];\n\nvoid main(void)\n{\n   vec4 c11 = texture2D(uSampler, vTextureCoord - texelSize); // top left\n   vec4 c12 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - texelSize.y)); // top center\n   vec4 c13 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y - texelSize.y)); // top right\n\n   vec4 c21 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y)); // mid left\n   vec4 c22 = texture2D(uSampler, vTextureCoord); // mid center\n   vec4 c23 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y)); // mid right\n\n   vec4 c31 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y + texelSize.y)); // bottom left\n   vec4 c32 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + texelSize.y)); // bottom center\n   vec4 c33 = texture2D(uSampler, vTextureCoord + texelSize); // bottom right\n\n   gl_FragColor =\n       c11 * matrix[0] + c12 * matrix[1] + c13 * matrix[2] +\n       c21 * matrix[3] + c22 * matrix[4] + c23 * matrix[5] +\n       c31 * matrix[6] + c32 * matrix[7] + c33 * matrix[8];\n\n   gl_FragColor.a = c22.a;\n}\n",{matrix:{type:"1fv",value:new Float32Array(t)},texelSize:{type:"v2",value:{x:1/e,y:1/i}}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{matrix:{get:function(){return this.uniforms.matrix.value},set:function(t){this.uniforms.matrix.value=new Float32Array(t)}},width:{get:function(){return 1/this.uniforms.texelSize.value.x},set:function(t){this.uniforms.texelSize.value.x=1/t}},height:{get:function(){return 1/this.uniforms.texelSize.value.y},set:function(t){this.uniforms.texelSize.value.y=1/t}}})},{"../../core":23}],90:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\n    if (lum < 1.00)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.75)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.50)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.3)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n}\n")}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n},{"../../core":23}],91:[function(t,e,i){function n(t,e){var i=new r.Matrix;t.renderable=!1,r.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vMapCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision mediump float;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nvoid main(void)\n{\n   vec4 map =  texture2D(mapSampler, vMapCoord);\n\n   map -= 0.5;\n   map.xy *= scale;\n\n   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y));\n}\n",{mapSampler:{type:"sampler2D",value:t.texture},otherMatrix:{type:"mat3",value:i.toArray(!0)},scale:{type:"v2",value:{x:1,y:1}}}),this.maskSprite=t,this.maskMatrix=i,null!==e&&void 0!==e||(e=20),this.scale=new r.Point(e,e)}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.applyFilter=function(t,e,i){var n=t.filterManager;n.calculateMappedMatrix(e.frame,this.maskSprite,this.maskMatrix),this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0),this.uniforms.scale.value.x=this.scale.x*(1/e.frame.width),this.uniforms.scale.value.y=this.scale.y*(1/e.frame.height);var r=this.getShader(t);n.applyFilter(r,e,i)},Object.defineProperties(n.prototype,{map:{get:function(){return this.uniforms.mapSampler.value},set:function(t){this.uniforms.mapSampler.value=t}}})},{"../../core":23}],92:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec4 dimensions;\nuniform sampler2D uSampler;\n\nuniform float angle;\nuniform float scale;\n\nfloat pattern()\n{\n   float s = sin(angle), c = cos(angle);\n   vec2 tex = vTextureCoord * dimensions.xy;\n   vec2 point = vec2(\n       c * tex.x - s * tex.y,\n       s * tex.x + c * tex.y\n   ) * scale;\n   return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\nvoid main()\n{\n   vec4 color = texture2D(uSampler, vTextureCoord);\n   float average = (color.r + color.g + color.b) / 3.0;\n   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\n}\n",{scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{scale:{get:function(){return this.uniforms.scale.value},set:function(t){this.uniforms.scale.value=t}},angle:{get:function(){return this.uniforms.angle.value},set:function(t){this.uniforms.angle.value=t}}})},{"../../core":23}],93:[function(t,e,i){function n(){r.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform vec2 offset;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition+offset), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform vec3 color;\nuniform float alpha;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 sum = vec4(0.0);\n\n    sum += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    sum += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    sum += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    sum += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    sum += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n\n    gl_FragColor = vec4( color.rgb * sum.a * alpha, sum.a * alpha );\n}\n",{
blur:{type:"1f",value:1/512},color:{type:"c",value:[0,0,0]},alpha:{type:"1f",value:.7},offset:{type:"2f",value:[5,5]},strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.applyFilter=function(t,e,i,n){var r=this.getShader(t);if(this.uniforms.strength.value=this.strength/4/this.passes*(e.frame.height/e.size.height),1===this.passes)t.filterManager.applyFilter(r,e,i,n);else{for(var s=t.filterManager.getRenderTarget(!0),o=e,a=s,h=0;h<this.passes-1;h++){t.filterManager.applyFilter(r,o,a,n);var l=a;a=o,o=l}t.filterManager.applyFilter(r,o,i,n),t.filterManager.returnRenderTarget(s)}},Object.defineProperties(n.prototype,{blur:{get:function(){return this.strength},set:function(t){this.padding=.5*t,this.strength=t}}})},{"../../core":23}],94:[function(t,e,i){function n(){r.AbstractFilter.call(this),this.blurXFilter=new s,this.blurYTintFilter=new o,this.defaultFilter=new r.AbstractFilter,this.padding=30,this._dirtyPosition=!0,this._angle=45*Math.PI/180,this._distance=10,this.alpha=.75,this.hideObject=!1,this.blendMode=r.BLEND_MODES.MULTIPLY}var r=t("../../core"),s=t("../blur/BlurXFilter"),o=t("./BlurYTintFilter");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.applyFilter=function(t,e,i){var n=t.filterManager.getRenderTarget(!0);this._dirtyPosition&&(this._dirtyPosition=!1,this.blurYTintFilter.uniforms.offset.value[0]=Math.sin(this._angle)*this._distance,this.blurYTintFilter.uniforms.offset.value[1]=Math.cos(this._angle)*this._distance),this.blurXFilter.applyFilter(t,e,n),t.blendModeManager.setBlendMode(this.blendMode),this.blurYTintFilter.applyFilter(t,n,i),t.blendModeManager.setBlendMode(r.BLEND_MODES.NORMAL),this.hideObject||this.defaultFilter.applyFilter(t,e,i),t.filterManager.returnRenderTarget(n)},Object.defineProperties(n.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYTintFilter.blur=t}},blurX:{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t}},blurY:{get:function(){return this.blurYTintFilter.blur},set:function(t){this.blurYTintFilter.blur=t}},color:{get:function(){return r.utils.rgb2hex(this.blurYTintFilter.uniforms.color.value)},set:function(t){this.blurYTintFilter.uniforms.color.value=r.utils.hex2rgb(t)}},alpha:{get:function(){return this.blurYTintFilter.uniforms.alpha.value},set:function(t){this.blurYTintFilter.uniforms.alpha.value=t}},distance:{get:function(){return this._distance},set:function(t){this._dirtyPosition=!0,this._distance=t}},angle:{get:function(){return this._angle},set:function(t){this._dirtyPosition=!0,this._angle=t}}})},{"../../core":23,"../blur/BlurXFilter":84,"./BlurYTintFilter":93}],95:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float gray;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);\n}\n",{gray:{type:"1f",value:1}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{gray:{get:function(){return this.uniforms.gray.value},set:function(t){this.uniforms.gray.value=t}}})},{"../../core":23}],96:[function(t,e,i){e.exports={AsciiFilter:t("./ascii/AsciiFilter"),BloomFilter:t("./bloom/BloomFilter"),BlurFilter:t("./blur/BlurFilter"),BlurXFilter:t("./blur/BlurXFilter"),BlurYFilter:t("./blur/BlurYFilter"),BlurDirFilter:t("./blur/BlurDirFilter"),ColorMatrixFilter:t("./color/ColorMatrixFilter"),ColorStepFilter:t("./color/ColorStepFilter"),ConvolutionFilter:t("./convolution/ConvolutionFilter"),CrossHatchFilter:t("./crosshatch/CrossHatchFilter"),DisplacementFilter:t("./displacement/DisplacementFilter"),DotScreenFilter:t("./dot/DotScreenFilter"),GrayFilter:t("./gray/GrayFilter"),DropShadowFilter:t("./dropshadow/DropShadowFilter"),InvertFilter:t("./invert/InvertFilter"),NoiseFilter:t("./noise/NoiseFilter"),PixelateFilter:t("./pixelate/PixelateFilter"),RGBSplitFilter:t("./rgb/RGBSplitFilter"),ShockwaveFilter:t("./shockwave/ShockwaveFilter"),SepiaFilter:t("./sepia/SepiaFilter"),SmartBlurFilter:t("./blur/SmartBlurFilter"),TiltShiftFilter:t("./tiltshift/TiltShiftFilter"),TiltShiftXFilter:t("./tiltshift/TiltShiftXFilter"),TiltShiftYFilter:t("./tiltshift/TiltShiftYFilter"),TwistFilter:t("./twist/TwistFilter")}},{"./ascii/AsciiFilter":80,"./bloom/BloomFilter":81,"./blur/BlurDirFilter":82,"./blur/BlurFilter":83,"./blur/BlurXFilter":84,"./blur/BlurYFilter":85,"./blur/SmartBlurFilter":86,"./color/ColorMatrixFilter":87,"./color/ColorStepFilter":88,"./convolution/ConvolutionFilter":89,"./crosshatch/CrossHatchFilter":90,"./displacement/DisplacementFilter":91,"./dot/DotScreenFilter":92,"./dropshadow/DropShadowFilter":94,"./gray/GrayFilter":95,"./invert/InvertFilter":97,"./noise/NoiseFilter":98,"./pixelate/PixelateFilter":99,"./rgb/RGBSplitFilter":100,"./sepia/SepiaFilter":101,"./shockwave/ShockwaveFilter":102,"./tiltshift/TiltShiftFilter":104,"./tiltshift/TiltShiftXFilter":105,"./tiltshift/TiltShiftYFilter":106,"./twist/TwistFilter":107}],97:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform float invert;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);\n}\n",{invert:{type:"1f",value:1}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{invert:{get:function(){return this.uniforms.invert.value},set:function(t){this.uniforms.invert.value=t}}})},{"../../core":23}],98:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float noise;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    float diff = (rand(vTextureCoord) - 0.5) * noise;\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    gl_FragColor = color;\n}\n",{noise:{type:"1f",value:.5}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{noise:{get:function(){return this.uniforms.noise.value},set:function(t){this.uniforms.noise.value=t}}})},{"../../core":23}],99:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 dimensions;\nuniform vec2 pixelSize;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord;\n\n    vec2 size = dimensions.xy / pixelSize;\n\n    vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;\n\n    gl_FragColor = texture2D(uSampler, color);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"v2",value:{x:10,y:10}}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(t){this.uniforms.pixelSize.value=t}}})},{"../../core":23}],100:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 dimensions;\nuniform vec2 red;\nuniform vec2 green;\nuniform vec2 blue;\n\nvoid main(void)\n{\n   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;\n   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;\n   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;\n   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;\n}\n",{red:{type:"v2",value:{x:20,y:20}},green:{type:"v2",value:{x:-20,y:20}},blue:{type:"v2",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{red:{get:function(){return this.uniforms.red.value},set:function(t){this.uniforms.red.value=t}},green:{get:function(){return this.uniforms.green.value},set:function(t){this.uniforms.green.value=t}},blue:{get:function(){return this.uniforms.blue.value},set:function(t){this.uniforms.blue.value=t}}})},{"../../core":23}],101:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float sepia;\n\nconst mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);\n}\n",{sepia:{type:"1f",value:1}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{sepia:{get:function(){return this.uniforms.sepia.value},set:function(t){this.uniforms.sepia.value=t}}})},{"../../core":23}],102:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform vec2 center;\nuniform vec3 params; // 10.0, 0.8, 0.1\nuniform float time;\n\nvoid main()\n{\n    vec2 uv = vTextureCoord;\n    vec2 texCoord = uv;\n\n    float dist = distance(uv, center);\n\n    if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )\n    {\n        float diff = (dist - time);\n        float powDiff = 1.0 - pow(abs(diff*params.x), params.y);\n\n        float diffTime = diff  * powDiff;\n        vec2 diffUV = normalize(uv - center);\n        texCoord = uv + (diffUV * diffTime);\n    }\n\n    gl_FragColor = texture2D(uSampler, texCoord);\n}\n",{center:{type:"v2",value:{x:.5,y:.5}},params:{type:"v3",value:{x:10,y:.8,z:.1}},time:{type:"1f",value:0}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{center:{get:function(){return this.uniforms.center.value},set:function(t){this.uniforms.center.value=t}},params:{get:function(){return this.uniforms.params.value},set:function(t){this.uniforms.params.value=t}},time:{get:function(){return this.uniforms.time.value},set:function(t){this.uniforms.time.value=t}}})},{"../../core":23}],103:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float blur;\nuniform float gradientBlur;\nuniform vec2 start;\nuniform vec2 end;\nuniform vec2 delta;\nuniform vec2 texSize;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{blur:{type:"1f",value:100},gradientBlur:{type:"1f",value:600},start:{type:"v2",value:{x:0,y:window.innerHeight/2}},end:{type:"v2",value:{x:600,y:window.innerHeight/2}},delta:{type:"v2",value:{x:30,y:30}},texSize:{type:"v2",value:{x:window.innerWidth,y:window.innerHeight}}}),this.updateDelta()}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.updateDelta=function(){this.uniforms.delta.value.x=0,this.uniforms.delta.value.y=0},Object.defineProperties(n.prototype,{blur:{get:function(){return this.uniforms.blur.value},set:function(t){this.uniforms.blur.value=t}},gradientBlur:{get:function(){return this.uniforms.gradientBlur.value},set:function(t){this.uniforms.gradientBlur.value=t}},start:{get:function(){return this.uniforms.start.value},set:function(t){this.uniforms.start.value=t,this.updateDelta()}},end:{get:function(){return this.uniforms.end.value},set:function(t){this.uniforms.end.value=t,this.updateDelta()}}})},{"../../core":23}],104:[function(t,e,i){function n(){r.AbstractFilter.call(this),this.tiltShiftXFilter=new s,this.tiltShiftYFilter=new o}var r=t("../../core"),s=t("./TiltShiftXFilter"),o=t("./TiltShiftYFilter");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.applyFilter=function(t,e,i){var n=t.filterManager.getRenderTarget(!0);this.tiltShiftXFilter.applyFilter(t,e,n),this.tiltShiftYFilter.applyFilter(t,n,i),t.filterManager.returnRenderTarget(n)},Object.defineProperties(n.prototype,{blur:{get:function(){return this.tiltShiftXFilter.blur},set:function(t){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=t}},gradientBlur:{get:function(){return this.tiltShiftXFilter.gradientBlur},set:function(t){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=t}},start:{get:function(){return this.tiltShiftXFilter.start},set:function(t){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=t}},end:{get:function(){return this.tiltShiftXFilter.end},set:function(t){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=t}}})},{"../../core":23,"./TiltShiftXFilter":105,"./TiltShiftYFilter":106}],105:[function(t,e,i){function n(){r.call(this)}var r=t("./TiltShiftAxisFilter");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.updateDelta=function(){var t=this.uniforms.end.value.x-this.uniforms.start.value.x,e=this.uniforms.end.value.y-this.uniforms.start.value.y,i=Math.sqrt(t*t+e*e);this.uniforms.delta.value.x=t/i,this.uniforms.delta.value.y=e/i}},{"./TiltShiftAxisFilter":103}],106:[function(t,e,i){function n(){r.call(this)}var r=t("./TiltShiftAxisFilter");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.updateDelta=function(){var t=this.uniforms.end.value.x-this.uniforms.start.value.x,e=this.uniforms.end.value.y-this.uniforms.start.value.y,i=Math.sqrt(t*t+e*e);this.uniforms.delta.value.x=-e/i,this.uniforms.delta.value.y=t/i}},{"./TiltShiftAxisFilter":103}],107:[function(t,e,i){function n(){r.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\n\nvoid main(void)\n{\n   vec2 coord = vTextureCoord - offset;\n   float dist = length(coord);\n\n   if (dist < radius)\n   {\n       float ratio = (radius - dist) / radius;\n       float angleMod = ratio * ratio * angle;\n       float s = sin(angleMod);\n       float c = cos(angleMod);\n       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n   }\n\n   gl_FragColor = texture2D(uSampler, coord+offset);\n}\n",{radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"v2",value:{x:.5,y:.5}}})}var r=t("../../core");n.prototype=Object.create(r.AbstractFilter.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{offset:{get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value=t}},radius:{get:function(){return this.uniforms.radius.value},set:function(t){this.uniforms.radius.value=t}},angle:{get:function(){return this.uniforms.angle.value},set:function(t){this.uniforms.angle.value=t}}})},{"../../core":23}],108:[function(t,e,i){(function(i){t("./polyfill");var n=e.exports=t("./core");n.extras=t("./extras"),n.filters=t("./filters"),n.interaction=t("./interaction"),n.loaders=t("./loaders"),n.mesh=t("./mesh"),n.accessibility=t("./accessibility"),n.loader=new n.loaders.Loader,Object.assign(n,t("./deprecation")),i.PIXI=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./accessibility":15,"./core":23,"./deprecation":72,"./extras":79,"./filters":96,"./interaction":111,"./loaders":114,"./mesh":121,"./polyfill":126}],109:[function(t,e,i){function n(){this.global=new r.Point,this.target=null,this.originalEvent=null}var r=t("../core");n.prototype.constructor=n,e.exports=n,n.prototype.getLocalPosition=function(t,e,i){return t.worldTransform.applyInverse(i||this.global,e)}},{"../core":23}],110:[function(t,e,i){function n(t,e){e=e||{},this.renderer=t,this.autoPreventDefault=void 0!==e.autoPreventDefault?e.autoPreventDefault:!0,this.interactionFrequency=e.interactionFrequency||10,this.mouse=new s,this.eventData={stopped:!1,target:null,type:null,data:this.mouse,stopPropagation:function(){this.stopped=!0}},this.interactiveDataPool=[],this.interactionDOMElement=null,this.eventsAdded=!1,this.onMouseUp=this.onMouseUp.bind(this),this.processMouseUp=this.processMouseUp.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.processMouseDown=this.processMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.processMouseMove=this.processMouseMove.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.processMouseOverOut=this.processMouseOverOut.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.processTouchStart=this.processTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.processTouchEnd=this.processTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.processTouchMove=this.processTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this._tempPoint=new r.Point,this.resolution=1,this.setTargetElement(this.renderer.view,this.renderer.resolution)}var r=t("../core"),s=t("./InteractionData");Object.assign(r.DisplayObject.prototype,t("./interactiveTarget")),n.prototype.constructor=n,e.exports=n,n.prototype.setTargetElement=function(t,e){this.removeEvents(),this.interactionDOMElement=t,this.resolution=e||1,this.addEvents()},n.prototype.addEvents=function(){this.interactionDOMElement&&(r.ticker.shared.add(this.update,this),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"),window.document.addEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.addEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.addEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!0)},n.prototype.removeEvents=function(){this.interactionDOMElement&&(r.ticker.shared.remove(this.update),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""),window.document.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!1)},n.prototype.update=function(t){if(this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement)){if(this.didMove)return void(this.didMove=!1);this.cursor="inherit",this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)}},n.prototype.dispatchEvent=function(t,e,i){i.stopped||(i.target=t,i.type=e,t.emit(e,i),t[e]&&t[e](i))},n.prototype.mapPositionToPoint=function(t,e,i){var n=this.interactionDOMElement.getBoundingClientRect();t.x=(e-n.left)*(this.interactionDOMElement.width/n.width)/this.resolution,t.y=(i-n.top)*(this.interactionDOMElement.height/n.height)/this.resolution},n.prototype.processInteractive=function(t,e,i,n,r){if(!e||!e.visible)return!1;var s=!1,o=r=e.interactive||r;if(e.hitArea&&(o=!1),e.interactiveChildren)for(var a=e.children,h=a.length-1;h>=0;h--)this.processInteractive(t,a[h],i,n,o)&&(s=!0,o=!1,a[h].interactive&&(n=!1));return r&&(n&&!s&&(e.hitArea?(e.worldTransform.applyInverse(t,this._tempPoint),s=e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)):e.containsPoint&&(s=e.containsPoint(t))),e.interactive&&i(e,s)),s},n.prototype.onMouseDown=function(t){this.mouse.originalEvent=t,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.autoPreventDefault&&this.mouse.originalEvent.preventDefault(),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseDown,!0)},n.prototype.processMouseDown=function(t,e){var i=this.mouse.originalEvent,n=2===i.button||3===i.which;e&&(t[n?"_isRightDown":"_isLeftDown"]=!0,this.dispatchEvent(t,n?"rightdown":"mousedown",this.eventData))},n.prototype.onMouseUp=function(t){this.mouse.originalEvent=t,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseUp,!0)},n.prototype.processMouseUp=function(t,e){var i=this.mouse.originalEvent,n=2===i.button||3===i.which,r=n?"_isRightDown":"_isLeftDown";e?(this.dispatchEvent(t,n?"rightup":"mouseup",this.eventData),t[r]&&(t[r]=!1,this.dispatchEvent(t,n?"rightclick":"click",this.eventData))):t[r]&&(t[r]=!1,this.dispatchEvent(t,n?"rightupoutside":"mouseupoutside",this.eventData))},n.prototype.onMouseMove=function(t){this.mouse.originalEvent=t,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.didMove=!0,this.cursor="inherit",this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseMove,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)},n.prototype.processMouseMove=function(t,e){this.dispatchEvent(t,"mousemove",this.eventData),this.processMouseOverOut(t,e)},n.prototype.onMouseOut=function(t){this.mouse.originalEvent=t,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.interactionDOMElement.style.cursor="inherit",this.mapPositionToPoint(this.mouse.global,t.clientX,t.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!1)},n.prototype.processMouseOverOut=function(t,e){e?(t._over||(t._over=!0,this.dispatchEvent(t,"mouseover",this.eventData)),t.buttonMode&&(this.cursor=t.defaultCursor)):t._over&&(t._over=!1,this.dispatchEvent(t,"mouseout",this.eventData))},n.prototype.onTouchStart=function(t){this.autoPreventDefault&&t.preventDefault();for(var e=t.changedTouches,i=e.length,n=0;i>n;n++){var r=e[n],s=this.getTouchData(r);s.originalEvent=t,this.eventData.data=s,this.eventData.stopped=!1,this.processInteractive(s.global,this.renderer._lastObjectRendered,this.processTouchStart,!0),this.returnTouchData(s)}},n.prototype.processTouchStart=function(t,e){e&&(t._touchDown=!0,this.dispatchEvent(t,"touchstart",this.eventData))},n.prototype.onTouchEnd=function(t){this.autoPreventDefault&&t.preventDefault();for(var e=t.changedTouches,i=e.length,n=0;i>n;n++){var r=e[n],s=this.getTouchData(r);s.originalEvent=t,this.eventData.data=s,this.eventData.stopped=!1,this.processInteractive(s.global,this.renderer._lastObjectRendered,this.processTouchEnd,!0),this.returnTouchData(s)}},n.prototype.processTouchEnd=function(t,e){e?(this.dispatchEvent(t,"touchend",this.eventData),t._touchDown&&(t._touchDown=!1,this.dispatchEvent(t,"tap",this.eventData))):t._touchDown&&(t._touchDown=!1,this.dispatchEvent(t,"touchendoutside",this.eventData))},n.prototype.onTouchMove=function(t){this.autoPreventDefault&&t.preventDefault();for(var e=t.changedTouches,i=e.length,n=0;i>n;n++){var r=e[n],s=this.getTouchData(r);s.originalEvent=t,this.eventData.data=s,this.eventData.stopped=!1,this.processInteractive(s.global,this.renderer._lastObjectRendered,this.processTouchMove,!0),this.returnTouchData(s)}},n.prototype.processTouchMove=function(t,e){e=e,this.dispatchEvent(t,"touchmove",this.eventData)},n.prototype.getTouchData=function(t){var e=this.interactiveDataPool.pop();return e||(e=new s),e.identifier=t.identifier,this.mapPositionToPoint(e.global,t.clientX,t.clientY),navigator.isCocoonJS&&(e.global.x=e.global.x/this.resolution,e.global.y=e.global.y/this.resolution),t.globalX=e.global.x,t.globalY=e.global.y,e},n.prototype.returnTouchData=function(t){this.interactiveDataPool.push(t)},n.prototype.destroy=function(){this.removeEvents(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactiveDataPool=null,this.interactionDOMElement=null,this.onMouseUp=null,this.processMouseUp=null,this.onMouseDown=null,this.processMouseDown=null,this.onMouseMove=null,this.processMouseMove=null,this.onMouseOut=null,this.processMouseOverOut=null,this.onTouchStart=null,this.processTouchStart=null,this.onTouchEnd=null,this.processTouchEnd=null,this.onTouchMove=null,this.processTouchMove=null,this._tempPoint=null},r.WebGLRenderer.registerPlugin("interaction",n),r.CanvasRenderer.registerPlugin("interaction",n)},{"../core":23,"./InteractionData":109,"./interactiveTarget":112}],111:[function(t,e,i){e.exports={InteractionData:t("./InteractionData"),InteractionManager:t("./InteractionManager"),interactiveTarget:t("./interactiveTarget")}},{"./InteractionData":109,"./InteractionManager":110,"./interactiveTarget":112}],112:[function(t,e,i){var n={interactive:!1,buttonMode:!1,interactiveChildren:!0,defaultCursor:"pointer",_over:!1,_touchDown:!1};e.exports=n},{}],113:[function(t,e,i){function n(t,e){var i={},n=t.data.getElementsByTagName("info")[0],r=t.data.getElementsByTagName("common")[0];i.font=n.getAttribute("face"),i.size=parseInt(n.getAttribute("size"),10),i.lineHeight=parseInt(r.getAttribute("lineHeight"),10),i.chars={};for(var a=t.data.getElementsByTagName("char"),h=0;h<a.length;h++){var l=parseInt(a[h].getAttribute("id"),10),u=new s.Rectangle(parseInt(a[h].getAttribute("x"),10)+e.frame.x,parseInt(a[h].getAttribute("y"),10)+e.frame.y,parseInt(a[h].getAttribute("width"),10),parseInt(a[h].getAttribute("height"),10));i.chars[l]={xOffset:parseInt(a[h].getAttribute("xoffset"),10),yOffset:parseInt(a[h].getAttribute("yoffset"),10),xAdvance:parseInt(a[h].getAttribute("xadvance"),10),kerning:{},texture:new s.Texture(e.baseTexture,u)}}var c=t.data.getElementsByTagName("kerning");for(h=0;h<c.length;h++){var p=parseInt(c[h].getAttribute("first"),10),d=parseInt(c[h].getAttribute("second"),10),f=parseInt(c[h].getAttribute("amount"),10);i.chars[d].kerning[p]=f}t.bitmapFont=i,o.BitmapText.fonts[i.font]=i}var r=t("resource-loader").Resource,s=t("../core"),o=t("../extras"),a=t("path");e.exports=function(){return function(t,e){if(!t.data||!t.isXml)return e();if(0===t.data.getElementsByTagName("page").length||0===t.data.getElementsByTagName("info").length||null===t.data.getElementsByTagName("info")[0].getAttribute("face"))return e();var i=a.dirname(t.url);"."===i&&(i=""),this.baseUrl&&i&&("/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(i+="/"),i=i.replace(this.baseUrl,"")),i&&"/"!==i.charAt(i.length-1)&&(i+="/");var o=i+t.data.getElementsByTagName("page")[0].getAttribute("file");if(s.utils.TextureCache[o])n(t,s.utils.TextureCache[o]),e();else{var h={crossOrigin:t.crossOrigin,loadType:r.LOAD_TYPE.IMAGE,metadata:t.metadata.imageMetadata};this.add(t.name+"_image",o,h,function(i){n(t,i.texture),e()})}}}},{"../core":23,"../extras":79,path:2,"resource-loader":133}],114:[function(t,e,i){e.exports={Loader:t("./loader"),bitmapFontParser:t("./bitmapFontParser"),spritesheetParser:t("./spritesheetParser"),textureParser:t("./textureParser"),Resource:t("resource-loader").Resource}},{"./bitmapFontParser":113,"./loader":115,"./spritesheetParser":116,"./textureParser":117,"resource-loader":133}],115:[function(t,e,i){function n(t,e){r.call(this,t,e);for(var i=0;i<n._pixiMiddleware.length;++i)this.use(n._pixiMiddleware[i]())}var r=t("resource-loader"),s=t("./textureParser"),o=t("./spritesheetParser"),a=t("./bitmapFontParser");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n._pixiMiddleware=[r.middleware.parsing.blob,s,o,a],n.addPixiMiddleware=function(t){n._pixiMiddleware.push(t)};var h=r.Resource;h.setExtensionXhrType("fnt",h.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":113,"./spritesheetParser":116,"./textureParser":117,"resource-loader":133}],116:[function(t,e,i){var n=t("resource-loader").Resource,r=t("path"),s=t("../core");e.exports=function(){return function(t,e){if(!t.data||!t.isJson||!t.data.frames)return e();var i={crossOrigin:t.crossOrigin,loadType:n.LOAD_TYPE.IMAGE,metadata:t.metadata.imageMetadata},o=r.dirname(t.url.replace(this.baseUrl,"")),a=s.utils.getResolutionOfUrl(t.url);this.add(t.name+"_image",o+"/"+t.data.meta.image,i,function(i){t.textures={};var n=t.data.frames;for(var r in n){var o=n[r].frame;if(o){var h=null,l=null;if(h=n[r].rotated?new s.Rectangle(o.x,o.y,o.h,o.w):new s.Rectangle(o.x,o.y,o.w,o.h),n[r].trimmed&&(l=new s.Rectangle(n[r].spriteSourceSize.x/a,n[r].spriteSourceSize.y/a,n[r].sourceSize.w/a,n[r].sourceSize.h/a)),n[r].rotated){var u=h.width;h.width=h.height,h.height=u}h.x/=a,h.y/=a,h.width/=a,h.height/=a,t.textures[r]=new s.Texture(i.texture.baseTexture,h,h.clone(),l,n[r].rotated),s.utils.TextureCache[r]=t.textures[r]}}e()})}}},{"../core":23,path:2,"resource-loader":133}],117:[function(t,e,i){var n=t("../core");e.exports=function(){return function(t,e){if(t.data&&t.isImage){var i=new n.BaseTexture(t.data,null,n.utils.getResolutionOfUrl(t.url));i.imageUrl=t.url,t.texture=new n.Texture(i),n.utils.BaseTextureCache[t.url]=i,n.utils.TextureCache[t.url]=t.texture}e()}}},{"../core":23}],118:[function(t,e,i){function n(t,e,i,s,o){r.Container.call(this),this._texture=null,this.uvs=i||new Float32Array([0,0,1,0,1,1,0,1]),this.vertices=e||new Float32Array([0,0,100,0,100,100,0,100]),this.indices=s||new Uint16Array([0,1,3,2]),this.dirty=!0,this.blendMode=r.BLEND_MODES.NORMAL,this.canvasPadding=0,this.drawMode=o||n.DRAW_MODES.TRIANGLE_MESH,this.texture=t,this.shader=null}var r=t("../core"),s=new r.Point,o=new r.Polygon;n.prototype=Object.create(r.Container.prototype),n.prototype.constructor=n,e.exports=n,Object.defineProperties(n.prototype,{texture:{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t,t&&(t.baseTexture.hasLoaded?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)));
}}}),n.prototype._renderWebGL=function(t){t.setObjectRenderer(t.plugins.mesh),t.plugins.mesh.render(this)},n.prototype._renderCanvas=function(t){var e=t.context,i=this.worldTransform;t.roundPixels?e.setTransform(i.a,i.b,i.c,i.d,0|i.tx,0|i.ty):e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.drawMode===n.DRAW_MODES.TRIANGLE_MESH?this._renderCanvasTriangleMesh(e):this._renderCanvasTriangles(e)},n.prototype._renderCanvasTriangleMesh=function(t){for(var e=this.vertices,i=this.uvs,n=e.length/2,r=0;n-2>r;r++){var s=2*r;this._renderCanvasDrawTriangle(t,e,i,s,s+2,s+4)}},n.prototype._renderCanvasTriangles=function(t){for(var e=this.vertices,i=this.uvs,n=this.indices,r=n.length,s=0;r>s;s+=3){var o=2*n[s],a=2*n[s+1],h=2*n[s+2];this._renderCanvasDrawTriangle(t,e,i,o,a,h)}},n.prototype._renderCanvasDrawTriangle=function(t,e,i,n,r,s){var o=this._texture.baseTexture.source,a=this._texture.baseTexture.width,h=this._texture.baseTexture.height,l=e[n],u=e[r],c=e[s],p=e[n+1],d=e[r+1],f=e[s+1],m=i[n]*a,g=i[r]*a,y=i[s]*a,v=i[n+1]*h,x=i[r+1]*h,b=i[s+1]*h;if(this.canvasPadding>0){var w=this.canvasPadding/this.worldTransform.a,_=this.canvasPadding/this.worldTransform.d,T=(l+u+c)/3,E=(p+d+f)/3,S=l-T,A=p-E,C=Math.sqrt(S*S+A*A);l=T+S/C*(C+w),p=E+A/C*(C+_),S=u-T,A=d-E,C=Math.sqrt(S*S+A*A),u=T+S/C*(C+w),d=E+A/C*(C+_),S=c-T,A=f-E,C=Math.sqrt(S*S+A*A),c=T+S/C*(C+w),f=E+A/C*(C+_)}t.save(),t.beginPath(),t.moveTo(l,p),t.lineTo(u,d),t.lineTo(c,f),t.closePath(),t.clip();var P=m*x+v*y+g*b-x*y-v*g-m*b,M=l*x+v*c+u*b-x*c-v*u-l*b,O=m*u+l*y+g*c-u*y-l*g-m*c,R=m*x*c+v*u*y+l*g*b-l*x*y-v*g*c-m*u*b,k=p*x+v*f+d*b-x*f-v*d-p*b,I=m*d+p*y+g*f-d*y-p*g-m*f,D=m*x*f+v*d*y+p*g*b-p*x*y-v*g*f-m*d*b;t.transform(M/P,k/P,O/P,I/P,R/P,D/P),t.drawImage(o,0,0),t.restore()},n.prototype.renderMeshFlat=function(t){var e=this.context,i=t.vertices,n=i.length/2;e.beginPath();for(var r=1;n-2>r;r++){var s=2*r,o=i[s],a=i[s+2],h=i[s+4],l=i[s+1],u=i[s+3],c=i[s+5];e.moveTo(o,l),e.lineTo(a,u),e.lineTo(h,c)}e.fillStyle="#FF0000",e.fill(),e.closePath()},n.prototype._onTextureUpdate=function(){this.updateFrame=!0},n.prototype.getBounds=function(t){if(!this._currentBounds){for(var e=t||this.worldTransform,i=e.a,n=e.b,s=e.c,o=e.d,a=e.tx,h=e.ty,l=-(1/0),u=-(1/0),c=1/0,p=1/0,d=this.vertices,f=0,m=d.length;m>f;f+=2){var g=d[f],y=d[f+1],v=i*g+s*y+a,x=o*y+n*g+h;c=c>v?v:c,p=p>x?x:p,l=v>l?v:l,u=x>u?x:u}if(c===-(1/0)||u===1/0)return r.Rectangle.EMPTY;var b=this._bounds;b.x=c,b.width=l-c,b.y=p,b.height=u-p,this._currentBounds=b}return this._currentBounds},n.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,s);var e,i,r=this.vertices,a=o.points;if(this.drawMode===n.DRAW_MODES.TRIANGLES){var h=this.indices;for(i=this.indices.length,e=0;i>e;e+=3){var l=2*h[e],u=2*h[e+1],c=2*h[e+2];if(a[0]=r[l],a[1]=r[l+1],a[2]=r[u],a[3]=r[u+1],a[4]=r[c],a[5]=r[c+1],o.contains(s.x,s.y))return!0}}else for(i=r.length,e=0;i>e;e+=6)if(a[0]=r[e],a[1]=r[e+1],a[2]=r[e+2],a[3]=r[e+3],a[4]=r[e+4],a[5]=r[e+5],o.contains(s.x,s.y))return!0;return!1},n.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":23}],119:[function(t,e,i){function n(t,e,i){r.call(this,t),this._ready=!0,this.segmentsX=e||10,this.segmentsY=i||10,this.drawMode=r.DRAW_MODES.TRIANGLES,this.refresh()}var r=t("./Mesh");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.refresh=function(){var t=this.segmentsX*this.segmentsY,e=[],i=[],n=[],r=[],s=this.texture,o=this.segmentsX-1,a=this.segmentsY-1,h=0,l=s.width/o,u=s.height/a;for(h=0;t>h;h++){var c=h%this.segmentsX,p=h/this.segmentsX|0;e.push(c*l,p*u),n.push(c/(this.segmentsX-1),p/(this.segmentsY-1))}var d=o*a;for(h=0;d>h;h++){var f=h%o,m=h/o|0,g=m*this.segmentsX+f,y=m*this.segmentsX+f+1,v=(m+1)*this.segmentsX+f,x=(m+1)*this.segmentsX+f+1;r.push(g,y,v),r.push(y,x,v)}this.vertices=new Float32Array(e),this.uvs=new Float32Array(n),this.colors=new Float32Array(i),this.indices=new Uint16Array(r)},n.prototype._onTextureUpdate=function(){r.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()}},{"./Mesh":118}],120:[function(t,e,i){function n(t,e){r.call(this,t),this.points=e,this.vertices=new Float32Array(4*e.length),this.uvs=new Float32Array(4*e.length),this.colors=new Float32Array(2*e.length),this.indices=new Uint16Array(2*e.length),this._ready=!0,this.refresh()}var r=t("./Mesh"),s=t("../core");n.prototype=Object.create(r.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.refresh=function(){var t=this.points;if(!(t.length<1)&&this._texture._uvs){var e=this.uvs,i=this.indices,n=this.colors,r=this._texture._uvs,o=new s.Point(r.x0,r.y0),a=new s.Point(r.x2-r.x0,r.y2-r.y0);e[0]=0+o.x,e[1]=0+o.y,e[2]=0+o.x,e[3]=1*a.y+o.y,n[0]=1,n[1]=1,i[0]=0,i[1]=1;for(var h,l,u,c=t.length,p=1;c>p;p++)h=t[p],l=4*p,u=p/(c-1),e[l]=u*a.x+o.x,e[l+1]=0+o.y,e[l+2]=u*a.x+o.x,e[l+3]=1*a.y+o.y,l=2*p,n[l]=1,n[l+1]=1,l=2*p,i[l]=l,i[l+1]=l+1;this.dirty=!0}},n.prototype._onTextureUpdate=function(){r.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},n.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){for(var e,i,n,r,s,o,a=t[0],h=0,l=0,u=this.vertices,c=t.length,p=0;c>p;p++)i=t[p],n=4*p,e=p<t.length-1?t[p+1]:i,l=-(e.x-a.x),h=e.y-a.y,r=10*(1-p/(c-1)),r>1&&(r=1),s=Math.sqrt(h*h+l*l),o=this._texture.height/2,h/=s,l/=s,h*=o,l*=o,u[n]=i.x+h,u[n+1]=i.y+l,u[n+2]=i.x-h,u[n+3]=i.y-l,a=i;this.containerUpdateTransform()}}},{"../core":23,"./Mesh":118}],121:[function(t,e,i){e.exports={Mesh:t("./Mesh"),Plane:t("./Plane"),Rope:t("./Rope"),MeshRenderer:t("./webgl/MeshRenderer"),MeshShader:t("./webgl/MeshShader")}},{"./Mesh":118,"./Plane":119,"./Rope":120,"./webgl/MeshRenderer":122,"./webgl/MeshShader":123}],122:[function(t,e,i){function n(t){r.ObjectRenderer.call(this,t),this.indices=new Uint16Array(15e3);for(var e=0,i=0;15e3>e;e+=6,i+=4)this.indices[e+0]=i+0,this.indices[e+1]=i+1,this.indices[e+2]=i+2,this.indices[e+3]=i+0,this.indices[e+4]=i+2,this.indices[e+5]=i+3;this.currentShader=null}var r=t("../../core"),s=t("../Mesh");n.prototype=Object.create(r.ObjectRenderer.prototype),n.prototype.constructor=n,e.exports=n,r.WebGLRenderer.registerPlugin("mesh",n),n.prototype.onContextChange=function(){},n.prototype.render=function(t){t._vertexBuffer||this._initWebGL(t);var e=this.renderer,i=e.gl,n=t._texture.baseTexture,r=t.shader,o=t.drawMode===s.DRAW_MODES.TRIANGLE_MESH?i.TRIANGLE_STRIP:i.TRIANGLES;e.blendModeManager.setBlendMode(t.blendMode),r=r?r.shaders[i.id]||r.getShader(e):e.shaderManager.plugins.meshShader,this.renderer.shaderManager.setShader(r),r.uniforms.translationMatrix.value=t.worldTransform.toArray(!0),r.uniforms.projectionMatrix.value=e.currentRenderTarget.projectionMatrix.toArray(!0),r.uniforms.alpha.value=t.worldAlpha,r.syncUniforms(),t.dirty?(t.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,t._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,t.vertices,i.STATIC_DRAW),i.vertexAttribPointer(r.attributes.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,t._uvBuffer),i.bufferData(i.ARRAY_BUFFER,t.uvs,i.STATIC_DRAW),i.vertexAttribPointer(r.attributes.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),n._glTextures[i.id]?i.bindTexture(i.TEXTURE_2D,n._glTextures[i.id]):this.renderer.updateTexture(n),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,t._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,t.vertices),i.vertexAttribPointer(r.attributes.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,t._uvBuffer),i.vertexAttribPointer(r.attributes.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),n._glTextures[i.id]?i.bindTexture(i.TEXTURE_2D,n._glTextures[i.id]):this.renderer.updateTexture(n),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t._indexBuffer),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,t.indices)),i.drawElements(o,t.indices.length,i.UNSIGNED_SHORT,0)},n.prototype._initWebGL=function(t){var e=this.renderer.gl;t._vertexBuffer=e.createBuffer(),t._indexBuffer=e.createBuffer(),t._uvBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t.vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._uvBuffer),e.bufferData(e.ARRAY_BUFFER,t.uvs,e.STATIC_DRAW),t.colors&&(t._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._colorBuffer),e.bufferData(e.ARRAY_BUFFER,t.colors,e.STATIC_DRAW)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW)},n.prototype.flush=function(){},n.prototype.start=function(){this.currentShader=null},n.prototype.destroy=function(){r.ObjectRenderer.prototype.destroy.call(this)}},{"../../core":23,"../Mesh":118}],123:[function(t,e,i){function n(t){r.Shader.call(this,t,["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * alpha ;","}"].join("\n"),{alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aTextureCoord:0})}var r=t("../../core");n.prototype=Object.create(r.Shader.prototype),n.prototype.constructor=n,e.exports=n,r.ShaderManager.registerPlugin("meshShader",n)},{"../../core":23}],124:[function(t,e,i){Math.sign||(Math.sign=function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1})},{}],125:[function(t,e,i){Object.assign||(Object.assign=t("object-assign"))},{"object-assign":11}],126:[function(t,e,i){t("./Object.assign"),t("./requestAnimationFrame"),t("./Math.sign")},{"./Math.sign":124,"./Object.assign":125,"./requestAnimationFrame":127}],127:[function(t,e,i){(function(t){if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!t.performance||!t.performance.now){var e=Date.now();t.performance||(t.performance={}),t.performance.now=function(){return Date.now()-e}}for(var i=Date.now(),n=["ms","moz","webkit","o"],r=0;r<n.length&&!t.requestAnimationFrame;++r)t.requestAnimationFrame=t[n[r]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[n[r]+"CancelAnimationFrame"]||t[n[r]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),n=16+i-e;return 0>n&&(n=0),i=e,setTimeout(function(){i=Date.now(),t(performance.now())},n)}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],128:[function(e,i,n){(function(e){!function(){function n(t){var e=!1;return function(){if(e)throw new Error("Callback was already called.");e=!0,t.apply(r,arguments)}}var r,s,o={};r=this,null!=r&&(s=r.async),o.noConflict=function(){return r.async=s,o};var a=Object.prototype.toString,h=Array.isArray||function(t){return"[object Array]"===a.call(t)},l=function(t,e){if(t.forEach)return t.forEach(e);for(var i=0;i<t.length;i+=1)e(t[i],i,t)},u=function(t,e){if(t.map)return t.map(e);var i=[];return l(t,function(t,n,r){i.push(e(t,n,r))}),i},c=function(t,e,i){return t.reduce?t.reduce(e,i):(l(t,function(t,n,r){i=e(i,t,n,r)}),i)},p=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e};"undefined"!=typeof e&&e.nextTick?(o.nextTick=e.nextTick,"undefined"!=typeof setImmediate?o.setImmediate=function(t){setImmediate(t)}:o.setImmediate=o.nextTick):"function"==typeof setImmediate?(o.nextTick=function(t){setImmediate(t)},o.setImmediate=o.nextTick):(o.nextTick=function(t){setTimeout(t,0)},o.setImmediate=o.nextTick),o.each=function(t,e,i){function r(e){e?(i(e),i=function(){}):(s+=1,s>=t.length&&i())}if(i=i||function(){},!t.length)return i();var s=0;l(t,function(t){e(t,n(r))})},o.forEach=o.each,o.eachSeries=function(t,e,i){if(i=i||function(){},!t.length)return i();var n=0,r=function(){e(t[n],function(e){e?(i(e),i=function(){}):(n+=1,n>=t.length?i():r())})};r()},o.forEachSeries=o.eachSeries,o.eachLimit=function(t,e,i,n){var r=d(e);r.apply(null,[t,i,n])},o.forEachLimit=o.eachLimit;var d=function(t){return function(e,i,n){if(n=n||function(){},!e.length||0>=t)return n();var r=0,s=0,o=0;!function a(){if(r>=e.length)return n();for(;t>o&&s<e.length;)s+=1,o+=1,i(e[s-1],function(t){t?(n(t),n=function(){}):(r+=1,o-=1,r>=e.length?n():a())})}()}},f=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[o.each].concat(e))}},m=function(t,e){return function(){var i=Array.prototype.slice.call(arguments);return e.apply(null,[d(t)].concat(i))}},g=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[o.eachSeries].concat(e))}},y=function(t,e,i,n){if(e=u(e,function(t,e){return{index:e,value:t}}),n){var r=[];t(e,function(t,e){i(t.value,function(i,n){r[t.index]=n,e(i)})},function(t){n(t,r)})}else t(e,function(t,e){i(t.value,function(t){e(t)})})};o.map=f(y),o.mapSeries=g(y),o.mapLimit=function(t,e,i,n){return v(e)(t,i,n)};var v=function(t){return m(t,y)};o.reduce=function(t,e,i,n){o.eachSeries(t,function(t,n){i(e,t,function(t,i){e=i,n(t)})},function(t){n(t,e)})},o.inject=o.reduce,o.foldl=o.reduce,o.reduceRight=function(t,e,i,n){var r=u(t,function(t){return t}).reverse();o.reduce(r,e,i,n)},o.foldr=o.reduceRight;var x=function(t,e,i,n){var r=[];e=u(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){i(t.value,function(i){i&&r.push(t),e()})},function(t){n(u(r.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};o.filter=f(x),o.filterSeries=g(x),o.select=o.filter,o.selectSeries=o.filterSeries;var b=function(t,e,i,n){var r=[];e=u(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){i(t.value,function(i){i||r.push(t),e()})},function(t){n(u(r.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};o.reject=f(b),o.rejectSeries=g(b);var w=function(t,e,i,n){t(e,function(t,e){i(t,function(i){i?(n(t),n=function(){}):e()})},function(t){n()})};o.detect=f(w),o.detectSeries=g(w),o.some=function(t,e,i){o.each(t,function(t,n){e(t,function(t){t&&(i(!0),i=function(){}),n()})},function(t){i(!1)})},o.any=o.some,o.every=function(t,e,i){o.each(t,function(t,n){e(t,function(t){t||(i(!1),i=function(){}),n()})},function(t){i(!0)})},o.all=o.every,o.sortBy=function(t,e,i){o.map(t,function(t,i){e(t,function(e,n){e?i(e):i(null,{value:t,criteria:n})})},function(t,e){if(t)return i(t);var n=function(t,e){var i=t.criteria,n=e.criteria;return n>i?-1:i>n?1:0};i(null,u(e.sort(n),function(t){return t.value}))})},o.auto=function(t,e){e=e||function(){};var i=p(t),n=i.length;if(!n)return e();var r={},s=[],a=function(t){s.unshift(t)},u=function(t){for(var e=0;e<s.length;e+=1)if(s[e]===t)return void s.splice(e,1)},d=function(){n--,l(s.slice(0),function(t){t()})};a(function(){if(!n){var t=e;e=function(){},t(null,r)}}),l(i,function(i){var n=h(t[i])?t[i]:[t[i]],s=function(t){var n=Array.prototype.slice.call(arguments,1);if(n.length<=1&&(n=n[0]),t){var s={};l(p(r),function(t){s[t]=r[t]}),s[i]=n,e(t,s),e=function(){}}else r[i]=n,o.setImmediate(d)},f=n.slice(0,Math.abs(n.length-1))||[],m=function(){return c(f,function(t,e){return t&&r.hasOwnProperty(e)},!0)&&!r.hasOwnProperty(i)};if(m())n[n.length-1](s,r);else{var g=function(){m()&&(u(g),n[n.length-1](s,r))};a(g)}})},o.retry=function(t,e,i){var n=5,r=[];"function"==typeof t&&(i=e,e=t,t=n),t=parseInt(t,10)||n;var s=function(n,s){for(var a=function(t,e){return function(i){t(function(t,n){i(!t||e,{err:t,result:n})},s)}};t;)r.push(a(e,!(t-=1)));o.series(r,function(t,e){e=e[e.length-1],(n||i)(e.err,e.result)})};return i?s():s},o.waterfall=function(t,e){if(e=e||function(){},!h(t)){var i=new Error("First argument to waterfall must be an array of functions");return e(i)}if(!t.length)return e();var n=function(t){return function(i){if(i)e.apply(null,arguments),e=function(){};else{var r=Array.prototype.slice.call(arguments,1),s=t.next();s?r.push(n(s)):r.push(e),o.setImmediate(function(){t.apply(null,r)})}}};n(o.iterator(t))()};var _=function(t,e,i){if(i=i||function(){},h(e))t.map(e,function(t,e){t&&t(function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),e.call(null,t,i)})},i);else{var n={};t.each(p(e),function(t,i){e[t](function(e){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),n[t]=r,i(e)})},function(t){i(t,n)})}};o.parallel=function(t,e){_({map:o.map,each:o.each},t,e)},o.parallelLimit=function(t,e,i){_({map:v(e),each:d(e)},t,i)},o.series=function(t,e){if(e=e||function(){},h(t))o.mapSeries(t,function(t,e){t&&t(function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),e.call(null,t,i)})},e);else{var i={};o.eachSeries(p(t),function(e,n){t[e](function(t){var r=Array.prototype.slice.call(arguments,1);r.length<=1&&(r=r[0]),i[e]=r,n(t)})},function(t){e(t,i)})}},o.iterator=function(t){var e=function(i){var n=function(){return t.length&&t[i].apply(null,arguments),n.next()};return n.next=function(){return i<t.length-1?e(i+1):null},n};return e(0)},o.apply=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e.concat(Array.prototype.slice.call(arguments)))}};var T=function(t,e,i,n){var r=[];t(e,function(t,e){i(t,function(t,i){r=r.concat(i||[]),e(t)})},function(t){n(t,r)})};o.concat=f(T),o.concatSeries=g(T),o.whilst=function(t,e,i){t()?e(function(n){return n?i(n):void o.whilst(t,e,i)}):i()},o.doWhilst=function(t,e,i){t(function(n){if(n)return i(n);var r=Array.prototype.slice.call(arguments,1);e.apply(null,r)?o.doWhilst(t,e,i):i()})},o.until=function(t,e,i){t()?i():e(function(n){return n?i(n):void o.until(t,e,i)})},o.doUntil=function(t,e,i){t(function(n){if(n)return i(n);var r=Array.prototype.slice.call(arguments,1);e.apply(null,r)?i():o.doUntil(t,e,i)})},o.queue=function(t,e){function i(t,e,i,n){return t.started||(t.started=!0),h(e)||(e=[e]),0==e.length?o.setImmediate(function(){t.drain&&t.drain()}):void l(e,function(e){var r={data:e,callback:"function"==typeof n?n:null};i?t.tasks.unshift(r):t.tasks.push(r),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),o.setImmediate(t.process)})}void 0===e&&(e=1);var r=0,s={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(t,e){i(s,t,!1,e)},kill:function(){s.drain=null,s.tasks=[]},unshift:function(t,e){i(s,t,!0,e)},process:function(){if(!s.paused&&r<s.concurrency&&s.tasks.length){var e=s.tasks.shift();s.empty&&0===s.tasks.length&&s.empty(),r+=1;var i=function(){r-=1,e.callback&&e.callback.apply(e,arguments),s.drain&&s.tasks.length+r===0&&s.drain(),s.process()},o=n(i);t(e.data,o)}},length:function(){return s.tasks.length},running:function(){return r},idle:function(){return s.tasks.length+r===0},pause:function(){s.paused!==!0&&(s.paused=!0,s.process())},resume:function(){s.paused!==!1&&(s.paused=!1,s.process())}};return s},o.priorityQueue=function(t,e){function i(t,e){return t.priority-e.priority}function n(t,e,i){for(var n=-1,r=t.length-1;r>n;){var s=n+(r-n+1>>>1);i(e,t[s])>=0?n=s:r=s-1}return n}function r(t,e,r,s){return t.started||(t.started=!0),h(e)||(e=[e]),0==e.length?o.setImmediate(function(){t.drain&&t.drain()}):void l(e,function(e){var a={data:e,priority:r,callback:"function"==typeof s?s:null};t.tasks.splice(n(t.tasks,a,i)+1,0,a),t.saturated&&t.tasks.length===t.concurrency&&t.saturated(),o.setImmediate(t.process)})}var s=o.queue(t,e);return s.push=function(t,e,i){r(s,t,e,i)},delete s.unshift,s},o.cargo=function(t,e){var i=!1,n=[],r={tasks:n,payload:e,saturated:null,empty:null,drain:null,drained:!0,push:function(t,i){h(t)||(t=[t]),l(t,function(t){n.push({data:t,callback:"function"==typeof i?i:null}),r.drained=!1,r.saturated&&n.length===e&&r.saturated()}),o.setImmediate(r.process)},process:function s(){if(!i){if(0===n.length)return r.drain&&!r.drained&&r.drain(),void(r.drained=!0);var o="number"==typeof e?n.splice(0,e):n.splice(0,n.length),a=u(o,function(t){return t.data});r.empty&&r.empty(),i=!0,t(a,function(){i=!1;var t=arguments;l(o,function(e){e.callback&&e.callback.apply(null,t)}),s()})}},length:function(){return n.length},running:function(){return i}};return r};var E=function(t){return function(e){var i=Array.prototype.slice.call(arguments,1);e.apply(null,i.concat([function(e){var i=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(e?console.error&&console.error(e):console[t]&&l(i,function(e){console[t](e)}))}]))}};o.log=E("log"),o.dir=E("dir"),o.memoize=function(t,e){var i={},n={};e=e||function(t){return t};var r=function(){var r=Array.prototype.slice.call(arguments),s=r.pop(),a=e.apply(null,r);a in i?o.nextTick(function(){s.apply(null,i[a])}):a in n?n[a].push(s):(n[a]=[s],t.apply(null,r.concat([function(){i[a]=arguments;var t=n[a];delete n[a];for(var e=0,r=t.length;r>e;e++)t[e].apply(null,arguments)}])))};return r.memo=i,r.unmemoized=t,r},o.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},o.times=function(t,e,i){for(var n=[],r=0;t>r;r++)n.push(r);return o.map(n,e,i)},o.timesSeries=function(t,e,i){for(var n=[],r=0;t>r;r++)n.push(r);return o.mapSeries(n,e,i)},o.seq=function(){var t=arguments;return function(){var e=this,i=Array.prototype.slice.call(arguments),n=i.pop();o.reduce(t,i,function(t,i,n){i.apply(e,t.concat([function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);n(t,e)}]))},function(t,i){n.apply(e,[t].concat(i))})}},o.compose=function(){return o.seq.apply(null,Array.prototype.reverse.call(arguments))};var S=function(t,e){var i=function(){var i=this,n=Array.prototype.slice.call(arguments),r=n.pop();return t(e,function(t,e){t.apply(i,n.concat([e]))},r)};if(arguments.length>2){var n=Array.prototype.slice.call(arguments,2);return i.apply(this,n)}return i};o.applyEach=f(S),o.applyEachSeries=g(S),o.forever=function(t,e){function i(n){if(n){if(e)return e(n);throw n}t(i)}i()},"undefined"!=typeof i&&i.exports?i.exports=o:"undefined"!=typeof t&&t.amd?t([],function(){return o}):r.async=o}()}).call(this,e("_process"))},{_process:3}],129:[function(t,e,i){"use strict";function n(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(){}var s="function"!=typeof Object.create?"~":!1;r.prototype._events=void 0,r.prototype.listeners=function(t,e){var i=s?s+t:t,n=this._events&&this._events[i];if(e)return!!n;if(!n)return[];if(this._events[i].fn)return[this._events[i].fn];for(var r=0,o=this._events[i].length,a=new Array(o);o>r;r++)a[r]=this._events[i][r].fn;return a},r.prototype.emit=function(t,e,i,n,r,o){var a=s?s+t:t;if(!this._events||!this._events[a])return!1;var h,l,u=this._events[a],c=arguments.length;if("function"==typeof u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,n),!0;case 5:return u.fn.call(u.context,e,i,n,r),!0;case 6:return u.fn.call(u.context,e,i,n,r,o),!0}for(l=1,h=new Array(c-1);c>l;l++)h[l-1]=arguments[l];u.fn.apply(u.context,h)}else{var p,d=u.length;for(l=0;d>l;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,i);break;default:if(!h)for(p=1,h=new Array(c-1);c>p;p++)h[p-1]=arguments[p];u[l].fn.apply(u[l].context,h)}}return!0},r.prototype.on=function(t,e,i){var r=new n(e,i||this),o=s?s+t:t;return this._events||(this._events=s?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):this._events[o]=r,this},r.prototype.once=function(t,e,i){var r=new n(e,i||this,!0),o=s?s+t:t;return this._events||(this._events=s?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):this._events[o]=r,this},r.prototype.removeListener=function(t,e,i,n){var r=s?s+t:t;if(!this._events||!this._events[r])return this;var o=this._events[r],a=[];if(e)if(o.fn)(o.fn!==e||n&&!o.once||i&&o.context!==i)&&a.push(o);else for(var h=0,l=o.length;l>h;h++)(o[h].fn!==e||n&&!o[h].once||i&&o[h].context!==i)&&a.push(o[h]);return a.length?this._events[r]=1===a.length?a[0]:a:delete this._events[r],this},r.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[s?s+t:t]:this._events=s?{}:Object.create(null),this):this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.prefixed=s,e.exports=r},{}],130:[function(t,e,i){function n(t,e){a.call(this),e=e||10,this.baseUrl=t||"",this.progress=0,this.loading=!1,this._progressChunk=0,this._beforeMiddleware=[],this._afterMiddleware=[],this._boundLoadResource=this._loadResource.bind(this),this._boundOnLoad=this._onLoad.bind(this),this._buffer=[],this._numToLoad=0,this._queue=r.queue(this._boundLoadResource,e),this.resources={}}var r=t("async"),s=t("url"),o=t("./Resource"),a=t("eventemitter3");n.prototype=Object.create(a.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.add=n.prototype.enqueue=function(t,e,i,n){if(Array.isArray(t)){for(var r=0;r<t.length;++r)this.add(t[r]);return this}if("object"==typeof t&&(n=e||t.callback||t.onComplete,i=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(n=i,i=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof i&&(n=i,i=null),this.resources[t])throw new Error('Resource with name "'+t+'" already exists.');return e=this._handleBaseUrl(e),this.resources[t]=new o(t,e,i),"function"==typeof n&&this.resources[t].once("afterMiddleware",n),this._numToLoad++,this._queue.started?(this._queue.push(this.resources[t]),this._progressChunk=(100-this.progress)/(this._queue.length()+this._queue.running())):(this._buffer.push(this.resources[t]),this._progressChunk=100/this._buffer.length),this},n.prototype._handleBaseUrl=function(t){var e=s.parse(t);return e.protocol||0===e.pathname.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t},n.prototype.before=n.prototype.pre=function(t){return this._beforeMiddleware.push(t),this},n.prototype.after=n.prototype.use=function(t){return this._afterMiddleware.push(t),this},n.prototype.reset=function(){this.progress=0,this.loading=!1,this._progressChunk=0,this._buffer.length=0,this._numToLoad=0,this._queue.kill(),this._queue.started=!1,this.resources={}},n.prototype.load=function(t){if("function"==typeof t&&this.once("complete",t),this._queue.started)return this;this.emit("start",this);for(var e=0;e<this._buffer.length;++e)this._queue.push(this._buffer[e]);return this._buffer.length=0,this},n.prototype._loadResource=function(t,e){var i=this;t._dequeue=e,this._runMiddleware(t,this._beforeMiddleware,function(){t.load(i._boundOnLoad)})},n.prototype._onComplete=function(){this.emit("complete",this,this.resources)},n.prototype._onLoad=function(t){this.progress+=this._progressChunk,this.emit("progress",this,t),this._runMiddleware(t,this._afterMiddleware,function(){t.emit("afterMiddleware",t),this._numToLoad--,0===this._numToLoad&&(this.progress=100,this._onComplete()),t.error?this.emit("error",t.error,this,t):this.emit("load",this,t)}),t._dequeue()},n.prototype._runMiddleware=function(t,e,i){var n=this;r.eachSeries(e,function(e,i){e.call(n,t,i)},i.bind(this,t))},n.LOAD_TYPE=o.LOAD_TYPE,n.XHR_READY_STATE=o.XHR_READY_STATE,n.XHR_RESPONSE_TYPE=o.XHR_RESPONSE_TYPE},{"./Resource":131,async:128,eventemitter3:129,url:8}],131:[function(t,e,i){function n(t,e,i){if(o.call(this),i=i||{},"string"!=typeof t||"string"!=typeof e)throw new Error("Both name and url are required for constructing a resource.");this.name=t,this.url=e,this.isDataUrl=0===this.url.indexOf("data:"),this.data=null,this.crossOrigin=i.crossOrigin===!0?"anonymous":i.crossOrigin,this.loadType=i.loadType||this._determineLoadType(),this.xhrType=i.xhrType,this.metadata=i.metadata||{},this.error=null,this.xhr=null,this.isJson=!1,this.isXml=!1,this.isImage=!1,this.isAudio=!1,this.isVideo=!1,this._dequeue=null,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this)}function r(t){return t.toString().replace("object ","")}function s(t,e,i){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=i)}var o=t("eventemitter3"),a=t("url"),h=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),l=null;n.prototype=Object.create(o.prototype),n.prototype.constructor=n,e.exports=n,n.prototype.complete=function(){this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError),this.data.removeEventListener("load",this._boundComplete),this.data.removeEventListener("progress",this._boundOnProgress),this.data.removeEventListener("canplaythrough",this._boundComplete)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError),this.xhr.removeEventListener("abort",this._boundXhrOnAbort),this.xhr.removeEventListener("progress",this._boundOnProgress),this.xhr.removeEventListener("load",this._boundXhrOnLoad)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null)),this.emit("complete",this)},n.prototype.load=function(t){switch(this.emit("start",this),t&&this.once("complete",t),this.crossOrigin!==!1&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case n.LOAD_TYPE.IMAGE:this._loadImage();break;case n.LOAD_TYPE.AUDIO:this._loadElement("audio");break;case n.LOAD_TYPE.VIDEO:this._loadElement("video");break;case n.LOAD_TYPE.XHR:default:h&&this.crossOrigin?this._loadXdr():this._loadXhr()}},n.prototype._loadImage=function(){this.data=new Image,this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.data.src=this.url,this.isImage=!0,this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1)},n.prototype._loadElement=function(t){if("audio"===t&&"undefined"!=typeof Audio?this.data=new Audio:this.data=document.createElement(t),null===this.data)return this.error=new Error("Unsupported element "+t),void this.complete();if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=0;e<this.url.length;++e)this.data.appendChild(this._createSource(t,this.url[e]));else this.data.appendChild(this._createSource(t,this.url));this["is"+t[0].toUpperCase()+t.substring(1)]=!0,this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load()},n.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XMLHttpRequest;t.open("GET",this.url,!0),this.xhrType===n.XHR_RESPONSE_TYPE.JSON||this.xhrType===n.XHR_RESPONSE_TYPE.DOCUMENT?t.responseType=n.XHR_RESPONSE_TYPE.TEXT:t.responseType=this.xhrType,t.addEventListener("error",this._boundXhrOnError,!1),t.addEventListener("abort",this._boundXhrOnAbort,!1),t.addEventListener("progress",this._boundOnProgress,!1),
t.addEventListener("load",this._boundXhrOnLoad,!1),t.send()},n.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXdrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){t.send()},0)},n.prototype._createSource=function(t,e,i){i||(i=t+"/"+e.substr(e.lastIndexOf(".")+1));var n=document.createElement("source");return n.src=e,n.type=i,n},n.prototype._onError=function(t){this.error=new Error("Failed to load element using "+t.target.nodeName),this.complete()},n.prototype._onProgress=function(t){t&&t.lengthComputable&&this.emit("progress",this,t.loaded/t.total)},n.prototype._xhrOnError=function(){this.error=new Error(r(this.xhr)+" Request failed. Status: "+this.xhr.status+', text: "'+this.xhr.statusText+'"'),this.complete()},n.prototype._xhrOnAbort=function(){this.error=new Error(r(this.xhr)+" Request was aborted by the user."),this.complete()},n.prototype._xdrOnTimeout=function(){this.error=new Error(r(this.xhr)+" Request timed out."),this.complete()},n.prototype._xhrOnLoad=function(){var t=this.xhr,e=void 0!==t.status?t.status:200;if(200===e||204===e||0===e&&t.responseText.length>0)if(this.xhrType===n.XHR_RESPONSE_TYPE.TEXT)this.data=t.responseText;else if(this.xhrType===n.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(t.responseText),this.isJson=!0}catch(i){this.error=new Error("Error trying to parse loaded json:",i)}else if(this.xhrType===n.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var r=new DOMParser;this.data=r.parseFromString(t.responseText,"text/xml")}else{var s=document.createElement("div");s.innerHTML=t.responseText,this.data=s}this.isXml=!0}catch(i){this.error=new Error("Error trying to parse loaded xml:",i)}else this.data=t.response||t.responseText;else this.error=new Error("["+t.status+"]"+t.statusText+":"+t.responseURL);this.complete()},n.prototype._determineCrossOrigin=function(t,e){if(0===t.indexOf("data:"))return"";e=e||window.location,l||(l=document.createElement("a")),l.href=t,t=a.parse(l.href);var i=!t.port&&""===e.port||t.port===e.port;return t.hostname===e.hostname&&i&&t.protocol===e.protocol?"":"anonymous"},n.prototype._determineXhrType=function(){return n._xhrTypeMap[this._getExtension()]||n.XHR_RESPONSE_TYPE.TEXT},n.prototype._determineLoadType=function(){return n._loadTypeMap[this._getExtension()]||n.LOAD_TYPE.XHR},n.prototype._getExtension=function(){var t,e=this.url;if(this.isDataUrl){var i=e.indexOf("/");t=e.substring(i+1,e.indexOf(";",i))}else{var n=e.indexOf("?");-1!==n&&(e=e.substring(0,n)),t=e.substring(e.lastIndexOf(".")+1)}return t},n.prototype._getMimeFromXhrType=function(t){switch(t){case n.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case n.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case n.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case n.XHR_RESPONSE_TYPE.JSON:return"application/json";case n.XHR_RESPONSE_TYPE.DEFAULT:case n.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},n.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},n.XHR_READY_STATE={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},n.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},n._loadTypeMap={gif:n.LOAD_TYPE.IMAGE,png:n.LOAD_TYPE.IMAGE,bmp:n.LOAD_TYPE.IMAGE,jpg:n.LOAD_TYPE.IMAGE,jpeg:n.LOAD_TYPE.IMAGE,tif:n.LOAD_TYPE.IMAGE,tiff:n.LOAD_TYPE.IMAGE,webp:n.LOAD_TYPE.IMAGE,tga:n.LOAD_TYPE.IMAGE},n._xhrTypeMap={xhtml:n.XHR_RESPONSE_TYPE.DOCUMENT,html:n.XHR_RESPONSE_TYPE.DOCUMENT,htm:n.XHR_RESPONSE_TYPE.DOCUMENT,xml:n.XHR_RESPONSE_TYPE.DOCUMENT,tmx:n.XHR_RESPONSE_TYPE.DOCUMENT,tsx:n.XHR_RESPONSE_TYPE.DOCUMENT,svg:n.XHR_RESPONSE_TYPE.DOCUMENT,gif:n.XHR_RESPONSE_TYPE.BLOB,png:n.XHR_RESPONSE_TYPE.BLOB,bmp:n.XHR_RESPONSE_TYPE.BLOB,jpg:n.XHR_RESPONSE_TYPE.BLOB,jpeg:n.XHR_RESPONSE_TYPE.BLOB,tif:n.XHR_RESPONSE_TYPE.BLOB,tiff:n.XHR_RESPONSE_TYPE.BLOB,webp:n.XHR_RESPONSE_TYPE.BLOB,tga:n.XHR_RESPONSE_TYPE.BLOB,json:n.XHR_RESPONSE_TYPE.JSON,text:n.XHR_RESPONSE_TYPE.TEXT,txt:n.XHR_RESPONSE_TYPE.TEXT},n.setExtensionLoadType=function(t,e){s(n._loadTypeMap,t,e)},n.setExtensionXhrType=function(t,e){s(n._xhrTypeMap,t,e)}},{eventemitter3:129,url:8}],132:[function(t,e,i){e.exports={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeBinary:function(t){for(var e,i="",n=new Array(4),r=0,s=0,o=0;r<t.length;){for(e=new Array(3),s=0;s<e.length;s++)r<t.length?e[s]=255&t.charCodeAt(r++):e[s]=0;switch(n[0]=e[0]>>2,n[1]=(3&e[0])<<4|e[1]>>4,n[2]=(15&e[1])<<2|e[2]>>6,n[3]=63&e[2],o=r-(t.length-1)){case 2:n[3]=64,n[2]=64;break;case 1:n[3]=64}for(s=0;s<n.length;s++)i+=this._keyStr.charAt(n[s])}return i}}},{}],133:[function(t,e,i){e.exports=t("./Loader"),e.exports.Resource=t("./Resource"),e.exports.middleware={caching:{memory:t("./middlewares/caching/memory")},parsing:{blob:t("./middlewares/parsing/blob")}}},{"./Loader":130,"./Resource":131,"./middlewares/caching/memory":134,"./middlewares/parsing/blob":135}],134:[function(t,e,i){var n={};e.exports=function(){return function(t,e){n[t.url]?(t.data=n[t.url],t.complete()):t.once("complete",function(){n[this.url]=this.data}),e()}}},{}],135:[function(t,e,i){var n=t("../../Resource"),r=t("../../b64");window.URL=window.URL||window.webkitURL,e.exports=function(){return function(t,e){if(!t.data)return e();if(t.xhr&&t.xhrType===n.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var i=URL.createObjectURL(t.data);t.blob=t.data,t.data=new Image,t.data.src=i,t.isImage=!0,t.data.onload=function(){URL.revokeObjectURL(i),t.data.onload=null,e()}}}else{var s=t.xhr.getResponseHeader("content-type");s&&0===s.indexOf("image")&&(t.data=new Image,t.data.src="data:"+s+";base64,"+r.encodeBinary(t.xhr.responseText),t.isImage=!0,t.data.onload=function(){t.data.onload=null,e()})}else e()}}},{"../../Resource":131,"../../b64":132}]},{},[108])(108)}),function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return r(i?i:t)},l,l.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){var n=t("../lib/swig");"function"==typeof window.define&&"object"==typeof window.define.amd?window.define("swig",[],function(){return n}):window.swig=n},{"../lib/swig":9}],2:[function(t,e,i){var n=t("./utils"),r={full:["January","February","March","April","May","June","July","August","September","October","November","December"],abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},s={full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],alt:{"-1":"Yesterday",0:"Today",1:"Tomorrow"}};i.tzOffset=0,i.DateZ=function(){var t={"default":["getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","toISOString","toGMTString","toUTCString","valueOf","getTime"],z:["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getYear","toDateString","toLocaleDateString","toLocaleTimeString"]},e=this;e.date=e.dateZ=arguments.length>1?new Date(Date.UTC.apply(Date,arguments)+6e4*(new Date).getTimezoneOffset()):1===arguments.length?new Date(new Date(arguments[0])):new Date,e.timezoneOffset=e.dateZ.getTimezoneOffset(),n.each(t.z,function(t){e[t]=function(){return e.dateZ[t]()}}),n.each(t["default"],function(t){e[t]=function(){return e.date[t]()}}),this.setTimezoneOffset(i.tzOffset)},i.DateZ.prototype={getTimezoneOffset:function(){return this.timezoneOffset},setTimezoneOffset:function(t){return this.timezoneOffset=t,this.dateZ=new Date(this.date.getTime()+6e4*this.date.getTimezoneOffset()-6e4*this.timezoneOffset),this}},i.d=function(t){return(t.getDate()<10?"0":"")+t.getDate()},i.D=function(t){return s.abbr[t.getDay()]},i.j=function(t){return t.getDate()},i.l=function(t){return s.full[t.getDay()]},i.N=function(t){var e=t.getDay();return e>=1?e:7},i.S=function(t){var e=t.getDate();return e%10===1&&11!==e?"st":e%10===2&&12!==e?"nd":e%10===3&&13!==e?"rd":"th"},i.w=function(t){return t.getDay()},i.z=function(t,e,n){var r=t.getFullYear(),s=new i.DateZ(r,t.getMonth(),t.getDate(),12,0,0),o=new i.DateZ(r,0,1,12,0,0);return s.setTimezoneOffset(e,n),o.setTimezoneOffset(e,n),Math.round((s-o)/864e5)},i.W=function(t){var e,i=new Date(t.valueOf()),n=(t.getDay()+6)%7;return i.setDate(i.getDate()-n+3),e=i.valueOf(),i.setMonth(0,1),4!==i.getDay()&&i.setMonth(0,1+(4-i.getDay()+7)%7),1+Math.ceil((e-i)/6048e5)},i.F=function(t){return r.full[t.getMonth()]},i.m=function(t){return(t.getMonth()<9?"0":"")+(t.getMonth()+1)},i.M=function(t){return r.abbr[t.getMonth()]},i.n=function(t){return t.getMonth()+1},i.t=function(t){return 32-new Date(t.getFullYear(),t.getMonth(),32).getDate()},i.L=function(t){return 29===new Date(t.getFullYear(),1,29).getDate()},i.o=function(t){var e=new Date(t.valueOf());return e.setDate(e.getDate()-(t.getDay()+6)%7+3),e.getFullYear()},i.Y=function(t){return t.getFullYear()},i.y=function(t){return t.getFullYear().toString().substr(2)},i.a=function(t){return t.getHours()<12?"am":"pm"},i.A=function(t){return t.getHours()<12?"AM":"PM"},i.B=function(t){var e,i=t.getUTCHours();return i=23===i?0:i+1,e=Math.abs((60*(60*i+t.getUTCMinutes())+t.getUTCSeconds())/86.4).toFixed(0),"000".concat(e).slice(e.length)},i.g=function(t){var e=t.getHours();return 0===e?12:e>12?e-12:e},i.G=function(t){return t.getHours()},i.h=function(t){var e=t.getHours();return(10>e||e>12&&22>e?"0":"")+(12>e?e:e-12)},i.H=function(t){var e=t.getHours();return(10>e?"0":"")+e},i.i=function(t){var e=t.getMinutes();return(10>e?"0":"")+e},i.s=function(t){var e=t.getSeconds();return(10>e?"0":"")+e},i.O=function(t){var e=t.getTimezoneOffset();return(0>e?"-":"+")+(10>e/60?"0":"")+Math.abs(e/60)+"00"},i.Z=function(t){return 60*t.getTimezoneOffset()},i.c=function(t){return t.toISOString()},i.r=function(t){return t.toUTCString()},i.U=function(t){return t.getTime()/1e3}},{"./utils":26}],3:[function(t,e,i){function n(t){var e=this,i={};return r.isArray(t)?r.map(t,function(t){return e.apply(null,arguments)}):"object"==typeof t?(r.each(t,function(t,n){i[n]=e.apply(null,arguments)}),i):void 0}var r=t("./utils"),s=t("./dateformatter");i.addslashes=function(t){var e=n.apply(i.addslashes,arguments);return void 0!==e?e:t.replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\"/g,'\\"')},i.capitalize=function(t){var e=n.apply(i.capitalize,arguments);return void 0!==e?e:t.toString().charAt(0).toUpperCase()+t.toString().substr(1).toLowerCase()},i.date=function(t,e,i,n){var r,o=e.length,a=new s.DateZ(t),h=0,l="";for(i&&a.setTimezoneOffset(i,n),h;o>h;h+=1)r=e.charAt(h),"\\"===r?(h+=1,l+=o>h?e.charAt(h):r):l+=s.hasOwnProperty(r)?s[r](a,i,n):r;return l},i["default"]=function(t,e){return"undefined"==typeof t||!t&&"number"!=typeof t?e:t},i.escape=function(t,e){var r,s=n.apply(i.escape,arguments),o=t,a=0;if(void 0!==s)return s;if("string"!=typeof t)return t;switch(s="",e){case"js":for(o=o.replace(/\\/g,"\\u005C"),a;a<o.length;a+=1)r=o.charCodeAt(a),32>r?(r=r.toString(16).toUpperCase(),r=r.length<2?"0"+r:r,s+="\\u00"+r):s+=o[a];return s.replace(/&/g,"\\u0026").replace(/</g,"\\u003C").replace(/>/g,"\\u003E").replace(/\'/g,"\\u0027").replace(/"/g,"\\u0022").replace(/\=/g,"\\u003D").replace(/-/g,"\\u002D").replace(/;/g,"\\u003B");default:return o.replace(/&(?!amp;|lt;|gt;|quot;|#39;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}},i.e=i.escape,i.first=function(t){if("object"==typeof t&&!r.isArray(t)){var e=r.keys(t);return t[e[0]]}return"string"==typeof t?t.substr(0,1):t[0]},i.groupBy=function(t,e){if(!r.isArray(t))return t;var i={};return r.each(t,function(t){if(t.hasOwnProperty(e)){var n=t[e];r.extend({},t);delete t[e],i[n]||(i[n]=[]),i[n].push(t)}}),i},i.join=function(t,e){if(r.isArray(t))return t.join(e);if("object"==typeof t){var i=[];return r.each(t,function(t){i.push(t)}),i.join(e)}return t},i.json=function(t,e){return JSON.stringify(t,null,e||0)},i.json_encode=i.json,i.last=function(t){if("object"==typeof t&&!r.isArray(t)){var e=r.keys(t);return t[e[e.length-1]]}return"string"==typeof t?t.charAt(t.length-1):t[t.length-1]},i.lower=function(t){var e=n.apply(i.lower,arguments);return void 0!==e?e:t.toString().toLowerCase()},i.raw=function(t){return i.safe(t)},i.raw.safe=!0,i.replace=function(t,e,i,n){var r=new RegExp(e,n);return t.replace(r,i)},i.reverse=function(t){return i.sort(t,!0)},i.safe=function(t){return t},i.safe.safe=!0,i.sort=function(t,e){var i;if(r.isArray(t))i=t.sort();else switch(typeof t){case"object":i=r.keys(t).sort();break;case"string":return i=t.split(""),e?i.reverse().join(""):i.sort().join("")}return i&&e?i.reverse():i||t},i.striptags=function(t){var e=n.apply(i.striptags,arguments);return void 0!==e?e:t.toString().replace(/(<([^>]+)>)/gi,"")},i.title=function(t){var e=n.apply(i.title,arguments);return void 0!==e?e:t.toString().replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})},i.uniq=function(t){var e;return t&&r.isArray(t)?(e=[],r.each(t,function(t){-1===e.indexOf(t)&&e.push(t)}),e):""},i.upper=function(t){var e=n.apply(i.upper,arguments);return void 0!==e?e:t.toString().toUpperCase()},i.url_encode=function(t){var e=n.apply(i.url_encode,arguments);return void 0!==e?e:encodeURIComponent(t)},i.url_decode=function(t){var e=n.apply(i.url_decode,arguments);return void 0!==e?e:decodeURIComponent(t)}},{"./dateformatter":2,"./utils":26}],4:[function(t,e,i){function n(t){var e;return r.some(o,function(i){return r.some(i.regex,function(n){var r,s=t.match(n);if(s)return r=s[i.idx||0].replace(/\s*$/,""),r=i.hasOwnProperty("replace")&&i.replace.hasOwnProperty(r)?i.replace[r]:r,e={match:r,type:i.type,length:s[0].length},!0})}),e||(e={match:t,type:s.UNKNOWN,length:t.length}),e}var r=t("./utils"),s={WHITESPACE:0,STRING:1,FILTER:2,FILTEREMPTY:3,FUNCTION:4,FUNCTIONEMPTY:5,PARENOPEN:6,PARENCLOSE:7,COMMA:8,VAR:9,NUMBER:10,OPERATOR:11,BRACKETOPEN:12,BRACKETCLOSE:13,DOTKEY:14,ARRAYOPEN:15,CURLYOPEN:17,CURLYCLOSE:18,COLON:19,COMPARATOR:20,LOGIC:21,NOT:22,BOOL:23,ASSIGNMENT:24,METHODOPEN:25,UNKNOWN:100},o=[{type:s.WHITESPACE,regex:[/^\s+/]},{type:s.STRING,regex:[/^""/,/^".*?[^\\]"/,/^''/,/^'.*?[^\\]'/]},{type:s.FILTER,regex:[/^\|\s*(\w+)\(/],idx:1},{type:s.FILTEREMPTY,regex:[/^\|\s*(\w+)/],idx:1},{type:s.FUNCTIONEMPTY,regex:[/^\s*(\w+)\(\)/],idx:1},{type:s.FUNCTION,regex:[/^\s*(\w+)\(/],idx:1},{type:s.PARENOPEN,regex:[/^\(/]},{type:s.PARENCLOSE,regex:[/^\)/]},{type:s.COMMA,regex:[/^,/]},{type:s.LOGIC,regex:[/^(&&|\|\|)\s*/,/^(and|or)\s+/],idx:1,replace:{and:"&&",or:"||"}},{type:s.COMPARATOR,regex:[/^(===|==|\!==|\!=|<=|<|>=|>|in\s|gte\s|gt\s|lte\s|lt\s)\s*/],idx:1,replace:{gte:">=",gt:">",lte:"<=",lt:"<"}},{type:s.ASSIGNMENT,regex:[/^(=|\+=|-=|\*=|\/=)/]},{type:s.NOT,regex:[/^\!\s*/,/^not\s+/],replace:{not:"!"}},{type:s.BOOL,regex:[/^(true|false)\s+/,/^(true|false)$/],idx:1},{type:s.VAR,regex:[/^[a-zA-Z_$]\w*((\.\$?\w*)+)?/,/^[a-zA-Z_$]\w*/]},{type:s.BRACKETOPEN,regex:[/^\[/]},{type:s.BRACKETCLOSE,regex:[/^\]/]},{type:s.CURLYOPEN,regex:[/^\{/]},{type:s.COLON,regex:[/^\:/]},{type:s.CURLYCLOSE,regex:[/^\}/]},{type:s.DOTKEY,regex:[/^\.(\w+)/],idx:1},{type:s.NUMBER,regex:[/^[+\-]?\d+(\.\d+)?/]},{type:s.OPERATOR,regex:[/^(\+|\-|\/|\*|%)/]}];i.types=s,i.read=function(t){for(var e,i,r=0,s=[];r<t.length;)e=t.substring(r),i=n(e),r+=i.length,s.push(i);return s}},{"./utils":26}],5:[function(t,e,i){var n=t("__browserify_process"),r=t("fs"),s=t("path");e.exports=function(t,e){var i={};return e=e||"utf8",t=t?s.normalize(t):null,i.resolve=function(e,i){return i=t?t:i?s.dirname(i):n.cwd(),s.resolve(i,e)},i.load=function(t,n){if(!r||n&&!r.readFile||!r.readFileSync)throw new Error("Unable to find file "+t+" because there is no filesystem to read from.");return t=i.resolve(t),n?void r.readFile(t,e,n):r.readFileSync(t,e)},i}},{__browserify_process:31,fs:28,path:29}],6:[function(t,e,i){i.fs=t("./filesystem"),i.memory=t("./memory")},{"./filesystem":5,"./memory":7}],7:[function(t,e,i){var n=t("path"),r=t("../utils");e.exports=function(t,e){var i={};return e=e?n.normalize(e):null,i.resolve=function(t,i){return i=e?e:i?n.dirname(i):"/",n.resolve(i,t)},i.load=function(e,i){var n,s;return s=[e,e.replace(/^(\/|\\)/,"")],n=t[s[0]]||t[s[1]],n||r.throwError('Unable to find template "'+e+'".'),i?void i(null,n):n},i}},{"../utils":26,path:29}],8:[function(t,e,i){function n(t){return t.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")}function r(t,e,i,n,r){this.out=[],this.state=[],this.filterApplyIdx=[],this._parsers={},this.line=n,this.filename=r,this.filters=e,this.escape=i,this.parse=function(){var e=this;return e._parsers.start&&e._parsers.start.call(e),s.each(t,function(i,n){var r=t[n-1];if(e.isLast=n===t.length-1,r)for(;r.type===a.WHITESPACE;)n-=1,r=t[n-1];e.prevToken=r,e.parseToken(i)}),e._parsers.end&&e._parsers.end.call(e),e.escape&&(e.filterApplyIdx=[0],"string"==typeof e.escape?(e.parseToken({type:a.FILTER,match:"e"}),e.parseToken({type:a.COMMA,match:","}),e.parseToken({type:a.STRING,match:String(i)}),e.parseToken({type:a.PARENCLOSE,match:")"})):e.parseToken({type:a.FILTEREMPTY,match:"e"})),e.out}}var s=t("./utils"),o=t("./lexer"),a=o.types,h=["break","case","catch","continue","debugger","default","delete","do","else","finally","for","function","if","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with"];r.prototype={on:function(t,e){this._parsers[t]=e},parseToken:function(t){var e,i=this,n=i._parsers[t.type]||i._parsers["*"],r=t.match,o=i.prevToken,h=o?o.type:null,l=i.state.length?i.state[i.state.length-1]:null;if(!n||"function"!=typeof n||n.call(this,t))switch(l&&o&&l===a.FILTER&&h===a.FILTER&&t.type!==a.PARENCLOSE&&t.type!==a.COMMA&&t.type!==a.OPERATOR&&t.type!==a.FILTER&&t.type!==a.FILTEREMPTY&&i.out.push(", "),l&&l===a.METHODOPEN&&(i.state.pop(),t.type!==a.PARENCLOSE&&i.out.push(", ")),t.type){case a.WHITESPACE:break;case a.STRING:i.filterApplyIdx.push(i.out.length),i.out.push(r.replace(/\\/g,"\\\\"));break;case a.NUMBER:case a.BOOL:i.filterApplyIdx.push(i.out.length),i.out.push(r);break;case a.FILTER:i.filters.hasOwnProperty(r)&&"function"==typeof i.filters[r]||s.throwError('Invalid filter "'+r+'"',i.line,i.filename),i.escape=i.filters[r].safe?!1:i.escape,i.out.splice(i.filterApplyIdx[i.filterApplyIdx.length-1],0,'_filters["'+r+'"]('),i.state.push(t.type);break;case a.FILTEREMPTY:i.filters.hasOwnProperty(r)&&"function"==typeof i.filters[r]||s.throwError('Invalid filter "'+r+'"',i.line,i.filename),i.escape=i.filters[r].safe?!1:i.escape,i.out.splice(i.filterApplyIdx[i.filterApplyIdx.length-1],0,'_filters["'+r+'"]('),i.out.push(")");break;case a.FUNCTION:case a.FUNCTIONEMPTY:i.out.push("((typeof _ctx."+r+' !== "undefined") ? _ctx.'+r+" : ((typeof "+r+' !== "undefined") ? '+r+" : _fn))("),i.escape=!1,t.type===a.FUNCTIONEMPTY?i.out[i.out.length-1]=i.out[i.out.length-1]+")":i.state.push(t.type),i.filterApplyIdx.push(i.out.length-1);break;case a.PARENOPEN:i.state.push(t.type),i.filterApplyIdx.length?(i.out.splice(i.filterApplyIdx[i.filterApplyIdx.length-1],0,"("),o&&h===a.VAR?(e=o.match.split(".").slice(0,-1),i.out.push(" || _fn).call("+i.checkMatch(e)),i.state.push(a.METHODOPEN),i.escape=!1):i.out.push(" || _fn)("),i.filterApplyIdx.push(i.out.length-3)):(i.out.push("("),i.filterApplyIdx.push(i.out.length-1));break;case a.PARENCLOSE:e=i.state.pop(),e!==a.PARENOPEN&&e!==a.FUNCTION&&e!==a.FILTER&&s.throwError("Mismatched nesting state",i.line,i.filename),i.out.push(")"),i.filterApplyIdx.pop(),e!==a.FILTER&&i.filterApplyIdx.pop();break;case a.COMMA:l!==a.FUNCTION&&l!==a.FILTER&&l!==a.ARRAYOPEN&&l!==a.CURLYOPEN&&l!==a.PARENOPEN&&l!==a.COLON&&s.throwError("Unexpected comma",i.line,i.filename),l===a.COLON&&i.state.pop(),i.out.push(", "),i.filterApplyIdx.pop();break;case a.LOGIC:case a.COMPARATOR:o&&h!==a.COMMA&&h!==t.type&&h!==a.BRACKETOPEN&&h!==a.CURLYOPEN&&h!==a.PARENOPEN&&h!==a.FUNCTION||s.throwError("Unexpected logic",i.line,i.filename),i.out.push(t.match);break;case a.NOT:i.out.push(t.match);break;case a.VAR:i.parseVar(t,r,l);break;case a.BRACKETOPEN:!o||h!==a.VAR&&h!==a.BRACKETCLOSE&&h!==a.PARENCLOSE?(i.state.push(a.ARRAYOPEN),i.filterApplyIdx.push(i.out.length)):i.state.push(t.type),i.out.push("[");break;case a.BRACKETCLOSE:e=i.state.pop(),e!==a.BRACKETOPEN&&e!==a.ARRAYOPEN&&s.throwError("Unexpected closing square bracket",i.line,i.filename),i.out.push("]"),i.filterApplyIdx.pop();break;case a.CURLYOPEN:i.state.push(t.type),i.out.push("{"),i.filterApplyIdx.push(i.out.length-1);break;case a.COLON:l!==a.CURLYOPEN&&s.throwError("Unexpected colon",i.line,i.filename),i.state.push(t.type),i.out.push(":"),i.filterApplyIdx.pop();break;case a.CURLYCLOSE:l===a.COLON&&i.state.pop(),i.state.pop()!==a.CURLYOPEN&&s.throwError("Unexpected closing curly brace",i.line,i.filename),i.out.push("}"),i.filterApplyIdx.pop();break;case a.DOTKEY:(!o||h!==a.VAR&&h!==a.BRACKETCLOSE&&h!==a.DOTKEY&&h!==a.PARENCLOSE&&h!==a.FUNCTIONEMPTY&&h!==a.FILTEREMPTY&&h!==a.CURLYCLOSE)&&s.throwError('Unexpected key "'+r+'"',i.line,i.filename),i.out.push("."+r);break;case a.OPERATOR:i.out.push(" "+r+" "),i.filterApplyIdx.pop()}},parseVar:function(t,e,i){var n=this;return e=e.split("."),-1!==h.indexOf(e[0])&&s.throwError('Reserved keyword "'+e[0]+'" attempted to be used as a variable',n.line,n.filename),n.filterApplyIdx.push(n.out.length),i===a.CURLYOPEN?(e.length>1&&s.throwError("Unexpected dot",n.line,n.filename),void n.out.push(e[0])):void n.out.push(n.checkMatch(e))},checkMatch:function(t){function e(e){var i=e+r,n=t,o="";return o="(typeof "+i+' !== "undefined" && '+i+" !== null",s.each(n,function(t,e){0!==e&&(o+=" && "+i+"."+t+" !== undefined && "+i+"."+t+" !== null",i+="."+t)}),o+=")"}function i(i){return"("+e(i)+" ? "+i+t.join(".")+' : "")'}var n,r=t[0];return n="("+e("_ctx.")+" ? "+i("_ctx.")+" : "+i("")+")","("+n+" !== null ? "+n+' : "" )'}},i.parse=function(t,e,h,l,u){function c(t,e){var i,n,a=o.read(s.strip(t));return i=new r(a,u,m,e,h.filename),n=i.parse().join(""),i.state.length&&s.throwError('Unable to parse "'+t+'"',e,h.filename),{compile:function(){return"_output += "+n+";\n"}}}function p(e,i){var n,c,p,d,f,g,y;if(s.startsWith(e,"end")){if(y=L[L.length-1],y&&y.name===e.split(/\s+/)[0].replace(/^end/,"")&&y.ends){switch(y.name){case"autoescape":m=h.autoescape;break;case"raw":G=!1}return void L.pop()}G||s.throwError('Unexpected end of tag "'+e.replace(/^end/,"")+'"',i,h.filename)}if(!G){switch(p=e.split(/\s+(.+)?/),d=p.shift(),l.hasOwnProperty(d)||s.throwError('Unexpected tag "'+e+'"',i,h.filename),n=o.read(s.strip(p.join(" "))),c=new r(n,u,!1,i,h.filename),f=l[d],f.parse(p[1],i,c,a,L,h,t)||s.throwError('Unexpected tag "'+d+'"',i,h.filename),c.parse(),g=c.out,d){case"autoescape":m="false"!==g[0]?g[0]:!1;break;case"raw":G=!0}return{block:!!l[d].block,compile:f.compile,args:g,content:[],ends:f.ends,name:d}}}function d(t){return"string"==typeof t&&(t=t.replace(/\s*$/,"")),t}e=e.replace(/\r\n/g,"\n");var f,m=h.autoescape,g=h.tagControls[0],y=h.tagControls[1],v=h.varControls[0],x=h.varControls[1],b=n(g),w=n(y),_=n(v),T=n(x),E=new RegExp("^"+b+"-?\\s*-?|-?\\s*-?"+w+"$","g"),S=new RegExp("^"+b+"-"),A=new RegExp("-"+w+"$"),C=new RegExp("^"+_+"-?\\s*-?|-?\\s*-?"+T+"$","g"),P=new RegExp("^"+_+"-"),M=new RegExp("-"+T+"$"),O=h.cmtControls[0],R=h.cmtControls[1],k="[\\s\\S]*?",I=new RegExp("("+b+k+w+"|"+_+k+T+"|"+n(O)+k+n(R)+")"),D=1,L=[],F=null,B=[],N={},G=!1;return i.parseVariable=c,s.each(e.split(I),function(t){var e,i,n,r,o;if(t){if(!G&&s.startsWith(t,v)&&s.endsWith(t,x))n=P.test(t),f=M.test(t),e=c(t.replace(C,""),D);else if(s.startsWith(t,g)&&s.endsWith(t,y))n=S.test(t),f=A.test(t),e=p(t.replace(E,""),D),e&&("extends"===e.name?F=e.args.join("").replace(/^\'|\'$/g,"").replace(/^\"|\"$/g,""):e.block&&!L.length&&(N[e.args.join("")]=e)),G&&!e&&(e=t);else if(G||!s.startsWith(t,O)&&!s.endsWith(t,R))e=f?t.replace(/^\s*/,""):t,f=!1;else if(s.startsWith(t,O)&&s.endsWith(t,R))return;n&&B.length&&(r=B.pop(),"string"==typeof r?r=d(r):r.content&&r.content.length&&(o=d(r.content.pop()),r.content.push(o)),B.push(r)),e&&(L.length?L[L.length-1].content.push(e):B.push(e),e.name&&e.ends&&L.push(e),i=t.match(/\n/g),D+=i?i.length:0)}}),{name:h.filename,parent:F,tokens:B,blocks:N}},i.compile=function(t,e,n,r){var o="",a=s.isArray(t)?t:t.tokens;return s.each(a,function(t){var s;return"string"==typeof t?void(o+='_output += "'+t.replace(/\\/g,"\\\\").replace(/\n|\r/g,"\\n").replace(/"/g,'\\"')+'";\n'):(s=t.compile(i.compile,t.args?t.args.slice(0):[],t.content?t.content.slice(0):[],e,n,r),void(o+=s||""))}),o}},{"./lexer":4,"./utils":26}],9:[function(t,e,i){function n(){return""}function r(t){if(t){if(s.each(["varControls","tagControls","cmtControls"],function(e){if(t.hasOwnProperty(e)){if(!s.isArray(t[e])||2!==t[e].length)throw new Error('Option "'+e+'" must be an array containing 2 different control strings.');if(t[e][0]===t[e][1])throw new Error('Option "'+e+'" open and close controls must not be the same.');s.each(t[e],function(t,i){if(t.length<2)throw new Error('Option "'+e+'" '+(i?"open ":"close ")+'control must be at least 2 characters. Saw "'+t+'" instead.')})}}),t.hasOwnProperty("cache")&&t.cache&&"memory"!==t.cache&&(!t.cache.get||!t.cache.set))throw new Error("Invalid cache option "+JSON.stringify(t.cache)+' found. Expected "memory" or { get: function (key) { ... }, set: function (key, value) { ... } }.');if(t.hasOwnProperty("loader")&&t.loader&&(!t.loader.load||!t.loader.resolve))throw new Error("Invalid loader option "+JSON.stringify(t.loader)+" found. Expected { load: function (pathname, cb) { ... }, resolve: function (to, from) { ... } }.")}}var s=t("./utils"),o=t("./tags"),a=t("./filters"),h=t("./parser"),l=t("./dateformatter"),u=t("./loaders");i.version="1.4.2";var c,p={autoescape:!0,varControls:["{{","}}"],tagControls:["{%","%}"],cmtControls:["{#","#}"],locals:{},cache:"memory",loader:u.fs()};i.setDefaults=function(t){r(t),c.options=s.extend(c.options,t)},i.setDefaultTZOffset=function(t){l.tzOffset=t},i.Swig=function(t){function e(t){return t&&t.locals?s.extend({},m.options.locals,t.locals):m.options.locals}function i(t){return t=t||{},t.hasOwnProperty("cache")&&!t.cache||!m.options.cache}function l(t,e){return i(e)?void 0:"memory"===m.options.cache?m.cache[t]:m.options.cache.get(t)}function u(t,e,n){return i(e)?void 0:"memory"===m.options.cache?void(m.cache[t]=n):void m.options.cache.set(t,n)}function c(t,e){return s.map(e,function(e){var i=e.args?e.args.join(""):"";return"block"===e.name&&t[i]&&(e=t[i]),e.content&&e.content.length&&(e.content=c(t,e.content)),e})}function d(t,e){var i=[];s.each(t,function(t){i.push(t)}),s.each(i.reverse(),function(t){"block"!==t.name&&e.unshift(t)})}function f(t,e){for(var i,n,r,o=t.parent,a=[],h=[];o;){if(!e||!e.filename)throw new Error('Cannot extend "'+o+'" because current template has no filename.');if(i=i||e.filename,i=m.options.loader.resolve(o,i),n=l(i,e)||m.parseFile(i,s.extend({},e,{filename:i})),o=n.parent,-1!==a.indexOf(i))throw new Error('Illegal circular extends of "'+i+'".');a.push(i),h.push(n)}for(r=h.length,r=h.length-2;r>=0;r-=1)h[r].tokens=c(h[r].blocks,h[r+1].tokens),d(h[r].blocks,h[r].tokens);return h}r(t),this.options=s.extend({},p,t||{}),this.cache={},this.extensions={};var m=this,g=o,y=a;this.invalidateCache=function(){"memory"===m.options.cache&&(m.cache={})},this.setFilter=function(t,e){if("function"!=typeof e)throw new Error('Filter "'+t+'" is not a valid function.');y[t]=e},this.setTag=function(t,e,i,n,r){if("function"!=typeof e)throw new Error('Tag "'+t+'" parse method is not a valid function.');if("function"!=typeof i)throw new Error('Tag "'+t+'" compile method is not a valid function.');g[t]={parse:e,compile:i,ends:n||!1,block:!!r}},this.setExtension=function(t,e){m.extensions[t]=e},this.parse=function(t,i){r(i);var n,o=e(i),a={};for(n in i)i.hasOwnProperty(n)&&"locals"!==n&&(a[n]=i[n]);return i=s.extend({},m.options,a),i.locals=o,h.parse(this,t,i,g,y)},this.parseFile=function(t,e){var i;return e||(e={}),t=m.options.loader.resolve(t,e.resolveFrom),i=m.options.loader.load(t),e.filename||(e=s.extend({filename:t},e)),m.parse(i,e)},this.precompile=function(t,e){var i,n=m.parse(t,e),r=f(n,e);r.length&&(n.tokens=c(n.blocks,r[0].tokens),d(n.blocks,n.tokens));try{i=new Function("_swig","_ctx","_filters","_utils","_fn",'  var _ext = _swig.extensions,\n    _output = "";\n'+h.compile(n,r,e)+"\n  return _output;\n")}catch(o){s.throwError(o,null,e.filename)}return{tpl:i,tokens:n}},this.render=function(t,e){return m.compile(t,e)()},this.renderFile=function(t,e,i){return i?void m.compileFile(t,{},function(t,n){var r;if(t)return void i(t);try{r=n(e)}catch(s){return void i(s)}i(null,r)}):m.compileFile(t)(e)},this.compile=function(t,i){function r(t){var e;return e=t&&a?s.extend({},o,t):t&&!a?t:!t&&a?o:{},h.tpl(m,e,y,s,n)}var o,a,h,c=i?i.filename:null,p=c?l(c,i):null;return p?p:(o=e(i),a=s.keys(o).length,h=this.precompile(t,i),s.extend(r,h.tokens),c&&u(c,i,r),r)},this.compileFile=function(t,e,i){var n,r;return e||(e={}),t=m.options.loader.resolve(t,e.resolveFrom),e.filename||(e=s.extend({filename:t},e)),(r=l(t,e))?i?void i(null,r):r:i?void m.options.loader.load(t,function(t,n){if(t)return void i(t);var r;try{r=m.compile(n,e)}catch(s){return void i(s)}i(t,r)}):(n=m.options.loader.load(t),m.compile(n,e))},this.run=function(t,i,r){var o=e({locals:i});return r&&u(r,{},t),t(m,o,y,s,n)}},c=new i.Swig,i.setFilter=c.setFilter,i.setTag=c.setTag,i.setExtension=c.setExtension,i.parseFile=c.parseFile,i.precompile=c.precompile,i.compile=c.compile,i.compileFile=c.compileFile,i.render=c.render,i.renderFile=c.renderFile,i.run=c.run,i.invalidateCache=c.invalidateCache,i.loaders=u},{"./dateformatter":2,"./filters":3,"./loaders":6,"./parser":8,"./tags":20,"./utils":26}],10:[function(t,e,i){var n=t("../utils"),r=["html","js"];i.compile=function(t,e,i,n,r,s){return t(i,n,r,s)},i.parse=function(t,e,i,s,o,a){var h;return i.on("*",function(t){return h||t.type!==s.BOOL&&(t.type!==s.STRING||-1!==r.indexOf(t.match))?void n.throwError('Unexpected token "'+t.match+'" in autoescape tag',e,a.filename):(this.out.push(t.match),void(h=!0))}),!0},i.ends=!0},{"../utils":26}],11:[function(t,e,i){i.compile=function(t,e,i,n,r){return t(i,n,r,e.join(""))},i.parse=function(t,e,i){return i.on("*",function(t){this.out.push(t.match)}),!0},i.ends=!0,i.block=!0},{}],12:[function(t,e,i){i.compile=function(){return"} else {\n"},i.parse=function(t,e,i,n,r){return i.on("*",function(t){throw new Error('"else" tag does not accept any tokens. Found "'+t.match+'" on line '+e+".")}),r.length&&"if"===r[r.length-1].name}},{}],13:[function(t,e,i){var n=t("./if").parse;i.compile=function(t,e){return"} else if ("+e.join(" ")+") {\n"},i.parse=function(t,e,i,r,s){var o=n(t,e,i,r,s);return o&&s.length&&"if"===s[s.length-1].name}},{"./if":17}],14:[function(t,e,i){i.compile=function(){},i.parse=function(){return!0},i.ends=!1},{}],15:[function(t,e,i){var n=t("../filters");i.compile=function(t,e,i,n,r,s){var o=e.shift().replace(/\($/,""),a='(function () {\n  var _output = "";\n'+t(i,n,r,s)+"  return _output;\n})()";return")"===e[e.length-1]&&e.pop(),e=e.length?", "+e.join(""):"",'_output += _filters["'+o+'"]('+a+e+");\n"},i.parse=function(t,e,i,r){function s(t){if(!n.hasOwnProperty(t))throw new Error('Filter "'+t+'" does not exist on line '+e+".")}var o;return i.on(r.FUNCTION,function(t){return o?!0:(o=t.match.replace(/\($/,""),s(o),this.out.push(t.match),void this.state.push(t.type))}),i.on(r.VAR,function(t){return o?!0:(o=t.match,s(o),void this.out.push(o))}),!0},i.ends=!0},{"../filters":3}],16:[function(t,e,i){
var n="_ctx.",r=n+"loop";i.compile=function(t,e,i,s,o,a){var h,l=e.shift(),u="__k",c=(n+"__loopcache"+Math.random()).replace(/\./g,"");return e[0]&&","===e[0]&&(e.shift(),u=l,l=e.shift()),h=e.join(""),["(function () {\n","  var __l = "+h+', __len = (_utils.isArray(__l) || typeof __l === "string") ? __l.length : _utils.keys(__l).length;\n',"  if (!__l) { return; }\n","    var "+c+" = { loop: "+r+", "+l+": "+n+l+", "+u+": "+n+u+" };\n","    "+r+" = { first: false, index: 1, index0: 0, revindex: __len, revindex0: __len - 1, length: __len, last: false };\n","  _utils.each(__l, function ("+l+", "+u+") {\n","    "+n+l+" = "+l+";\n","    "+n+u+" = "+u+";\n","    "+r+".key = "+u+";\n","    "+r+".first = ("+r+".index0 === 0);\n","    "+r+".last = ("+r+".revindex0 === 0);\n","    "+t(i,s,o,a),"    "+r+".index += 1; "+r+".index0 += 1; "+r+".revindex -= 1; "+r+".revindex0 -= 1;\n","  });\n","  "+r+" = "+c+".loop;\n","  "+n+l+" = "+c+"."+l+";\n","  "+n+u+" = "+c+"."+u+";\n","  "+c+" = undefined;\n","})();\n"].join("")},i.parse=function(t,e,i,n){var r,s;return i.on(n.NUMBER,function(t){var i=this.state.length?this.state[this.state.length-1]:null;if(!s||i!==n.ARRAYOPEN&&i!==n.CURLYOPEN&&i!==n.CURLYCLOSE&&i!==n.FUNCTION&&i!==n.FILTER)throw new Error('Unexpected number "'+t.match+'" on line '+e+".");return!0}),i.on(n.VAR,function(t){return s&&r?!0:(this.out.length||(r=!0),void this.out.push(t.match))}),i.on(n.COMMA,function(t){return r&&this.prevToken.type===n.VAR?void this.out.push(t.match):!0}),i.on(n.COMPARATOR,function(t){if("in"!==t.match||!r)throw new Error('Unexpected token "'+t.match+'" on line '+e+".");s=!0,this.filterApplyIdx.push(this.out.length)}),!0},i.ends=!0},{}],17:[function(t,e,i){i.compile=function(t,e,i,n,r,s){return"if ("+e.join(" ")+") { \n"+t(i,n,r,s)+"\n}"},i.parse=function(t,e,i,n){if("undefined"==typeof t)throw new Error("No conditional statement provided on line "+e+".");return i.on(n.COMPARATOR,function(t){if(this.isLast)throw new Error('Unexpected logic "'+t.match+'" on line '+e+".");if(this.prevToken.type===n.NOT)throw new Error('Attempted logic "not '+t.match+'" on line '+e+". Use !(foo "+t.match+") instead.");this.out.push(t.match),this.filterApplyIdx.push(this.out.length)}),i.on(n.NOT,function(t){if(this.isLast)throw new Error('Unexpected logic "'+t.match+'" on line '+e+".");this.out.push(t.match)}),i.on(n.BOOL,function(t){this.out.push(t.match)}),i.on(n.LOGIC,function(t){if(!this.out.length||this.isLast)throw new Error('Unexpected logic "'+t.match+'" on line '+e+".");this.out.push(t.match),this.filterApplyIdx.pop()}),!0},i.ends=!0},{}],18:[function(t,e,i){var n=t("../utils");i.compile=function(t,e){var i=e.pop(),r="_ctx."+i+' = {};\n  var _output = "";\n',s=n.map(e,function(t){return{ex:new RegExp("_ctx."+t.name,"g"),re:"_ctx."+i+"."+t.name}});return n.each(e,function(t){var e=t.compiled;n.each(s,function(t){e=e.replace(t.ex,t.re)}),r+=e}),r},i.parse=function(e,i,r,s,o,a,h){var l,u,c=t("../parser").compile,p={resolveFrom:a.filename},d=n.extend({},a,p);return r.on(s.STRING,function(t){var e=this;if(!l)return l=h.parseFile(t.match.replace(/^("|')|("|')$/g,""),p).tokens,void n.each(l,function(t){var i,n="";t&&"macro"===t.name&&t.compile&&(i=t.args[0],n+=t.compile(c,t.args,t.content,[],d)+"\n",e.out.push({compiled:n,name:i}))});throw new Error("Unexpected string "+t.match+" on line "+i+".")}),r.on(s.VAR,function(t){var e=this;if(!l||u)throw new Error('Unexpected variable "'+t.match+'" on line '+i+".");if("as"!==t.match)return u=t.match,e.out.push(u),!1}),!0},i.block=!0},{"../parser":8,"../utils":26}],19:[function(t,e,i){var n="ignore",r="missing",s="only";i.compile=function(t,e){var i=e.shift(),n=e.indexOf(s),o=-1!==n?e.splice(n,1):!1,a=(e.pop()||"").replace(/\\/g,"\\\\"),h=e[e.length-1]===r?e.pop():!1,l=e.join("");return(h?"  try {\n":"")+"_output += _swig.compileFile("+i+', {resolveFrom: "'+a+'"})('+(o&&l?l:l?"_utils.extend({}, _ctx, "+l+")":"_ctx")+");\n"+(h?"} catch (e) {}\n":"")},i.parse=function(t,e,i,o,a,h){var l,u;return i.on(o.STRING,function(t){return l?!0:(l=t.match,void this.out.push(l))}),i.on(o.VAR,function(t){if(!l)return l=t.match,!0;if(!u&&"with"===t.match)return void(u=!0);if(u&&t.match===s&&"with"!==this.prevToken.match)return void this.out.push(t.match);if(t.match===n)return!1;if(t.match===r){if(this.prevToken.match!==n)throw new Error('Unexpected token "'+r+'" on line '+e+".");return this.out.push(t.match),!1}if(this.prevToken.match===n)throw new Error('Expected "'+r+'" on line '+e+' but found "'+t.match+'".');return!0}),i.on("end",function(){this.out.push(h.filename||null)}),!0}},{}],20:[function(t,e,i){i.autoescape=t("./autoescape"),i.block=t("./block"),i["else"]=t("./else"),i.elseif=t("./elseif"),i.elif=i.elseif,i["extends"]=t("./extends"),i.filter=t("./filter"),i["for"]=t("./for"),i["if"]=t("./if"),i["import"]=t("./import"),i.include=t("./include"),i.macro=t("./macro"),i.parent=t("./parent"),i.raw=t("./raw"),i.set=t("./set"),i.spaceless=t("./spaceless")},{"./autoescape":10,"./block":11,"./else":12,"./elseif":13,"./extends":14,"./filter":15,"./for":16,"./if":17,"./import":18,"./include":19,"./macro":21,"./parent":22,"./raw":23,"./set":24,"./spaceless":25}],21:[function(t,e,i){i.compile=function(t,e,i,n,r,s){var o=e.shift();return"_ctx."+o+" = function ("+e.join("")+') {\n  var _output = "",\n    __ctx = _utils.extend({}, _ctx);\n  _utils.each(_ctx, function (v, k) {\n    if (["'+e.join('","')+'"].indexOf(k) !== -1) { delete _ctx[k]; }\n  });\n'+t(i,n,r,s)+"\n _ctx = _utils.extend(_ctx, __ctx);\n  return _output;\n};\n_ctx."+o+".safe = true;\n"},i.parse=function(t,e,i,n){var r;return i.on(n.VAR,function(t){if(-1!==t.match.indexOf("."))throw new Error('Unexpected dot in macro argument "'+t.match+'" on line '+e+".");this.out.push(t.match)}),i.on(n.FUNCTION,function(t){r||(r=t.match,this.out.push(r),this.state.push(n.FUNCTION))}),i.on(n.FUNCTIONEMPTY,function(t){r||(r=t.match,this.out.push(r))}),i.on(n.PARENCLOSE,function(){if(!this.isLast)throw new Error("Unexpected parenthesis close on line "+e+".")}),i.on(n.COMMA,function(){return!0}),i.on("*",function(){}),!0},i.ends=!0,i.block=!0},{}],22:[function(t,e,i){i.compile=function(t,e,i,n,r,s){if(!n||!n.length)return"";var o,a,h=e[0],l=!0,u=n.length,c=0;for(c;u>c;c+=1)if(o=n[c],o.blocks&&o.blocks.hasOwnProperty(s)&&l&&h!==o.name)return a=o.blocks[s],a.compile(t,[s],a.content,n.slice(c+1),r)+"\n"},i.parse=function(t,e,i,n,r,s){return i.on("*",function(t){throw new Error('Unexpected argument "'+t.match+'" on line '+e+".")}),i.on("end",function(){this.out.push(s.filename)}),!0}},{}],23:[function(t,e,i){i.compile=function(t,e,i,n,r,s){return t(i,n,r,s)},i.parse=function(t,e,i){return i.on("*",function(t){throw new Error('Unexpected token "'+t.match+'" in raw tag on line '+e+".")}),!0},i.ends=!0},{}],24:[function(t,e,i){i.compile=function(t,e){return e.join(" ")+";\n"},i.parse=function(t,e,i,n){var r,s="";return i.on(n.VAR,function(t){return r?void(r+="_ctx."+t.match):i.out.length?!0:void(s+=t.match)}),i.on(n.BRACKETOPEN,function(t){return r||this.out.length?!0:void(r=t.match)}),i.on(n.STRING,function(t){return r&&!this.out.length?void(r+=t.match):!0}),i.on(n.BRACKETCLOSE,function(t){return r&&!this.out.length?(s+=r+t.match,void(r=void 0)):!0}),i.on(n.DOTKEY,function(t){return r||s?void(s+="."+t.match):!0}),i.on(n.ASSIGNMENT,function(t){if(this.out.length||!s)throw new Error('Unexpected assignment "'+t.match+'" on line '+e+".");this.out.push("_ctx."+s),this.out.push(t.match),this.filterApplyIdx.push(this.out.length)}),!0},i.block=!0},{}],25:[function(t,e,i){var n=t("../utils");i.compile=function(t,e,i,r,s,o){function a(t){return n.map(t,function(t){return t.content||"string"!=typeof t?(t.content=a(t.content),t):t.replace(/^\s+/,"").replace(/>\s+</g,"><").replace(/\s+$/,"")})}return t(a(i),r,s,o)},i.parse=function(t,e,i){return i.on("*",function(t){throw new Error('Unexpected token "'+t.match+'" on line '+e+".")}),!0},i.ends=!0},{"../utils":26}],26:[function(t,e,i){var n;i.strip=function(t){return t.replace(/^\s+|\s+$/g,"")},i.startsWith=function(t,e){return 0===t.indexOf(e)},i.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},i.each=function(t,e){var i,r;if(n(t))for(i=0,r=t.length,i;r>i&&e(t[i],i,t)!==!1;i+=1);else for(i in t)if(t.hasOwnProperty(i)&&e(t[i],i,t)===!1)break;return t},i.isArray=n=Array.hasOwnProperty("isArray")?Array.isArray:function(t){return t?"object"==typeof t&&-1!==Object.prototype.toString.call(t).indexOf():!1},i.some=function(t,e){var r,s,o=0;if(n(t))for(s=t.length,o;s>o&&!(r=e(t[o],o,t));o+=1);else i.each(t,function(i,n){return r=e(i,n,t),!r});return!!r},i.map=function(t,e){var i,r=0,s=[];if(n(t))for(i=t.length,r;i>r;r+=1)s[r]=e(t[r],r);else for(r in t)t.hasOwnProperty(r)&&(s[r]=e(t[r],r));return s},i.extend=function(){var t,e,i=arguments,n=i[0],r=i.length>1?Array.prototype.slice.call(i,1):[],s=0,o=r.length;for(s;o>s;s+=1){e=r[s]||{};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t])}return n},i.keys=function(t){return t?Object.keys?Object.keys(t):i.map(t,function(t,e){return e}):[]},i.throwError=function(t,e,i){throw e&&(t+=" on line "+e),i&&(t+=" in file "+i),new Error(t+".")}},{}],27:[function(t,e,i){function n(t){return"[object Array]"===l.call(t)}function r(t,e){var i;if(null===t)i={__proto__:null};else{if("object"!=typeof t)throw new TypeError("typeof prototype["+typeof t+"] != 'object'");var n=function(){};n.prototype=t,i=new n,i.__proto__=t}return"undefined"!=typeof e&&Object.defineProperties&&Object.defineProperties(i,e),i}function s(t){return"object"!=typeof t&&"function"!=typeof t||null===t}function o(t){if(s(t))throw new TypeError("Object.keys called on a non-object");var e=[];for(var i in t)u.call(t,i)&&e.push(i);return e}function a(t){if(s(t))throw new TypeError("Object.getOwnPropertyNames called on a non-object");var e=o(t);return i.isArray(t)&&-1===i.indexOf(t,"length")&&e.push("length"),e}function h(t,e){return{value:t[e]}}var l=Object.prototype.toString,u=Object.prototype.hasOwnProperty;i.isArray="function"==typeof Array.isArray?Array.isArray:n,i.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0;i<t.length;i++)if(e===t[i])return i;return-1},i.filter=function(t,e){if(t.filter)return t.filter(e);for(var i=[],n=0;n<t.length;n++)e(t[n],n,t)&&i.push(t[n]);return i},i.forEach=function(t,e,i){if(t.forEach)return t.forEach(e,i);for(var n=0;n<t.length;n++)e.call(i,t[n],n,t)},i.map=function(t,e){if(t.map)return t.map(e);for(var i=new Array(t.length),n=0;n<t.length;n++)i[n]=e(t[n],n,t);return i},i.reduce=function(t,e,i){if(t.reduce)return t.reduce(e,i);var n,r=!1;2<arguments.length&&(n=i,r=!0);for(var s=0,o=t.length;o>s;++s)t.hasOwnProperty(s)&&(r?n=e(n,t[s],s,t):(n=t[s],r=!0));return n},"b"!=="ab".substr(-1)?i.substr=function(t,e,i){return 0>e&&(e=t.length+e),t.substr(e,i)}:i.substr=function(t,e,i){return t.substr(e,i)},i.trim=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},i.bind=function(){var t=Array.prototype.slice.call(arguments),e=t.shift();if(e.bind)return e.bind.apply(e,t);var i=t.shift();return function(){e.apply(i,t.concat([Array.prototype.slice.call(arguments)]))}},i.create="function"==typeof Object.create?Object.create:r;var c="function"==typeof Object.keys?Object.keys:o,p="function"==typeof Object.getOwnPropertyNames?Object.getOwnPropertyNames:a;if((new Error).hasOwnProperty("description")){var d=function(t,e){return"[object Error]"===l.call(t)&&(e=i.filter(e,function(t){return"description"!==t&&"number"!==t&&"message"!==t})),e};i.keys=function(t){return d(t,c(t))},i.getOwnPropertyNames=function(t){return d(t,p(t))}}else i.keys=c,i.getOwnPropertyNames=p;if("function"==typeof Object.getOwnPropertyDescriptor)try{Object.getOwnPropertyDescriptor({a:1},"a"),i.getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor}catch(f){i.getOwnPropertyDescriptor=function(t,e){try{return Object.getOwnPropertyDescriptor(t,e)}catch(i){return h(t,e)}}}else i.getOwnPropertyDescriptor=h},{}],28:[function(t,e,i){i.readFileSync=function(t,e){var i=(window.require("assets"),window.require("pixi")),n=i.loader.resources[t].data;return n}},{}],29:[function(t,e,i){function n(t,e){for(var i=0,n=t.length-1;n>=0;n--){var r=t[n];"."===r?t.splice(n,1):".."===r?(t.splice(n,1),i++):i&&(t.splice(n,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}var r=t("__browserify_process"),s=t("util"),o=t("_shims"),a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,h=function(t){return a.exec(t).slice(1)};i.resolve=function(){for(var t="",e=!1,i=arguments.length-1;i>=-1&&!e;i--){var a=i>=0?arguments[i]:r.cwd();if(!s.isString(a))throw new TypeError("Arguments to path.resolve must be strings");a&&(t=a+"/"+t,e="/"===a.charAt(0))}return t=n(o.filter(t.split("/"),function(t){return!!t}),!e).join("/"),(e?"/":"")+t||"."},i.normalize=function(t){var e=i.isAbsolute(t),r="/"===o.substr(t,-1);return t=n(o.filter(t.split("/"),function(t){return!!t}),!e).join("/"),t||e||(t="."),t&&r&&(t+="/"),(e?"/":"")+t},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(o.filter(t,function(t,e){if(!s.isString(t))throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},i.relative=function(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var r=n(t.split("/")),s=n(e.split("/")),o=Math.min(r.length,s.length),a=o,h=0;o>h;h++)if(r[h]!==s[h]){a=h;break}for(var l=[],h=a;h<r.length;h++)l.push("..");return l=l.concat(s.slice(a)),l.join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=h(t),i=e[0],n=e[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."},i.basename=function(t,e){var i=h(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return h(t)[3]}},{__browserify_process:31,_shims:27,util:30}],30:[function(t,e,i){function n(t,e){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),f(e)?n.showHidden=e:e&&i._extend(n,e),b(n.showHidden)&&(n.showHidden=!1),b(n.depth)&&(n.depth=2),b(n.colors)&&(n.colors=!1),b(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=r),a(n,t,n.depth)}function r(t,e){var i=n.styles[e];return i?"["+n.colors[i][0]+"m"+t+"["+n.colors[i][1]+"m":t}function s(t,e){return t}function o(t){var e={};return k.forEach(t,function(t,i){e[t]=!0}),e}function a(t,e,n){if(t.customInspect&&e&&S(e.inspect)&&e.inspect!==i.inspect&&(!e.constructor||e.constructor.prototype!==e)){var r=e.inspect(n);return v(r)||(r=a(t,r,n)),r}var s=h(t,e);if(s)return s;var f=k.keys(e),m=o(f);if(t.showHidden&&(f=k.getOwnPropertyNames(e)),0===f.length){if(S(e)){var g=e.name?": "+e.name:"";return t.stylize("[Function"+g+"]","special")}if(w(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(T(e))return t.stylize(Date.prototype.toString.call(e),"date");if(E(e))return l(e)}var y="",x=!1,b=["{","}"];if(d(e)&&(x=!0,b=["[","]"]),S(e)){var _=e.name?": "+e.name:"";y=" [Function"+_+"]"}if(w(e)&&(y=" "+RegExp.prototype.toString.call(e)),T(e)&&(y=" "+Date.prototype.toUTCString.call(e)),E(e)&&(y=" "+l(e)),0===f.length&&(!x||0==e.length))return b[0]+y+b[1];if(0>n)return w(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special");t.seen.push(e);var A;return A=x?u(t,e,n,m,f):f.map(function(i){return c(t,e,n,m,i,x)}),t.seen.pop(),p(A,y,b)}function h(t,e){if(b(e))return t.stylize("undefined","undefined");if(v(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return y(e)?t.stylize(""+e,"number"):f(e)?t.stylize(""+e,"boolean"):m(e)?t.stylize("null","null"):void 0}function l(t){return"["+Error.prototype.toString.call(t)+"]"}function u(t,e,i,n,r){for(var s=[],o=0,a=e.length;a>o;++o)R(e,String(o))?s.push(c(t,e,i,n,String(o),!0)):s.push("");return k.forEach(r,function(r){r.match(/^\d+$/)||s.push(c(t,e,i,n,r,!0))}),s}function c(t,e,i,n,r,s){var o,h,l;if(l=k.getOwnPropertyDescriptor(e,r)||{value:e[r]},l.get?h=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(h=t.stylize("[Setter]","special")),R(n,r)||(o="["+r+"]"),h||(k.indexOf(t.seen,l.value)<0?(h=m(i)?a(t,l.value,null):a(t,l.value,i-1),h.indexOf("\n")>-1&&(h=s?h.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+h.split("\n").map(function(t){return"   "+t}).join("\n"))):h=t.stylize("[Circular]","special")),b(o)){if(s&&r.match(/^\d+$/))return h;o=JSON.stringify(""+r),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+h}function p(t,e,i){var n=0,r=k.reduce(t,function(t,e){return n++,e.indexOf("\n")>=0&&n++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return r>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}function d(t){return k.isArray(t)}function f(t){return"boolean"==typeof t}function m(t){return null===t}function g(t){return null==t}function y(t){return"number"==typeof t}function v(t){return"string"==typeof t}function x(t){return"symbol"==typeof t}function b(t){return void 0===t}function w(t){return _(t)&&"[object RegExp]"===P(t)}function _(t){return"object"==typeof t&&t}function T(t){return _(t)&&"[object Date]"===P(t)}function E(t){return _(t)&&"[object Error]"===P(t)}function S(t){return"function"==typeof t}function A(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function C(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.binarySlice}function P(t){return Object.prototype.toString.call(t)}function M(t){return 10>t?"0"+t.toString(10):t.toString(10)}function O(){var t=new Date,e=[M(t.getHours()),M(t.getMinutes()),M(t.getSeconds())].join(":");return[t.getDate(),D[t.getMonth()],e].join(" ")}function R(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var k=t("_shims"),I=/%[sdj%]/g;i.format=function(t){if(!v(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(n(arguments[i]));return e.join(" ")}for(var i=1,r=arguments,s=r.length,o=String(t).replace(I,function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch(e){return"[Circular]"}default:return t}}),a=r[i];s>i;a=r[++i])o+=m(a)||!_(a)?" "+a:" "+n(a);return o},i.inspect=n,n.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},n.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},i.isArray=d,i.isBoolean=f,i.isNull=m,i.isNullOrUndefined=g,i.isNumber=y,i.isString=v,i.isSymbol=x,i.isUndefined=b,i.isRegExp=w,i.isObject=_,i.isDate=T,i.isError=E,i.isFunction=S,i.isPrimitive=A,i.isBuffer=C;var D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];i.log=function(){console.log("%s - %s",O(),i.format.apply(i,arguments))},i.inherits=function(t,e){t.super_=e,t.prototype=k.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})},i._extend=function(t,e){if(!e||!_(e))return t;for(var i=k.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}},{_shims:27}],31:[function(t,e,i){var n=e.exports={};n.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var i=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),i.length>0)){var n=i.shift();n()}},!0),function(t){i.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return""},n.chdir=function(t){throw new Error("process.chdir is not supported")}},{}]},{},[1]),function(){"use strict";function t(t,e){return t.replace(/{module}/g,e)}function e(e,i,n){function r(e){this.message=n?t(n,e):e}return r.prototype=Object.create(e.prototype),r.prototype.name=i,r.prototype.constructor=r,r}function i(t,e){return new(Function.prototype.bind.apply(t,[{}].concat(e)))}function n(t){var e=t.split("."),i=e[0],n=e[1],r=f[i];return r&&("undefined"==typeof n||n in r)}function r(t,e){if(arguments.length<1||arguments.length>2||"string"!=typeof t)throw new S("`require()` accepts only one or two arguments");var n,s=t.split("."),o=s[0];if(e){if(!(t in m))throw new E(t);for(var a=[],h=0;h<m[t].dependencies.length;h++){var l=m[t].dependencies[h];a.push(l in e?e[l]:r(l))}n=i(m[t].constructor,a)}else n=f[o];if(n){if(1===s.length)return n;for(var h=1;h<s.length&&s[h]in n;h++)if(n=n[s[h]],h===s.length-1)return n}if(v)return v(t);throw new E(t)}function s(t,e){try{return r(t,e)}catch(i){if(!(i instanceof E||"MODULE_NOT_FOUND"===i.code))throw i}return null}function o(t){var e,n=[];if(arguments.length<2||arguments.length>3)throw new b("`define()` accepts only two or three arguments");if("string"!=typeof t)throw new w(t);if(!g.test(t)){var s=r("settings"),a=s("ALIASES",{});if(t in a){var h=[a[t]].concat(Array.prototype.slice.call(arguments,1));return o.apply(void 0,h)}throw new w(t)}if(t in f&&"settings"!==t||y&&"settings"===t)throw new T(t);if(e=arguments[arguments.length-1],3===arguments.length){if("function"!=typeof e)throw new x("redundant dependecies specified when module is not a function");n=arguments[1]}if("function"==typeof e){m[t]={constructor:e,dependencies:n};for(var l=[],u=0;u<n.length;u++)l.push(r(n[u]));e=i(e,l)}if(arguments.length<2||"undefined"==typeof e)throw new _(t);if("settings"===t){y=!0;for(var c in e)c in f._settings||(f._settings[c]=e[c])}else f[t]=e;if(f.settings("DEBUG")){window.nebula=window.nebula||{};for(var p=t.split("/"),d=window.nebula,u=0;u<p.length;u++)if(0!==u||"nebula"!==p[u]){var v=u===p.length-1;d[p[u]]||(d[p[u]]={}),v?d[p[u]]=e:d=d[p[u]]}}}function a(t){var e=/^\s*function\s+([^\s\(]+).*/i,i=String(t),n=e.exec(i);return 2===n.length?n[1]:null}function h(){for(var t,e={},i=0;i<arguments.length;i++){if("function"!=typeof arguments[i])throw new TypeError("argument "+(i+1)+" is not a function");if(t=a(arguments[i]),null===t)throw new Error("couldn't get function name for argument "+(i+1));e[t]=arguments[i]}return e}function l(t,e){if(arguments.length<1||arguments.length>2)throw new TypeError("settings getter accepts only one or two arguments");var i=f._settings[t];return"undefined"!=typeof i?i:e}function u(t){t=t||{};var e=p.document.querySelectorAll(d);if(e.length>1)throw new x("multiple settings defined in HTML, only one `<script>` tag with settings is allowed");if(e.length){try{var i=p.JSON.parse(e[0].innerHTML)}catch(n){if(n instanceof SyntaxError)throw new x("invalid syntax in the HTML settings: "+n.message);throw n}for(var r in i)t[r]=i[r]}return t}function c(t,e,i){var n=f;return p=i||window,y=!1,o._constructors=m=e||{},o._modules=f=t||{settings:l,_settings:{}},f._settings=u(),n}var p,d='script[type="application/vnd.nebula-settings+json"]',f={},m={},g=/^[a-z0-9_]+(?:\/[a-z0-9_]+)*$/,y=!1,v=window.require,x=e(TypeError,"define.Error"),b=e(x,"define.ArgumentCountError"),w=e(x,"define.InvalidModuleNameError","module name '{module}' is invalid, allowed characters: a-z, 0-9, _ and /"),_=e(x,"define.InvalidModuleError","module '{module}' doesn't export any definitions"),T=e(x,"define.DuplicateModuleError","module '{module}' is already defined"),E=e(TypeError,"require.Error","no module named '{module}'"),S=e(E,"require.ArgumentsError");r.Error=E,r.ArgumentsError=S,r.exists=n,r.optionally=s,o.Error=x,o.ArgumentCountError=b,o.InvalidModuleNameError=w,o.InvalidModuleError=_,o.DuplicateModuleError=T,o.functions=h,o._init=c,o._modules=f,o._constructors=m,window.define=o,window.require=r,c(null,null,window)}(),define("nebula/window",function(){"use strict";return window}),define("settings",["settings"],function(t){var e=document.createElement("audio"),i=Boolean(e.canPlayType("audio/ogg")),n={trap:{type:"string","default":"button11"},toggleTeam:{type:"string","default":"button9"},up:{type:"string","default":"axisButton2"},right:{type:"string","default":"axisButton1"},down:{type:"string","default":"axisButton3"},left:{type:"string","default":"axisButton0"},sprint:{type:"string","default":"button4"},slide:{type:"string","default":"button1"},goalkeeperSlide:{type:"string","default":"button3"},togglePlayer:{type:"string","default":"button0"},pass:{type:"string","default":"button0"},lob:{type:"string","default":"button2"},shoot:{type:"string","default":"button1"},swerveUp:{type:"string","default":"button4"},swerveDown:{type:"string","default":"button5"},powerup:{type:"string","default":"button6"},back:{type:"string","default":"button1"},enter:{type:"string","default":"button0"},pause:{type:"string","default":"button8"}};return{OGG_SUPPORT:i,GAMEPAD_DEBUG:!1,GAMEPAD_DEADZONE:.25,IMAGE_PACKER_DEBUG:!1,VALIDATOR_DEBUG:!1,PROFILE_PRETTY_SAVE:!1,DEFAULT_OPTIONS:{game:{save:{type:"json",required:!1}},stats:{wins:{type:"number","default":0,min:0},draws:{type:"number","default":0,min:0},loses:{type:"number","default":0,min:0},goalsScored:{type:"number","default":0,min:0},goalsConceded:{type:"number","default":0,min:0}},fame:{score:{type:"number","default":0,min:0},token:{type:"string","default":""}},audio:{enabled:{type:"boolean","default":!0},fxVolume:{type:"number","default":.5,min:0,max:1},musicVolume:{type:"number","default":.5,min:0,max:1}},video:{shadows:{type:"boolean","default":!0},particles:{type:"boolean","default":!0}},keyboardLayout:{trap:{type:"string","default":"t"},toggleTeam:{type:"string","default":"space"},up:{type:"string","default":"up"},right:{type:"string","default":"right"},down:{type:"string","default":"down"},left:{type:"string","default":"left"},sprint:{type:"string","default":"shift"},slide:{type:"string","default":"d"},goalkeeperSlide:{type:"string","default":"q"},togglePlayer:{type:"string","default":"s"},pass:{type:"string","default":"s"},lob:{type:"string","default":"a"},shoot:{type:"string","default":"d"},swerveUp:{type:"string","default":"w"},swerveDown:{type:"string","default":"s"},powerup:{type:"string","default":"e"},back:{type:"string","default":"esc"},enter:{type:"string","default":"enter"},pause:{type:"string","default":"esc"}},gamepadLayout1:n,gamepadLayout2:n,gamepadLayout3:n,gamepadLayout4:n},CONTROLLER_ACTIONS:{changeSkin:"+f8",trap:"-%(trap)s",toggleTeam:"+%(toggleTeam)s",up:"%(up)s",right:"%(right)s",down:"%(down)s",left:"%(left)s",sprint:"%(sprint)s",togglePlayer:"+%(togglePlayer)s",slide:"+%(slide)s",goalkeeperSlide:"+%(goalkeeperSlide)s",pass:"+%(pass)s",throughBall:"%(pass)s",lob:"-%(lob)s",shoot:"%(shoot)s",swerveUp:"%(swerveUp)s",swerveDown:"%(swerveDown)s",powerup:"%(powerup)s",moveFocus:"%(up)s|%(down)s|%(right)s|%(left)s",back:"+%(back)s",enter:"+%(enter)s",pause:"%(pause)s"},GAMEPAD_BUTTON_MAP:{button0:"xbox-a",button1:"xbox-b",button2:"xbox-x",button3:"xbox-y",button4:"xbox-lb",button5:"xbox-rb",button6:"xbox-lt",button7:"xbox-rt",button8:"xbox-back",button9:"xbox-start",axisButton0:"xbox-stick-left-left",axisButton1:"xbox-stick-left-right",axisButton2:"xbox-stick-left-up",axisButton3:"xbox-stick-left-down",axisButton4:"xbox-stick-right-left",axisButton5:"xbox-stick-right-right",axisButton6:"xbox-stick-right-up",axisButton7:"xbox-stick-right-down",button10:"xbox-stick-left-button",button11:"xbox-stick-right-button",button12:"xbox-dpad-up",button13:"xbox-dpad-down",button14:"xbox-dpad-left",button15:"xbox-dpad-right"},RENDERER_OPTIONS:{antialias:!1,clearBeforeRender:!1},USER_COLORS:[15395878,4515583,16672062,4521728,12255487],AI_COLORS:[16777215,11184810,5592405,0],USER_TOGGLE_PLAYER_TIMEOUT:.2,RANDOM_TEAM:{isRandom:!0,name:null,flag:"images/teams/random.png",thumbnail:"images/teams/random_team_thumbnail.png"},GRAVITY:-9.81,PITCH_WIDTH:35,PITCH_HEIGHT:22.666666666666664,GOAL_WIDTH:2.9333333333333336,GOAL_HEIGHT:1.05,PENALTY_AREA_WIDTH:5.5,PENALTY_AREA_HEIGHT:13.433333333,KICKOFF_ASSIST_DISTANCE:2,BALL_FRICTION:4,BALL_RADIUS:.1,PLAYER_MAX_FORCE:1,PLAYER_RADIUS:.25,PLAYER_DECELERATION:10,PLAYER_TURN_RATE:[360,480,630,720],PLAYER_HUMAN_TURN_RATE:720,PLAYER_COMFORT_ZONE:[1,2,2.5,3.5],PLAYER_MIN_COMFORT_ZONE_TIME:[1/0,2,1,.5],PLAYER_IN_BALL_RANGE:.333333,PLAYER_HEIGHT:.68,PLAYER_IN_BALL_RANGE_HEIGHT:.56,PLAYER_IN_TARGET_RANGE:1,PLAYER_RECEIVING_RANGE:1.5,PLAYER_WALK_SPEED:3/3.6,PLAYER_RUN_SPEED:17/3.6,PLAYER_SPRINT_SPEED:21/3.6,PLAYER_DRIBBLE_SPEED:14/3.6,PLAYER_SHOOTING_CHANCE:.5,PLAYER_STAMINA_RECOVERY:20,PLAYER_STAMINA_MAX:1e3,LONG_SHOT_CHANCE:[.1,.3,.6,.8],LONG_SHOT_MIN_DISTANCE:7,LONG_SHOT_MAX_DISTANCE:9.5,CORNER_KICK_MIN_DISTANCE:4,CORNER_KICK_MAX_DISTANCE:16,CORNER_KICK_PASS_CHANCE:.1,THROW_IN_MIN_DISTANCE:3,THROW_IN_MAX_DISTANCE:7,LOB_MIN_DISTANCE:5,LOB_MAX_DISTANCE:13,LOB_CHANCE:[.2,.15,.1,.05],PASS_ACCURACY:1,MIN_PASS_DISTANCE:3.5,MIN_PASSING_FORCE:8.5,MAX_PASSING_FORCE:11,MIN_SHOOTING_FORCE:13,MAX_SHOOTING_FORCE:17,TRAP_RANGE:.3,TRAP_COOLDOWN:.5,SLIDE_SPEED:42/3.6,SLIDE_TIME:.3,SLIDE_DELAY:.35,SLIDE_COOLDOWN:1,SLIDE_COLLISION_RADIUS:.22,HEADER_SPEED:35/3.6,HEADER_TIME:.2,HEADER_FORCE:13,HEADER_DELAY:.5,HEADER_HEAD_RADIUS:.25,GOALKEEPER_MAX_FORCE:2,GOALKEEPER_CATCH_SPEED:40/3.6,GOALKEEPER_WALK_SPEED:5/3.6,GOALKEEPER_RUN_SPEED:13/3.6,GOALKEEPER_SPRINT_SPEED:16/3.6,GOALKEEPER_TENDING_RANGE:.75,GOALKEEPER_TRAP_RANGE:.3,GOALKEEPER_INTERCEPT_RANGE:4,GOALKEEPER_MIN_PASS_DISTANCE:2,GOALKEEPER_HOLDING_BALL_TIME_LIMIT:2,GOALKEEPER_LOB_CHANCE:.25,GOALKEEPER_SLIDE_CHANCE:.25,GOALKEEPER_LOB_MIN_DISTANCE:11,GOALKEEPER_LOB_MAX_DISTANCE:13,SUPERSHOT_FORCE:20,SUPERSHOT_BALL_FRICTION:3,SUPERSHOT_BALL_MASS:3,SUPPORT_SPOTS_COLS:10,SUPPORT_SPOTS_ROWS:15,SUPPORT_SPOTS_PASSING_WEIGHT:.5,SUPPORT_SPOTS_SHOOTING_WEIGHT:1.5,SUPPORT_SPOTS_DISTANCE_WEIGHT:1,SUPPORT_SPOTS_OPTIMAL_DISTANCE:7,SUPPORT_SPOTS_UPDATE_DELAY:2,SKILL_GOAL_CONCEDE:-20,SKILL_GOAL_SCORE:10,SKILL_POSSESSION:.25,SKILL_DRIBBLING:.25,SKILL_SHOT:5,SKILL_PASS:3,SKILL_SLIDE_HIT:1,SKILL_SLIDE_TRAP:10,SKILL_BLOCKED_SHOT:10,SKILL_INTERCEPT:10,SKILL_STEAL:5,SKILL_TRAP:3,SUPERMOVES:["supershot"],SUPERMOVE_SCORE:200,FAME_WHEN_LOSE:.2,FAME_WHEN_DREW:.8,FAME_PER_AI:[1,2,4,10],FAME_PER_CHALLENGE:[500,1e3,2e3,5e3],LEADERBOARD_PLATINUM_LIMIT:100,LEADERBOARD_PLATINUM_SCORE:5e5,LEADERBOARD_GOLD_LIMIT:1e3,LEADERBOARD_GOLD_SCORE:25e4,LEADERBOARD_SILVER_LIMIT:1e4,LEADERBOARD_SILVER_SCORE:1e5}}),define("pixi",function(){"use strict";var t=window.PIXI;if("undefined"==typeof t)throw new Error("The PIXI library was not loaded.");return delete window.PIXI,t.Texture.EMPTY.baseTexture={},t.Texture.EMPTY.baseTexture.hasLoaded=!0,t}),define("swig",function(){"use strict";var t=window.swig;if("undefined"==typeof t)throw new Error("The swig library was not loaded.");return delete window.swig,t}),define("greenworks",function(){"use strict";var t=null;return t&&(t.initAPI()?t.loaded=!0:t=null),t}),define("nebula/numbers",function(){"use strict";function t(){for(var t=0,e=0,i=arguments.length;i>e;e++)t+=arguments[e];return t}function e(){for(var t=0,e=0,i=arguments.length;i>e;e++)t*=arguments[e];return t}function i(t){return t-Math.trunc(t)}function n(t,e){return(t%e+e)%e}function r(t,e,i){return Math.min(Math.max(t,e),i)}function s(t,e){var i=Math.abs(e);if(e!==i)throw new Error("Suppressor must be positive");return Math.sign(t)*Math.max(0,Math.abs(t)-i)}function o(t,e,i){return t*(1-i)+e*i}function a(t,e){return t>e?0:1}function h(t,e,i){var n=this.clamp((i-t)/(e-t),0,1);return n*n*(3-2*n)}function l(t,e,i,n,r){
return n+(t-e)*(r-n)/(i-e)}function u(t,e,i){arguments.length<2&&(e=t,t=0),arguments.length<3&&(i=t>e?-1:1);for(var n=Math.max(Math.ceil((e-t)/i),0),r=0,s=new Array(n);n>r;)s[r++]=t,t+=i;return s}function c(t,e){return(+(Math.round(+(t+"e"+e))+"e"+-e)).toFixed(e)}function p(t,e,i,n){if(isNaN(t)||null==t)return"";arguments.length<4&&(n=","),arguments.length<3&&(i="."),arguments.length<2&&(e=2),t=c(t,e);var r=t.split("."),s=r[0],o=r[1]?i+r[1]:"";return s.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+n)+o}function d(t,e,i,n){var r=t-i,s=e-n;return Math.sqrt(r*r+s*s)}function f(t,e){return Math.sqrt(t*t+e*e)}function m(t){return t*Math.PI/180}function g(t){return 180*t/Math.PI}function y(t){return 0>=t||2147483648!==t&&t!==~~t?!1:!(t&t-1)}function v(t){return 1>t?1:this.isPowerOfTwo(t)?t:(t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t+1)}try{var x=require("swig");p.safe=!0,x.setFilter("numberFormat",p)}catch(b){}return{sum:t,multiply:e,fract:i,mod:n,clamp:r,suppress:s,mix:o,step:a,smoothStep:h,scale:l,range:u,format:p,distance:d,length:f,radians:m,degrees:g,isPowerOfTwo:y,nextPowerOfTwo:v}}),define("nebula/strings",function(){"use strict";function t(t){for(var e=t.toLowerCase(),i="",n=0;n<t.length;n++)t[n]!==e[n]&&n>0&&(i+="_"),i+=e[n];return i}function e(t,e){return e.toUpperCase()}function i(t){return t.replace(/_([a-z])/g,e)}return{camelCaseToSnakeCase:t,snakeCaseToCamelCase:i}}),define("nebula/random",["nebula/window"],function(t){"use strict";function e(t){this._state0U=0,this._state0L=0,this._state1U=0,this._state1L=0,this._result=[],this.state=t}e.prototype.value=function(){var t=this._state0U,e=this._state0L,i=this._state1U,n=this._state1L;this._state0U=i,this._state0L=n;var r=0,s=0,o=0,a=0,h=23,l=4294967295<<32-h;r=t<<h|(e&l)>>>32-h,s=e<<h,t^=r,e^=s,r=t^i,s=e^n;var u=17,c=4294967295>>>32-u;o=t>>>u,a=e>>>u|(t&c)<<32-u,r^=o,s^=a;var p=26,d=4294967295>>>32-p;o=i>>>p,a=n>>>p|(i&d)<<32-p,r^=o,s^=a,this._state1U=r,this._state1L=s;var f=(s>>>0)+(n>>>0);return this._result[0]=r+i+(f/2>>>31)>>>0,this._result[1]=f>>>0,this._result},e.prototype.sign=function(){var t=this.value(),e=(4294967296*t[0]+t[1])/0x10000000000000000;return.5>e?-1:1},e.prototype.uniform=function(t,e){var i=this.value(),n=(4294967296*i[0]+i[1])/0x10000000000000000;return"undefined"==typeof t?n:"undefined"==typeof e?n*t:t+(e-t)*n},e.prototype.integer=function(t,e){var i=this.uniform(t,e);return i>=0?Math.floor(i):Math.ceil(i)},e.prototype.choice=function(t){return t[this.integer(t.length)]},e.prototype.shuffle=function(t){for(var e,i,n=t.length;--n;)e=this.integer(n+1),i=t[n],t[n]=t[e],t[e]=i},e.prototype.sample=function(t,e){if(e>t.length)throw new Error("Sample larger than population");var i,n,r=new Array(e);if(e>t.length/3){var s=t.slice(0);for(i=0;e>i;i++)n=this.integer(t.length-i),r[i]=s[n],s[n]=s[t.length-i-1]}else{var o=new Array(e);for(i=0;e>i;i++){do n=this.integer(t.length);while(o.indexOf(n)>=0);o[i]=n,r[i]=t[n]}}return r},e.prototype.pointInSegment=function(t,e,i){var n=this.uniform();i.x=t.x+(t.x-e.x)*n,i.y=t.y+(t.y-e.y)*n},e.prototype.pointInCircle=function(t,e,i){var n=this.uniform()*Math.PI*2,r=this.uniform()*e;i.x=Math.cos(n)*r,i.y=Math.sin(n)*r},e.prototype.pointInRing=function(t,e,i,n){var r=this.uniform()*Math.PI*2,s=this.uniform(e,i);n.x=Math.cos(r)*s,n.y=Math.sin(r)*s},e.prototype.pointInArc=function(t,e,i,n,r,s){var o=this.uniform(n,r),a=this.uniform(e,i);s.x=Math.cos(o)*a,s.y=Math.sin(o)*a},e.prototype.pointInRectangle=function(t,e,i,n,r){r.x=this.uniform(t,t+i),r.y=this.uniform(e,e+n)},Object.defineProperty(e.prototype,"state",{get:function(){return[this._state0U,this._state0L,this._state1U,this._state1L]},set:function(e){e||(t.crypto?(e=new Uint32Array(4),t.crypto.getRandomValues(e)):e=[0,t.Date.now()/65536,0,t.Date.now()%65536]),this._seed=[0|e[0],0|e[1],0|e[2],0|e[3]],this._state0U=this._seed[0],this._state0L=this._seed[1],this._state1U=this._seed[2],this._state1L=this._seed[3]}});var i=new e;return{sign:i.sign.bind(i),uniform:i.uniform.bind(i),integer:i.integer.bind(i),choice:i.choice.bind(i),shuffle:i.shuffle.bind(i),sample:i.sample.bind(i),pointInSegment:i.pointInSegment.bind(i),pointInCircle:i.pointInCircle.bind(i),pointInRing:i.pointInRing.bind(i),pointInArc:i.pointInArc.bind(i),pointInRectangle:i.pointInRectangle.bind(i),_generator:i,Generator:e}}),define("nebula/md5",["nebula/window"],function(t){"use strict";function e(t){for(var e="",i="",n=0,r=0,s=0,o=t.length;o>s;s++){var a=t.charCodeAt(s);128>a?r++:(i=2048>a?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),r>n&&(e+=t.slice(n,r)),e+=i,n=r=s+1)}return r>n&&(e+=t.slice(n,o)),e}function i(t){var e,i;if(t+="",g=!1,y=v=t.length,v>63){for(n(t.substring(0,64)),o(c),g=!0,e=128;v>=e;e+=64)n(t.substring(e-64,e)),a(c);t=t.substring(e-64),v=t.length}for(u[0]=u[1]=u[2]=u[3]=u[4]=u[5]=u[6]=u[7]=u[8]=u[9]=u[10]=u[11]=u[12]=u[13]=u[14]=u[15]=0,e=0;v>e;e++)i=3&e,0===i?u[e>>2]=t.charCodeAt(e):u[e>>2]|=t.charCodeAt(e)<<f[i];return u[e>>2]|=p[3&e],e>55?(g?a(u):(o(u),g=!0),a([0,0,0,0,0,0,0,0,0,0,0,0,0,0,y<<3,0])):(u[14]=y<<3,void(g?a(u):o(u)))}function n(t){for(var e=16;e--;){var i=e<<2;c[e]=t.charCodeAt(i)+(t.charCodeAt(i+1)<<8)+(t.charCodeAt(i+2)<<16)+(t.charCodeAt(i+3)<<24)}}function r(t,n,r){i(n?t:e(t));var s=m[0];return l[1]=d[15&s],l[0]=d[15&(s>>=4)],l[3]=d[15&(s>>=4)],l[2]=d[15&(s>>=4)],l[5]=d[15&(s>>=4)],l[4]=d[15&(s>>=4)],l[7]=d[15&(s>>=4)],l[6]=d[15&(s>>=4)],s=m[1],l[9]=d[15&s],l[8]=d[15&(s>>=4)],l[11]=d[15&(s>>=4)],l[10]=d[15&(s>>=4)],l[13]=d[15&(s>>=4)],l[12]=d[15&(s>>=4)],l[15]=d[15&(s>>=4)],l[14]=d[15&(s>>=4)],s=m[2],l[17]=d[15&s],l[16]=d[15&(s>>=4)],l[19]=d[15&(s>>=4)],l[18]=d[15&(s>>=4)],l[21]=d[15&(s>>=4)],l[20]=d[15&(s>>=4)],l[23]=d[15&(s>>=4)],l[22]=d[15&(s>>=4)],s=m[3],l[25]=d[15&s],l[24]=d[15&(s>>=4)],l[27]=d[15&(s>>=4)],l[26]=d[15&(s>>=4)],l[29]=d[15&(s>>=4)],l[28]=d[15&(s>>=4)],l[31]=d[15&(s>>=4)],l[30]=d[15&(s>>=4)],r?l:l.join("")}function s(t,e,i,n,r,s,o){return e+=t+n+o,(e<<r|e>>>s)+i<<0}function o(t){h(0,0,0,0,t),m[0]=x[0]+1732584193<<0,m[1]=x[1]-271733879<<0,m[2]=x[2]-1732584194<<0,m[3]=x[3]+271733878<<0}function a(t){h(m[0],m[1],m[2],m[3],t),m[0]=x[0]+m[0]<<0,m[1]=x[1]+m[1]<<0,m[2]=x[2]+m[2]<<0,m[3]=x[3]+m[3]<<0}function h(t,e,i,n,r){var o,a;g?(t=s((i^n)&e^n,t,e,r[0],7,25,-680876936),n=s((e^i)&t^i,n,t,r[1],12,20,-389564586),i=s((t^e)&n^e,i,n,r[2],17,15,606105819),e=s((n^t)&i^t,e,i,r[3],22,10,-1044525330)):(t=r[0]-680876937,t=(t<<7|t>>>25)-271733879<<0,n=r[1]-117830708+(2004318071&t^-1732584194),n=(n<<12|n>>>20)+t<<0,i=r[2]-1126478375+((-271733879^t)&n^-271733879),i=(i<<17|i>>>15)+n<<0,e=r[3]-1316259209+((n^t)&i^t),e=(e<<22|e>>>10)+i<<0),t=s((i^n)&e^n,t,e,r[4],7,25,-176418897),n=s((e^i)&t^i,n,t,r[5],12,20,1200080426),i=s((t^e)&n^e,i,n,r[6],17,15,-1473231341),e=s((n^t)&i^t,e,i,r[7],22,10,-45705983),t=s((i^n)&e^n,t,e,r[8],7,25,1770035416),n=s((e^i)&t^i,n,t,r[9],12,20,-1958414417),i=s((t^e)&n^e,i,n,r[10],17,15,-42063),e=s((n^t)&i^t,e,i,r[11],22,10,-1990404162),t=s((i^n)&e^n,t,e,r[12],7,25,1804603682),n=s((e^i)&t^i,n,t,r[13],12,20,-40341101),i=s((t^e)&n^e,i,n,r[14],17,15,-1502002290),e=s((n^t)&i^t,e,i,r[15],22,10,1236535329),t=s((e^i)&n^i,t,e,r[1],5,27,-165796510),n=s((t^e)&i^e,n,t,r[6],9,23,-1069501632),i=s((n^t)&e^t,i,n,r[11],14,18,643717713),e=s((i^n)&t^n,e,i,r[0],20,12,-373897302),t=s((e^i)&n^i,t,e,r[5],5,27,-701558691),n=s((t^e)&i^e,n,t,r[10],9,23,38016083),i=s((n^t)&e^t,i,n,r[15],14,18,-660478335),e=s((i^n)&t^n,e,i,r[4],20,12,-405537848),t=s((e^i)&n^i,t,e,r[9],5,27,568446438),n=s((t^e)&i^e,n,t,r[14],9,23,-1019803690),i=s((n^t)&e^t,i,n,r[3],14,18,-187363961),e=s((i^n)&t^n,e,i,r[8],20,12,1163531501),t=s((e^i)&n^i,t,e,r[13],5,27,-1444681467),n=s((t^e)&i^e,n,t,r[2],9,23,-51403784),i=s((n^t)&e^t,i,n,r[7],14,18,1735328473),e=s((i^n)&t^n,e,i,r[12],20,12,-1926607734),o=e^i,t=s(o^n,t,e,r[5],4,28,-378558),n=s(o^t,n,t,r[8],11,21,-2022574463),a=n^t,i=s(a^e,i,n,r[11],16,16,1839030562),e=s(a^i,e,i,r[14],23,9,-35309556),o=e^i,t=s(o^n,t,e,r[1],4,28,-1530992060),n=s(o^t,n,t,r[4],11,21,1272893353),a=n^t,i=s(a^e,i,n,r[7],16,16,-155497632),e=s(a^i,e,i,r[10],23,9,-1094730640),o=e^i,t=s(o^n,t,e,r[13],4,28,681279174),n=s(o^t,n,t,r[0],11,21,-358537222),a=n^t,i=s(a^e,i,n,r[3],16,16,-722521979),e=s(a^i,e,i,r[6],23,9,76029189),o=e^i,t=s(o^n,t,e,r[9],4,28,-640364487),n=s(o^t,n,t,r[12],11,21,-421815835),a=n^t,i=s(a^e,i,n,r[15],16,16,530742520),e=s(a^i,e,i,r[2],23,9,-995338651),t=s(i^(e|~n),t,e,r[0],6,26,-198630844),n=s(e^(t|~i),n,t,r[7],10,22,1126891415),i=s(t^(n|~e),i,n,r[14],15,17,-1416354905),e=s(n^(i|~t),e,i,r[5],21,11,-57434055),t=s(i^(e|~n),t,e,r[12],6,26,1700485571),n=s(e^(t|~i),n,t,r[3],10,22,-1894986606),i=s(t^(n|~e),i,n,r[10],15,17,-1051523),e=s(n^(i|~t),e,i,r[1],21,11,-2054922799),t=s(i^(e|~n),t,e,r[8],6,26,1873313359),n=s(e^(t|~i),n,t,r[15],10,22,-30611744),i=s(t^(n|~e),i,n,r[6],15,17,-1560198380),e=s(n^(i|~t),e,i,r[13],21,11,1309151649),t=s(i^(e|~n),t,e,r[4],6,26,-145523070),n=s(e^(t|~i),n,t,r[11],10,22,-1120210379),i=s(t^(n|~e),i,n,r[2],15,17,718787259),e=s(n^(i|~t),e,i,r[9],21,11,-343485551),x[0]=t,x[1]=e,x[2]=i,x[3]=n}var l=[],u=[],c=[],p=[],d="0123456789abcdef".split(""),f=[],m=[],g=!1,y=0,v=0,x=[];if(t.Int32Array)u=new Int32Array(16),c=new Int32Array(16),p=new Int32Array(4),f=new Int32Array(4),m=new Int32Array(4),x=new Int32Array(4);else{var b;for(b=0;16>b;b++)u[b]=c[b]=0;for(b=0;4>b;b++)p[b]=f[b]=m[b]=x[b]=0}return p[0]=128,p[1]=32768,p[2]=8388608,p[3]=-2147483648,f[0]=0,f[1]=8,f[2]=16,f[3]=24,r}),define("nebula/colors/rgb",["nebula/numbers"],function(t){"use strict";function e(){return"[RGB r:"+this.r+" g:"+this.g+" b:"+this.b+"]"}function i(){return h(this)}function n(t,n,r){return{r:t||0,g:n||0,b:r||0,toString:e,valueOf:i}}function r(t){return n(t.r,t.g,t.b)}function s(t,e){var i=t.r,n=t.g,r=t.b;e.y=.3*i+.59*n+.11*r,e.i=.74*(i-e.y)-.27*(r-e.y),e.q=.48*(i-e.y)+.41*(r-e.y)}function o(e,i){var n,r,s,o,a,h=e.r,l=e.g,u=e.b,c=Math.max(h,l,u),p=Math.min(h,l,u),d=(p+c)/2,f=c-p;return p===c?(i.h=0,i.l=d,void(i.s=0)):(r=.5>=d?f/(c+p):f/(2-c-p),s=(c-h)/f,o=(c-l)/f,a=(c-u)/f,n=h===c?a-o:l===c?2+s-a:4+o-s,i.h=t.mod(n/6,1),i.l=d,void(i.s=r))}function a(e,i){var n,r,s,o,a,h=e.r,l=e.g,u=e.b,c=Math.max(h,l,u),p=Math.min(h,l,u),d=c,f=c-p;return p===c?(i.h=i.s=0,void(i.v=d)):(r=f/c,s=(c-h)/f,o=(c-l)/f,a=(c-u)/f,n=h===c?a-o:l===c?2+s-a:4+o-s,i.h=t.mod(n/6,1),i.s=r,void(i.v=d))}function h(t){return 255*t.r<<16|255*t.g<<8|255*t.b<<0}function l(t,e){e.r=((16711680&t)>>16)/255,e.g=((65280&t)>>8)/255,e.b=(255&t)/255}return{create:n,copy:r,fromNumber:l,toYIQ:s,toHLS:o,toHSV:a,pack:h}}),define("nebula/easings",function(){"use strict";function t(t){return 1-2*Math.abs(t-.5)}function e(t){return t}function i(t,i,n,r){function s(t,e,i){return(((1-3*i+3*e)*t+(3*i-6*e))*t+3*e)*t}function o(t,e,i){return(3-9*i+9*e)*t*t+(6*i-12*e)*t+3*e}function a(e){for(var i=e,r=0;8>r;++r){var a=o(i,t,n);if(0===a)return i;var h=s(i,t,n)-e;i-=h/a}return i}function h(t){return s(a(t),i,r)}if(4!==arguments.length)throw new Error("`cubicBezier()` requires 4 arguments.");for(var l=0;4>l;++l)if("number"!=typeof arguments[l]||isNaN(arguments[l])||!isFinite(arguments[l]))throw new Error("`cubicBezier()` arguments must be numbers.");if(0>t||t>1||0>n||n>1)throw new Error("`cubicBezier()` x values must be in [0, 1] range.");return t===i&&n===r?e:(h.toString=function(){return"[cubicBezier "+[t,i,n,r]+"]"},h)}var n={"in":function(t){return t*t},out:function(t){return t*(2-t)},inOut:function(t){return.5>t?2*t*t:-2*t*t+4*t-1}},r={"in":function(t){return t*t*t},out:function(t){var e=t-1;return e*e*e+1},inOut:function(t){if(.5>t)return 4*t*t*t;var e=2*t-2;return.5*e*e*e+1}},s={"in":function(t){return t*t*t*t},out:function(t){var e=t-1;return e*e*e*(1-t)+1},inOut:function(t){if(.5>t)return 8*t*t*t*t;var e=t-1;return-8*e*e*e*e+1}},o={"in":function(t){return t*t*t*t*t},out:function(t){var e=t-1;return e*e*e*e*e+1},inOut:function(t){if(.5>t)return 16*t*t*t*t*t;var e=2*t-2;return.5*e*e*e*e*e+1}},a={"in":function(t){return Math.sin((t-1)*Math.PI/2)+1},out:function(t){return Math.sin(t*Math.PI/2)},inOut:function(t){return.5*(1-Math.cos(t*Math.PI))}},h={"in":function(t){return 1-Math.sqrt(1-t*t)},out:function(t){return Math.sqrt((2-t)*t)},inOut:function(t){return.5>t?.5*(1-Math.sqrt(1-4*t*t)):.5*(Math.sqrt(-(2*t-3)*(2*t-1))+1)}},l={"in":function(t){return 0==t?t:Math.pow(2,10*(t-1))},out:function(t){return 1==t?t:1-Math.pow(2,-10*t)},inOut:function(t){return 0==t||1==t?t:.5>t?.5*Math.pow(2,20*t-10):-.5*Math.pow(2,-20*t+10)+1}},u={"in":function(t){return Math.sin(13*Math.PI/2*t)*Math.pow(2,10*(t-1))},out:function(t){return Math.sin(-13*Math.PI/2*(t+1))*Math.pow(2,-10*t)+1},inOut:function(t){return.5>t?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*(Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+2)}},c={"in":function(t){return t*t*t-t*Math.sin(t*Math.PI)},out:function(t){var e=1-t;return 1-(e*e*e-e*Math.sin(e*Math.PI))},inOut:function(t){if(.5>t){var e=2*t;return.5*(e*e*e-e*Math.sin(e*Math.PI))}var e=1-(2*t-1);return.5*(1-(e*e*e-e*Math.sin(e*Math.PI)))+.5}},p={"in":function(t){return 1-p.out(1-t)},out:function(t){return 4/11>t?121*t*t/16:8/11>t?9.075*t*t-9.9*t+3.4:.9>t?4356/361*t*t-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72},inOut:function(t){return.5>t?.5*p["in"](2*t):.5*p.out(2*t-1)+.5}};return{mirror:t,linear:e,quadratic:n,cubic:r,quartic:s,quintic:o,sine:a,circular:h,exponential:l,elastic:u,back:c,bounce:p,cubicBezier:i}}),define("nebula/html",function(){"use strict";function t(t,i){if(t=String(t),1===arguments.length){i=e;for(var n in i)t=t.replace.apply(t,i[n])}else for(var n in i)t=t.replace(new RegExp(n,"g"),i[n]);return t}this.ESCAPE_MAP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var e={};for(var i in this.ESCAPE_MAP)e[i]=[new RegExp(i,"g"),this.ESCAPE_MAP[i]];return{escape:t}}),define("nebula/format",function(){"use strict";function t(t){return parseInt(t,10)}function e(t){return parseFloat(t)}function i(t,e){return!!t&&-1!==t.indexOf(e)}function n(t){var e=typeof t;if("object"===e){if(t.callee)return"array";e=/^\[object\s(.+?)\]$/.test(Object.prototype.toString.call(t))&&RegExp.$1.toLowerCase()}return e}function r(t,e,i){t+="";var n=Math.abs(e)-t.length;return n>0?Array(n+1).join(i||" "):""}function s(t,e,i){return i=null!=e?r(t,e,i):"",0>e?t+i:i+t}function o(t){var e=[],i=0;switch(n(t)){case"array":for(;i<t.length;i++)e.push(o(t[i]));return"["+e.join(", ")+"]";case"object":var r=[];for(i in t)r.push(i);for(r.sort(),i=0;i<r.length;i++)e.push("'"+r[i]+"': "+o(t[r[i]]));return"{"+e.join(", ")+"}";case"string":return"'"+t.replace(/'/g,"\\'")+"'";case"function":return"("+m.toSource()+")"}return String(t)}function a(t,e,i){return 0>t&&"-"||e&&"+"||i&&" "||""}function h(e){e=String(e);for(var n="",r=1,s=0;s<e.length;s++){var o=e.charAt(s);if("%"==o){var a=u.exec(e.substr(s));if(!a)return n+e.substr(s);var h=a[1]?arguments[1][a[1]]:arguments[r],c={type:a[6].toLowerCase(),alt:i(a[2],"#"),padleft:i(a[2],"-"),space:i(a[2]," "),sign:i(a[2],"+"),pad:i(a[2],"0")&&!i(a[2],"-")?"0":" ",lenmod:a[5]?t(a[5]):""};if(r+=a[1]||"%"===a[6]?0:1,"*"==a[3]){if(a[1])throw new SyntaxError("* expects a number");c.minwidth=arguments[r++]}else a[3]&&(c.minwidth=t(a[3]));if(c.minwidth&&i(a[2],"-")&&(c.minwidth=-c.minwidth),"*"==a[4]){if(a[1])throw new SyntaxError("* expects a number");c.precision=arguments[r++]}else a[4]&&(c.precision=t(a[4].substr(1))||0);var p=l[c.type]||l.s,d=p(h,c);n+=a[6]!==c.type?d.toUpperCase():d,s+=a[0].length-1}else n+=o}return n}var l={d:function(e,i){var n=t(e),o=Math.abs(n),h=a(n,i.sign,i.space),l="0"==i.pad?Math.max(!!i.precision,(i.minwidth||0)-h.length):i.precision;return s(h+r(o,l,"0")+o,i.minwidth,i.pad)},o:function(e,i){var n=t(e),o=Math.abs(n).toString(8),h=a(n,i.sign,i.space),l=i.alt?"0":"",u="0"==i.pad?Math.max(!!i.precision,(i.minwidth||0)-h.length-l.length):i.precision,c=r(o,u,"0");return"0"!==c.charAt(0)&&"0"!==o.charAt(0)||(l=""),s(h+l+c+o,i.minwidth,i.pad)},x:function(e,i){var n=t(e),o=Math.abs(n).toString(16),h=a(n,i.sign,i.space),l=i.alt?"0x":"",u="0"==i.pad?Math.max(!!i.precision,(i.minwidth||0)-h.length-l.length):i.precision;return s(h+l+r(o,u,"0")+o,i.minwidth,i.pad)},e:function(t,i){var n=e(t),r=null==i.precision?6:i.precision,o=Math.abs(n).toExponential(r).split("e+"),h=a(n,i.sign,i.space);return o=o[0]+(!r&&i.alt&&"."||"")+"e+"+s(o[1],2,"0"),h+s(o,i.minwidth-h.length,i.pad)},f:function(t,i){var n=e(t),r=null==i.precision?6:Math.min(Math.abs(i.precision),50);if(t>1e25)return l.g(t,i);var o=Math.abs(n).toFixed(r),h=a(n,i.sign,i.space),u=i.alt&&0==r?".":"",c=i.minwidth>0?i.minwidth-h.length:i.minwidth+h.length;return h+s(o+u,c,i.pad)},g:function(t,i){var n=e(t),r=null==i.precision?5:i.precision;if(Math.abs(n)>=Math.pow(10,r||1))return l.e(t,i);var o;if(i.alt){var h=Math.abs(n).toFixed(r).split(".");o=h[0]+"."+(h[1]||"")}else o=null!=i.precision?Math.abs(n).toPrecision(r).replace(/\.?0+$/,""):Math.abs(n)+"";var u=a(n,i.sign,i.space),c=i.minwidth>0?i.minwidth-u.length:i.minwidth+u.length;return u+s(o,c,i.pad)},c:function(t,e){var i=n(t);if("number"===i)return String.fromCharCode(t);if("string"===i)return t.charAt(0);throw new TypeError("%c requires number or string")},r:function(t,e){var i=o(t),n=null==e.precision?i.length:e.precision;return s(i.substring(0,n),e.minwidth," ")},s:function(t,e){var i=""+t,n=null==e.precision?i.length:e.precision;return s(i.substring(0,n),e.minwidth," ")},"%":function(t,e){return"%"}};l.i=l.u=l.d;var u=/^%(?:\(([^)]*?)\))?([ 0#+\-]+)?(\d+|\*)?(\.\d*|\*)?([hlL])?([diouxefgcrs%])/i;return h}),define("nebula/signal",function(){"use strict";function t(){var t="function"==typeof arguments[0]?{receiver:arguments[0],context:arguments[1]}:arguments[0];if("function"!=typeof t.receiver)throw new Error("Can't connect receiver to a signal, receiver is not a function");for(var e=0;e<this.receivers.length;e++)if(this.receivers[e].receiver===t.receiver&&this.receivers[e].context==t.context&&this.receivers[e].sender==t.sender)throw new Error("Can't connect receiver to a signal, this receiver with same context and same sender is already connected");this.receivers.push({callback:t.context?t.receiver.bind(t.context):t.receiver,receiver:t.receiver,sender:t.sender,context:t.context,once:t.once})}function e(){var e="function"==typeof arguments[0]?{receiver:arguments[0],context:arguments[1]}:arguments[0];return e.once=!0,t.call(this,e)}function i(t,e){var i="function"==typeof t?{receiver:t,context:e}:t;if("function"!=typeof i.receiver)throw new Error("Can't disconnect receiver from a signal, receiver is not a function");if(this.sending)this._toDisconnect.push(i);else for(var n=0;n<this.receivers.length;n++){var r=this.receivers[n];if(r.receiver===i.receiver&&r.context===i.context&&r.sender===i.sender)return void this.receivers.splice(n,1)}}function n(t,e,i,n,r,s,o,a,h,l){this.sending=!0;for(var u=0;u<this.receivers.length;u++){var c=this.receivers[u];"undefined"!=typeof c.sender&&c.sender!==t||(c.callback(t,e,i,n,r,s,o,a,h),c.once&&(this.receivers.splice(u,1),u-=1))}if(this.sending=!1,this._toDisconnect.length){for(var u=0;u<this._toDisconnect.length;u++)this.disconnect(this._toDisconnect[u]);this._toDisconnect=[]}}function r(){function r(){t.apply(r,arguments)}return r.sending=!1,r.receivers=[],r._toDisconnect=[],r.connect=t.bind(r),r.once=e.bind(r),r.disconnect=i.bind(r),r.send=n.bind(r),r}return r}),define("nebula/messages",["nebula/signal"],function(t){"use strict";function e(t){this.name=t,this._methodName="on"+t,this._message={name:t,sender:null,_methodName:this._methodName}}function i(){for(var t,i,n={},r=0;r<arguments.length;r++){if(t=arguments[r],t in n)throw new Error("Duplicate message name: '"+t+"'");i=t.charAt(0).toUpperCase()+t.slice(1),n[t]=new e(i)}return n}var n="Receiver doesn't support receiving messages";return e.prototype._send=function(t,e){if(!t.onMessage)throw new Error(n);var i=t.onMessage(e);return i},e.prototype.send=function(t){if(t.name=this.name,t._methodName=this._methodName,"receivers"in t){for(var e=new Array(t.receivers.length),i=0;i<t.receivers.length;i++)e[i]=this._send(t.receivers[i],t);return e}return this._send(t.receiver,t)},e.prototype.sendTo=function(t){if(!t.onMessage)throw new Error(n);var e=t.onMessage(this._message);return e},{Message:e,build:i}}),define("nebula/objects",function(){"use strict";function t(t){for(var e in t)return!1;return!0}function e(){for(var t=arguments.length-1,e=arguments.length>1?arguments[t]:{},i=0;t>i;i++){var n=arguments[i];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}function i(t,i,n){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,n&&e(n,i.prototype)}function n(t,e){e=e.split(".");for(var i=0;i<e.length-1;)t=t[e[i++]];return{parent:t,property:e[i]}}function r(t,e,i){if(i="undefined"==typeof i?!0:i,"string"!=typeof e){for(var n=[],s=0;s<e.length;s++)n=n.concat(r(t,e[s],i));return n}var o=e,a=o.split(".");if(1===a.length){if("*"===o){var n=[];for(var h in t)n=n.concat(t[h]);return n}if(!t[o]){if(i)throw new Error("Property does not exist");return[]}return[t[o]]}if("*"===a[0]){a.shift();var n=[];for(var h in t)n=n.concat(r(t[h],a.join("."),i));return n}if(o=a.shift(),!t[o]){if(i)throw new Error("Property does not exist");return[]}return r(t[o],a.join("."),i)}function s(t,e,i){if("string"!=typeof e)for(var n=0;n<e.length;n++)s(t,e[n],i);else{var r=e,o=r.split(".");if(1===o.length)r in t&&(t[r]=i(t[r],r,t));else if("*"===o[0]){o.shift();for(var a in t)a in t&&s(t[a],o.join("."),i)}else{var a=o.shift();a in t&&s(t[a],o.join("."),i)}}}return{isEmpty:t,copy:e,inherit:i,getProperty:n,getValues:r,setValues:s}}),define("nebula/query",function(){"use strict";function t(t,e){e=e.split(".");for(var i=0;i<e.length&&null!=t;t=t[e[i++]]);return t}function e(t,e,i){e=e.split(".");for(var n=0;n<e.length&&null!=t;t=t[e[n++]])if(n===e.length-1)return void(t[e[n]]=i)}function i(e,i){var n,r,s,o,a=e,h={exact:function(e){return t(e,s)===n},not:function(e){return t(e,s)!==n},gt:function(e){return t(e,s)>n},gte:function(e){return t(e,s)>=n},lt:function(e){return t(e,s)<n},lte:function(e){return t(e,s)<=n},"in":function(e){return n.indexOf(t(e,s))>=0},"typeof":function(e){return typeof t(e,s)===n},"instanceof":function(e){return t(e,s)instanceof n}};for(var l in i){if(n=i[l],r=l.split("_"),s=r[0],o=r[1]||"exact",!(o in h))throw new Error("Unknown operator '"+o+"'");a=a.filter(h[o])}return a}function n(e,i){var n,r,s,o,a=e,h={exact:function(e){return t(e,s)!==n},not:function(e){return t(e,s)===n},gt:function(e){return t(e,s)<=n},gte:function(e){return t(e,s)<n},lt:function(e){return t(e,s)>=n},lte:function(e){return t(e,s)>n},"in":function(e){return n.indexOf(t(e,s))<0},"typeof":function(e){return typeof t(e,s)!==n},"instanceof":function(e){return!(t(e,s)instanceof n)}};for(var l in i){if(n=i[l],r=l.split("_"),s=r[0],o=r[1]||"exact",!(o in h))throw new Error("Unknown operator '"+o+"'");a=a.filter(h[o])}return a}function r(t,i){for(var n in i){var r=i[n];t.forEach(function(t){e(t,n,r)})}}function s(t){return t.reduce(function(t,e){return-1===t.indexOf(e)&&t.push(e),t},[])}return{filter:i,exclude:n,update:r,unique:s}}),define("nebula/audio",function(){"use strict";function t(t,e){this.url=e,this.audioData=t,this.ready=!1,this.onReady=new n,this._decodeError=this._decodeError.bind(this),this._decodeSuccess=this._decodeSuccess.bind(this)}function e(t,e,i){this._buffer=t,this._gain=r.ctx.createGain(),this.destination=e,this.loop=i||!1,this.paused=!1,this.ended=!1,this.progress=0}function i(t,e,i){if(this.url=t,this.buffer=r.cache[t],this.minDelay="undefined"!=typeof i?i:.1,this._lastEmitTime=-(1/0),this._currentTime=0,!this.buffer)throw new Error("Sound `"+t+"` not in audio buffer cache.");this.destination=e||r.gainNode}var n=require("nebula/signal"),r={};return r.cache={},r.ctx=new(window.AudioContext||window.webkitAudioContext),r.output=r.ctx.destination,r.gainNode=r.ctx.createGain(),r.gainNode.connect(r.output),t.prototype.decode=function(){r.ctx.decodeAudioData(this.audioData,this._decodeSuccess,this._decodeError)},t.prototype._decodeSuccess=function(t){this.buffer=t,this.ready=!0,this.onReady.send()},t.prototype._decodeError=function(t){console&&console.error("Cannot decode audio from file: "+this.url),this.onReady.send(t)},e.onStarted=new n,e.onEnded=new n,e.prototype._onEnded=function(){this.ended||(this.ended=!0,e.onEnded.send(this),this._source.stop(),this._source.disconnect(),this._gain.disconnect())},e.prototype.update=function(t){this.paused||(this.progress+=t*this.playbackRate,this.progress>this._source.buffer.duration&&(this._source.loop?this.progress-=this._source.buffer.duration:this._onEnded()))},e.prototype._play=function(t,e){this.ended=!1,this.paused=!1,this._source=r.ctx.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=t,this._source.connect(this._gain),this._gain.connect(this.destination),this._source.start(0,e||0)},e.prototype.pause=function(){this.ended||(this.paused=!0,this._source.stop(),this._source.disconnect(),this._gain.disconnect())},e.prototype.resume=function(){this.paused&&!this.ended&&this._play(this.loop,this.progress)},e.prototype.play=function(t){this.progress=t||0,this._play(this.loop,this.progress)},e.prototype.stop=function(){this.progress=0,this._onEnded()},Object.defineProperty(e.prototype,"volume",{get:function(){return this._gain.gain.value},set:function(t){this._gain.gain.value=t}}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this._source.playbackRate.value},set:function(t){this._source.playbackRate.value=t}}),i.onEmitted=new n,i.prototype.update=function(t){this._currentTime+=t},i.prototype._play=function(t,n,r,s){if(this.minDelay>this._currentTime-this._lastEmitTime)return null;this._lastEmitTime=this._currentTime;var o=new e(this.buffer,r||this.destination,t);return o.url=this.url,o.volume="undefined"!=typeof s?s:1,o.play(n),i.onEmitted.send(this,o),o},i.prototype.play=function(t,e,i){return this._play(!0,t,e,i)},i.prototype.playOnce=function(t,e,i){return this._play(!1,t,e,i)},r.Sound=e,r.SoundEmitter=i,r.DataDecoder=t,r}),define("pixi_audio_loader",["pixi","nebula/audio"],function(t,e){"use strict";function i(t,i){if(!t.data||t.isImage)return i();if(t.xhr&&t.xhrType===n.XHR_RESPONSE_TYPE.BUFFER){var r=new e.DataDecoder(t.data,t.url);r.onReady.connect(function(n){n||(t.data=r.buffer,t.isAudio=!0,e.cache[t.url]=r.buffer),i()}),r.decode()}else i()}var n=t.loaders.Resource;return t.loader.use(i),t.loaders.Resource.setExtensionXhrType("ogg",n.XHR_RESPONSE_TYPE.BUFFER),t.loaders.Resource.setExtensionXhrType("m4a",n.XHR_RESPONSE_TYPE.BUFFER),n.prototype._oldXhrOnLoad=n.prototype._xhrOnLoad,n.prototype._xhrOnLoad=function(){"arraybuffer"===this.xhr.responseType?(this.data=this.xhr.response,this.complete()):this._oldXhrOnLoad()},i}),define("nebula/lock",function(){"use strict";function t(t,e,i){var n="boolean"==typeof t;this.reset(n?t:void 0),!n&&t&&this._decorate(t,e,i)}return t.prototype.reset=function(t){this._count=t?1:0},t.prototype.open=function(){this.reset()},t.prototype.acquire=function(){this._count+=1},t.prototype.release=function(){this._count>0&&(this._count-=1)},t.prototype._isLocked=t.prototype._isActive=function(){return this._count>0},t.prototype._isOpen=function(){return 0===this._count},t.prototype._decorate=function(t,e,i){if("function"!=typeof t[e])throw new Error("Cannot make a lock around object '"+t+"', it doesn't have method named '"+e+"' or it's not a function");if("function"!=typeof t[i])throw new Error("Cannot make a lock around object '"+t+"', it doesn't have method named '"+i+"' or it's not a function");var n=this,r=t[e],s=t[i];t[e]=function(){var t=n._isOpen();return n.acquire(),t&&n._isLocked()?r.apply(this,arguments):void 0},t[i]=function(){var t=n._isLocked();return n.release(),t&&n._isOpen()?s.apply(this,arguments):void 0}},Object.defineProperty&&(Object.defineProperty(t.prototype,"isOpen",{get:t.prototype._isOpen}),Object.defineProperty(t.prototype,"isLocked",{get:t.prototype._isLocked}),Object.defineProperty(t.prototype,"isActive",{get:t.prototype._isActive})),t}),define("nebula/math/quaternion",function(){"use strict";function t(t,e,i,n){return{x:t||0,y:e||0,z:i||0,w:n||0}}function e(e,i,n,r,s){for(var o=new Array(e),a=0;e>a;a++)o[a]=t(i,n,r,s);return o}function i(e){return t(e.x,e.y,e.z,e.w)}function n(t,e){e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w}function r(t,e,i){var n=.5*e,r=Math.sin(n);i.x=t.x*r,i.y=t.y*r,i.z=t.z*r,i.w=Math.cos(n)}return{create:t,array:e,copy:i,assign:n,fromAngle:r}}),define("nebula/math/vector2",function(){"use strict";function t(t,e){return{x:t||0,y:e||0}}function e(t,e){yt=(yt+1)%gt.length;var i=gt[yt];return i.x=t||0,i.y=e||0,i}function i(e,i,n){for(var r=new Array(e),s=0;e>s;s++)r[s]=t(i,n);return r}function n(e){return t(e.x,e.y)}function r(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y}function s(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y}function o(t,e,i){i.x=t.x*e.x,i.y=t.y*e.y}function a(t,e,i){i.x=t.x/e.x,i.y=t.y/e.y}function h(t,e,i){i.x=t.x+e,i.y=t.y+e}function l(t,e,i){i.x=t.x-e,i.y=t.y-e}function u(t,e,i){i.x=t.x*e,i.y=t.y*e}function c(t,e,i){i.x=t.x/e,i.y=t.y/e}function p(t,e){e.x=t.x*Math.PI/180,e.y=t.y*Math.PI/180}function d(t,e){e.x=180*t.x/Math.PI,e.y=180*t.y/Math.PI}function f(t,e){e.x=Math.sin(t.x),e.y=Math.sin(t.y)}function m(t,e){e.x=Math.cos(t.x),e.y=Math.cos(t.y)}function g(t,e){e.x=Math.tan(t.x),e.y=Math.tan(t.y)}function y(t,e){e.x=Math.asin(t.x),e.y=Math.asin(t.y)}function v(t,e){e.x=Math.acos(t.x),e.y=Math.acos(t.y)}function x(t,e){e.x=Math.atan(t.x),e.y=Math.atan(t.y)}function b(t,e,i){i.x=Math.pow(t.x,e.x),i.y=Math.pow(t.y,e.y)}function w(t,e){e.x=Math.exp(t.x),e.y=Math.exp(t.y)}function _(t,e){e.x=Math.log(t.x),e.y=Math.log(t.y)}function T(t,e){e.x=Math.pow(2,t.x),e.y=Math.pow(2,t.y)}function E(t,e){e.x=Math.log2(t.x),e.y=Math.log2(t.y)}function S(t,e){e.x=Math.abs(t.x),e.y=Math.abs(t.y)}function A(t,e){e.x=Math.sign(t.x),e.y=Math.sign(t.y)}function C(t,e){return t.y*e.x>t.x*e.y?-1:1}function P(t,e){e.x=Math.floor(t.x),e.y=Math.floor(t.y)}function M(t,e){e.x=Math.ceil(t.x),e.y=Math.ceil(t.y)}function O(t,e){e.x=t.x-Math.trunc(t.x),e.y=t.y-Math.trunc(t.y)}function R(t,e,i){i.x=t.x-e.x*Math.trunc(t.x/e.x),i.y=t.y-e.y*Math.trunc(t.y/e.y)}function k(t,e,i){i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y)}function I(t,e,i){i.x=Math.min(t.x,e),i.y=Math.min(t.y,e)}function D(t,e,i){i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y)}function L(t,e,i){i.x=Math.max(t.x,e),i.y=Math.max(t.y,e)}function F(t,e,i,n){n.x=Math.min(Math.max(t.x,e.x),i.x),n.y=Math.min(Math.max(t.y,e.y),i.y)}function B(t,e,i,n){n.x=Math.min(Math.max(t.x,e),i),n.y=Math.min(Math.max(t.y,e),i)}function N(t,e,i,n){n.x=t.x*(1-i.x)+e.x*i.x,n.y=t.y*(1-i.y)+e.y*i.y}function G(t,e,i,n){n.x=t.x*(1-i)+e.x*i,n.y=t.y*(1-i)+e.y*i}function q(t,e,i){i.x=e.x<t.x?0:1,i.y=e.y<t.y?0:1}function z(t,e,i){i.x=e.x<t?0:1,i.y=e.y<t?0:1}function U(t,e,i,n){var r;r=Math.min(Math.max((i.x-t.x)/(e.x-t.x),0),1),n.x=r*r*(3-2*r),r=Math.min(Math.max((i.y-t.y)/(e.y-t.y),0),1),n.y=r*r*(3-2*r)}function j(t,e,i,n){var r;r=Math.min(Math.max((i.x-t)/(e-t),0),1),n.x=r*r*(3-2*r),r=Math.min(Math.max((i.y-t)/(e-t),0),1),n.y=r*r*(3-2*r)}function H(t,e){e.x=-t.x,e.y=-t.y}function W(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function Y(t,e){return t.x*e.x+t.y*e.y}function X(t,e){return t.x*e.y-t.y*e.x}function K(t,e){var i=Math.sqrt(t.x*t.x+t.y*t.y);i>0?(e.x=t.x/i,e.y=t.y/i):e.x=e.y=0}function V(t,e,i){var n=2*Y(t,e);i.x=t.x-e.x*n,i.y=t.y-e.y*n}function Z(t,e,i,n){K(t,n),t=n;var r=t.x*e.x+t.y*e.y,s=1-i*i*(1-r*r);0>s?n.x=n.y=0:(n.x=i*t.x-(i*r+Math.sqrt(s))*e.x,n.y=i*t.y-(i*r+Math.sqrt(s))*e.y)}function J(t,e,i,n){Y(i,e)<0?(n.x=t.x,n.y=t.y):(n.x=-t.x,n.y=-t.y)}function Q(t,e){var i=t.x;e.x=-t.y,e.y=i}function $(t,e){return(e.y-t.y)/(e.x-t.x)}function tt(t,e){e.x=Math.cos(t),e.y=Math.sin(t)}function et(t,e,i){var n=Math.cos(e),r=Math.sin(e),s=t.x*n-t.y*r,o=t.x*r+t.y*n;i.x=s,i.y=o}function it(t,e,i){var n=W(t);i.x=e.x*n,i.y=e.y*n}function nt(t){return Math.atan2(t.y,t.x)}function rt(t,e){
return Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x)}function st(t,i,n,r){var s=e();K(t,s);var o=Math.min(Math.max(Y(s,i),-1),1),a=Math.acos(o);return 1e-5>a?(ot(i,W(t),r),!0):(a>n&&(a=n),et(t,a*C(t,i),r),!1)}function ot(t,e,i){K(t,i),i.x*=e,i.y*=e}function at(t,e,i){var n=W(t);n>e&&(i.x=t.x/n*e,i.y=t.y/n*e)}function ht(t,e,i,n){var r=W(t);if(0===r)throw new Error("Can't clamp vector, it's length is 0");r>i?(n.x=t.x/r*i,n.y=t.y/r*i):e>r&&(n.x=t.x/r*e,n.y=t.y/r*e)}function lt(t){return 0===t.x&&0===t.y}function ut(t){return 0!==t.x||0!==t.y}function ct(t,e){return t.x<e.x&&t.y<e.y}function pt(t,e){return t.x<=e.x&&t.y<=e.y}function dt(t,e){return t.x>e.x&&t.y>e.y}function ft(t,e){return t.x>=e.x&&t.y>=e.y}function mt(t,e){return t.x===e.x&&t.y===e.y}var gt=i(1e3),yt=-1,vt={create:t,temp:e,array:i,copy:n,add:r,subtract:s,multiply:o,divide:a,addNumber:h,subtractNumber:l,multiplyNumber:u,divideNumber:c,radians:p,degrees:d,sin:f,cos:m,tan:g,asin:y,acos:v,atan:x,pow:b,exp:w,log:_,exp2:T,log2:E,abs:S,sign:A,sign2:C,floor:P,ceil:M,fract:O,mod:R,min:k,minNumber:I,max:D,maxNumber:L,clamp:F,clampNumber:B,mix:N,mixNumber:G,step:q,stepNumber:z,smoothStep:U,smoothStepNumber:j,invert:H,length:W,dot:Y,cross:X,normalize:K,reflect:V,refract:Z,faceForward:J,perpendicular:Q,slope:$,direction:tt,rotate:et,rotate2:it,angle:nt,angle2:rt,look:st,resize:ot,truncateLength:at,clampLength:ht,isZero:lt,notZero:ut,lessThan:ct,lessThanEqual:pt,greaterThan:dt,greaterThanEqual:ft,equals:mt};return vt.ZERO=t(),vt}),define("nebula/math/vector3",function(){"use strict";function t(t,e,i){return{x:t||0,y:e||0,z:i||0}}function e(t,e,i){lt=(lt+1)%ht.length;var n=ht[lt];return n.x=t||0,n.y=e||0,n.z=i||0,n}function i(e,i,n,r){for(var s=new Array(e),o=0;e>o;o++)s[o]=t(i,n,r);return s}function n(e,i){return i?(i.x=e.x,i.y=e.y,void(i.z=e.z)):t(e.x,e.y,e.z)}function r(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z}function s(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z}function o(t,e,i){i.x=t.x*e.x,i.y=t.y*e.y,i.z=t.z*e.z}function a(t,e,i){i.x=t.x/e.x,i.y=t.y/e.y,i.z=t.z/e.z}function h(t,e,i){i.x=t.x+e,i.y=t.y+e,i.z=t.z+e}function l(t,e,i){i.x=t.x-e,i.y=t.y-e,i.z=t.z-e}function u(t,e,i){i.x=t.x*e,i.y=t.y*e,i.z=t.z*e}function c(t,e,i){i.x=t.x/e,i.y=t.y/e,i.z=t.z/e}function p(t,e){e.x=t.x*Math.PI/180,e.y=t.y*Math.PI/180,e.z=t.z*Math.PI/180}function d(t,e){e.x=180*t.x/Math.PI,e.y=180*t.y/Math.PI,e.z=180*t.z/Math.PI}function f(t,e){e.x=Math.sin(t.x),e.y=Math.sin(t.y),e.z=Math.sin(t.z)}function m(t,e){e.x=Math.cos(t.x),e.y=Math.cos(t.y),e.z=Math.cos(t.z)}function g(t,e){e.x=Math.tan(t.x),e.y=Math.tan(t.y),e.z=Math.tan(t.z)}function y(t,e){e.x=Math.asin(t.x),e.y=Math.asin(t.y),e.z=Math.asin(t.z)}function v(t,e){e.x=Math.acos(t.x),e.y=Math.acos(t.y),e.z=Math.acos(t.z)}function x(t,e){e.x=Math.atan(t.x),e.y=Math.atan(t.y),e.z=Math.atan(t.z)}function b(t,e,i){i.x=Math.pow(t.x,e.x),i.y=Math.pow(t.y,e.y),i.z=Math.pow(t.z,e.z)}function w(t,e){e.x=Math.exp(t.x),e.y=Math.exp(t.y),e.z=Math.exp(t.z)}function _(t,e){e.x=Math.log(t.x),e.y=Math.log(t.y),e.z=Math.log(t.z)}function T(t,e){e.x=Math.pow(2,t.x),e.y=Math.pow(2,t.y),e.z=Math.pow(2,t.z)}function E(t,e){e.x=Math.log2(t.x),e.y=Math.log2(t.y),e.z=Math.log2(t.z)}function S(t,e){e.x=Math.abs(t.x),e.y=Math.abs(t.y),e.z=Math.abs(t.z)}function A(t,e){e.x=Math.sign(t.x),e.y=Math.sign(t.y),e.z=Math.sign(t.z)}function C(t,e){e.x=Math.floor(t.x),e.y=Math.floor(t.y),e.z=Math.floor(t.z)}function P(t,e){e.x=Math.ceil(t.x),e.y=Math.ceil(t.y),e.z=Math.ceil(t.z)}function M(t,e){e.x=t.x-Math.trunc(t.x),e.y=t.y-Math.trunc(t.y),e.z=t.z-Math.trunc(t.z)}function O(t,e,i){i.x=t.x-e.x*Math.trunc(t.x/e.x),i.y=t.y-e.y*Math.trunc(t.y/e.y),i.z=t.z-e.z*Math.trunc(t.z/e.z)}function R(t,e,i){i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.z=Math.min(t.z,e.z)}function k(t,e,i){i.x=Math.min(t.x,e),i.y=Math.min(t.y,e),i.z=Math.min(t.z,e)}function I(t,e,i){i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i.z=Math.max(t.z,e.z)}function D(t,e,i){i.x=Math.max(t.x,e),i.y=Math.max(t.y,e),i.z=Math.max(t.z,e)}function L(t,e,i,n){n.x=Math.min(Math.max(t.x,e.x),i.x),n.y=Math.min(Math.max(t.y,e.y),i.y),n.z=Math.min(Math.max(t.z,e.z),i.z)}function F(t,e,i,n){n.x=Math.min(Math.max(t.x,e),i),n.y=Math.min(Math.max(t.y,e),i),n.z=Math.min(Math.max(t.z,e),i)}function B(t,e,i,n){n.x=t.x*(1-i.x)+e.x*i.x,n.y=t.y*(1-i.y)+e.y*i.y,n.z=t.z*(1-i.z)+e.z*i.z}function N(t,e,i,n){n.x=t.x*(1-i)+e.x*i,n.y=t.y*(1-i)+e.y*i,n.z=t.z*(1-i)+e.z*i}function G(t,e,i){i.x=e.x<t.x?0:1,i.y=e.y<t.y?0:1,i.z=e.z<t.z?0:1}function q(t,e,i){i.x=e.x<t?0:1,i.y=e.y<t?0:1,i.z=e.z<t?0:1}function z(t,e,i,n){var r;r=Math.min(Math.max((i.x-t.x)/(e.x-t.x),0),1),n.x=r*r*(3-2*r),r=Math.min(Math.max((i.y-t.y)/(e.y-t.y),0),1),n.y=r*r*(3-2*r),r=Math.min(Math.max((i.z-t.z)/(e.z-t.z),0),1),n.z=r*r*(3-2*r)}function U(t,e,i,n){var r;r=Math.min(Math.max((i.x-t)/(e-t),0),1),n.x=r*r*(3-2*r),r=Math.min(Math.max((i.y-t)/(e-t),0),1),n.y=r*r*(3-2*r),r=Math.min(Math.max((i.z-t)/(e-t),0),1),n.z=r*r*(3-2*r)}function j(t,e){e.x=-t.x,e.y=-t.y,e.z=-t.z}function H(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}function W(t,e){var i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0?(e.x=t.x/i,e.y=t.y/i,e.z=t.z/i):e.x=e.y=e.z=0}function Y(t,e,i){W(t,i),i.x*=e,i.y*=e,i.z*=e}function X(t,e,i){var n=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);n>e&&(i.x=t.x/n*e,i.y=t.y/n*e,i.z=t.z/n*e)}function K(t,e,i,n){var r=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);r>i?(n.x*=i/r,n.y*=i/r,n.z*=i/r):e>r&&(n.x*=e/r,n.y*=e/r,n.z*=e/r)}function V(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function Z(t,e,i){var n=t.x,r=t.y,s=t.z,o=e.x,a=e.y,h=e.z;i.x=r*h-s*a,i.y=s*o-n*h,i.z=n*a-r*o}function J(t,e,i,n){at.fromAngle(e,i,ut),ot(t,ut,n)}function Q(t){return 0===t.x&&0===t.y&&0===t.z}function $(t){return 0!==t.x||0!==t.y||0!==t.z}function tt(t,e){return t.x<e.x&&t.y<e.y&&t.z<e.z}function et(t,e){return t.x<=e.x&&t.y<=e.y&&t.z<=e.z}function it(t,e){return t.x>e.x&&t.y>e.y&&t.z>e.z}function nt(t,e){return t.x>=e.x&&t.y>=e.y&&t.z>=e.z}function rt(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}function st(t,e,i){i.x=e[0]*t.x+e[4]*t.y+e[8]*t.z+e[12],i.y=e[1]*t.x+e[5]*t.y+e[9]*t.z+e[13],i.z=e[2]*t.x+e[6]*t.y+e[10]*t.z+e[14]}function ot(t,e,i){var n=t.x,r=t.y,s=t.z,o=e.x,a=e.y,h=e.z,l=e.w,u=l*n+a*s-h*r,c=l*r+h*n-o*s,p=l*s+o*r-a*n,d=-o*n-a*r-h*s;i.x=u*l+d*-o+c*-h-p*-a,i.y=c*l+d*-a+p*-o-u*-h,i.z=p*l+d*-h+u*-a-c*-o}var at=require("nebula/math/quaternion"),ht=i(1e3),lt=-1,ut=(t(),at.create()),ct={create:t,temp:e,array:i,copy:n,add:r,subtract:s,multiply:o,divide:a,addNumber:h,subtractNumber:l,multiplyNumber:u,divideNumber:c,radians:p,degrees:d,sin:f,cos:m,tan:g,asin:y,acos:v,atan:x,pow:b,exp:w,log:_,exp2:T,log2:E,abs:S,sign:A,floor:C,ceil:P,fract:M,mod:O,min:R,minNumber:k,max:I,maxNumber:D,clamp:L,clampNumber:F,mix:B,mixNumber:N,step:G,stepNumber:q,smoothStep:z,smoothStepNumber:U,invert:j,length:H,normalize:W,resize:Y,truncateLength:X,clampLength:K,dot:V,cross:Z,rotate:J,isZero:Q,notZero:$,lessThan:tt,lessThanEqual:et,greaterThan:it,greaterThanEqual:nt,equals:rt,applyMatrix4:st,applyQuaternion:ot};return ct.ZERO=t(),ct}),define("nebula/math/point2",function(){"use strict";function t(t,e){return{x:t||0,y:e||0}}function e(t,e){g=(g+1)%m.length;var i=m[g];return i.x=t||0,i.y=e||0,i}function i(e,i,n){for(var r=new Array(e),s=0;e>s;s++)r[s]=t(i,n);return r}function n(e){return t(e.x,e.y)}function r(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y}function s(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y}function o(t,e,i){var n=e.x-t.x,r=e.y-t.y,s=Math.sqrt(n*n+r*r);s?(i.x=n/s,i.y=r/s):i.x=i.y=0}function a(t,e,i){i.x=t.x*e.x,i.y=t.y*e.y}function h(t,e,i){i.x=t.x*e,i.y=t.y*e}function l(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}function u(t,e,i){i.x=(t.x+e.x)/2,i.y=(t.y+e.y)/2}function c(t,e){var i=t.length;for(e.x=e.y=0;i--;)e.x+=t[i].x,e.y+=t[i].y;e.x/=t.length,e.y/=t.length}function p(t,e){return Math.atan2(t.y-e.y,t.x-e.x)}function d(t,e,i,n){var r=Math.cos(i),s=Math.sin(i),o=t.x-e.x,a=t.y-e.y;n.x=e.x+o*r-a*s,n.y=e.y+o*s+a*r}function f(t,e){return t.x*e.y-t.y*e.x}var m=i(1e3),g=-1,y={create:t,temp:e,array:i,copy:n,move:r,difference:s,direction:o,scale:a,scaleNumber:h,distance:l,midpoint:u,centroid:c,angle:p,rotate:d,cross:f};return y.ZERO=t(),y}),define("nebula/math/point3",function(){"use strict";function t(t,e,i){return{x:t||0,y:e||0,z:i||0}}function e(t,e,i){p=(p+1)%c.length;var n=c[p];return n.x=t||0,n.y=e||0,n.z=i||0,n}function i(e,i,n,r){for(var s=new Array(e),o=0;e>o;o++)s[o]=t(i,n,r);return s}function n(e,i){return i?(i.x=e.x,i.y=e.y,void(i.z=e.z)):t(e.x,e.y,e.z)}function r(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z}function s(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z}function o(t,e,i){var n=e.x-t.x,r=e.y-t.y,s=e.z-t.z,o=Math.sqrt(n*n+r*r+s*s);o?(i.x=n/o,i.y=r/o,i.z=s/o):i.x=i.y=i.z=0}function a(t,e,i){i.x=t.x*e.x,i.y=t.y*e.y,i.z=t.z*e.z}function h(t,e,i){i.x=t.x*e,i.y=t.y*e,i.z=t.z*e}function l(t,e){var i=t.x-e.x,n=t.y-e.y,r=t.z-e.z;return Math.sqrt(i*i+n*n+r*r)}function u(t,e,i){i.x=(t.x+e.x)/2,i.y=(t.y+e.y)/2,i.z=(t.z+e.z)/2}var c=i(1e3),p=-1,d={create:t,temp:e,array:i,copy:n,move:r,difference:s,direction:o,scale:a,scaleNumber:h,distance:l,midpoint:u};return d.ZERO=t(),d}),define("nebula/math/matrix2d",function(){"use strict";function t(t,e,i,n,r,s){return t="undefined"!=typeof t?t:1,n="undefined"!=typeof n?n:1,{a:t,b:e||0,c:i||0,d:n,e:r||0,f:s||0}}function e(e){return t(e.a,e.b,e.c,e.d,e.e,e.f)}function i(t){return 1===t.a&&0===t.b&&0===t.c&&1===t.d&&0===t.e&&0===t.f}function n(t){t.a=1,t.b=0,t.c=0,t.d=1,t.e=0,t.f=0}function r(t,e){var i=t.a,n=t.b,r=t.c,s=t.d,o=t.e,a=t.f,h=i*s-n*r;return h?(h=1/h,e.a=s*h,e.b=-n*h,e.c=-r*h,e.d=i*h,e.e=(r*a-s*o)*h,void(e.f=(n*o-i*a)*h)):void(e.a=e.b=e.c=e.d=e.e=e.f=null)}function s(t){return t.a*t.d-t.b*t.c}function o(t,e,i){var n=t.a,r=t.b,s=t.c,o=t.d,a=t.e,h=t.f,l=e.a,u=e.b,c=e.c,p=e.d,d=e.e,f=e.f;i.a=n*l+s*u,i.b=r*l+o*u,i.c=n*c+s*p,i.d=r*c+o*p,i.e=n*d+s*f+a,i.f=r*d+o*f+h}function a(t,e,i,n,r,s,o,a){var h=t.a,l=t.b,u=t.c,c=t.d,p=t.e,d=t.f;a.a=h*e+u*i,a.b=l*e+c*i,a.c=h*n+u*r,a.d=l*n+c*r,a.e=h*s+u*o+p,a.f=l*s+c*o+d}function h(t,e,i){var n=t.a,r=t.b,s=t.c,o=t.d,a=t.e,h=t.f,l=Math.sin(e),u=Math.cos(e);i.a=n*u+s*l,i.b=r*u+o*l,i.c=n*-l+s*u,i.d=r*-l+o*u,i.e=a,i.f=h}function l(t,e,i){a(t,e.x,-e.y,e.y,e.x,0,0,i)}function u(t,e,i){var n=n[0],r=n[1],s=n[2],o=n[3],a=n[4],h=n[5],l=e.x,u=e.y;i.a=n*l,i.b=r*l,i.c=s*u,i.d=o*u,i.e=a,i.f=h}function c(t,e,i,n){var r=r[0],s=r[1],o=r[2],a=r[3],h=r[4],l=r[5];n.a=r*e,n.b=s*e,n.c=o*i,n.d=a*i,n.e=h,n.f=l}function p(t,e,i){var n=t.a,r=t.b,s=t.c,o=t.d,a=t.e,h=t.f,l=e.x,u=e.y;i.a=n,i.b=r,i.c=s,i.d=o,i.e=n*l+s*u+a,i.f=r*l+o*u+h}function d(t,e,i,n){var r=t.a,s=t.b,o=t.c,a=t.d,h=t.e,l=t.f;n.a=r,n.b=s,n.c=o,n.d=a,n.e=r*e+o*i+h,n.f=s*e+a*i+l}function f(t,e,i){var n=e.x,r=e.y;i.x=t.a*n+t.b*r+t.e,i.y=t.c*n+t.d*r+t.f}return{create:t,copy:e,isIdentity:i,identity:n,invert:r,determinant:s,multiply:o,multiplyNumber:a,rotate:h,rotate2:l,scale:u,scaleNumber:c,translate:p,translateNumber:d,transformVector:f}}),define("nebula/math/matrix4",function(){"use strict";function t(t,e,i,r,s,o,a,h,l,u,c,p,d,f,m,g){if(null==t){var y=new Array(16);return n(y),y}return[t,e,i,r,s,o,a,h,l,u,c,p,d,f,m,g]}function e(t,e){if(!e)return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]];for(var i=0;16>i;i++)e[i]=t[i]}function i(t){return 1===out[0]&&0===out[1]&&0===out[2]&&0===out[3]&&0===out[4]&&1===out[5]&&0===out[6]&&0===out[7]&&0===out[8]&&0===out[9]&&1===out[10]&&0===out[11]&&0===out[12]&&0===out[13]&&0===out[14]&&1===out[15]}function n(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}function r(t,e,i){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],h=t[5],l=t[6],u=t[7],c=t[8],p=t[9],d=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15],x=e[0],b=e[1],w=e[2],_=e[3];i[0]=x*n+b*a+w*c+_*m,i[1]=x*r+b*h+w*p+_*g,i[2]=x*s+b*l+w*d+_*y,i[3]=x*o+b*u+w*f+_*v,x=e[4],b=e[5],w=e[6],_=e[7],i[4]=x*n+b*a+w*c+_*m,i[5]=x*r+b*h+w*p+_*g,i[6]=x*s+b*l+w*d+_*y,i[7]=x*o+b*u+w*f+_*v,x=e[8],b=e[9],w=e[10],_=e[11],i[8]=x*n+b*a+w*c+_*m,i[9]=x*r+b*h+w*p+_*g,i[10]=x*s+b*l+w*d+_*y,i[11]=x*o+b*u+w*f+_*v,x=e[12],b=e[13],w=e[14],_=e[15],i[12]=x*n+b*a+w*c+_*m,i[13]=x*r+b*h+w*p+_*g,i[14]=x*s+b*l+w*d+_*y,i[15]=x*o+b*u+w*f+_*v}function s(t,e,i,n){var r=i.x,s=i.y,o=i.z,a=Math.sqrt(r*r+s*s+o*o);if(0!==a){a=1/a,r*=a,s*=a,o*=a;var h=Math.sin(e),l=Math.cos(e),u=1-l,c=t[0],p=t[1],d=t[2],f=t[3],m=t[4],g=t[5],y=t[6],v=t[7],x=t[8],b=t[9],w=t[10],_=t[11],T=r*r*u+l,E=s*r*u+o*h,S=o*r*u-s*h,A=r*s*u-o*h,C=s*s*u+l,P=o*s*u+r*h,M=r*o*u+s*h,O=s*o*u-r*h,R=o*o*u+l;n[0]=c*T+m*E+x*S,n[1]=p*T+g*E+b*S,n[2]=d*T+y*E+w*S,n[3]=f*T+v*E+_*S,n[4]=c*A+m*C+x*P,n[5]=p*A+g*C+b*P,n[6]=d*A+y*C+w*P,n[7]=f*A+v*C+_*P,n[8]=c*M+m*O+x*R,n[9]=p*M+g*O+b*R,n[10]=d*M+y*O+w*R,n[11]=f*M+v*O+_*R,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15])}}var o=t();return n(o),{create:t,copy:e,isIdentity:i,identity:n,multiply:r,rotation:s,IDENTITY:o}}),define("nebula/math/transformations",function(){"use strict";function t(t,e,s,o){r.a=e.x,r.b=e.y,r.c=-e.y,r.d=e.x,r.e=-i.dot(s,e),r.f=-(s.x*-e.y+s.y*e.x),n.transformVector(r,t,o)}function e(t,e,i){n.identity(r),n.rotate2(r,e,r),n.transformVector(r,t,i)}var i=require("nebula/math/vector2"),n=require("nebula/math/matrix2d"),r=n.create();return{pointToLocalSpace:t,vectorToWorldSpace:e}}),define("nebula/math/geometry",["nebula/math/vector2","nebula/math/vector3","nebula/math/point2","nebula/math/point3"],function(t,e,i,n){"use strict";function r(t,e,i,n,r){return!(t.x<e||t.x>e+n||t.y<i||t.y>i+r)}function s(t,e,i){var n=(t.x-e.x)*i.x+(t.y-e.y)*i.y;if(0>=n){var r=t.x-e.x,s=t.y-e.y;return Math.sqrt(r*r+s*s)}var r=t.x-e.x-n*i.x,s=t.y-e.y-n*i.y;return Math.sqrt(r*r+s*s)}function o(e,n,r,s,o){var a=t.temp();i.difference(e,n,a);var h=t.dot(a,r);if(0>h||h>s)return!1;var l=h/s*o,u=H.length(a.x-h*r.x,a.y-h*r.y);return l>u}function a(t,e,i,n){var r=(t.x-e.x)*i.x+(t.y-e.y)*i.y;0>=r?(n.x=e.x,n.y=e.y):(n.x=e.x+r*i.x,n.y=e.y+r*i.y)}function h(e,n,r,s){var o=i.distance(n,r);if(0===o)return s.x=n.x,void(s.y=n.y);var a=t.temp();i.difference(r,n,a);var h=((e.x-n.x)*a.x+(e.y-n.y)*a.y)/(o*o);0>=h?(s.x=n.x,s.y=n.y):h>=1?(s.x=r.x,s.y=r.y):(s.x=n.x+a.x*h,s.y=n.y+a.y*h)}function l(t,e,r){var s=i.distance(e,r);if(0===s)return i.distance(t,e);var o=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/(s*s);if(0>=o)return i.distance(t,e);if(o>=1)return i.distance(t,r);var a=n.temp(e.x+o*(r.x-e.x),e.y+o*(r.y-e.y));return i.distance(t,a)}function u(t,e,i){var n=e.x-i.x,r=e.y-i.y,s=e.z-i.z,o=Math.sqrt(n*n+r*r+s*s);if(0===o)return n=t.x-e.x,r=t.y-e.y,s=t.z-e.z,Math.sqrt(n*n+r*r+s*s);var a=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y)+(t.z-e.z)*(i.z-e.z))/o;return 0>=a?(n=t.x-e.x,r=t.y-e.y,s=t.z-e.z,Math.sqrt(n*n+r*r+s*s)):a>=1?(n=t.x-i.x,r=t.y-i.y,s=t.z-i.z,Math.sqrt(n*n+r*r+s*s)):(n=t.x-(e.x+a*(i.x-e.x)),r=t.y-(e.y+a*(i.y-e.y)),s=t.z-(e.z+a*(i.z-e.z)),Math.sqrt(n*n+r*r+s*s))}function c(t,e,i,n,r){var s=t.x,o=t.y,a=Math.max(Math.min(s,e+n),e),h=Math.max(Math.min(o,i+r),i);return Math.sqrt((s-a)*(s-a)+(o-h)*(o-h))}function p(t,e,i,n,r,s){s.x=Math.max(e,Math.min(t.x,e+n)),s.y=Math.max(i,Math.min(t.y,i+r))}function d(e,n,s,o,a,h){if(!r(e,n,s,o,a))return h.x=e.x,void(h.y=e.y);var l=o/2,u=a/2,c=i.temp(n+l,s+u),p=t.temp();i.difference(e,c,p);var d=Math.abs(p.x),f=Math.abs(p.y),m=Math.sign(p.x),g=Math.sign(p.y);d>f?(h.x=c.x+l*m,h.y=c.y+p.y*l/d):(h.y=c.y+u*g,h.x=c.x+p.x*u/f)}function f(t,e,n,s,o,a,h){p(t,e,n,s,o,h),r(h,e,n,a,a)?g(h,i.temp(e+a,n+a),a,h):r(h,e+s-a,n,a,a,a)?g(h,i.temp(e+s-a,n+a),a,h):r(h,e,n+o-a,a,a,a)?g(h,i.temp(e+a,n+o-a),a,h):r(h,e+s-a,n+o-a,a,a,a)&&g(h,i.temp(e+s-a,n+o-a),a,h)}function m(t,e,n){return i.distance(t,e)<n}function g(t,e,n,r){i.distance(t,e)<=n?(r.x=t.x,r.y=t.y):(i.direction(e,t,r),r.x=e.x+r.x*n,r.y=e.y+r.y*n)}function y(t,e,n,r){i.distance(t,e)<n?(i.direction(e,t,r),r.x=e.x+r.x*n,r.y=e.y+r.y*n):(r.x=t.x,r.y=t.y)}function v(e,i){for(var n=0,r=t.temp(1,0),s=0;s<i.length;s++){var o=(s+1)%i.length;x(e,r,i[s],i[o])&&(n+=1)}return n%2===1}function x(t,e,i,n,r){var s=(n.x-i.x)*-e.y+(n.y-i.y)*e.x;if(0===s)return!1;var o=((n.x-i.x)*(t.y-i.y)-(t.x-i.x)*(n.y-i.y))/s,a=((t.x-i.x)*-e.y+(t.y-i.y)*e.x)/s;return a>=0&&1>=a&&o>=0?(r&&(r.x=i.x+(n.x-i.x)*a,r.y=i.y+(n.y-i.y)*a),!0):!1}function b(t,e,i,n,r,s){var o=1/e.x,a=1/e.y,h=(i-t.x)*o,l=(i+r-t.x)*o,u=(n+s-t.y)*a,c=(n-t.y)*a,p=Math.max(Math.min(h,l),Math.min(u,c)),d=Math.min(Math.max(h,l),Math.max(u,c));return!(0>d||p>d)}function w(t,e,i,n){var r=t.x,s=t.y,o=e.x,a=e.y,h=i.x,l=i.y,u=n.x,c=n.y,p=(o-r)*(c-l)-(a-s)*(u-h);if(0===p)return!1;var d=((s-l)*(u-h)-(r-h)*(c-l))/p,f=((s-l)*(o-r)-(r-h)*(a-s))/p;return d>=0&&1>=d&&f>=0&&1>=f}function _(t,e,n,r,s){var o=t.x,a=t.y,h=e.x,l=e.y,u=n.x,c=n.y,p=r.x,d=r.y,f=(h-o)*(d-c)-(l-a)*(p-u);if(0===f)return 0;var m=((a-c)*(p-u)-(o-u)*(d-c))/f,g=((a-c)*(h-o)-(o-u)*(l-a))/f;return m>0&&1>m&&g>0&&1>g?(s.x=t.x+m*(e.x-t.x),s.y=t.y+m*(e.y-t.y),i.distance(t,e)*m):0}function T(t,e,i,n){return Math.max(l(i,t,e)-n,0)}function E(t,e,i,n){return l(i,t,e)<n}function S(t,e,i,n){var r=t.x-i.x,s=t.y-i.y;return(e+n)*(e+n)>r*r+s*s}function A(t,e,i,n,r,s){var o=Math.abs(t.x-i),a=Math.abs(t.y-n);return o>r/2+e||a>s/2+e?!1:r/2>=o||s/2>=a?!0:e*e>=(o-r/2)*(o-r/2)+(a-s/2)*(a-s/2)}function C(t,e,i,n,r,s,o,a){return!(t>r+o||r>t+i||e>s+a||s>e+n)}function P(e,n,r,s,o){var a=t.temp();i.difference(r,e,a);var h=a.x*a.x+a.y*a.y,l=n*n;if(l>=h)return!1;var u=1/h,c=Math.sqrt(Math.abs(h-l));return s.x=e.x+n*(n*a.x-a.y*c)*u,s.y=e.y+n*(n*a.y+a.x*c)*u,o.x=e.x+n*(n*a.x+a.y*c)*u,o.y=e.y+n*(n*a.y-a.x*c)*u,!0}function M(e,n,r,s,o){var a=t.temp();i.difference(r.oldPosition,n.oldPosition,a);var h=t.length(a);if(o>h){var l=.5*(o-h);return t.resize(a,l,a),n.position.x-=a.x,n.position.y-=a.y,r.position.x+=a.x,r.position.y+=a.y,e}var u=s-h,c=o-h,p=e*(u?c/u:0),d=e-p;return n.position.x=n.oldPosition.x+n.velocity.x*p,n.position.y=n.oldPosition.y+n.velocity.y*p,r.position.x=r.oldPosition.x+r.velocity.x*p,r.position.y=r.oldPosition.y+r.velocity.y*p,d}function O(t,i,r,s,o){var a=e.temp();n.difference(r.oldPosition,i.oldPosition,a);var h=e.length(a);if(o>h){var l=.5*(o-h);return e.resize(a,l,a),i.position.x-=a.x,i.position.y-=a.y,i.position.z-=a.z,r.position.x+=a.x,r.position.y+=a.y,r.position.z+=a.z,t}var u=s-h,c=o-h,p=t*(u?c/u:0),d=t-p;return i.position.x=i.oldPosition.x+i.velocity.x*p,i.position.y=i.oldPosition.y+i.velocity.y*p,i.position.z=i.oldPosition.z+i.velocity.z*p,r.position.x=r.oldPosition.x+r.velocity.x*p,r.position.y=r.oldPosition.y+r.velocity.y*p,r.position.z=r.oldPosition.z+r.velocity.z*p,d}function R(e,n,r){var s=t.temp(),o=l(n.oldPosition,r.from,r.to),a=l(n.position,r.from,r.to),h=a-o,u=h?e*(n.radius-o)/h:0,c=e-u;return i.difference(n.position,n.oldPosition,s),n.position.x=n.oldPosition.x+s.x*u,n.position.y=n.oldPosition.y+s.y*u,c}function k(e,n,r){var s=i.temp();h(n.position,r.from,r.to,s);var o=t.temp();i.difference(n.position,s,o);var a=t.length(o);if(!(a>=n.radius)){var l=R(e,n,r),u=t.temp();t.reflect(n.velocity,r.normal,u),n.position.x=n.position.x+u.x*l,n.position.y=n.position.y+u.y*l,n.velocity.x=u.x,n.velocity.y=u.y}}function I(e,n,r){var s=t.temp();i.difference(n.position,r.position,s);var o=t.length(s),a=n.radius+r.radius;if(!(o>=a)){var h=M(e,n,r,o,a),l=t.temp();t.normalize(s,l);var u=t.temp();t.perpendicular(l,u);var c=t.dot(l,n.velocity),p=t.dot(u,n.velocity),d=t.dot(l,r.velocity),f=t.dot(u,r.velocity),m=(c*(n.mass-r.mass)+2*r.mass*d)/(r.mass+n.mass),g=(d*(r.mass-n.mass)+2*n.mass*c)/(r.mass+n.mass),y=t.temp(g*l.x,g*l.y),v=t.temp(f*u.x,f*u.y),x=t.temp(m*l.x,m*l.y),b=t.temp(p*u.x,p*u.y),w=t.temp(x.x+b.x,x.y+b.y),_=t.temp(y.x+v.x,y.y+v.y);n.position.x=n.position.x+w.x*h,n.position.y=n.position.y+w.y*h,r.position.x=r.position.x+_.x*h,r.position.y=r.position.y+_.y*h,n.velocity.x=w.x,n.velocity.y=w.y,r.velocity.x=_.x,r.velocity.y=_.y}}function D(e,n,r){i.direction(e,n,r),t.perpendicular(r,r)}function L(t,e,i,n){var r,s,o,a,h,l;r=e.x-t.x,s=e.y-t.y,o=e.z-t.z,a=i.x-t.x,h=i.y-t.y,l=i.z-t.z,n.x=s*l-o*h,n.y=o*a-r*l,n.z=r*h-s*a}function F(t,e,i,n,r){var s,o,a,h,l,u,c,p,d,f,m,g;s=e.x-t.x,o=e.y-t.y,a=e.z-t.z,h=i.x-t.x,l=i.y-t.y,u=i.z-t.z,c=i.x-t.x,p=i.y-t.y,d=i.z-t.z,f=n.x-t.x,m=n.y-t.y,g=n.z-t.z,r.x=.5*(o*u-a*l+p*g-d*m),r.y=.5*(a*h-s*u+d*f-c*g),r.z=.5*(s*l-o*h+c*m-p*f);var y=Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);y>0&&(r.x/=y,r.y/=y,r.z/=y)}function B(t,e,i,n,r){var s,o,a,h,l,u,c,p,d,f,m,g,y,v,x,b,w,_,T,E,S,A,C,P,M,O,R,k=t.x,I=t.y,D=t.z,L=e.x,F=e.y,B=e.z,N=i.x,G=i.y,q=i.z,z=n.x,U=n.y,j=n.z;return y=N-L,v=G-F,x=q-B,b=z-L,w=U-F,_=j-B,T=k-L,E=I-F,S=D-B,s=y*T+v*E+x*S,o=b*T+w*E+_*S,0>=s&&0>=o?(r.x=L,r.y=F,void(r.z=B)):(A=k-N,C=I-G,P=D-q,a=y*A+v*C+x*P,h=b*A+w*C+_*P,a>=0&&a>=h?(r.x=N,r.y=G,void(r.z=q)):(f=s*h-a*o,0>=f&&s>=0&&0>=a?(c=s/(s-a),r.x=L+c*y,r.y=F+c*v,void(r.z=B+c*x)):(M=k-z,O=I-U,R=D-j,l=y*M+v*O+x*R,u=b*M+w*O+_*R,u>=0&&u>=l?(r.x=z,r.y=U,void(r.z=j)):(d=l*o-s*u,0>=d&&o>=0&&0>=u?(m=o/(o-u),r.x=L+m*b,r.y=F+m*w,void(r.z=B+m*_)):(p=a*u-l*h,0>=p&&h-a>=0&&l-u>=0?(m=(h-a)/(h-a+l-u),r.x=N+m*(z-N),r.y=G+m*(U-G),void(r.z=q+m*(j-q))):(g=1/(p+d+f),c=d*g,m=f*g,r.x=L+y*c+b*m,r.y=F+v*c+w*m,void(r.z=B+x*c+_*m)))))))}function N(t,e,i,n,r,s){B(t,i,n,r,s);var o=s.x-t.x,a=s.y-t.y,h=s.z-t.z;return e*e>o*o+a*a+h*h}function G(t,e,i,n,r){return u(t,i,n)<e+r}function q(e,n,r,s){var o,a,h=t.temp(),l=t.temp(),u=t.temp();t.subtract(n,e,h),t.subtract(s,r,l),t.subtract(e,r,u);var c=t.dot(h,h),p=t.dot(l,l),d=t.dot(l,u);if(0===c&&0===p)return i.distance(e,r);if(0===c)o=0,a=W(d/p,0,1);else{var f=t.dot(h,u);if(0===p)a=0,o=W(-f/c,0,1);else{var m=t.dot(h,l),g=c*p-m*m;o=0!=g?W((m*d-f*p)/g,0,1):0,a=(m*o+d)/p,0>a?(a=0,o=W(-f/c,0,1)):a>1&&(a=1,o=W((m-f)/c,0,1))}}var y=i.temp(),v=i.temp();return y.x=e.x+h.x*o,y.y=e.y+h.y*o,v.x=r.x+l.x*a,v.y=r.y+l.y*a,i.distance(y,v)}function z(t,i,r,s){var o,a,h=e.temp(),l=e.temp(),u=e.temp();e.subtract(i,t,h),e.subtract(s,r,l),e.subtract(t,r,u);var c=e.dot(h,h),p=e.dot(l,l),d=e.dot(l,u);if(0===c&&0===p)return n.distance(t,r);if(0===c)o=0,a=W(d/p,0,1);else{var f=e.dot(h,u);if(0===p)a=0,o=W(-f/c,0,1);else{var m=e.dot(h,l),g=c*p-m*m;o=0!=g?W((m*d-f*p)/g,0,1):0,a=(m*o+d)/p,0>a?(a=0,o=W(-f/c,0,1)):a>1&&(a=1,o=W((m-f)/c,0,1))}}var y=n.temp(),v=n.temp();return y.x=t.x+h.x*o,y.y=t.y+h.y*o,y.z=t.z+h.z*o,v.x=r.x+l.x*a,v.y=r.y+l.y*a,v.z=r.z+l.z*a,n.distance(y,v)}function U(t,e,i,n,r){return q(t,e,i,n)<r}function j(t,e,i,n,r,s){return z(t,e,n,r)<i+s}var H=require("nebula/numbers"),W=require("nebula/numbers").clamp;return{pointInRectangle:r,pointRayDistance:s,pointInCone2:o,nearestPointOnRay:a,nearestPointOnSegment2:h,pointSegmentDistance2:l,pointSegmentDistance3:u,pointRectangleDistance:c,clampPointInRectangle:p,clampPointInRoundedRectangle:f,clampPointOutsideRectangle:d,pointInCircle:m,clampPointInCircle:g,clampPointOutsideCircle:y,pointInPolygon:v,raySegmentIntersect:x,rayRectangleIntersect:b,segmentsIntersect:w,segmentsIntersectionPoint:_,segmentCircleDistance:T,segmentCircleIntersect:E,circlesIntersect:S,circleRectangleIntersect:A,rectanglesIntersect:C,tangentPoints:P,separateCircles:M,separateSpheres:O,separateCircleWall:R,resolveCirclesCollision:I,resolveCircleWallCollision:k,segmentNormal:D,triangleNormal:L,quadNormal:F,closestPointToTriangle:B,testSphereTriangle:N,sphereCapsuleIntersect:G,segmentsDistance2:q,segmentsDistance3:z,segmentCapsuleIntersect2:U,capsulesIntersect3:j}}),define("nebula/physics2",function(){"use strict";function t(t,e,i){return.5*Math.asin(i*t/(e*e))}function e(t,e,i){return t/(e*Math.cos(i))}function i(t,e,i){return t*t*Math.sin(2*e)/i}function n(t,e,i,n){var r=h.distance(t,e);if(!r)return 0;if(!n)return i?r/i:-1;var s=i*i+2*n*r;return 0>s?-1:(Math.sqrt(s)-i)/n}function r(t,e,i){return e?.5*e*i*i+t*i:t*i}function s(t,e,i,n,r){var s=l.temp();l.normalize(e,s),r.x=t.x+.5*s.x*i*n*n+e.x*n,r.y=t.y+.5*s.y*i*n*n+e.y*n}function o(t,e,i,n,r){r.x=t.x+.5*i.x*n*n+e.x*n,r.y=t.y+.5*i.y*n*n+e.y*n}function a(t,e,i,n,r){for(var s=r.length-1,a=0;s>=a;a++)o(t,e,i,a/s*n,r[a])}var h=require("nebula/math/point2"),l=require("nebula/math/vector2");return{angleOfReach:t,timeOfFlight:e,distanceTraveled:i,timeToCoverDistance:n,range:r,futurePosition:s,futurePosition2:o,trajectory:a}}),define("nebula/physics3",function(){"use strict";function t(t,e,i,n){var s=r.distance(t,e);return s?n?(Math.sqrt(i*i+2*n*s)-i)/n:i?s/i:-1:0}function e(t,e,i,n,r){var o=s.temp();s.normalize(e,o),r.x=t.x+.5*o.x*i*n*n+e.x*n,r.y=t.y+.5*o.y*i*n*n+e.y*n,r.z=t.z+.5*o.z*i*n*n+e.z*n}function i(t,e,i,n,r){r.x=t.x+.5*i.x*n*n+e.x*n,r.y=t.y+.5*i.y*n*n+e.y*n,r.z=t.z+.5*i.z*n*n+e.z*n}function n(t,e,n,r,s){for(var o=s.length-1,a=0;o>=a;a++)i(t,e,n,a/o*r,s[a])}var r=require("nebula/math/point3"),s=require("nebula/math/vector3");return{timeToCoverDistance:t,futurePosition:e,futurePosition2:i,trajectory:n}}),define("nebula/tweens",function(){"use strict";function t(t,e){if(!t)return e||c.linear;if("string"==typeof t){var i=require.optionally(t);return i?i:require("nebula/easings."+t)}if("function"==typeof t)return t;throw new Error("Invalid easing specified: "+t)}function e(t,e){return t>e}function i(t,e){var i=t[0],n=t[1];return n?i.call(n,e):i(e),!1}function n(t,e){for(var i=0;i<t.length;i++){var n=t[i].object,r=t[i].property;n[r]=t[i].to}return!1}function r(t,e,i){for(var n=0,r=0;r<t.length;r++){var s,o=t[r],a=o.object,h=o.property,l=o.key;null==o.from?(l in i||(i[l]=a[h]),s=i[l]):s=o.from;var u=p.clamp((e-o.delay)/o.duration,0,1),c=s+(o.to-s)*o.easing(u);a[h]=c,n=Math.max(n,o.delay+o.duration)}return n>e}function s(t){this.object=t,this.events=[],this.repeatCount=1,this.paused=!1,this.cancelled=!1,this.event=0,this.time=0,this.iteration=1,this.store={}}function o(t){for(var e=d.length;--e>=0;)d[e].update(t)===!1&&d.splice(e,1)}function a(t){var e=new s(t);return d.push(e),e}function h(t){d.indexOf(t)>=0&&l(t),t.event=0,t.paused=!1,d.push(t)}function l(t){var e=d.indexOf(t);e>=0&&d.splice(e,1)}var u=require("nebula/objects"),c=require("nebula/easings"),p=require("nebula/numbers"),d=[];return s.prototype.stop=function(){this.event=this.time=0,this.iteration=1,this.store={},this.paused=!0},s.prototype.update=function(t){if(this.cancelled)return this.cancelled=!1,!1;if(this.paused)return!0;var e=this.events[this.event];return e[0](e[1],this.time,this.store)===!1&&(this.event+=1,this.time=0,this.store={},this.event===this.events.length&&this.iteration<this.repeatCount&&(this.iteration+=1,this.event=0)),this.time+=t,this.event<this.events.length},s.prototype.set=s.prototype.from=function(t){var e,i,r=[];for(var s in t){if(-1!==s.indexOf(".")){var o=u.getProperty(this.object,s);e=o.parent,i=o.property}else e=this.object,i=s;r.push({object:e,property:i,to:t[s]})}return this.events.push([n,r]),this},s.prototype.wait=function(t){return this.events.push([e,t]),this},s.prototype.call=function(t,e){return this.events.push([i,[t,e]]),this},s.prototype.to=function(e,i,n){var s,o,a,h,l=t(n),c=[];for(var p in e){if(a=h=e[p],-1!==p.indexOf(".")){var d=u.getProperty(this.object,p);s=d.parent,o=d.property}else s=this.object,o=p;"number"==typeof h?c.push({object:s,key:p,property:o,from:null,to:h,delay:0,duration:i,easing:l}):c.push({object:s,key:p,property:o,from:"from"in a?a.from:null,to:a.to,delay:"delay"in a?a.delay:0,duration:"duration"in a?a.duration:i,easing:t(a.easing,l)})}return this.events.push([r,c]),this},s.prototype.repeat=function(t){return this.repeatCount=t,this},{Timeline:s,timelines:d,update:o,create:a,play:h,stop:l}}),define("nebula/input/key",function(){"use strict";function t(t,e,i,n){this.code=t,this.name=e,this.codeName=i||"key"+t,this.location=null!=n?n:KeyboardEvent.DOM_KEY_LOCATION_STANDARD,this.isLocked=!1,this.resetState()}return t.prototype.resetState=function(){this.isUp=!0,this.isDown=!1,this.pressTime=0},t.prototype.lock=function(){this.isLocked=!0},t.prototype.unlock=function(){this.isLocked=!1},Object.defineProperty(t.prototype,"value",{get:function(){return Number(this.isDown)}}),t}),define("nebula/input/keyboard",["nebula/window","nebula/signal","nebula/input/key","nebula/math/vector2"],function(t,e,i,n){"use strict";function r(t){var e=t.keyCode,n=A[e];if(n){if(n.length){for(var r=0;r<n.length;r++)if(n[r].location===t.location)return n[r];return n[0]}}else n=new i(e),C[n.code]=A[e]=n,D.push(n);return n}function s(t){var e=r(t);e.isLocked&&t.preventDefault();var i=e.isUp;e.isUp=!(e.isDown=!0),i?(e.pressTime=0,M.send(e)):O.send(e)}function o(t){var e=r(t);e.isLocked&&t.preventDefault();var i=e.isDown;e.isUp=!(e.isDown=!1),i&&P.send(e)}function a(t){return t.isUp}function h(){return Array.prototype.every.call(arguments,a)}function l(t){return t.isDown}function u(){return Array.prototype.every.call(arguments,l)}function c(){for(var t=0;t<D.length;t++)D[t].resetState()}function p(t){t.lock()}function d(){Array.prototype.forEach.call(arguments,p)}function f(t){t.unlock()}function m(){Array.prototype.forEach.call(arguments,f)}function g(){for(var t=0;t<D.length;t++)D[t].lock()}function y(){for(var t=0;t<D.length;t++)D[t].unlock()}function v(t){for(var e=0;e<D.length;e++)if(D[e].code===t)return D[e].name;return"key"+t}function x(t){for(var e=0;e<D.length;e++)if(D[e].code===t)return D[e].name;return"Key "+t}function b(t){for(var e=t.split(" "),i=0;i<e.length;i++){var n=e[i];if(!(n in C))throw new Error("Invalid key name `"+n+"`");e[i]=C[n]}return e}function w(t){return function(){return"string"==typeof arguments[0]?t.apply(this,b(arguments[0])):t.apply(this,arguments)}}function _(e){e&&(e.lockAll?g():e.lock&&d.apply(void 0,e.lock)),t.addEventListener("blur",c),t.addEventListener("keydown",s),t.addEventListener("keyup",o)}function T(t){for(var e,i=0;i<D.length;i++)e=D[i],e.isDown&&(e.pressTime+=t)}function E(){y(),t.removeEventListener("blur",c),t.removeEventListener("keydown",s),t.removeEventListener("keyup",o)}function S(t,e,i,n){return t=t||C.up,e=e||C.right,i=i||C.down,n=n||C.left,R.x=e.isDown-n.isDown,R.y=i.isDown-t.isDown,R.x&&R.y&&(R.x/=k,R.y/=k),R}for(var A={},C={},P=new e,M=new e,O=new e,R=n.create(),k=Math.sqrt(2),I=(KeyboardEvent.DOM_KEY_LOCATION_STANDARD,KeyboardEvent.DOM_KEY_LOCATION_LEFT,KeyboardEvent.DOM_KEY_LOCATION_RIGHT,KeyboardEvent.DOM_KEY_LOCATION_NUMPAD),D=[new i(8,"Backspace","backspace"),new i(9,"Tab","tab"),new i(12,"Clear","clear"),new i(13,"Enter","enter"),new i(13,"Num Enter","numpadEnter",I),new i(16,"Shift","shift"),new i(17,"Ctrl","ctrl"),new i(18,"Alt","alt"),new i(19,"Pause/Break","pauseBreak"),new i(20,"Caps Lock","capsLock"),new i(27,"Esc","esc"),new i(32,"Space","space"),new i(33,"Page Up","pageUp"),new i(33,"Num Page Up","numpadPageUp",I),new i(34,"Page Down","pageDown"),new i(34,"Num Page Down","numpadPageDown",I),new i(35,"End","end"),new i(35,"Num End","numpadEnd",I),new i(36,"Home","home"),new i(36,"Num Home","numpadHome",I),new i(37,"","left"),new i(37,"Num Left","numpadLeft",I),new i(38,"","up"),new i(38,"Num Up","numpadUp",I),new i(39,"","right"),new i(39,"Num Right","numpadRight",I),new i(40,"","down"),new i(40,"Num Down","numpadDown",I),new i(45,"Insert","insert"),new i(45,"Num Insert","numpadInsert",I),new i(46,"Delete","delete"),new i(46,"Num Delete","numpadDelete",I),new i(47,"Help","help"),new i(48,"0","zero"),new i(49,"1","one"),new i(50,"2","two"),new i(51,"3","three"),new i(52,"4","four"),new i(53,"5","five"),new i(54,"6","six"),new i(55,"7","seven"),new i(56,"8","eight"),new i(57,"9","nine"),new i(65,"A","a"),new i(66,"B","b"),new i(67,"C","c"),new i(68,"D","d"),new i(69,"E","e"),new i(70,"F","f"),new i(71,"G","g"),new i(72,"H","h"),new i(73,"I","i"),new i(74,"J","j"),new i(75,"K","k"),new i(76,"L","l"),new i(77,"M","m"),new i(78,"N","n"),new i(79,"O","o"),new i(80,"P","p"),new i(81,"Q","q"),new i(82,"R","r"),new i(83,"S","s"),new i(84,"T","t"),new i(85,"U","u"),new i(86,"V","v"),new i(87,"W","w"),new i(88,"X","x"),new i(89,"Y","y"),new i(90,"Z","z"),new i(91,"Left Windows","leftWindows"),new i(92,"Right Windows","rightWindows"),new i(93,"Menu","menu"),new i(96,"Num 0","numpad0"),new i(97,"Num 1","numpad1"),new i(98,"Num 2","numpad2"),new i(99,"Num 3","numpad3"),new i(100,"Num 4","numpad4"),new i(101,"Num 5","numpad5"),new i(102,"Num 6","numpad6"),new i(103,"Num 7","numpad7"),new i(104,"Num 8","numpad8"),new i(105,"Num 9","numpad9"),new i(106,"Num *","numpadMultiply"),new i(107,"Num +","numpadAdd"),new i(108,"Num Enter","numpadEnter"),new i(109,"Num -","numpadSubtract"),new i(110,"Num .","numpadDecimal"),new i(111,"Num /","numpadDivide"),new i(112,"F1","f1"),new i(113,"F2","f2"),new i(114,"F3","f3"),new i(115,"F4","f4"),new i(116,"F5","f5"),new i(117,"F6","f6"),new i(118,"F7","f7"),new i(119,"F8","f8"),new i(120,"F9","f9"),new i(121,"F10","f10"),new i(122,"F11","f11"),new i(123,"F12","f12"),new i(124,"F13","f13"),new i(125,"F14","f14"),new i(126,"F15","f15"),new i(144,"Num Lock","numLock"),new i(145,"Scroll Lock","scrollLock"),new i(186,";","semiColon"),new i(187,"=","equals"),new i(188,",","comma"),new i(189,"-","minus"),new i(190,".","period"),new i(191,"/","slash"),new i(192,"`","tilde"),new i(219,"[","openBracket"),new i(220,"\\","backSlash"),new i(221,"]","closeBracket"),new i(222,"'","quote")],L=0;L<D.length;L++){
var F=D[L];if(A[F.code]){var B=A[F.code];B.length?A[F.code].push(F):A[F.code]=[B,F]}else A[F.code]=F;C[F.codeName]=F}return{type:"keyboard",keysByCode:A,parseKeyNames:b,keys:C,enable:_,update:T,disable:E,lock:w(d),unlock:w(m),lockAll:g,unlockAll:y,clearBuffer:c,keyCodeToName:x,keyCodeToCodeName:v,isUp:w(h),isDown:w(u),onUp:P,onDown:M,onDownRepeat:O,direction:w(S)}}),define("nebula/input/gamepad",["nebula/signal","nebula/math/vector2"],function(t,e){"use strict";function i(t){for(var e,i,n,r=t.split(" "),s=0;s<r.length;s++)if(n=r[s],0!==n.indexOf("button")){if(0!==n.indexOf("axisButton"))throw new Error("Invalid button name: "+n);if(i=n.replace("axisButton",""),e=Number(i),""===i||NaN===e||0>e||e>=this.axesButtons.length)throw new Error("Invalid axis button name: "+n);r[s]=this.axesButtons[e]}else{if(i=n.replace("button",""),e=Number(i),""===i||NaN===e||0>e||e>=this.buttons.length)throw new Error("Invalid button name: "+n);r[s]=this.buttons[e]}return r}function n(t){return v.indexOf(t)<0&&v.push(t),t}function r(t){for(var e=0;e<v.length;e++)if(v[e]===t||v[e].remappingFor===t)return v[e];return null}function s(t,e){for(var n,s=0;s<t.length;s++)if(n=t[s]){var o=r(n);o?(x(n),o.lastChecked=e):(n=x(n),n.lastChecked=e,n.parseKeyNames=i,v.push(n),a(n,0),h(n,0),g.send(n))}for(s=v.length;--s>=0;)n=v[s],n.lastChecked!==e&&(v.splice(s,1),n.connected=!1,y.send(n))}function o(t,e,i){e.lastValue!==e.value&&(e.isDown=e.value>d,e.isUp=!e.isDown,e.isDown?(e.pressTime=0,m.send(e,t)):f.send(e,t)),e.isDown&&(e.pressTime+=i),e.lastValue=e.value}function a(t,e){for(var i=0;i<t.buttons.length;i++){var n=t.buttons[i];"undefined"!=typeof n.lastValue?o(t,n,e):(n.lastValue=n.value,n.id=i,n.name="button"+i)}}function h(t,i){var n=e.temp();if(!t.axesButtons){t.axesButtons=[];for(var r=0;r<t.axes.length/2;r++)t.axesButtons[4*r+0]={name:"axisButton"+(4*r+0),id:"axis-"+2*r+"-negative",value:0,lastValue:0,sign:-1},t.axesButtons[4*r+1]={name:"axisButton"+(4*r+1),id:"axis-"+2*r+"-positive",value:0,lastValue:0,sign:1},t.axesButtons[4*r+2]={name:"axisButton"+(4*r+2),id:"axis-"+(2*r+1)+"-negative",value:0,lastValue:0,sign:-1},t.axesButtons[4*r+3]={name:"axisButton"+(4*r+3),id:"axis-"+(2*r+1)+"-positive",value:0,lastValue:0,sign:1}}for(var r=0;r<t.axes.length/2;r++){n.x=t.axes[2*r],n.y=t.axes[2*r+1];var s=e.length(n),a=t.axesButtons[4*r+0],h=t.axesButtons[4*r+1],l=t.axesButtons[4*r+2],u=t.axesButtons[4*r+3];p>s?a.value=h.value=l.value=u.value=0:(s=c.scale(s,p,1,0,1),e.normalize(n,n),e.multiplyNumber(n,s,n),a.value=Math.abs(Math.min(n.x,0)),h.value=Math.max(n.x,0),l.value=Math.abs(Math.min(n.y,0)),u.value=Math.max(n.y,0)),o(t,a,i),o(t,h,i),o(t,l,i),o(t,u,i)}}function l(t){var e=navigator.getGamepads();s(e,window.performance.now());for(var i=0;i<v.length;i++)a(v[i],t),h(v[i],t)}var u=require("settings"),c=require("nebula/numbers"),p=(u("GAMEPAD_DEBUG"),u("GAMEPAD_DEADZONE",.05)),d=Math.sqrt(p),f=new t,m=new t,g=(new t,new t,new t),y=new t,v=[],x=n;return{type:"gamepad",update:l,onUp:f,onDown:m,onConnect:g,onDisconnect:y,storedGamepads:v}}),define("nebula/gui/gui",["settings","swig","nebula/input/keyboard","nebula/signal"],function(t,e,i,n){"use strict";function r(e){e=e||{},this.scale=1,this.stack=[],this.templateCache={},this._controller=null,this.onOpen=new n,this.onClose=new n,this.onRedraw=new n,this.onFocus=new n,this.onSelect=new n,this.onBack=new n,this.onControllerChange=new n,this.container=e.container||document.getElementById(t("GUI_CONTAINER_ID","gui"))||document.body,this.actionWhiteList=["moveFocus","enter","back"],this.back=this.back.bind(this)}return r.prototype.constructor=r,r.prototype.loadTemplate=function(t){return this.templateCache[t]||(this.templateCache[t]=e.compileFile(t)),this.templateCache[t]},r.prototype.push=function(t){this.stack.length&&this.top.widget.classList.remove("top"),this.stack.push(t),this.container.insertAdjacentHTML("beforeend",t.buildTemplate()),t.bindWidgets(),this.top.widget.classList.add("top"),this.onOpen.send(this.top)},r.prototype.removeFromStack=function(t){for(var e=0;e<this.stack.length;e++)if(this.stack[e]===t)return this.stack.splice(e,1),t.blur(),t.close(),t.widget.remove(),this.stack.length&&(this.top.widget.classList.add("top"),this.top.updateWidget()),this.onClose.send(t),t},r.prototype.pop=function(){return this.removeFromStack(this.top)},r.prototype.back=function(){this.stack.length&&this.top.close()},r.prototype.closeAll=function(){for(;this.stack.length;)this.pop()},r.prototype.setController=function(t){t!==this._controller&&(this._controller=t,this.onControllerChange.send())},r.prototype.input=function(t,e){-1!==this.actionWhiteList.indexOf(e.name)&&(this.top&&this.top.input(e.name,t)||"back"===e.name&&(this.onBack.send(this.top),this.back()))},r.prototype.redraw=function(){for(var t=0;t<this.stack.length;t++){var e=this.stack[t],i=e.widget.classList;e._replaceWidget(),e.bindWidgets(),e.setScale();for(var n=0;n<i.length;n++)e.widget.classList.add(i[n])}this.onRedraw.send()},Object.defineProperty(r.prototype,"top",{get:function(){return this.stack[this.stack.length-1]}}),new r}),define("nebula/gui/base",["nebula/gui/gui"],function(t){"use strict";function e(t,e){return"undefined"==typeof t?e:t}function i(n){n=e(n,{}),this.id=e(n.id,"widget-"+i.id++),this.gui=e(n.gui,t),this.classes=n.classes||"",this.focused=!1,this.selected=!1,this.disabled=e(n.disabled,!1),this.data=e(n.data,{}),this.templatePath=e(n.templatePath,this.defaultTemplatePath),this.template,this.label=e(n.label,""),this.widget,this.actions={};for(var r in this.defaultActions){var s=this.defaultActions[r];if(!Array.isArray(s))throw new Error("Invalid defaultActions array for action `"+r+"`");for(var o=0;o<s.length;o++){var a=s[o];if("string"==typeof a){if("function"!=typeof this[a])throw new Error("Invalid callback string");a=this[a]}this.addAction(r,a)}}for(var r in n.actions){var s=n.actions[r];if(s instanceof Array)for(var o=0;o<s.length;o++)this.addAction(r,s[o]);else this.addAction(r,s)}}var n=require("settings"),r=n("DEBUG");return i.id=1,i.prototype.defaultTemplatePath="",i.prototype.defaultActions={},i.prototype.extendDefaultActions=function(t,e){var i={};for(var n in t)i[n]=t[n].slice();for(var n in e)i[n]=(i[n]||[]).concat(e[n]);return i},i.prototype.input=function(t,e){var i=this.actions[t];if(i){for(var n=!1,r=0;r<i.length;r++)i[r].apply(this,[e])&&(n=!0);return n}},i.prototype.addAction=function(t,e){this.actions[t]||(this.actions[t]=[]),this.actions[t].push(e)},i.prototype.removeAction=function(t,e){for(var i=this.actions[t],n=0;n<i.length;n++)i[n]===e&&i.splice(n,1)},i.prototype.bindWidgets=function(t){t||(t=document),this.widget=t.querySelector("#"+this.id),!this.widget&&r&&console.warn("Cannot bind widget. Widget #"+this.id+" not found.")},i.prototype._updateWidget=function(){var t=this.widget.classList;t.toggle("focused",this.focused),t.toggle("disabled",this.disabled),t.toggle("selected",this.selected)},i.prototype.updateWidget=function(){this.widget&&this._updateWidget()},i.prototype._replaceWidget=function(){if(this.widget){var t=document.createElement("div");t.innerHTML=this.html;var e=this.widget,i=t.querySelector("#"+this.id);e.parentNode.replaceChild(i,e),this.widget=i}},i.prototype.focus=function(t){"undefined"==typeof t&&(t=!0),this.focused=!0,this.updateWidget(),t&&this.gui.onFocus.send(this)},i.prototype.blur=function(){this.focused=!1,this.updateWidget()},i.prototype.select=function(){this.selected=!0,this.updateWidget()},i.prototype.unSelect=function(){this.selected=!1,this.updateWidget()},i.prototype.preventActionPropagation=function(){return!0},Object.defineProperty(i.prototype,"html",{get:function(){return this.template||(this.template=this.gui.loadTemplate(this.templatePath)),this.template(this)}}),i}),define("nebula/gui/button",["nebula/gui/base"],function(t){"use strict";function e(e){t.apply(this,arguments)}return e.prototype=Object.create(t.prototype),e.prototype.defaultTemplatePath="gui/button.txt",e.prototype.onEnter=function(){this.gui.onSelect.send(this)},e.prototype.defaultActions=t.prototype.extendDefaultActions(t.prototype.defaultActions,{enter:[e.prototype.onEnter]}),e}),define("nebula/gui/container",["nebula/gui/base","nebula/numbers","nebula/math/point2","nebula/math/vector2"],function(t,e,i,n){"use strict";function r(e){t.apply(this,arguments),this.lastFocusedChild=null,this.children=e.children||[],this.open=this.open.bind(this),this.close=this.close.bind(this),this.showPreviousContainer=e.showPreviousContainer||!1,this.scrolledElements=[],this._animating=!1,this._lastScrollTime=null,this.animateScroll=this.animateScroll.bind(this)}var s=require("settings"),o=s("GAMEPAD_BUTTON_MAP",{}),a=require("nebula/input/keyboard"),h=s("DEBUG");return r.prototype=Object.create(t.prototype),r.prototype.defaultTemplatePath="gui/container.txt",r.prototype.animateScroll=function(){if(!this._animating){this._animating=!0,this._lastScrollTime||(this._lastScrollTime=Date.now());var t=!0,e=Date.now(),i=(e-this._lastScrollTime)/1e3;this._lastScrollTime=e;for(var n=0;n<this.scrolledElements.length;n++){var r=this.scrolledElements[n],s=parseFloat(r.getAttribute("data-scroll-x")),o=parseFloat(r.getAttribute("data-scroll-y")),a=r.currentX||0,h=r.currentY||0,l=s-a,u=o-h;0==l&&0==u||(t=!1,Math.abs(l)<1?a=s:a+=4*l*i,Math.abs(u)<1?h=o:h+=4*u*i,r.style.transform="translate3d("+Math.round(a)+"px, "+Math.round(h)+"px, 0)",r.currentX=a,r.currentY=h)}this._animating=!1,t?this._lastScrollTime=null:requestAnimationFrame(this.animateScroll)}},r.prototype.buildTemplate=function(t){return this.html},r.prototype.add=function(t,e){return e?this.children.unshift(t):this.children.push(t),t.gui=this.gui,this},r.prototype.input=function(e,i){for(var n=!1,r=0;r<this.children.length;r++)this.children[r].focused&&this.children[r].input(e,i)&&(n=!0);return n?!0:t.prototype.input.apply(this,arguments)?!0:void 0},r.prototype.bindWidgets=function(){t.prototype.bindWidgets.apply(this,arguments);for(var e=0;e<this.children.length;e++)this.children[e].bindWidgets(this.widget);this.onControllerChange()},r.prototype.focus=function(){if(t.prototype.focus.apply(this,arguments),this.children.length&&!this.focusedChild)if(this.lastFocusedChild&&this.lastFocusedChild.widget)this.lastFocusedChild.focus(!1);else{for(var e=0;e<this.children.length;e++)if(this.children[e].widget)return this.children[e].focus(!1),void(this.lastFocusedChild=this.children[e]);h&&console.warn("Cannot set focus to child. None visible.")}},r.prototype.blur=function(){for(var e=0;e<this.children.length;e++)this.children[e].blur();t.prototype.blur.apply(this,arguments)},r.prototype.focusChild=function(t){if(this.focused){var e=t.direction||n.create(),i=this.focusedChild||this.lastFocusedChild,r=i;return n.length(e)&&i&&(r=this.findClosest(i,this.children,e)),r&&(i.blur(),r.focus(),this.lastFocusedChild=r),r&&this.scrollToElement(r.widget),r}},r.prototype.scrollToElement=function(t,e){for(var i=t.parentNode;!i.classList.contains("scrollable-content");)if(i=i.parentNode,i===document.body){i=null;break}if(i){this.gui.container.classList.add("no-scale"),e?i.classList.add("instant-scroll"):i.classList.remove("instant-scroll");var n=0,r=0,s=i.parentNode.getBoundingClientRect(),o=t.getBoundingClientRect(),a=i.getBoundingClientRect(),h=parseInt(i.getAttribute("data-padding-x"),10)||0,l=parseInt(i.getAttribute("data-padding-y"),10)||0;n=Math.min(0,s.right-o.right-h)||Math.max(0,s.left-o.left+h),r=Math.min(0,s.bottom-o.bottom-l)||Math.max(0,s.top-o.top+l),n-=s.left-a.left,r-=s.top-a.top,n=Math.min(0,Math.max(n,s.width-a.width)),r=Math.min(0,Math.max(r,s.height-a.height)),this.setScrollPosition(i,n,r),this.gui.container.classList.remove("no-scale")}},r.prototype.setScrollPosition=function(t,e,i){t.setAttribute("data-scroll-x",e),t.setAttribute("data-scroll-y",i),-1===this.scrolledElements.indexOf(t)&&this.scrolledElements.push(t),this.animateScroll()},r.prototype.findClosest=function(t,n,r){var s,o,a,h=1/0,l=null,u=r.x,c=r.y,p=t.widget.getBoundingClientRect();Math.abs(u)<Math.abs(c)?u=0:c=0;for(var d=i.create(p.left+(1+Math.sign(u))*p.width/2,p.top+(1+Math.sign(c))*p.height/2),f=i.create(),m=0;m<n.length;m++)o=n[m],o!==t&&o.widget&&(a=o.widget.getBoundingClientRect(),u>0&&a.left<p.right||0>u&&a.right>p.left||c>0&&a.top<p.bottom||0>c&&a.bottom>p.top||(f.x=e.clamp(d.x,a.left,a.right),f.y=e.clamp(d.y,a.top,a.bottom),s=i.distance(d,f),h>s&&(h=s,l=o)));return l},r.prototype.setScale=function(t){for(var e=this.widget.querySelectorAll(".scalable"),i=0;i<e.length;i++)e[i].style.transform="scale("+(t||this.gui.scale)+", "+(t||this.gui.scale)+")"},r.prototype.updateWidget=function(){if(t.prototype.updateWidget.apply(this,arguments),this.widget){this.setScale();for(var e=0;e<this.children.length;e++)this.children[e].updateWidget()}},r.prototype.onControllerChange=function(){if(this.widget&&this.gui._controller){for(var t=this.widget.querySelectorAll(".key.auto-update, .gamepad-button.auto-update"),e="keyboard"===this.gui._controller.apis[0].type,i=0;i<t.length;i++){var n=t[i].getAttribute("data-action");if(n&&this.gui._controller&&-1!==this.gui._controller.actionNames.indexOf(n)){var r=this.gui._controller[n].condition.str.replace(/[\|\-\+]/,"");e?(t[i].innerHTML=a.keys[r].name,t[i].classList.add("key"),t[i].classList.remove("gamepad-button"),t[i].removeAttribute("data-map")):(t[i].innerHTML=r,t[i].classList.remove("key"),t[i].classList.add("gamepad-button"),t[i].setAttribute("data-map",o[r]||""))}}var h=this.widget.querySelector(".menu-footer .user-status");if(h)for(var l=require("users"),u=s("USER_COLORS"),i=0;i<u.length;i++){var c=h.querySelector(".user-"+i);c.classList.remove("online"),i<l.list.length&&l.list[i].controller&&c.classList.add("online")}}},r.prototype.open=function(){this.gui.push(this),this.showPreviousContainer&&this.previous.widget.classList.add("top"),this.focus(),this.updateWidget(),this.onControllerChange();var t=require("users");t.onConnect(this.onControllerChange,this),t.onDisconnect(this.onControllerChange,this),this.gui.onControllerChange(this.onControllerChange,this),this.focusedChild&&this.scrollToElement(this.focusedChild.widget,!0)},r.prototype.close=function(){this.gui.removeFromStack(this),this.scrolledElements.length=0;var t=require("users");this.gui.onControllerChange.disconnect(this.onControllerChange,this),t.onConnect.disconnect(this.onControllerChange,this),t.onDisconnect.disconnect(this.onControllerChange,this)},r.prototype.defaultActions=t.prototype.extendDefaultActions(t.prototype.defaultActions,{moveFocus:["focusChild"]}),Object.defineProperty(r.prototype,"find",{get:function(){for(var t={},e=0;e<this.children.length;e++)t[this.children[e].id]=this.children[e];return t}}),Object.defineProperty(r.prototype,"focusedChild",{get:function(){for(var t=0;t<this.children.length;t++)if(this.children[t].focused)return this.children[t];return null},set:function(t){if(-1===this.children.indexOf(t))throw new Error("Unknown child");this.focusedChild&&(this.focusedChild.focused=!1),t.focused=!0}}),Object.defineProperty(r.prototype,"selectedChild",{get:function(){for(var t=0;t<this.children.length;t++)if(this.children[t].selected)return this.children[t];return null}}),Object.defineProperty(r.prototype,"previous",{get:function(){for(var t=1;t<this.gui.stack.length;t++)if(this===this.gui.stack[t])return this.gui.stack[t-1];return null}}),r}),define("nebula/states",["nebula/signal","settings","nebula/format"],function(t,e,i){"use strict";function n(){}function r(t,e,i,n,r,s,o,a,h,l){this.machine=t,this.enter(e,i,n,r,s,o,a,h,l)}function s(t){this.owner=t||null,this.current=null,this.previous=null,this._global=null,this["default"]=null,this._cache={},this._queue=[],this.time=0,this._isIdle=!1,p&&(this.history=[])}var o=require("nebula/objects"),a="Cannot remember value for '%s', no such property",h="Cannot restore value for '%s', no such property",l="Value already remembered for property '%s'",u="No state specified for `StateMachine.queue()` method",c="No state specified for `StateMachine.change()` method",p=e("DEBUG"),d=new t;r.extend=function(e,i){try{var n="return function "+e+"(machine, a1, a2, a3, a4, a5, a6, a7, a8, a9) {this.machine = machine;this.enter(a1, a2, a3, a4, a5, a6, a7, a8, a9);};",r=new Function(n)()}catch(s){throw s instanceof SyntaxError?new SyntaxError("Invalid state name, contains illegal characters: "+e):s}return r.parent=this,r.extend=this.extend,r.onEnter=new t,r.onExit=new t,o.inherit(this,r,i),r},r.parent=null,r.onEnter=new t,r.onExit=new t,r.prototype.enter=n,r.prototype.update=n,r.prototype.exit=n,r.prototype.onMessage=n,r.prototype.save=function(t){this._data=new Array(2*(arguments.length-1));for(var e=1,n=arguments.length,r=0;n>e;e++,r+=2){var s=arguments[e];if(!(s in t))throw new Error(i(a,s));if(s in this._data)throw new Error(i(l,s));this._data[r]=s,this._data[r+1]=t[s]}},r.prototype.restore=function(t){for(var e=0,n=this._data.length;n>e;e+=2){var r=this._data[e];if(!(r in t))throw new Error(i(h,r));t[r]=this._data[e+1]}},r.prototype.toString=function(){return String(this.constructor.name)},s.prototype.onMessage=function(t){if(!this._isIdle){var e,i;if(this.current){if(i=this.current[t._methodName],"undefined"!=typeof i){if(i===!0||i===!1)return i;if(e=this.current[t._methodName](this.owner,t),void 0!==e)return e}if(e=this.current.onMessage(this.owner,t),void 0!==e)return e}if(this._global){if(i=this._global[t._methodName],"undefined"!=typeof i){if(i===!0||i===!1)return i;if(e=this._global[t._methodName](this.owner,t),void 0!==e)return e}if(e=this._global.onMessage(this.owner,t),void 0!==e)return e}}},s.prototype.is=function(t){return t===this.current||"function"==typeof t&&this.current instanceof t},s.prototype.global=function(t,e,i,n,r,s,o,a,h){var l=this._global;if(l){l.exit(this.owner),l.constructor.onExit.send(this.owner);for(var u=l.constructor;u=u.parent;)u.onExit.send(this.owner,t);this._cache[l.constructor.name]=l}if(t){this._global=this._cache[t.name],this._global?this._global.enter(this.owner,e,i,n,r,s,o,a,h):this._global=new t(this,this.owner,e,i,n,r,s,o,a,h),t.onEnter.send(this.owner,e,i,n,r,s,o,a,h);for(var u=t;u=u.parent;)u.onEnter.send(this.owner)}else this._global=null;this._isIdle=!Boolean(this.current||this._global),d.send(this.owner,l?l.constructor:null,t)},s.prototype._change=function(t,e,i,n,r,s,o,a,h){if("undefined"==typeof t)throw new Error(c);if(this.current){this.previous=this.current.constructor,this.current.exit(this.owner),this.previous.onExit.send(this.owner);for(var l=this.previous;l=l.parent;)l.onExit.send(this.owner,t);this._cache[this.current.constructor.name]=this.current}else this.previous=null;if(this.time=0,t){this.current=this._cache[t.name],this.current?this.current.enter(this.owner,e,i,n,r,s,o,a,h):this.current=new t(this,this.owner,e,i,n,r,s,o,a,h),t.onEnter.send(this.owner,e,i,n,r,s,o,a,h);for(var l=t;l=l.parent;)l.onEnter.send(this.owner)}else this.current=null;this._isIdle=!Boolean(this.current||this._global),d.send(this.owner,this.previous,t)},s.prototype.change=function(t,e,i,n,r,s,o,a,h){return this._queue=[],this._change(t,e,i,n,r,s,o,a,h),this},s.prototype.replace=function(t,e,i,n,r,s,o,a,h){return this._change(t,e,i,n,r,s,o,a,h),this},s.prototype.idle=function(){this.change(null)},s.prototype.undo=function(){return this.change(this.previous),this},s.prototype.queue=function(t,e,i,n,r,s,o,a,h){if("undefined"==typeof t)throw new Error(u);return this._queue.push([t,e,i,n,r,s,o,a,h]),this},s.prototype.after=function(t,e,i,n,r,s,o,a,h){return this._queue=[[t,e,i,n,r,s,o,a,h]],this},s.prototype.next=function(){this._queue.length?this._change.apply(this,this._queue.shift()):this._change(this["default"]||null)},s.prototype.update=function(t){this.time+=t,this._isIdle||(this._global&&this._global.update(this.owner,t),this.current&&this.current.update(this.owner,t),p&&this.history.length>100&&this.history.shift())},Object.defineProperties(s.prototype,{name:{get:function(){return String(this.current||this._global||"idle")}},queued:{get:function(){return this._queue.length>0}},isIdle:{get:function(){return!this.current&&!this._global}}});var f=r.extend("Wait",{progress:0,enter:function(t,e){"undefined"!=typeof e&&(this.time=e)},update:function(t){this.time?this.progress=Math.min(1,this.machine.time/this.time):this.progress=1,1===this.progress&&this.machine.next()}}),m=r.extend("Interval",{elapsed:0,update:function(t,e){this.elapsed+=e,this.elapsed>=this.interval&&(this.step(t),this.elapsed-=this.interval)}}),g=r.extend("Callback",{enter:function(t,e,i){i?e.call(i,t):e(t)},update:function(){this.machine.next()}});return{onChange:d,State:r,StateMachine:s,Wait:f,Interval:m,Callback:g}}),define("nebula/steerings/behaviors/base",["nebula/math/vector2"],function(t){"use strict";function e(e){this.name=e,this.enabled=!1,this.weight=1,this.force=t.create()}return e.prototype.enable=function(t){this.enabled=!0,"undefined"!=typeof t&&(this.weight=t)},e.prototype.disable=function(){this.enabled=!1},e.prototype.calculate=function(){return this.force.x*=this.weight,this.force.y*=this.weight,this.force},{Behavior:e}}),define("nebula/steerings/behaviors/seek",function(){"use strict";function t(t,e,r){n.direction(t.position,e,r),i.multiplyNumber(r,t.maxSpeed,r)}function e(t){r.call(this,t||"seek"),this.target=null}var i=require("nebula/math/vector2"),n=require("nebula/math/point2"),r=require("nebula/steerings/behaviors/base").Behavior;return e.prototype=Object.create(r.prototype),e.prototype.enable=function(t,e){r.prototype.enable.call(this,e),"undefined"!=typeof t&&(this.target=t)},e.prototype.calculate=function(e){return t(e,this.target,this.force),r.prototype.calculate.call(this)},{seek:t,Seek:e}}),define("nebula/steerings/behaviors/evade",function(){"use strict";function t(t,e,r){n.direction(e,t.position,r),i.multiplyNumber(r,t.maxSpeed,r)}function e(t){r.call(this,t||"evade"),this.target=null}var i=require("nebula/math/vector2"),n=require("nebula/math/point2"),r=require("nebula/steerings/behaviors/base").Behavior;return e.prototype=Object.create(r.prototype),e.prototype.enable=function(t,e){r.prototype.enable.call(this,e),"undefined"!=typeof t&&(this.target=t)},e.prototype.calculate=function(e){return t(e,this.target,this.force),r.prototype.calculate.call(this)},{evade:t,Evade:e}}),define("nebula/steerings/behaviors/arrive",function(){"use strict";function t(t,e,r,o,a,h,l){n.difference(e,t.position,s),o&&(s.x+=o*a.x,s.y+=o*a.y);var u=i.length(s);if(u>h){var c=Math.min(u/(.3*r),t.maxSpeed);return i.multiplyNumber(s,c/u,l),i.subtract(l,t.velocity,l),!1}return l.x=l.y=0,!0}function e(t){r.call(this,t||"arrive"),this.target=null,this.radius=0,this.direction=i.create(),this.deceleration=1,this.tolerance=.001,this.atTarget=!1,this.distance=1/0}var i=require("nebula/math/vector2"),n=require("nebula/math/point2"),r=require("nebula/steerings/behaviors/base").Behavior,s=i.create();return e.prototype=Object.create(r.prototype),e.prototype.enable=function(t,e){r.prototype.enable.call(this,e),this.atTarget=!1,"undefined"!=typeof t&&(this.target=t)},e.prototype.calculate=function(e){return this.atTarget=t(e,this.target,this.deceleration,this.radius,this.direction,this.tolerance,this.force),this.distance=n.distance(e.position,this.target),r.prototype.calculate.call(this)},{arrive:t,Arrive:e}}),define("nebula/steerings/behaviors/pursuit",function(){"use strict";function t(t,e,r,h){n.difference(e.position,t.position,o);var l=i.dot(t.heading,e.heading);if(i.dot(o,t.heading)>0&&-.9>l)return s(t,e.position,h);var u=i.length(o)/(t.maxSpeed+e.speed)*r;return i.multiplyNumber(e.velocity,u,a),n.move(a,e.position,a),s(t,a,h)}function e(t){r.call(this,t||"pursuit"),this.targetEntity=null,this.predictability=0}var i=require("nebula/math/vector2"),n=require("nebula/math/point2"),r=require("nebula/steerings/behaviors/base").Behavior,s=require("nebula/steerings/behaviors/seek").seek,o=i.create(),a=n.create();return e.prototype=Object.create(r.prototype),e.prototype.enable=function(t,e){r.prototype.enable.call(this,e),"undefined"!=typeof t&&(this.targetEntity=t)},e.prototype.calculate=function(e){return t(e,this.targetEntity,this.predictability,this.force),r.prototype.calculate.call(this)},{pursuit:t,Pursuit:e}}),define("nebula/steerings/behaviors/interpose",function(){"use strict";function t(t,e,n,h,l){i.midpoint(e.position,n.position,s);var u=i.distance(t.position,s)/t.maxSpeed;o.x=e.position.x+e.velocity.x*u,o.y=e.position.y+e.velocity.y*u,a.x=n.position.x+n.velocity.x*u,a.y=n.position.y+n.velocity.y*u,i.midpoint(o,a,s),r(t,s,h,0,null,.001,l)}function e(t){n.call(this,t||"interpose"),this.deceleration=1,this.entityA=null,this.entityB=null}var i=(require("nebula/math/vector2"),require("nebula/math/point2")),n=require("nebula/steerings/behaviors/base").Behavior,r=require("nebula/steerings/behaviors/arrive").arrive,s=i.create(),o=i.create(),a=i.create();return e.prototype=Object.create(n.prototype),e.prototype.enable=function(t,e,i,r){n.prototype.enable.call(this,r),"undefined"!=typeof t&&(this.entityA=t),"undefined"!=typeof e&&(this.entityB=e),"undefined"!=typeof i&&(this.deceleration=i)},e.prototype.calculate=function(e){return t(e,this.entityA,this.entityB,this.deceleration,this.force),n.prototype.calculate.call(this)},{interpose:t,Interpose:e}}),define("nebula/steerings/behaviors/block",function(){"use strict";function t(t,e,i,r,h,l){n.direction(i,e,o),a.x=i.x+o.x*r,a.y=i.y+o.y*r,s(t,a,h,0,null,.001,l)}function e(t){r.call(this,t||"block"),this.deceleration=1,this.distance=1,this.attacker=null,this.target=null}var i=require("nebula/math/vector2"),n=require("nebula/math/point2"),r=require("nebula/steerings/behaviors/base").Behavior,s=require("nebula/steerings/behaviors/arrive").arrive,o=i.create(),a=n.create();return e.prototype=Object.create(r.prototype),e.prototype.enable=function(t,e,i){r.prototype.enable.call(this,i),"undefined"!=typeof t&&(this.attacker=t),"undefined"!=typeof e&&(this.target=e)},e.prototype.calculate=function(e){return t(e,this.attacker,this.target,this.distance,this.deceleration,this.force),r.prototype.calculate.call(this)},{block:t,Block:e}}),define("nebula/steerings/behaviors/separation",function(){"use strict";function t(t,e,r,o){var a,h;o.x=o.y=0;for(var l=0;l<e.length;l++)a=e[l],a!==t&&(n.difference(t.position,a.position,s),h=i.length(s),r>=h&&(i.normalize(s,s),o.x+=s.x/h,o.y+=s.y/h))}function e(t){r.call(this,t||"separation"),this.neighbors=[],this.radius=1/0}var i=require("nebula/math/vector2"),n=require("nebula/math/point2"),r=require("nebula/steerings/behaviors/base").Behavior,s=i.create();return e.prototype=Object.create(r.prototype),e.prototype.enable=function(t,e,i){r.prototype.enable.call(this,i),"undefined"!=typeof t&&(this.neighbors=t),"undefined"!=typeof e&&(this.radius=e)},e.prototype.calculate=function(e){return t(e,this.neighbors,this.radius,this.force),r.prototype.calculate.call(this)},{separation:t,Separation:e}}),define("nebula/steerings/behaviors/obstacle_avoidance",function(){"use strict";function t(t,e,r,s,o){for(var a=null,h=1/0,l=i.temp(),u=i.temp(),c=0;c<e.length;c++){var p=e[c];if(p!==t){var d=i.distance(t.position,p.position);if(!(d>r+p.radius||(n.pointToLocalSpace(p.position,t.heading,t.position,u),u.x<0))){var f=p.radius+s+t.radius;if(!(Math.abs(u.y)>f)){var m=Math.sqrt(f*f-u.y*u.y),d=u.x-m;0>=d&&(d=u.x+m),h>d&&(a=p,h=d,l.x=u.x,l.y=u.y)}}}}if(a){var g=1+(r-l.x)/r;o.y=(a.radius+s-l.y)*g,o.x=.2*(a.radius+s-l.x),n.vectorToWorldSpace(o,t.heading,o)}else o.x=o.y=0}function e(t){r.call(this,t||"obstacleAvoidance"),this.obstacles=[],this.detectionRadius=1,this.spacing=0}var i=(require("nebula/math/vector2"),require("nebula/math/point2")),n=require("nebula/math/transformations"),r=require("nebula/steerings/behaviors/base").Behavior;return e.prototype=Object.create(r.prototype),e.prototype.enable=function(t,e){r.prototype.enable.call(this,e),"undefined"!=typeof t&&(this.obstacles=t)},e.prototype.calculate=function(e){if(e.speed>0){var i=this.detectionRadius+e.speed/e.maxSpeed*this.detectionRadius;t(e,this.obstacles,i,this.spacing,this.force)}else this.force.x=this.force.y=0;return r.prototype.calculate.call(this)},{obstacleAvoidance:t,ObstacleAvoidance:e}}),define("nebula/steerings/behaviors/wall_avoidance",function(){"use strict";function t(t,e){this.from=t,this.to=e,this.normal=n.create(),s.segmentNormal(t,e,this.normal)}function e(t,e,i,o){var a=0,h=1/0,l=r.temp(),u=r.temp();o.x=o.y=0;for(var c=0;c<e.length;c++){for(var p=-1,d=0;d<i.length;d++)a=s.segmentsIntersectionPoint(t.position,e[c],i[d].from,i[d].to,l),a&&h>a&&(h=a,p=d,u.x=l.x,u.y=l.y);if(p>=0){var f=n.temp(),m=r.distance(e[c],u);r.direction(t.position,e[c],f),n.reflect(f,i[p].normal,o),o.x*=m,o.y*=m}}}function i(t){o.call(this,t||"wallAvoidance"),this.walls=[],this.feelers=r.array(3),this.distance=1}var n=require("nebula/math/vector2"),r=require("nebula/math/point2"),s=require("nebula/math/geometry"),o=require("nebula/steerings/behaviors/base").Behavior;return i.prototype=Object.create(o.prototype),i.prototype.enable=function(t,e){o.prototype.enable.call(this,e),this.walls=t||[]},i.prototype.updateFeelers=function(t){var e=this.feelers,i=n.temp(),r=t.position.x,s=t.position.y;e[0].x=r+this.distance*t._heading.x,e[0].y=s+this.distance*t._heading.y,n.rotate(t._heading,Math.PI*-.25,i),e[1].x=r+this.distance*i.x*.5,e[1].y=s+this.distance*i.y*.5,n.rotate(t._heading,.25*Math.PI,i),e[2].x=r+this.distance*i.x*.5,e[2].y=s+this.distance*i.y*.5},i.prototype.calculate=function(t){return t.speed?(this.updateFeelers(t),e(t,this.feelers,this.walls,this.force)):this.force.x=this.force.y=0,o.prototype.calculate.call(this)},{Wall:t,wallAvoidance:e,WallAvoidance:i}}),define("nebula/steerings/controller",function(){"use strict";function t(t){this.entity=t,this.force=e.create(),this.behaviors=[],this._target=null,this._pause=new n(this,"pause","resume")}var e=require("nebula/math/vector2"),i=require("nebula/format"),n=require("nebula/lock");return t.prototype._findBehavior=function(t,e){e=e||this.behaviors;for(var i=0;i<e.length;i++)if(e[i].name===t)return i;return-1},t.prototype.add=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if(e.name in this)throw new Error("Behavior named '"+e.name+"' is already added to this steering controller. Behavior names should be unique.");this.behaviors.push(e),this[e.name]=e}},t.prototype.remove=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t],i=this._findBehavior(e);if(!(i>=0))throw new Error("Cannot remove steering behavior '"+e+"', behavior not found");this.behaviors.splice(i,1),delete this[e]}},t.prototype.clear=function(){for(var t=0;t<this.behaviors.length;t++)delete this[this.behaviors[t].name];this.behaviors=[]},t.prototype.disable=function(){for(var t=0;t<this.behaviors.length;t++)this.behaviors[t].disable()},t.prototype.pause=function(){},t.prototype.resume=function(){},t.prototype.sort=function(){var t=this.behaviors;this.behaviors=[];for(var e=0;e<arguments.length;e++){var i=arguments[e],n=this._findBehavior(i,t);if(!(n>=0))throw new Error("Can't sort behaviors, behavior '"+i+"' not found");this.behaviors.push(t[n]),t.splice(n,1)}this.behaviors=this.behaviors.concat(t)},t.prototype.calculate=function(t){var i;if(this.force.x=this.force.y=0,this._pause.isOpen){for(var n=0;n<this.behaviors.length;n++)this.behaviors[n].enabled&&e.add(this.force,this.behaviors[n].calculate(this.entity),this.force);var i=e.length(this.force);if(i){var r=this.entity.deceleration*t;r>i&&e.resize(this.force,i+r,this.force),e.clampLength(this.force,this.entity.minForce,this.entity.maxForce,this.force)}}return this.force},t.prototype.debug=function(){for(var t=[],e=0;e<this.behaviors.length;e++)this.behaviors[e].enabled?t.push(i("%s(%f, %f)",this.behaviors[e].name,this.behaviors[e].force.x,this.behaviors[e].force.y)):t.push(i("%s",this.behaviors[e].name));return t.join(", ")},Object.defineProperty(t.prototype,"target",{set:function(t){this._target=t},get:function(t){
return this._target}}),t}),define("nebula/steerings/smoother",function(){"use strict";function t(t){this.slot=0,this.history=e.array(t)}var e=require("nebula/math/vector2");return t.prototype.update=function(t){this.history[this.slot].x=t.x,this.history[this.slot].y=t.y,this.slot=(this.slot+1)%this.history.length},t.prototype.resize=function(t){this.history=e.array(t),this.slot=0},t.prototype.set=function(t){for(var e=0;e<this.history.length;e++)this.history[e].x=t.x,this.history[e].y=t.y},t.prototype.getAverage=function(t){t.x=t.y=0;for(var i=0;i<this.history.length;i++)e.add(t,this.history[i],t);e.normalize(t,t)},t}),define("nebula/entities/base",function(){"use strict";function t(i){this.id=i&&i.id||t.id++,this.dead=!1,this.states=new e(this)}var e=require("nebula/states").StateMachine;return t.id=0,t.prototype.onMessage=function(t){if(t._methodName in this){var e=this[t._methodName];if(e===!0||e===!1)return e;var i=this[t._methodName](t);if(void 0!==i)return i}return this.states.onMessage(t)},t.prototype.update=function(t){this.states.update(t)},t}),define("nebula/entities/entity",function(){"use strict";function t(t,e){return"undefined"!=typeof t?t:e}function e(n){i.apply(this,arguments),n=n||{},this.integrationMethod=e.INTEGRATION_NONE,this._update=null;var a=t(n.integrationMethod,e.INTEGRATION_EULER);a===e.INTEGRATION_EULER?this.useEuler():this.useVerlet(),this.position=s.copy(n.position||{}),this.oldPosition=s.copy(this.position),this.velocity=r.create(),this.gravity=r.copy(n.gravity||{}),this._heading=r.create(1,0),this.heading=r.create(1,0),this.mass=t(n.mass,1),this.speed=0,this.maxSpeed=t(n.maxSpeed,1/0),this.minForce=t(n.minForce,0),this.maxForce=t(n.maxForce,1/0),this.maxTurnRate=t(n.maxTurnRate,1/0),this.damping=t(n.damping,0),this.friction=t(n.friction,0),this.drag=t(n.drag,0),this.deceleration=0,this.force=r.create(),this.radius=t(n.radius,0),n.steering&&(this.steering=new o(this)),this.smoother=null,this.smoothing=!1}var i=require("nebula/entities/base"),n=require("nebula/numbers"),r=require("nebula/math/vector2"),s=require("nebula/math/point2"),o=require("nebula/steerings/controller"),a=require("nebula/steerings/smoother");return e.INTEGRATION_NONE=0,e.INTEGRATION_EULER=1,e.INTEGRATION_VERLET=2,e.prototype=Object.create(i.prototype),e.prototype.enableSmoothing=function(t){this.smoother?t!==this.smoother.history.length&&this.smoother.resize(t):this.smoother=new a(t),this.smoothing=!0},e.prototype.disableSmoothing=function(){this.smoothing=!1},e.prototype.setHeading=function(t){this.smoothing&&this.smoother.update(t),this.heading.x=this._heading.x=t.x,this.heading.y=this._heading.y=t.y,r.rotate2(this.velocity,t,this.velocity)},e.prototype.lookAtNow=function(t){var e=r.temp();s.direction(this.position,t,e),this.setHeading(e)},e.prototype.look=function(t){var e=r.look(this._heading,t,this.maxTurnRate*this.game.timestep,this._heading);return this.setHeading(this._heading),e},e.prototype.lookAt=function(t){var e=r.temp();return s.direction(this.position,t,e),this.look(e)},e.prototype.stop=function(){this.force.x=this.force.y=0,this.usingEuler?this.velocity.x=this.velocity.y=0:this.usingVerlet&&(this.position.x=this.oldPosition.x,this.position.y=this.oldPosition.y)},e.prototype.useNone=function(){this.integrationMethod=e.INTEGRATION_NONE,this._update=null},e.prototype.useEuler=function(){this.integrationMethod=e.INTEGRATION_EULER,this._update=this._updateEuler},e.prototype.useVerlet=function(){this.integrationMethod=e.INTEGRATION_VERLET,this._update=this._updateVerlet},e.prototype._updateEuler=function(t){this.velocity.x+=this.force.x/this.mass*t,this.velocity.y+=this.force.y/this.mass*t,this.damping&&r.multiplyNumber(this.velocity,n.clamp(1-t*this.damping,0,1),this.velocity);var e=this.speed=r.length(this.velocity);this.speed&&this.deceleration&&(this.speed=Math.max(0,this.speed-this.deceleration*t)),this.speed>this.maxSpeed&&(this.speed=this.maxSpeed),this.speed!==e&&(this.velocity.x=this.velocity.x/e*this.speed,this.velocity.y=this.velocity.y/e*this.speed),this.oldPosition.x=this.position.x,this.oldPosition.y=this.position.y,this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.speed>0&&r.normalize(this.velocity,this._heading)},e.prototype._updateVerlet=function(t){this.velocity.x=this.position.x-this.oldPosition.x+this.force.x/this.mass*t*t,this.velocity.y=this.position.y-this.oldPosition.y+this.force.y/this.mass*t*t,this.damping&&r.multiplyNumber(this.velocity,n.clamp(1-t*this.damping,0,1),this.velocity);var e=this.speed=r.length(this.velocity);this.speed&&this.deceleration&&(this.speed=Math.max(0,this.speed-this.deceleration*t)),this.speed>this.maxSpeed&&(this.speed=this.maxSpeed),this.speed!==e&&(this.velocity.x=this.velocity.x/e*this.speed,this.velocity.y=this.velocity.y/e*this.speed),this.position.x=this.oldPosition.x+this.velocity.x*t,this.position.y=this.oldPosition.y+this.velocity.y*t,this.oldPosition.x=this.position.x,this.oldPosition.y=this.position.y,this.speed>0&&r.normalize(this.velocity,this._heading)},e.prototype.applyForce=function(t,e){"undefined"==typeof e&&(e=1),this.force.x+=t.x*e,this.force.y+=t.y*e},e.prototype.applyImpulse=function(t,e){"undefined"==typeof e&&(e=1),this.velocity.x+=t.x*e/this.mass,this.velocity.y+=t.y*e/this.mass},e.prototype.update=function(t){this.states.update(t),this.deceleration=(null===this.drag?this.speed*this.speed*.5:this.drag)+this.friction,this.steering&&this.steering._pause.isOpen&&this.applyImpulse(this.steering.calculate(t)),r.add(this.force,this.gravity,this.force),this._update(t),this.smoothing?(this.smoother.update(this._heading),this.smoother.getAverage(this.heading)):(this.heading.x=this._heading.x,this.heading.y=this._heading.y),this.force.x=this.force.y=0},Object.defineProperty(e.prototype,"usingEuler",{get:function(){return this.integrationMethod===e.INTEGRATION_EULER}}),Object.defineProperty(e.prototype,"usingVerlet",{get:function(){return this.integrationMethod===e.INTEGRATION_VERLET}}),e}),define("nebula/entities/entity3d",function(){"use strict";function t(t,e){return"undefined"!=typeof t?t:e}function e(e){i.apply(this,arguments),e=e||{},this.integrationMethod=n.INTEGRATION_NONE,this._update=null;var r=t(e.integrationMethod,n.INTEGRATION_EULER);r===n.INTEGRATION_EULER?this.useEuler():this.useVerlet(),this.position=o.copy(e.position||{}),this.oldPosition=o.copy(this.position),this.velocity=s.create(),this.gravity=s.copy(e.gravity||{}),this.heading=s.create(1,0,0),this.mass=t(e.mass,1),this.speed=0,this.maxSpeed=t(e.maxSpeed,1/0),this.minForce=t(e.minForce,0),this.maxForce=t(e.maxForce,1/0),this.maxTurnRate=t(e.maxTurnRate,1/0),this.damping=t(e.damping,0),this.friction=t(e.friction,0),this.drag=t(e.drag,0),this.deceleration=0,this.force=s.create(),this.radius=t(e.radius,0),e.steering&&(this.steering=new a(this))}var i=require("nebula/entities/base"),n=require("nebula/entities/entity"),r=require("nebula/numbers"),s=(require("nebula/math/vector2"),require("nebula/math/vector3")),o=require("nebula/math/point3"),a=require("nebula/steerings/controller");return e.prototype=Object.create(n.prototype),e.prototype.setHeading=function(t){throw new Error("`Entity3D.setHeading` not implemented.")},e.prototype.lookAtNow=function(t){throw new Error("`Entity3D.lookAtNow` not implemented.")},e.prototype.lookAt=function(t){throw new Error("`Entity3D.lookAt` not implemented.")},e.prototype.stop=function(){this.force.x=this.force.y=this.force.z=0,this.usingEuler?this.velocity.x=this.velocity.y=this.velocity.z=0:this.usingVerlet&&(this.position.x=this.oldPosition.x,this.position.y=this.oldPosition.y,this.position.z=this.oldPosition.z)},e.prototype._updateEuler=function(t){this.velocity.x+=this.force.x/this.mass*t,this.velocity.y+=this.force.y/this.mass*t,this.velocity.z+=this.force.z/this.mass*t,this.damping&&s.multiplyNumber(this.velocity,r.clamp(1-t*this.damping,0,1),this.velocity);var e=this.speed=s.length(this.velocity);this.speed&&this.deceleration&&(this.speed=Math.max(0,this.speed-this.deceleration*t)),this.speed>this.maxSpeed&&(this.speed=this.maxSpeed),this.speed!==e&&(this.velocity.x=this.velocity.x/e*this.speed,this.velocity.y=this.velocity.y/e*this.speed,this.velocity.z=this.velocity.z/e*this.speed),this.oldPosition.x=this.position.x,this.oldPosition.y=this.position.y,this.oldPosition.z=this.position.z,this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.position.z+=this.velocity.z*t,this.speed>0&&s.normalize(this.velocity,this.heading)},e.prototype._updateVerlet=function(t){var e=t*t,i=this.deceleration*t;this.velocity.x=this.position.x-this.oldPosition.x+this.force.x/this.mass*e,this.velocity.y=this.position.y-this.oldPosition.y+this.force.y/this.mass*e,this.velocity.z=this.position.z-this.oldPosition.z+this.force.z/this.mass*e,this.damping&&s.multiplyNumber(this.velocity,r.clamp(1-t*this.damping,0,1),this.velocity);var n=this.speed=s.length(this.velocity);this.speed&&i&&(this.speed=Math.max(0,this.speed-i)),this.speed>this.maxSpeed&&(this.speed=this.maxSpeed),this.speed!==n&&(this.velocity.x=this.velocity.x/n*this.speed,this.velocity.y=this.velocity.y/n*this.speed,this.velocity.z=this.velocity.z/n*this.speed),this.position.x=this.oldPosition.x+this.velocity.x*t,this.position.y=this.oldPosition.y+this.velocity.y*t,this.position.z=this.oldPosition.z+this.velocity.z*t,this.oldPosition.x=this.position.x,this.oldPosition.y=this.position.y,this.oldPosition.z=this.position.z},e.prototype.applyForce=function(t,e){"undefined"==typeof e&&(e=1),this.force.x+=t.x*e,this.force.y+=t.y*e,t.z&&(this.force.z+=t.z*e)},e.prototype.applyImpulse=function(t,e){"undefined"==typeof e&&(e=1),this.velocity.x+=t.x*e/this.mass,this.velocity.y+=t.y*e/this.mass,t.z&&(this.velocity.z+=t.z*e/this.mass)},e.prototype.update=function(t){this.states.update(t),this.deceleration=(null===this.drag?this.speed*this.speed*.5:this.drag)+this.friction,this.steering&&this.steering._pause.isOpen&&this.applyImpulse(this.steering.calculate(t)),s.add(this.force,this.gravity,this.force),this._update(t),this.force.x=this.force.y=this.force.z=0},e}),define("nebula/entities/utils",function(){"use strict";function t(t,e,i){for(var n=1/0,r=0;r<e.length;r++){var o=e[r];if(t!==o.position){var a=s.distance(t,o.position)-o.radius;if(0>=a)return 0;n>a&&(!i||i.indexOf(o)<0)&&(n=a)}}return n}function e(t,e,i){function n(e,n){if(t!==n.position){var r=Math.max(0,s.distance(t,n.position)-n.radius);r<e.distance&&(!i||i.indexOf(n)<0)&&(e.entity=n,e.distance=r)}return e}return e.reduce(n,{entity:null,distance:1/0})}function i(t,e,i){for(var n=null,r=1/0,o=0;o<e.length;o++){var a=e[o];if(t!==a.position&&(!i||i.indexOf(a)<0)){var h=Math.max(0,s.distance(t,a.position)-a.radius);r>h&&(n=a,r=h)}}return n}function n(t,e,i){function n(i){return i.position!==t&&s.distance(t,i.position)<e}return i.filter(n)}function r(t,e){function i(t,i){var n=s.distance(e,t.position),r=s.distance(e,i.position);return r>n?-1:n>r?1:0}t.sort(i)}var s=require("nebula/math/point2");return{distance:t,findClosest:e,findClosest2:i,findInRadius:n,sortByDistance:r}}),define("nebula/entities/manager",function(){"use strict";function t(t){this.list=[],this.owner=t}var e=require("nebula/signal"),i=new e,n=new e;return t.prototype.prepend=function(t){this.list.unshift(t),"function"==typeof t.add&&t.add(),i.send(this,t)},t.prototype.add=function(t){this.list.push(t),"function"==typeof t.add&&t.add(),i.send(this,t)},t.prototype.remove=function(t,e){var i=this.list.indexOf(t);if(i>=0)"function"==typeof t.remove&&t.remove(),this.list.splice(i,1),n.send(this,t);else if(!e)throw new Error("Can't remove entity, entity '"+t+"' not found")},t.prototype.removeAt=function(t){if(0>t||t>=this.list.length)throw new Error("Can't remove entity at index "+t+", index out of range");var e=this.list[t];"function"==typeof e.remove&&e.remove(),this.list.splice(t,1),n.send(this,e)},t.prototype.removeAll=function(){for(var t=0;t<this.list.length;t++){var e=this.list[t];"function"==typeof e.remove&&e.remove(),n.send(this,e)}this.list=[]},t.prototype.getById=function(t){for(var e=0;e<this.list.length;e++)if(this.list[e].id===t)return this.list[e];return null},Object.defineProperty(t.prototype,"length",{get:function(){return this.list.length}}),{onAddEntity:i,onRemoveEntity:n,EntityManager:t}}),define("nebula/entities/space",function(){"use strict";function t(t){e.apply(this,arguments),this.timeScale="undefined"!=typeof t.timeScale?t.timeScale:1,this.elapsed=0,this.entities=new i(this),this._pause=new n(this,"pause","resume")}var e=require("nebula/entities/base"),i=require("nebula/entities/manager").EntityManager,n=require("nebula/lock");require("nebula/easings");return t.prototype=Object.create(e.prototype),t.prototype.pause=function(){},t.prototype.resume=function(){},t.prototype._updateEntities=function(t){for(var e,i=this.entities.list,n=i.length;--n>=0;)e=i[n],(e.update&&e.update(t)===!1||e.dead)&&this.entities.removeAt(n)},t.prototype._renderEntities=function(t){for(var e=this.entities.list,i=0,n=e.length;n>i;i++)e[i].render&&e[i].render(t)},t.prototype.update=function(t){this._pause.isActive||(this.elapsed=this.timeScale*t,this.states.update(this.elapsed),this._updateEntities(this.elapsed))},t.prototype.render=function(t){this._pause.isActive||this._renderEntities(t*this.timeScale)},Object.defineProperties(t.prototype,{paused:{get:function(){return this._pause.isActive}}}),t}),define("nebula/clock",["nebula/window","nebula/lock"],function(t,e){"use strict";function i(t){this.lastUpdate=null,this.elapsed=0,this.totalElapsed=0,this.deltaCap=t||1/0,this.events=[],this.actionQueues={"default":[]},this._pause=new e(this,"pause","resume")}return i.prototype.reset=function(){this.lastUpdate=null,this.elapsed=0,this.totalElapsed=0,this.events=[],this.actionQueues={"default":[]},this._pause.reset()},i.prototype._getQueue=function(t){var e=this.actionQueues[t||"default"];if(!e)throw new Error("Action queue `"+t+"` does not exist.");return e},i.prototype._addToActionQueue=function(t,e,i,n,r){var s=this._getQueue();"undefined"==typeof e&&(e=1/0),s.push({timeout:e,time:0,callback:i,context:n,arguments:r})},i.prototype.action=function(t){function e(){var e=this._getQueue();!e.length&&t.callback.apply(t.context,t.args||arguments)||this._addToActionQueue(t.queueName,t.timeout,t.callback,t.context,t.args||arguments)}return e=e.bind(this),e.kwargs=t,e},i.prototype._schedule=function(t,e,i,n,r,s){var o={time:t,interval:e,limit:i,iteration:0,callback:n,context:r,arguments:s};return this.events.push(o),o},i.prototype.delayed=function(t){function e(){t.onSchedule&&t.onSchedule.apply(t.context,arguments)===!1||this._schedule(this.totalElapsed+e.delay,t.interval||0,t.limit||1,t.callback,t.context,arguments)}return e=e.bind(this),e.delay=t.delay,e.now=t.callback.bind(t.context),e},i.prototype.schedule=function(t){return this._schedule(t.time||this.totalElapsed+(t.delay||0),t.interval||0,t.limit||1,t.callback,t.context,t.arguments)},i.prototype.forever=function(t){return this._schedule(t.time||this.totalElapsed+(t.delay||0),t.interval||0,null,t.callback,t.context,t.arguments)},i.prototype.cancel=function(t,e){"function"==typeof t?this._cancelCallback(t,e):this._cancelEvent(t)},i.prototype._cancelCallback=function(t,e){function i(i){return i.callback!==t||i.context!=e}this.events=this.events.filter(i)},i.prototype._cancelEvent=function(t){var e=this.events.indexOf(t);e>=0&&this.events.splice(e,1)},i.prototype.start=function(){this.lastUpdate=t.performance.now()},i.prototype.pause=function(){},i.prototype.resume=function(){this.lastUpdate=t.performance.now()},i.prototype._isPaused=function(){return this._pause.isActive},i.prototype.update=function(e){if(this._isPaused())return 0;void 0===e&&(e=t.performance.now()),null===this.lastUpdate&&(this.lastUpdate=e),this.elapsed=Math.min(this.deltaCap,Math.max(0,(e-this.lastUpdate)/1e3)),this.lastUpdate=e,this.totalElapsed+=this.elapsed;for(var i,n=this.events.length;--n>=0;)i=this.events[n],this.totalElapsed>=i.time+i.iteration*i.interval&&(i.callback.apply(i.context,i.arguments),null===i.limit?i.iteration+=1:i.iteration<i.limit-1?(i.iteration+=1,i.time+=i.interval):this.events.splice(n,1));for(var r in this.actionQueues){for(var s=this.actionQueues[r],n=s.length;--n>=0;)s[n].time+=this.elapsed,s[n].time>=s[n].timeout&&s.splice(n,1);if(s.length){var o=s[0],a=o.callback.apply(o.context,o.arguments);a&&s.shift()}}return this.elapsed},Object.defineProperties(i.prototype,{isPaused:{get:i.prototype._isPaused},hasStarted:{get:function(){return null!==this.lastUpdate}}}),i}),define("nebula/fps_meter",["nebula/window"],function(t){"use strict";function e(t){this.frames=0,this.history=new Array(t||1),this._slot=-1,this._time=null;for(var e=0;e<this.history.length;e++)this.history[e]=0}var i=require("nebula/numbers");require("nebula/signal");return e.prototype.frame=function(){if(null==this._time)return void(this._time=t.performance.now());this.frames++;var e=t.performance.now(),i=e-this._time;if(i>=1e3){var n=this.frames/i*1e3;this._slot=(this._slot+1)%this.history.length,this.history[this._slot]=n,this.frames=0,this._time=e-i+1e3}},Object.defineProperties(e.prototype,{current:{get:function(){return this._slot>=0?this.history[this._slot]:0}},min:{get:function(){return Math.min.apply(void 0,this.history)}},max:{get:function(){return Math.max.apply(void 0,this.history)}},average:{get:function(){return i.sum.apply(void 0,this.history)/this.history.length}}}),e}),define("nebula/game",function(){"use strict";function t(t){s.apply(this,arguments),this.stage=new e.Container,this.stage.interactive=!1,t.renderer===e.WEBGL_RENDERER?this.renderer=new e.WebGLRenderer(t.width,t.height,t.rendererOptions):t.renderer===e.CANVAS_RENDERER?this.renderer=new e.CanvasRenderer(t.width,t.height,t.rendererOptions):this.renderer=e.autoDetectRenderer(t.width,t.height,t.rendererOptions),this.isCanvas=this.renderer.type===e.CANVAS_RENDERER,this.isWebGL=!this.renderer.isCanvas,this.clock=new r(2/60),this.updateFPS=60,this.TIMESTEP=1/this.updateFPS,this.timestep=this.TIMESTEP,this._timeAccumulator=0,this._frameProxy=this.frame.bind(this),this._frameRequestId=null,this.steps=0,this.loader=null,this.assets=t.assets||null,this.fps=new h(10),this.assets&&(this.loader=e.loader,this.loader.on("progress",this._onLoadProgress.bind(this)),this.loader.on("complete",this._onLoad.bind(this)),this.loader.add(this.assets)),this._background=!1,this.focused=!1,i.addEventListener("blur",this._onBlur.bind(this)),i.addEventListener("focus",this._onFocus.bind(this)),o.enable()}var e=require("pixi"),i=require("nebula/window"),n=require("nebula/signal"),r=require("nebula/clock"),s=require("nebula/entities/space"),o=(require("nebula/entities/manager").EntityManager,require("nebula/input/keyboard")),a=require("nebula/input/gamepad"),h=(require("nebula/states").StateMachine,require("nebula/states").Wait,require("nebula/fps_meter")),l=require("nebula/tweens");return t.onStart=new n,t.onPause=new n,t.onResume=new n,t.onBeforeFrame=new n,t.onBeforeUpdate=new n,t.onAfterUpdate=new n,t.onBeforeRender=new n,t.onAfterRender=new n,t.onAfterFrame=new n,t.onLoad=new n,t.onLoadProgress=new n,t.prototype=Object.create(s.prototype),t.prototype.resize=function(t,e,i){this.renderer.resize(t,e),1===i||null==i?this.renderer.view.style.transform="":(this.renderer.view.style.transform="scale("+1/i+", "+1/i+")",this.renderer.view.style.transformOrigin="0 0")},t.prototype.start=function(){this.clock.start(),this.frame(),t.onStart.send(this)},t.prototype._onFocus=function(){this.focused=!0,!this._background&&this.clock.hasStarted&&this.resume()},t.prototype._onBlur=function(){this.clock.hasStarted&&(this.focused=!1,this._background||this.pause())},t.prototype.pause=function(){this.clock.pause(),null!==this._frameRequestId&&(i.cancelAnimationFrame(this._frameRequestId),this._frameRequestId=null),t.onPause.send(this)},t.prototype.resume=function(){this.clock.resume(),this.frame(),t.onResume.send(this)},t.prototype.load=function(e){e&&t.onLoad({sender:this,receiver:e}),this.loader&&this.loader.load()},t.prototype._onLoadProgress=function(){var e=1-this.loader.loadCount/this.assets.length;t.onLoadProgress.send(this,e,this.assets.length,this.assets.length-this.loader.loadCount)},t.prototype._onLoad=function(){t.onLoad.send(this)},t.prototype.update=function(e){for(e*=this.timeScale,e>1/60-.002&&1/60+.002>e&&(e=this.TIMESTEP),this.steps=this.elapsed=0,this.timestep=this.TIMESTEP,this._timeAccumulator+=e,o.update(this.clock.elapsed),a.update(this.clock.elapsed);this._timeAccumulator>=this.timestep;)t.onBeforeUpdate.send(this,this.timestep),this.states.update(this.timestep),this._updateEntities(this.timestep),this._timeAccumulator-=this.timestep,this.steps+=1,this.elapsed+=this.timestep,t.onAfterUpdate.send(this,this.timestep);return this.steps},t.prototype.render=function(){t.onBeforeRender.send(this),l.update(this.elapsed),this._renderEntities(this.elapsed),this.renderer.render(this.stage),t.onAfterRender.send(this)},t.prototype.frame=function(e){return t.onBeforeFrame.send(this),this.update(this.paused?this.TIMESTEP:this.clock.update(e))&&this.render(),this.fps.frame(),t.onAfterFrame.send(this),this.paused||(this._frameRequestId=i.requestAnimationFrame(this._frameProxy,this.renderer.view)),this.steps},Object.defineProperties(t.prototype,{runInBackground:{get:function(){return this._background},set:function(t){return t==this._background?this._background:(this._background=Boolean(t),this._background&&!this.focused?this.resume():this._background||this.focused||this.pause(),this._background)}}}),t}),define("nebula/linked_list",function(){"use strict";function t(){this.head=null,this.tail=null,this.length=0}return t.prototype.toString=function(){for(var t=[],e=this.head;null!=e;)t.push(String(e.data)),e=e.next;return t.join(", ")},t.createNode=function(t){return{data:t,next:null,previous:null,list:null}},t.prototype.removeNode=function(t){this.detachNode(t),t.data=null},t.prototype.detachNode=function(t){if(!t.list)throw new Error("Cannot detach: node is not attached to a list.");if(t.list!==this)throw new Error("Cannot detach: node is attached to another list.");this.length--,t.previous?t.previous.next=t.next:this.head=t.next,t.next?t.next.previous=t.previous:this.tail=t.previous,t.list=null,t.next=null,t.previous=null},t.prototype.appendNode=function(t){if(t.list)throw new Error("Cannot append: node is attached to a list.");this.length++,null===this.tail?this.head=t:this.tail.next=t,t.previous=this.tail,t.next=null,t.list=this,this.tail=t},t.prototype.prependNode=function(t){if(t.list)throw new Error("Cannot prepend: node is attached to a list.");this.length++,null===this.head?this.tail=t:this.head.previous=t,t.next=this.head,t.previous=null,t.list=this,this.head=t},t.prototype.insertNodeBefore=function(t,e){if(t.list)throw new Error("Cannot insert: node is attached to a list.");if(null===e)throw new Error("Cannot insert: target is null");if(!e.list)throw new Error("Cannot insert: target node is not attached to a list.");e===this.head&&(this.head=t),t.list=this,t.previous=e.previous,t.previous&&(t.previous.next=t),e.previous=t,t.next=e},t.prototype.insertNodeAfter=function(t,e){if(t.list)throw new Error("Cannot insert: node is attached to a list.");if(null===e)throw new Error("Cannot insert: target is null");if(!e.list)throw new Error("Cannot insert: target node is not attached to a list.");e===this.tail&&(this.tail=t),t.list=this,t.next=e.next,t.next&&(t.next.previous=t),e.next=t,t.previous=e},t.prototype.append=function(e){this.appendNode(t.createNode(e))},t.prototype.prepend=function(e){this.prependNode(t.createNode(e))},t.prototype.getNode=function(t){for(var e=this.head;null!==e;){if(e.data===t)return e;e=e.next}return null},t.prototype.getNodeAtIndex=function(t){if(0>t||t>=this.length)throw new Error("Index out of bounds.");for(var e=this.head,i=0;null!==e;){if(i===t)return e;e=e.next,i++}return null},t}),define("spine/curves",function(){"use strict";function t(t){this.curves=[],this.curves.length=6*(t-1)}return t.prototype.setLinear=function(t){this.curves[6*t]=0},t.prototype.setStepped=function(t){this.curves[6*t]=-1},t.prototype.setCurve=function(t,e,i,n,r){var s=.1,o=s*s,a=o*s,h=3*s,l=3*o,u=6*o,c=6*a,p=2*-e+n,d=2*-i+r,f=3*(e-n)+1,m=3*(i-r)+1,g=6*t;this.curves[g]=e*h+p*l+f*a,this.curves[g+1]=i*h+d*l+m*a,this.curves[g+2]=p*u+f*c,this.curves[g+3]=d*u+m*c,this.curves[g+4]=f*c,this.curves[g+5]=m*c},t.prototype.getCurvePercent=function(t,e){e=Math.max(0,Math.min(e,1));var i=6*t,n=this.curves[i];if(!n)return e;if(-1==n)return 0;for(var r=this.curves[i+1],s=this.curves[i+2],o=this.curves[i+3],a=this.curves[i+4],h=this.curves[i+5],l=n,u=r,c=8;;){if(l>=e){var p=l-n,d=u-r;return d+(u-d)*(e-p)/(l-p)}if(0==c)break;c--,n+=s,r+=o,s+=a,o+=h,l+=n,u+=r}return u+(1-u)*(e-l)/(1-l)},t}),define("spine/search",function(){"use strict";function t(t,e,i){var n=0,r=Math.floor(t.length/i)-2;if(0==r)return i;for(var s=r>>>1;;){if(t[(s+1)*i]<=e?n=s+1:r=s,n==r)return(n+1)*i;s=n+r>>>1}}function e(t,e,i){for(var n=0,r=t.length-i;r>=n;n+=i)if(t[n]>e)return n;return-1}return{binary:t,linear:e}}),define("spine/track_entry",function(){"use strict";function t(){this.next=null,this.previous=null,this.animation=null,this.loop=!1,this.delay=0,this.time=0,this.lastTime=-1,this.endTime=0,this.timeScale=1,this.mixTime=0,this.mixDuration=0,this.mix=1,this.onStart=null,this.onEnd=null,this.onComplete=null,this.onEvent=null}return t}),define("spine/attachments/base",function(){"use strict";return{region:0,bounding_box:1,mesh:2,skinnedmesh:3}}),define("spine/attachments/region",["spine/attachments/base"],function(t){"use strict";function e(e){this.name=e,this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8,this.type=t.REGION,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.width=0,this.height=0,this.r=1,this.g=1,this.b=1,this.a=1,this.path=null,this.rendererObject=null,this.regionOffsetX=0,this.regionOffsetY=0,this.regionWidth=0,this.regionHeight=0,this.regionOriginalWidth=0,this.regionOriginalHeight=0}return e.prototype.setUVs=function(t,e,i,n,r){var s=this.uvs;r?(s[2]=t,s[3]=n,s[4]=t,s[5]=e,s[6]=i,s[7]=e,s[0]=i,s[1]=n):(s[0]=t,s[1]=n,s[2]=t,s[3]=e,s[4]=i,s[5]=e,s[6]=i,s[7]=n)},e.prototype.updateOffset=function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.regionOffsetX*t,n=-this.height/2*this.scaleY+this.regionOffsetY*e,r=i+this.regionWidth*t,s=n+this.regionHeight*e,o=this.rotation*Math.PI/180,a=Math.cos(o),h=Math.sin(o),l=i*a+this.x,u=i*h,c=n*a+this.y,p=n*h,d=r*a+this.x,f=r*h,m=s*a+this.y,g=s*h,y=this.offset;y[0]=l-p,y[1]=c+u,y[2]=l-g,y[3]=m+u,y[4]=d-g,y[5]=m+f,y[6]=d-p,y[7]=c+f},e.prototype.computeVertices=function(t,e,i,n){t+=i.worldX,e+=i.worldY;var r=i.m00,s=i.m01,o=i.m10,a=i.m11,h=this.offset;n[0]=h[0]*r+h[1]*s+t,n[1]=h[0]*o+h[1]*a+e,n[2]=h[2]*r+h[3]*s+t,n[3]=h[2]*o+h[3]*a+e,n[4]=h[4]*r+h[5]*s+t,n[5]=h[4]*o+h[5]*a+e,n[6]=h[6]*r+h[7]*s+t,n[7]=h[6]*o+h[7]*a+e},e}),define("spine/timelines/attachment",["spine/curves","spine/search"],function(t,e){"use strict";function i(e){this.curves=new t(e),this.frames=[],this.frames.length=e,this.attachmentNames=[],this.attachmentNames.length=e,this.slotIndex=0}return i.prototype.getFrameCount=function(){return this.frames.length},i.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},i.prototype.apply=function(t,i,n,r,s){if(!(n<this.frames[0])){var o;o=n>=this.frames[this.frames.length-1]?this.frames.length-1:e.binary(this.frames,n,1)-1;var a=this.attachmentNames[o];t.slots[this.slotIndex].setAttachment(a?t.getAttachmentBySlotIndex(this.slotIndex,a):null)}},i}),define("spine/timelines/color",["spine/curves","spine/search"],function(t,e){"use strict";function i(e){this.curves=new t(e),this.frames=[],this.frames.length=5*e,this.slotIndex=0}return i.prototype.getFrameCount=function(){return this.frames.length/5},i.prototype.setFrame=function(t,e,i,n,r,s){t*=5,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n,this.frames[t+3]=r,this.frames[t+4]=s},i.prototype.apply=function(t,i,n,r,s){if(!(n<this.frames[0])){var o,a,h,l;if(n>=this.frames[this.frames.length-5]){var u=this.frames.length-1;o=this.frames[u-3],a=this.frames[u-2],h=this.frames[u-1],l=this.frames[u]}else{var c=e.binary(this.frames,n,5),p=this.frames[c-4],d=this.frames[c-3],f=this.frames[c-2],m=this.frames[c-1],g=this.frames[c],y=1-(n-g)/(this.frames[c-5]-g);y=this.curves.getCurvePercent(c/5-1,y),o=p+(this.frames[c+1]-p)*y,a=d+(this.frames[c+2]-d)*y,h=f+(this.frames[c+3]-f)*y,l=m+(this.frames[c+4]-m)*y}var v=t.slots[this.slotIndex];1>s?(v.r+=(o-v.r)*s,v.g+=(a-v.g)*s,v.b+=(h-v.b)*s,v.a+=(l-v.a)*s):(v.r=o,v.g=a,v.b=h,v.a=l)}},i}),define("spine/timelines/draw_order",["spine/search"],function(t){"use strict";function e(t){this.frames=[],this.frames.length=t,this.drawOrders=[],this.drawOrders.length=t}return e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},e.prototype.apply=function(e,i,n,r,s){if(!(n<this.frames[0])){var o;o=n>=this.frames[this.frames.length-1]?this.frames.length-1:t.binary(this.frames,n,1)-1;var a=e.drawOrder,h=e.slots,l=this.drawOrders[o];if(l)for(var u=0,c=l.length;c>u;u++)a[u]=e.slots[l[u]];else for(var u=0,c=h.length;c>u;u++)a[u]=h[u]}},e}),define("spine/timelines/event",["spine/search"],function(t){"use strict";function e(t){this.frames=[],this.frames.length=t,this.events=[],this.events.length=t}return e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.events[t]=i},e.prototype.apply=function(e,i,n,r,s){if(r){var o=this.frames.length;if(i>n)this.apply(e,i,Number.MAX_VALUE,r,s),i=-1;else if(i>=this.frames[o-1])return;if(!(n<this.frames[0])){var a;if(i<this.frames[0])a=0;else{a=t.binary(this.frames,i,1);for(var h=this.frames[a];a>0&&this.frames[a-1]==h;)a--}for(var l=this.events;o>a&&n>=this.frames[a];a++)r.push(l[a])}}},e}),define("spine/timelines/ffd",["spine/curves","spine/search"],function(t,e){"use strict";function i(e){this.curves=new t(e),this.frames=[],this.frames.length=e,this.frameVertices=[],this.frameVertices.length=e,this.slotIndex=0,this.attachment=0}return i.prototype.getFrameCount=function(){return this.frames.length},i.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},i.prototype.apply=function(t,i,n,r,s){var o=t.slots[slotIndex];if(o.attachment==attachment){if(n<this.frames[0])return void(o.attachmentVertices.length=0);var a=this.frameVertices,h=a[0].length,l=o.attachmentVertices;if(l.length!=h&&(s=1),l.length=h,n>=this.frames[this.frames.length-1]){var u=a[this.frames.length-1];if(1>s)for(var c=0;h>c;c++)l[c]+=(u[c]-l[c])*s;else for(var c=0;h>c;c++)l[c]=u[c]}else{var p=e.binary(this.frames,n,1),d=this.frames[p],f=1-(n-d)/(this.frames[p-1]-d);f=this.curves.getCurvePercent(p-1,f);var m=a[p-1],g=a[p];if(1>s)for(var c=0;h>c;c++){var y=m[c];l[c]+=(y+(g[c]-y)*f-l[c])*s}else for(var c=0;h>c;c++){var y=m[c];l[c]=y+(g[c]-y)*f}}}},i}),define("spine/timelines/rotate",["spine/curves","spine/search"],function(t,e){"use strict";function i(e){this.curves=new t(e),this.frames=[],this.frames.length=2*e,this.boneIndex=0}return i.prototype.getFrameCount=function(){return this.frames.length/2},i.prototype.setFrame=function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},i.prototype.apply=function(t,i,n,r,s){if(!(n<this.frames[0])){var o=t.bones[this.boneIndex];if(n>=this.frames[this.frames.length-2]){for(var a=o.data.rotation+this.frames[this.frames.length-1]-o.rotation;a>180;)a-=360;for(;-180>a;)a+=360;return void(o.rotation+=a*s)}var h=e.binary(this.frames,n,2),l=this.frames[h-1],u=this.frames[h],c=1-(n-u)/(this.frames[h-2]-u);c=this.curves.getCurvePercent(h/2-1,c);for(var a=this.frames[h+1]-l;a>180;)a-=360;for(;-180>a;)a+=360;for(a=o.data.rotation+(l+a*c)-o.rotation;a>180;)a-=360;
for(;-180>a;)a+=360;o.rotation+=a*s}},i}),define("spine/timelines/scale",["spine/curves","spine/search"],function(t,e){"use strict";function i(e){this.curves=new t(e),this.frames=[],this.frames.length=3*e,this.boneIndex=0}return i.prototype.getFrameCount=function(){return this.frames.length/3},i.prototype.setFrame=function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},i.prototype.apply=function(t,i,n,r,s){if(!(n<this.frames[0])){var o=t.bones[this.boneIndex];if(n>=this.frames[this.frames.length-3])return o.scaleX+=(o.data.scaleX-1+this.frames[this.frames.length-2]-o.scaleX)*s,void(o.scaleY+=(o.data.scaleY-1+this.frames[this.frames.length-1]-o.scaleY)*s);var a=e.binary(this.frames,n,3),h=this.frames[a-2],l=this.frames[a-1],u=this.frames[a],c=1-(n-u)/(this.frames[a+-3]-u);c=this.curves.getCurvePercent(a/3-1,c),o.scaleX+=(o.data.scaleX-1+h+(this.frames[a+1]-h)*c-o.scaleX)*s,o.scaleY+=(o.data.scaleY-1+l+(this.frames[a+2]-l)*c-o.scaleY)*s}},i}),define("spine/timelines/translate",["spine/curves","spine/search"],function(t,e){"use strict";function i(e){this.curves=new t(e),this.frames=[],this.frames.length=3*e,this.boneIndex=0}return i.prototype.getFrameCount=function(){return this.frames.length/3},i.prototype.setFrame=function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},i.prototype.apply=function(t,i,n,r,s){if(!(n<this.frames[0])){var o=t.bones[this.boneIndex];if(n>=this.frames[this.frames.length-3])return o.x+=(o.data.x+this.frames[this.frames.length-2]-o.x)*s,void(o.y+=(o.data.y+this.frames[this.frames.length-1]-o.y)*s);var a=e.binary(this.frames,n,3),h=this.frames[a-2],l=this.frames[a-1],u=this.frames[a],c=1-(n-u)/(this.frames[a+-3]-u);c=this.curves.getCurvePercent(a/3-1,c),o.x+=(o.data.x+h+(this.frames[a+1]-h)*c-o.x)*s,o.y+=(o.data.y+l+(this.frames[a+2]-l)*c-o.y)*s}},i}),define("spine/animation",function(){"use strict";function t(t,e,i){this.name=t,this.timelines=e,this.duration=i}return t.prototype.apply=function(t,e,i,n,r){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var s=0,o=this.timelines.length;o>s;s++)this.timelines[s].apply(t,e,i,r,1)},t.prototype.mix=function(t,e,i,n,r,s){n&&0!=this.duration&&(i%=this.duration,e%=this.duration);for(var o=0,a=this.timelines.length;a>o;o++)this.timelines[o].apply(t,e,i,r,s)},t}),define("spine/animation_state",["spine/track_entry"],function(t){"use strict";function e(t){this.data=t,this.tracks=[],this.events=[],this.onStart=null,this.onEnd=null,this.onComplete=null,this.onEvent=null,this.timeScale=1}return e.prototype.update=function(t){t*=this.timeScale;for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){if(i.time+=t*i.timeScale,i.previous){var n=t*i.previous.timeScale;i.previous.time+=n,i.mixTime+=n}var r=i.next;r?(r.time=i.lastTime-r.delay,r.time>=0&&this.setCurrent(e,r)):!i.loop&&i.lastTime>=i.endTime&&this.clearTrack(e)}}},e.prototype.apply=function(t){for(var e=0;e<this.tracks.length;e++){var i=this.tracks[e];if(i){this.events.length=0;var n=i.time,r=i.lastTime,s=i.endTime,o=i.loop;!o&&n>s&&(n=s);var a=i.previous;if(a){var h=a.time;!a.loop&&h>a.endTime&&(h=a.endTime),a.animation.apply(t,h,h,a.loop,null);var l=i.mixTime/i.mixDuration*i.mix;l>=1&&(l=1,i.previous=null),i.animation.mix(t,i.lastTime,n,o,this.events,l)}else 1==i.mix?i.animation.apply(t,i.lastTime,n,o,this.events):i.animation.mix(t,i.lastTime,n,o,this.events,i.mix);for(var u=0,c=this.events.length;c>u;u++){var p=this.events[u];null!=i.onEvent&&i.onEvent(e,p),null!=this.onEvent&&this.onEvent(e,p)}if(o?r%s>n%s:s>r&&n>=s){var d=Math.floor(n/s);i.onComplete&&i.onComplete(e,d),this.onComplete&&this.onComplete(e,d)}i.lastTime=i.time}}},e.prototype.clearTracks=function(){for(var t=0,e=this.tracks.length;e>t;t++)this.clearTrack(t);this.tracks.length=0},e.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];e&&(null!=e.onEnd&&e.onEnd(t),null!=this.onEnd&&this.onEnd(t),this.tracks[t]=null)}},e.prototype._expandToIndex=function(t){if(t<this.tracks.length)return this.tracks[t];for(;t>=this.tracks.length;)this.tracks.push(null);return null},e.prototype.setCurrent=function(t,e){var i=this._expandToIndex(t);if(i){var n=i.previous;i.previous=null,null!=i.onEnd&&i.onEnd(t),null!=this.onEnd&&this.onEnd(t),e.mixDuration=this.data.getMix(i.animation,e.animation),e.mixDuration>0&&(e.mixTime=0,n&&i.mixTime/i.mixDuration<.5?e.previous=n:e.previous=i)}this.tracks[t]=e,null!=e.onStart&&e.onStart(t),null!=this.onStart&&this.onStart(t)},e.prototype.setAnimationByName=function(t,e,i){var n=this.data.skeletonData.findAnimation(e);if(!n)throw new Error("Animation not found: "+e);return this.setAnimation(t,n,i)},e.prototype.setAnimation=function(e,i,n){var r=new t;return r.animation=i,r.loop=n,r.endTime=i.duration,this.setCurrent(e,r),r},e.prototype.addAnimationByName=function(t,e,i,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);return this.addAnimation(t,r,i,n)},e.prototype.addAnimation=function(e,i,n,r){var s=new t;s.animation=i,s.loop=n,s.endTime=i.duration;var o=this._expandToIndex(e);if(o){for(;o.next;)o=o.next;o.next=s}else this.tracks[e]=s;return 0>=r&&(o?r+=o.endTime-this.data.getMix(o.animation,i):r=0),s.delay=r,s},e.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},e}),define("spine/animation_state_data",function(){"use strict";function t(t){this.skeletonData=t,this.animationToMixTime={},this.defaultMix=0}return t.prototype.setMixByName=function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw new Error("Animation not found: "+t);var r=this.skeletonData.findAnimation(e);if(!r)throw new Error("Animation not found: "+e);this.setMix(n,r,i)},t.prototype.setMix=function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},t.prototype.getMix=function(t,e){var i=this.animationToMixTime[t.name+":"+e.name];return"undefined"!=typeof i?i:this.defaultMix},t}),define("spine/bone",function(){"use strict";function t(t,e){this.data=t,this.parent=e,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.m00=0,this.m01=0,this.m10=0,this.m11=0,this.worldX=0,this.worldY=0,this.worldRotation=0,this.worldScaleX=1,this.worldScaleY=1,this.setToSetupPose()}return t.yDown=!0,t.prototype.updateWorldTransform=function(e,i){null!=this.parent?(this.worldX=this.x*this.parent.m00+this.y*this.parent.m01+this.parent.worldX,this.worldY=this.x*this.parent.m10+this.y*this.parent.m11+this.parent.worldY,this.data.inheritScale?(this.worldScaleX=this.parent.worldScaleX*this.scaleX,this.worldScaleY=this.parent.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.rotation,this.data.inheritRotation&&(this.worldRotation+=this.parent.worldRotation)):(this.worldX=e?-this.x:this.x,this.worldY=i!=t.yDown?-this.y:this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var n=this.worldRotation*Math.PI/180,r=Math.cos(n),s=Math.sin(n);this.m00=r*this.worldScaleX,this.m10=s*this.worldScaleX,this.m01=-s*this.worldScaleY,this.m11=r*this.worldScaleY,e&&(this.m00=-this.m00,this.m01=-this.m01),i!=t.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},t.prototype.setToSetupPose=function(){this.x=this.data.x,this.y=this.data.y,this.rotation=this.data.rotation,this.scaleX=this.data.scaleX,this.scaleY=this.data.scaleY},t}),define("spine/bone_data",function(){"use strict";function t(t,e){this.name=t,this.parent=e,this.length=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.inheritScale=!0,this.inheritRotation=!0}return t}),define("spine/event",function(){"use strict";function t(t){this.data=t,this.intValue=0,this.floatValue=0,this.stringValue=null}return t}),define("spine/event_data",function(){"use strict";function t(t){this.name=t,this.intValue=0,this.floatValue=0,this.stringValue=null}return t}),define("spine/slot",function(){"use strict";function t(t,e,i){this.data=t,this.skeleton=e,this.bone=i,this.r=1,this.g=1,this.b=1,this.a=1,this._attachmentTime=0,this.attachment=null,this.attachmentVertices=[],this.setToSetupPose()}return t.prototype.setAttachment=function(t){this.attachment=t,this._attachmentTime=this.skeleton.time,this.attachmentVertices.length=0},t.prototype.setAttachmentTime=function(t){this._attachmentTime=this.skeleton.time-t},t.prototype.getAttachmentTime=function(){return this.skeleton.time-this._attachmentTime},t.prototype.setToSetupPose=function(){this.r=this.data.r,this.g=this.data.g,this.b=this.data.b,this.a=this.data.a;for(var t=this.skeleton.data.slots,e=0,i=t.length;i>e;e++)if(t[e]==this.data){this.setAttachment(this.data.attachmentName?this.skeleton.getAttachmentBySlotIndex(e,this.data.attachmentName):null);break}},t}),define("spine/slot_data",function(){"use strict";function t(t,e){this.name=t,this.boneData=e,this.r=1,this.g=1,this.b=1,this.a=1,this.attachmentName=null,this.additiveBlending=!1}return t}),define("spine/skin",function(){"use strict";function t(t){this.name=t,this.attachments={}}return t.prototype.addAttachment=function(t,e,i){this.attachments[t+":"+e]=i},t.prototype.getAttachment=function(t,e){return this.attachments[t+":"+e]},t.prototype._attachAll=function(t,e){for(var i in this.attachments){var n=i.indexOf(":"),r=parseInt(i.substring(0,n)),s=i.substring(n+1),o=t.slots[r];if(!o.attachment||o.attachment&&o.attachment.name!==s){var a=this.getAttachment(r,s);a&&o.setAttachment(a)}}},t}),define("spine/skeleton",["spine/bone","spine/slot"],function(t,e){"use strict";function i(i){this.data=i,this.bones=[];for(var n=0,r=i.bones.length;r>n;n++){var s=i.bones[n],o=s.parent?this.bones[i.bones.indexOf(s.parent)]:null;this.bones.push(new t(s,o))}this.slots=[],this.drawOrder=[];for(var n=0,r=i.slots.length;r>n;n++){var a=i.slots[n],h=this.bones[i.bones.indexOf(a.boneData)],l=new e(a,this,h);this.slots.push(l),this.drawOrder.push(l)}this.x=0,this.y=0,this.skin=null,this.r=1,this.g=1,this.b=1,this.a=1,this.time=0,this.flipX=!1,this.flipY=!1}return i.prototype.updateWorldTransform=function(){for(var t=0,e=this.bones.length;e>t;t++)this.bones[t].updateWorldTransform(this.flipX,this.flipY)},i.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},i.prototype.setBonesToSetupPose=function(){for(var t=0,e=this.bones.length;e>t;t++)this.bones[t].setToSetupPose()},i.prototype.setSlotsToSetupPose=function(){for(var t=0,e=this.slots.length;e>t;t++)this.drawOrder[t]=this.slots[t],this.slots[t].setToSetupPose(t)},i.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},i.prototype.findBone=function(t){for(var e=0,i=this.bones.length;i>e;e++)if(this.bones[e].data.name==t)return this.bones[e];return null},i.prototype.findBoneIndex=function(t){for(var e=0,i=this.bones.length;i>e;e++)if(this.bones[e].data.name==t)return e;return-1},i.prototype.findSlot=function(t){for(var e=0,i=this.slots.length;i>e;e++)if(this.slots[e].data.name==t)return this.slots[e];return null},i.prototype.findSlotIndex=function(t){for(var e=0,i=this.slots.length;i>e;e++)if(this.slots[e].data.name==t)return e;return-1},i.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(!e)throw new Error("Skin not found: "+t);this.setSkin(e)},i.prototype.setSkin=function(t){if(t)if(this.skin)t._attachAll(this,this.skin);else for(var e=0,i=this.slots.length;i>e;e++){var n=this.slots[e],r=n.data.attachmentName;if(r){var s=t.getAttachment(e,r);s&&n.setAttachment(s)}}this.skin=t},i.prototype.getAttachmentBySlotName=function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},i.prototype.getAttachmentBySlotIndex=function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},i.prototype.setAttachment=function(t,e){for(var i=0,n=this.slots.length;n>i;i++){var r=this.slots[i];if(r.data.name==t){var s=null;if(e&&(s=this.getAttachmentBySlotIndex(i,e),!s))throw new Error("Attachment not found: "+e+", for slot: "+t);return void r.setAttachment(s)}}throw new Error("Slot not found: "+t)},i.prototype.update=function(t){this.time+=t},i}),define("spine/skeleton_data",function(){"use strict";function t(){this.bones=[],this.slots=[],this.skins=[],this.events=[],this.animations=[],this.defaultSkin=null}return t.prototype.findBone=function(t){for(var e=0,i=this.bones.length;i>e;e++)if(this.bones[e].name==t)return this.bones[e];return null},t.prototype.findBoneIndex=function(t){for(var e=0,i=this.bones.length;i>e;e++)if(this.bones[e].name==t)return e;return-1},t.prototype.findSlot=function(t){for(var e=0,i=this.slots.length;i>e;e++)if(this.slots[e].name==t)return this.slot[e];return null},t.prototype.findSlotIndex=function(t){for(var e=0,i=this.slots.length;i>e;e++)if(this.slots[e].name==t)return e;return-1},t.prototype.findSkin=function(t){for(var e=0,i=this.skins.length;i>e;e++)if(this.skins[e].name==t)return this.skins[e];return null},t.prototype.findEvent=function(t){for(var e=0,i=this.events.length;i>e;e++)if(this.events[e].name==t)return this.events[e];return null},t.prototype.findAnimation=function(t){for(var e=0,i=this.animations.length;i>e;e++)if(this.animations[e].name==t)return this.animations[e];return null},t}),define("spine/skeleton_json",function(){"use strict";function t(){this.scale=1}var e=require("spine/bone_data"),i=require("spine/event_data"),n=require("spine/slot_data"),r=require("spine/skeleton_data"),s=require("spine/attachments/base"),o=require("spine/attachments/region"),a=require("spine/timelines/attachment"),h=require("spine/timelines/color"),l=require("spine/timelines/draw_order"),u=require("spine/timelines/event"),c=require("spine/timelines/ffd"),p=require("spine/timelines/rotate"),d=require("spine/timelines/scale"),f=require("spine/timelines/translate"),m=require("spine/animation"),g=require("spine/event"),y=require("spine/skin");return t.prototype.readSkeletonData=function(t){for(var s=new r,o=t.bones||[],a=0,h=o.length;h>a;a++){var l=o[a],u=null;if(l.parent&&(u=s.findBone(l.parent),!u))throw new Error("Parent bone not found: "+l.parent);var c=new e(l.name,u);c.length=(l.length||0)*this.scale,c.x=(l.x||0)*this.scale,c.y=(l.y||0)*this.scale,c.rotation=l.rotation||0,c.scaleX=l.hasOwnProperty("scaleX")?l.scaleX:1,c.scaleY=l.hasOwnProperty("scaleY")?l.scaleY:1,c.inheritScale=!(l.inheritScale===!1),c.inheritRotation=!(l.inheritRotation===!1),s.bones.push(c)}for(var p=t.slots||[],a=0,h=p.length;h>a;a++){var d=p[a],c=s.findBone(d.bone);if(!c)throw new Error("Slot bone not found: "+d.bone);var f=new n(d.name,c),m=d.color;m&&(f.r=this.toColor(m,0),f.g=this.toColor(m,1),f.b=this.toColor(m,2),f.a=this.toColor(m,3)),f.attachmentName=d.attachment,f.additiveBlending=d.additive&&"true"==d.additive,s.slots.push(f)}var g=t.skins;for(var v in g)if(g.hasOwnProperty(v)){var x=g[v],b=new y(v);for(var w in x)if(x.hasOwnProperty(w)){var _=s.findSlotIndex(w),T=x[w];for(var E in T)if(T.hasOwnProperty(E)){var S=this.readAttachment(b,E,T[E]);null!=S&&b.addAttachment(_,E,S)}}s.skins.push(b),"default"==b.name&&(s.defaultSkin=b)}var A=t.events;for(var C in A)if(A.hasOwnProperty(C)){var P=A[C],M=new i(C);M.intValue=P["int"]||0,M.floatValue=P["float"]||0,M.stringValue=P.string||null,s.events.push(M)}var O=t.animations;for(var R in O)O.hasOwnProperty(R)&&this.readAnimation(R,O[R],s);return s},t.prototype.readAttachment=function(t,e,i){e=i.name||e;var n=s[i.type||"region"];i.path||e,this.scale;if(n==s.region){var r=new o(e);r.x=(i.x||0)*this.scale,r.y=(i.y||0)*this.scale,r.scaleX=i.scaleX||1,r.scaleY=i.scaleY||1,r.rotation=i.rotation||0,r.width=(i.width||0)*this.scale,r.height=(i.height||0)*this.scale;var a=i.color;return a&&(r.r=this.toColor(a,0),r.g=this.toColor(a,1),r.b=this.toColor(a,2),r.a=this.toColor(a,3)),r.updateOffset(),r.rendererObject={},r.rendererObject.name=e,r.rendererObject.scale={},r.rendererObject.scale.x=r.scaleX,r.rendererObject.scale.y=r.scaleY,r.rendererObject.rotation=-r.rotation*Math.PI/180,r}throw new Error("Unknown attachment type: "+n)},t.prototype.readAnimation=function(t,e,i){var n=[],r=0,o=e.slots;for(var y in o)if(o.hasOwnProperty(y)){var v=o[y],x=i.findSlotIndex(y);for(var b in v)if(v.hasOwnProperty(b)){var w=v[b];if("color"==b){var _=new h(w.length);_.slotIndex=x;for(var T=0,E=0,S=w.length;S>E;E++){var A=w[E],C=A.color,P=this.toColor(C,0),M=this.toColor(C,1),O=this.toColor(C,2),R=this.toColor(C,3);_.setFrame(T,A.time,P,M,O,R),this.readCurve(_,T,A),T++}n.push(_),r=Math.max(r,_.frames[5*_.getFrameCount()-5])}else{if("attachment"!=b)throw new Error("Invalid timeline type for a slot: "+b+" ("+y+")");var _=new a(w.length);_.slotIndex=x;for(var T=0,E=0,S=w.length;S>E;E++){var A=w[E];_.setFrame(T++,A.time,A.name)}n.push(_),r=Math.max(r,_.frames[_.getFrameCount()-1])}}}var k=e.bones;for(var I in k)if(k.hasOwnProperty(I)){var D=i.findBoneIndex(I);if(-1==D)throw new Error("Bone not found: "+I);var L=k[I];for(var b in L)if(L.hasOwnProperty(b)){var w=L[b];if("rotate"==b){var _=new p(w.length);_.boneIndex=D;for(var T=0,E=0,S=w.length;S>E;E++){var A=w[E];_.setFrame(T,A.time,A.angle),this.readCurve(_,T,A),T++}n.push(_),r=Math.max(r,_.frames[2*_.getFrameCount()-2])}else{if("translate"!=b&&"scale"!=b)throw new Error("Invalid timeline type for a bone: "+b+" ("+I+")");var _,F=1;"scale"==b?_=new d(w.length):(_=new f(w.length),F=this.scale),_.boneIndex=D;for(var T=0,E=0,S=w.length;S>E;E++){var A=w[E],B=(A.x||0)*F,N=(A.y||0)*F;_.setFrame(T,A.time,B,N),this.readCurve(_,T,A),T++}n.push(_),r=Math.max(r,_.frames[3*_.getFrameCount()-3])}}}var G=e.ffd;for(var q in G){var z=i.findSkin(q),v=G[q];for(y in v){var x=i.findSlotIndex(y),U=v[y];for(var j in U){var w=U[j],_=new c(w.length),H=z.getAttachment(x,j);if(!H)throw new Error("FFD attachment not found: "+j);_.slotIndex=x,_.attachment=H;var W,Y=H.type==s.mesh;W=Y?H.vertices.length:H.weights.length/3*2;for(var T=0,E=0,S=w.length;S>E;E++){var X,A=w[E];if(A.vertices){var K=A.vertices,X=[];X.length=W;var V=A.offset||0,Z=K.length;if(1==scale)for(var J=0;Z>J;J++)X[J+V]=K[J];else for(var J=0;Z>J;J++)X[J+V]=K[J]*scale;if(Y)for(var Q=H.vertices,J=0,Z=X.length;Z>J;E++)X[J]+=Q[J]}else Y?X=H.vertices:(X=[],X.length=W);_.setFrame(T,A.time,X),this.readCurve(_,T,A),T++}n[n.length]=_,r=Math.max(r,_.frames[_.frameCount-1])}}}var $=e.drawOrder;if($){for(var _=new l($.length),tt=i.slots.length,T=0,E=0,S=$.length;S>E;E++){var et=$[E],it=null;if(et.offsets){it=[],it.length=tt;for(var J=tt-1;J>=0;J--)it[J]=-1;var nt=et.offsets,rt=[];rt.length=tt-nt.length;for(var st=0,ot=0,J=0,Z=nt.length;Z>J;J++){var at=nt[J],x=i.findSlotIndex(at.slot);if(-1==x)throw new Error("Slot not found: "+at.slot);for(;st!=x;)rt[ot++]=st++;it[st+at.offset]=st++}for(;tt>st;)rt[ot++]=st++;for(var J=tt-1;J>=0;J--)-1==it[J]&&(it[J]=rt[--ot])}_.setFrame(T++,et.time,it)}n.push(_),r=Math.max(r,_.frames[_.getFrameCount()-1])}var ht=e.events;if(ht){for(var _=new u(ht.length),T=0,E=0,S=ht.length;S>E;E++){var lt=ht[E],ut=i.findEvent(lt.name);if(!ut)throw new Error("Event not found: "+lt.name);var ct=new g(ut);ct.intValue=lt.hasOwnProperty("int")?lt["int"]:ut.intValue,ct.floatValue=lt.hasOwnProperty("float")?lt["float"]:ut.floatValue,ct.stringValue=lt.hasOwnProperty("string")?lt.string:ut.stringValue,_.setFrame(T++,lt.time,ct)}n.push(_),r=Math.max(r,_.frames[_.getFrameCount()-1])}i.animations.push(new m(t,n,r))},t.prototype.readCurve=function(t,e,i){var n=i.curve;n&&("stepped"==n?t.curves.setStepped(e):n instanceof Array&&t.curves.setCurve(e,n[0],n[1],n[2],n[3]))},t.prototype.toColor=function(t,e){if(8!=t.length)throw new Error("Color hexidecimal length must be 8, recieved: "+t);return parseInt(t.substring(2*e,2*e+2),16)/255},t.prototype.getFloatArray=function(t,e,i){var n=t[e],r=[];r=n.length;var s=0,o=n.length;if(1==i)for(;o>s;s++)r[s]=n[s];else for(;o>s;s++)r[s]=n[s]*i;return r},t.prototype.getIntArray=function(t,e){var i=t[e],n=[];n=i.length;for(var r=0,s=i.length;s>r;r++)n[r]=0|i[r];return n},t}),define("pixi/spine",["pixi","spine/skeleton","spine/animation_state_data","spine/animation_state","spine/attachments/region"],function(t,e,i,n,r){"use strict";function s(r){if(t.Container.call(this),this.spineData=r,!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+url);this.skeleton=new e(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new i(this.spineData),this.state=new n(this.stateData),this.spriteContainers={},this.sprites={};for(var s=0,o=this.skeleton.drawOrder.length;o>s;s++){var a=new t.Sprite;a.anchor.set(.5,.5),this.spriteContainers[this.skeleton.drawOrder[s].data.name]=a,this.addChild(a)}this.update(0)}var o=require("nebula/colors/rgb");return s.prototype=Object.create(t.Container.prototype),s.prototype.drawOrderToNames=function(){for(var t=[],e=0;e<this.skeleton.drawOrder.length;e++)t.push(this.skeleton.drawOrder[e].data.name);return t},s.prototype.update=function(e){this.state.update(e),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var i=this.skeleton.drawOrder,n=0,s=i.length;s>n;n++){var a=i[n],h=a.bone,l=a.data.name,u=a.attachment,c=this.spriteContainers[l];if(this.children[n]!==c&&(this.children[n]=c),c.position.x=h.worldX,c.position.y=h.worldY,c.alpha=a.a,c.scale.x=h.worldScaleX,c.scale.y=h.worldScaleY,c.rotation=-a.bone.worldRotation*Math.PI/180,u instanceof r){if(u.rendererObject){if(!u.rendererObject.name){c.texture!==t.Texture.EMPTY&&(this.sprites[l]=null,c.texture=t.Texture.EMPTY);continue}var p=this.getTexture(u.rendererObject.name);p!==c.texture&&(c.texture=p,this.sprites[l]=c,u.height&&u.height!==p.height&&(u.rendererObject.scale.y=u.height/p.height),u.width&&u.width!==p.width&&(u.rendererObject.scale.x=u.width/p.width)),c.scale.x=h.worldScaleX*u.rendererObject.scale.x,c.scale.y=h.worldScaleY*u.rendererObject.scale.y,c.rotation=-a.bone.worldRotation*Math.PI/180+u.rendererObject.rotation,c.position.x+=u.x*h.m00+u.y*h.m01,c.position.y+=u.x*h.m10+u.y*h.m11,c.tint=o.pack(u)}}else c.texture!==t.Texture.EMPTY&&(this.sprites[l]=null,c.texture=t.Texture.EMPTY)}},s.prototype.getTexture=function(e){var i=t.utils.TextureCache[e]||t.utils.TextureCache[e+".png"];if(!i)throw new Error("No texture");return i},s}),define("assets",function(){"use strict";var t=require("settings"),e={};if(e.templates=["gui/alert.txt","gui/button.txt","gui/button_small.txt","gui/button_steam.txt","gui/checkbox.txt","gui/choice_container.txt","gui/container.txt","gui/container_large.txt","gui/container_medium.txt","gui/controls_keyboard.txt","gui/cup_team_select.txt","gui/full_version.txt","gui/help.txt","gui/help_advanced.txt","gui/help_basics.txt","gui/help_goalkeeper.txt","gui/help_passing.txt","gui/help_shooting.txt","gui/help_slide_tackle.txt","gui/help_super_moves.txt","gui/input_binder.txt","gui/intro.txt","gui/in_game.txt","gui/leaderboards.txt","gui/loading.txt","gui/main_menu.txt","gui/match_summary.txt","gui/overlay.txt","gui/pause.txt","gui/slider_image.txt","gui/team.txt","gui/team_container.txt","gui/team_select.txt","gui/tournament.txt","gui/_fame_widget.txt","gui/_footer.txt","gui/_svg_button.txt","gui/_svg_button_small.txt","gui/_svg_thumbnail_big.txt","gui/_svg_trophy_shelf.txt"],e.races=["images/player/races/african/race.json","images/player/races/caucasian/race.json","images/player/races/mulatto/race.json"],e.teams=["images/teams/argentina/team.json","images/teams/brazil/team.json","images/teams/czech_republic/team.json","images/teams/england/team.json","images/teams/france/team.json","images/teams/germany/team.json","images/teams/netherlands/team.json","images/teams/spain/team.json"],e.ball=["images/ball/texture.png","images/ball/shadow.png"],e.stadium=["images/stadium/goal.json","images/stadium/other.json","images/stadium/fans.png","images/stadium/podium_background.jpg","images/stadium/base.jpg"],e.powerups=["images/powerups/supershot/icon.png","images/powerups/supershot/overlay.png","images/powerups/supershot/glow.png","images/powerups/supershot/glow_center.png","images/powerups/supershot/air_flow.png"],e.other=["data/player.json","images/ball_air_flow.png","images/cup.png","images/shadow.png","images/indicators.json","images/signs.json","images/interface/match.json","images/all.json"],e.particles=["images/particles/grass.json","images/particles/confetti/confetti.json","images/particles/flash.png","images/particles/hit.png"],e.sounds=["audio/ball_hit/goal/01.ogg","audio/ball_hit/goal/02.ogg","audio/ball_land/01.ogg","audio/crowd/booing/01.ogg","audio/crowd/booing/02.ogg","audio/crowd/calm/01.ogg","audio/crowd/cheering/01.ogg","audio/crowd/cheering/02.ogg","audio/crowd/cheering/03.ogg","audio/crowd/cheering/04.ogg","audio/crowd/cheering/05.ogg","audio/crowd/ovation/01.ogg","audio/crowd/ovation/02.ogg","audio/crowd/ovation/03.ogg","audio/kick/lob/01.ogg","audio/kick/lob/02.ogg","audio/kick/lob/03.ogg","audio/kick/regular/01.ogg","audio/kick/regular/02.ogg","audio/kick/regular/03.ogg","audio/kick/regular/04.ogg","audio/kick/regular/05.ogg","audio/kick/regular/06.ogg","audio/kick/regular/07.ogg","audio/kick/regular/08.ogg","audio/kick/strong/01.ogg","audio/kick/strong/02.ogg","audio/kick/strong/03.ogg","audio/menu_music/theme_3.ogg","audio/menu_sounds/focus.ogg","audio/menu_sounds/select.ogg","audio/menu_sounds/select_invalid.ogg","audio/powerups/supershot_move.ogg","audio/powerups/supershot_prepare.ogg","audio/slow_motion/01.ogg","audio/tackle/hit/01.ogg","audio/tackle/hit/02.ogg","audio/tackle/hit/03.ogg","audio/tackle/shouting/01.ogg","audio/tackle/shouting/02.ogg","audio/tackle/shouting/03.ogg","audio/tackle/shouting/04.ogg","audio/tackle/shouting/05.ogg","audio/tackle/slide/01.ogg","audio/tackle/slide/02.ogg","audio/tackle/slide/03.ogg","audio/whistle/double.ogg","audio/whistle/single.ogg"],!t("OGG_SUPPORT"))for(var i=0;i<e.sounds.length;i++)e.sounds[i]=e.sounds[i].replace(".ogg",".m4a");return Object.defineProperty(e,"all",{get:function(){var t=[];for(var i in this)"templates"!==i&&(t=t.concat(e[i]));return t}}),e}),define("influence_map",function(){"use strict";function t(t,i,n,r,s,o,a,h){this.spots=[],this.time=0,this.frequency=o,this.delay=1/o,this.callback=a,this.context=h,this.max=null,this.invalid=!0,this.cols=r,this.rows=s,t||(t=e.ZERO);for(var l=0;s>l;l++)for(var u=0;r>u;u++)this.spots.push({value:0,position:e.create()});this.reposition(t,i,n)}var e=require("nebula/math/point2");return t.prototype.clear=function(){this.max=null,this.invalid=!0,this.time=0;for(var t=0;t<this.spots.length;t++)this.spots[t].value=0},t.prototype.reposition=function(t,i,n){this.origin=t||e.ZERO,this.width=i,this.height=n;for(var r=0;r<this.rows;r++)for(var s=0;s<this.cols;s++){var o=r*this.cols+s;this.spots[o].position.x=this.origin.x+s*this.width+this.width/2,this.spots[o].position.y=this.origin.y+r*this.height+this.height/2}},t.prototype.calculate=function(){var t=-(1/0);if(this.time=0,this.max=null,this.context)for(var e=0;e<this.spots.length;e++){var i=this.spots[e];this.callback.call(this.context,i),i.value>t&&(t=i.value,this.max=i)}else for(var e=0;e<this.spots.length;e++){var i=this.spots[e];this.callback(i),i.value>t&&(t=i.value,this.max=i)}this.invalid=!1},t.prototype.update=function(t){this.time+=t,this.time<this.delay||(this.calculate(),this.time-=this.delay)},t}),define("controller",["nebula/signal","nebula/math/vector2"],function(t,e){"use strict";function i(t,e){this.str=e,this.device=t,this.parse(e),this.lastState}function n(t,e,n){this.device=t,this.condition=new i(t,n),this.name=e,this.isActive=!1,this._oldState=!1,this.repeatDelay=this._repeatDelay=.5,this.repeatInterval=this._repeatInterval=.1}function r(t,i){this.direction=e.create(),this.velocity=e.create(),this.apis=t instanceof Array?t:[t],this._actions=[],this.setActions(i)}var s=require("settings"),o=require("nebula/format"),a=s("CONTROLLER_ACTIONS",{});return i.prototype.parse=function(t){if(t.indexOf("|")>-1){this.check=this.checkOr,this.conditions=[];for(var e=t.split("|"),n=0;n<e.length;n++)this.conditions.push(new i(this.device,e[n]))}else if("+"===t[0]&&(this.justPressed=!0,t=t.slice(1)),"-"===t[0]&&(this.justReleased=!0,t=t.slice(1)),t.indexOf("+")>-1){this.check=this.checkAnd,this.conditions=[];for(var e=t.split("+"),n=0;n<e.length;n++)this.conditions.push(new i(this.device,e[n]))}else this.control=this.device.getControl(t)},i.prototype._check=function(t){return this.justPressed?this.lastState===!1&&t?this.lastState=!0:(t||(this.lastState=!1),!1):this.justReleased?this.lastState!==!1||t?(t&&(this.lastState=!1),!1):this.lastState=!0:t},i.prototype.checkOr=function(){for(var t=0;t<this.conditions.length;t++)if(this.conditions[t].check())return!0;return!1},i.prototype.checkAnd=function(){for(var t=0;t<this.conditions.length;t++)if(!this.conditions[t].check())return this._check(!1);return this._check(!0)},i.prototype.check=function(){return this.control?this._check(this.control.isDown):!1},Object.defineProperty(i.prototype,"value",{get:function(){if(this.control)return this.control.value;if(!this.conditions)return 0;for(var t=0,e=0;e<this.conditions.length;e++)t=Math.max(t,this.conditions[e].value);return t}}),n.prototype.update=function(t){this.isActive=this.condition.check(),this.isActive&&this._oldState===!0?(this._repeatDelay-=t,this._repeatInterval-=t,this._repeatDelay<0&&this._repeatInterval<0&&(this._repeatInterval=this.repeatInterval,r.onRepeat.send(this.device,this))):(this._repeatDelay=this.repeatDelay,this._repeatInterval=this.repeatInterval),this._oldState===!1&&this.isActive===!0?r.onDown.send(this.device,this):this._oldState===!0&&this.isActive===!1&&r.onUp.send(this.device,this),this._oldState=this.isActive},Object.defineProperty(n.prototype,"value",{get:function(){return this.condition.value}}),r.onUp=new t,r.onDown=new t,r.onRepeat=new t,r.prototype.is=function(t){return this.apis.indexOf(t)>=0},r.prototype.getControl=function(t){for(var e=null,i=0;i<this.apis.length;i++)try{e=this.apis[i].parseKeyNames(t)[0]}catch(n){}return e},r.prototype.setActions=function(t){for(var e=0;e<this._actions.length;e++)delete this[this._actions.name];this._actions.length=0,this.actionNames=Object.keys(a);for(var i in a){var r=new n(this,i,o(a[i],t));this[i]=r,this._actions.push(r)}},r.prototype.update=function(t){this.direction.x=this.right.value-this.left.value,this.direction.y=this.down.value-this.up.value,e.normalize(this.direction,this.direction),this.velocity.x=this.right.value-this.left.value,this.velocity.y=this.down.value-this.up.value,e.truncateLength(this.velocity,1,this.velocity);for(var i=0;i<this._actions.length;i++)this._actions[i].update(t)},r}),define("image_packer",["settings","pixi"],function(t,e){"use strict";function i(t){2===t.length&&(t=[0,0,t[0],t[1]]),this.area=t,this.width=this.area[2]-this.area[0],this.height=this.area[3]-this.area[1]}function n(t,e){return e.height-t.height}function r(s,o,a,h,l,u){o=o||256,a=a||256,h=h||0,l=l||"";var c=new i([o,a]),p=new e.RenderTexture(require("main").renderer,o,a),d={},f=new e.Container;s=s.concat().sort(n),p.baseTexture.source=!0;for(var m=0;m<s.length;m++){var g=s[m],y=c.insert([g.width+h,g.height+h]);if(!y){if(u){var v=o,x=a;return o>a?x*=2:v*=2,t("DEBUG")&&t("IMAGE_PACKER_DEBUG")&&console.log("Pack size too small. Resizing to "+v+"x"+x),r(s,v,x,h,l,u)}throw new Error("Pack size too small")}var b=new e.BaseTexture(g),w=new e.Texture(b),_=new e.Sprite(w);_.position.x=y.area[0],_.position.y=y.area[1],f.addChild(_),d[g.fakeSrc||g.getAttribute("src")]=new e.Rectangle(y.area[0],y.area[1],g.width,g.height)}p.render(f);for(var m=0;m<f.children.length;m++)f.children[m].texture.destroy(!0);t("DEBUG")&&t("IMAGE_PACKER_DEBUG")&&(console.log("Image packer",d),window.open(p.getBase64()));var T={};for(var E in d)T[E]=new e.Texture(p.baseTexture,d[E]),e.Texture.addTextureToCache(T[E],E+l);return{frames:d,atlas:p,textures:T}}return i.prototype.insert=function(t){if(this.children){var e=this.children[0].insert(t);return e?e:this.children[1].insert(t)}return t=new i(t),t.width<=this.width&&t.height<=this.height?(this.children=[],
this.children[0]=new i([this.area[0]+t.width,this.area[1],this.area[2],this.area[1]+t.height]),this.children[1]=new i([this.area[0],this.area[1]+t.height,this.area[2],this.area[3]]),new i([this.area[0],this.area[1],this.area[0]+t.width,this.area[1]+t.height])):void 0},r}),define("messages",["nebula/messages"],function(t){return t.build("humanShoot","humanHeader","humanPass","humanLob","humanSlide","trap","releaseBall","steal","collision","hit","freeze","supportAttacker","receiveBall","receiveLob","requestPass","wait","markOpponent","interceptBall","canPlay","isReady","play","ballOutOfPlay","goalKick","kickoff","throwIn","corner","goal","joinGoalCelebrationPlane","reset","beginMatch","beginPractice","changeSides","goldenGoal","endMatch","supershotPrepare","supershotKick","supershotHit","supershotEnd","magnet","superspeedStart","superspeedEnd","powerup","userConnect","userDisconnect")}),define("region",["nebula/math/point2","nebula/math/geometry"],function(t,e){"use strict";function i(e,i,n,r){this.id=null,this.top=this.y=i,this.right=e+n,this.bottom=i+r,this.left=this.x=e,this.center=t.create(e+n/2,i+r/2),this.width=n,this.height=r,this.topLeft=t.create(e,i),this.topRight=t.create(e+n,i),this.bottomRight=t.create(e+n,i+r),this.bottomLeft=t.create(e,i+r)}return i.prototype.contains=function(t){return e.pointInRectangle(t,this.left,this.top,this.width,this.height)},{Region:i}}),define("net",function(){"use strict";function t(t){if(this.minWind&&(this.position.x+=this.minWind.x+(this.maxWind.x-this.minWind.x)*Math.random(),this.position.y+=this.minWind.y+(this.maxWind.y-this.minWind.y)*Math.random()),this.position.z-=981e-6,this.position.z<0&&(this.position.z=0),this.velocity.x=this.position.x-this.oldPosition.x,this.velocity.y=this.position.y-this.oldPosition.y,this.velocity.z=this.position.z-this.oldPosition.z,this.speed=h.length(this.velocity),this.speed){var e=this.speed;this.speed=Math.max(0,this.speed-.05*t),0===this.speed?this.velocity.x=this.velocity.y=this.velocity.z=0:(this.velocity.x=this.velocity.x/e*this.speed,this.velocity.y=this.velocity.y/e*this.speed,this.velocity.z=this.velocity.z/e*this.speed,this.oldPosition.x=this.position.x,this.oldPosition.y=this.position.y,this.oldPosition.z=this.position.z,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.position.z+=this.velocity.z)}}function e(){return{position:l.create(),oldPosition:l.create(),velocity:h.create(),minWind:null,maxWind:null,speed:0,movable:!0,update:t}}function i(t){var e=this.point1.position,i=this.point2.position,n=e.x-i.x,r=e.y-i.y,s=e.z-i.z,o=Math.sqrt(n*n+r*r+s*s);if(o>=this.length){var a=.2*(this.length-o);n=n/o*a,r=r/o*a,s=s/o*a,this.point1.movable&&(e.x+=n,e.y+=r,e.z+=s),this.point2.movable&&(i.x-=n,i.y-=r,i.z-=s)}}function n(t){return{point1:t.point1,point2:t.point2,length:t.length||1.25*l.distance(t.point1.position,t.point2.position),update:i}}function r(t,e,i){this.a=t,this.b=e,this.c=i}function s(t){o.apply(this,arguments),this.sidePoints=[],this.topPoints=[],this.points=[],this.constraints=[],this.triangles=[],this.divideX=t.divideX,this.divideY=t.divideY,this.topDivideY=t.topDivideY,this.topDivideX=this.divideX-2*(this.topDivideY+1),this.windEnabled=!1,this.windAngle=0,this._windStrength=0,this._windForce=0,this.minWind=h.create(),this.maxWind=h.create();var i=h.create();l.difference(t.point1,t.start,i);var n=h.create();l.difference(t.point2,t.start,n);for(var r=.1,s=0;s<this.divideY;s++)for(var a=0;a<this.divideX;a++){var u=e();u.oldPosition.x=u.position.x=t.start.x+i.x*a/(this.divideX-1)+n.x*s/(this.divideY-1),u.oldPosition.y=u.position.y=t.start.y+i.y*a/(this.divideX-1)+n.y*s/(this.divideY-1),u.oldPosition.z=u.position.z=t.start.z+i.z*a/(this.divideX-1)+n.z*s/(this.divideY-1),this.sidePoints.push(u),this.points.push(u)}for(var c=null,s=0;s<this.divideY;s++){var p=this.points.slice(s*this.divideX,(s+1)*this.divideX);this.line(p,r),s>0&&this.stich(c,p,r),c=p}r=.1;for(var d=this.topDivideY,f=this.topDivideX,s=0;d>s;s++)for(var a=0;f>a;a++){var u=e();u.oldPosition.x=u.position.x=t.start.x+i.x*a/(f-1)+n.x*s/(d-1),u.oldPosition.y=u.position.y=t.start.y+i.y*a/(f-1)+n.y*s/(d-1),u.oldPosition.z=u.position.z=t.start.z+i.z*a/(f-1)+n.z*s/(d-1),this.topPoints.push(u),this.points.push(u)}for(var c=null,s=0;d>s;s++){var p=this.topPoints.slice(s*f,s*f+f);this.line(p,r),s>0&&this.stich(c,p,r),c=p}for(var m=[],g=[],s=0;d>s;s++)m.push(this.topPoints[s*f]);g=this.points.slice(0,d),this.stich(m,g,r),m=[];for(var s=0;d>s;s++)m.unshift(this.topPoints[s*f+f-1]);g=this.points.slice(this.divideX-d,this.divideX),this.stich(m,g,r),m=this.topPoints.slice((d-1)*f),g=this.points.slice(d+1,this.divideX-d-1),this.stich(m,g,r)}var o=require("nebula/entities/entity3d"),a=(require("nebula/entities/entity"),require("nebula/math/vector2")),h=require("nebula/math/vector3"),l=require("nebula/math/point3");return s.prototype=Object.create(o.prototype),s.prototype.line=function(t,e){for(var i=1;i<t.length;i++)this.constraints.push(n({point1:t[i-1],point2:t[i],length:e}))},s.prototype.stich=function(t,e,i){if(t.length!==e.length)throw new Error("Cannot stich. Length of two fragments is not equal");for(var s=0;s<t.length;s++)if(this.constraints.push(n({point1:t[s],point2:e[s],length:i})),s<t.length-1){var o=t[s],a=t[s+1],h=e[s],l=e[s+1];this.triangles.push(new r(o,a,h)),this.triangles.push(new r(a,l,h))}},s.prototype._recalcWind=function(){this.maxWind.x=this._windStrength*this._windForce,this.maxWind.y=this._windStrength*this._windForce/10,this.minWind.x=this._windStrength*-this._windForce*.8,this.minWind.y=this._windStrength*-this._windForce/10,this._windForce*this._windStrength&&(a.rotate(this.maxWind,this.windAngle,this.maxWind),a.rotate(this.minWind,this.windAngle,this.minWind))},s.prototype.enableWind=function(t,e){this.windEnabled=!0,this.windAngle=t,this.windForce=e;for(var i=0,n=this.points.length-1;n>i;i++)this.points[i].minWind=this.minWind,this.points[i].maxWind=this.maxWind},s.prototype.disableWind=function(){this.windEnabled=!1,this.windForce=0;for(var t=0,e=this.points.length-1;e>t;t++)this.points[t].minWind=this.points[t].maxWind=null},s.prototype.update=function(t){for(var e=0,i=this.points.length-2;i>e;e+=2)this.points[e].movable&&this.points[e].update(t),this.points[e+1].movable&&this.points[e+1].update(t);for(var e=0,i=this.constraints.length-1;i>e;e++)this.constraints[e].update(t)},Object.defineProperties(s.prototype,{windForce:{set:function(t){return this._windForce=t,this._recalcWind(),t},get:function(){return this._windForce}},windStrength:{set:function(t){return this._windStrength=t,this._recalcWind(),t},get:function(){return this._windStrength}}}),s}),define("goal",function(){"use strict";function t(t,e,n,s){this.oldPosition=r.create(t,e),this.position=r.create(t,e),this.mass=s,this.radius=n,this.velocity=i.create()}function e(e,n,o,a,l,u){this.pitch=u,this.radius=.06,this.leftPost=new t(e,n,this.radius,1e5),this.rightPost=new t(o,a,this.radius,1e5),this.top=Math.min(this.leftPost.position.y,this.rightPost.position.y),this.bottom=Math.max(this.leftPost.position.y,this.rightPost.position.y),this.height=l,this.width=this.bottom-this.top,this.innerWidth=this.width-2*this.radius,this.innerHeight=this.height-this.radius,this.center=r.create(),r.midpoint(this.leftPost.position,this.rightPost.position,this.center),this.from=this.rightPost.position,this.to=this.leftPost.position,this.normal=this.facing=i.create(),r.direction(this.from,this.to,this.facing),i.perpendicular(this.facing,this.facing),this.goalLineTop=r.create(e-this.radius*this.facing.x,this.top),this.goalLineBottom=r.create(e-this.radius*this.facing.x,this.bottom),this.crossbar={position:r.create(this.center.x,this.height),oldPosition:r.create(this.center.x,this.height),velocity:i.create(),mass:1e5,radius:this.radius},this.ballZ={position:r.create(),oldPosition:r.create(),velocity:i.create(),mass:1,radius:0},this.net=new h({game:u.game,start:s.create(this.leftPost.position.x,this.leftPost.position.y,this.height),point1:s.create(this.leftPost.position.x+this.width+2,this.leftPost.position.y,this.height),point2:s.create(this.leftPost.position.x,this.leftPost.position.y,0),divideX:37,divideY:18,topDivideY:10});for(var c,p=this.net,d=0;d<p.divideY;d++)p.sidePoints[d*p.divideX].movable=!1,c=p.sidePoints[(d+1)*p.divideX-1],c.movable=!1,c.position.x=this.rightPost.position.x,c.position.y=this.rightPost.position.y;for(var f=0;f<=p.topDivideY;f++)c=p.sidePoints[f],c.movable=!1,c.position.x=this.leftPost.position.x-f/p.topDivideY*this.facing.x,c.position.y=this.leftPost.position.y,c=p.sidePoints[p.divideX-f-1],c.movable=!1,c.position.x=this.rightPost.position.x-f/p.topDivideY*this.facing.x,c.position.y=this.rightPost.position.y;for(var f=0;f<=p.topDivideY;f++)c=p.sidePoints[(p.divideY-1)*p.divideX+f],c.movable=!1,c.position.x=this.leftPost.position.x-f/p.topDivideY*this.facing.x,c.position.y=this.leftPost.position.y,c=p.sidePoints[p.divideY*p.divideX-f-1],c.movable=!1,c.position.x=this.rightPost.position.x-f/p.topDivideY*this.facing.x,c.position.y=this.rightPost.position.y;for(var m=this.rightPost.position.y-this.leftPost.position.y,f=0;f<p.topDivideX;f++)c=p.topPoints[f],c.movable=!1,c.position.x=this.leftPost.position.x,c.position.y=this.leftPost.position.y+(f+1)*m/(p.topDivideX+1),c.position.z=this.height;for(var f=0;f<p.topDivideX;f++)c=p.sidePoints[p.topDivideY+1+f],c.movable=!1,c.position.x=this.leftPost.position.x-this.facing.x,c.position.y=this.leftPost.position.y+(f+1)*m/(p.topDivideX+1);for(var f=0;f<p.topDivideX;f++)c=p.sidePoints[(p.divideY-1)*p.divideX+p.topDivideY+1+f],c.movable=!1,c.position.x=this.leftPost.position.x-this.facing.x,c.position.y=this.leftPost.position.y+(f+1)*m/(p.topDivideX+1),c.position.z=0;for(var f=0;180>f;f++)p.update(1/30)}var i=require("nebula/math/vector2"),n=require("nebula/math/vector3"),r=require("nebula/math/point2"),s=require("nebula/math/point3"),o=require("nebula/math/geometry"),a=require("nebula/numbers").clamp,h=require("net"),l=require("nebula/signal"),u=require("messages");return e.onCrossbarHit=new l,e.onPostHit=new l,e.prototype.randomTarget=function(t){return t?(t.x=this.leftPost.position.x,void(t.y=this.top+this.radius+this.pitch.random.uniform(0,this.innerWidth))):r.create(this.leftPost.position.x,this.top+this.radius+this.pitch.random.uniform(0,this.innerWidth))},e.prototype.distance=function(t){return o.pointSegmentDistance2(t,this.leftPost.position,this.rightPost.position)},e.prototype.closestPointTo=function(t,e,i){null==e&&(e=0),i.x=this.center.x,i.y=a(t.y,this.top+this.radius+e,this.bottom-this.radius-e)},e.prototype.closestPostTo=function(t){var e=r.distance(t,this.leftPost.position),i=r.distance(t,this.rightPost.position);return i>e?this.leftPost:this.rightPost},e.prototype.scored=function(t,e){return e.z<this.height&&o.segmentsIntersect(e,t,this.goalLineTop,this.goalLineBottom)},e.prototype.checkCollisionWithBall=function(t){var r=this.pitch.ball,a=this.top-2,h=this.center.x;if(h+=1===this.facing.x?-3:-2,!o.pointInRectangle(r.position,h,a,5,this.width+4)&&!o.pointInRectangle(r.oldPosition,h,a,5,this.width+4))return!1;if(r.position.z>this.height+2&&r.oldPosition.z>this.height+2)return!1;for(var l=!1,u=this.net.triangles,c=s.temp(),p=n.temp(),d=0,f=u.length;f>d;d++){var m=u[d];o.testSphereTriangle(r.position,r.radius,m.a.position,m.b.position,m.c.position,c)&&(s.difference(c,r.position,p),n.resize(p,.5*(r.radius-n.length(p)),p),m.a.movable&&s.move(m.a.position,p,m.a.position),m.b.movable&&s.move(m.b.position,p,m.b.position),m.c.movable&&s.move(m.c.position,p,m.c.position),n.multiplyNumber(r.velocity,1-t*r.speed*.2,r.velocity),r.speed=n.length(r.velocity),r.position.x-=p.x,r.position.y-=p.y,r.position.z-=p.z,l=!0)}return r.position.z-r.radius<this.height+this.radius&&(o.circlesIntersect(r.position,r.radius,this.leftPost.position,this.radius)?(o.resolveCirclesCollision(t,r,this.leftPost),i.multiplyNumber(r.velocity,.4,r.velocity),e.onPostHit.send(this,this.leftPost),l=!0):o.circlesIntersect(r.position,r.radius,this.rightPost.position,this.radius)&&(o.resolveCirclesCollision(t,r,this.rightPost),i.multiplyNumber(r.velocity,.4,r.velocity),e.onPostHit.send(this,this.rightPost),l=!0)),r.position.y+r.radius>this.top-this.radius&&r.position.y-r.radius<this.bottom+this.radius&&(this.ballZ.position.x=r.position.x,this.ballZ.position.y=r.position.z,this.ballZ.oldPosition.x=r.oldPosition.x,this.ballZ.oldPosition.y=r.oldPosition.z,this.ballZ.velocity.x=r.velocity.x,this.ballZ.velocity.y=r.velocity.z,this.ballZ.radius=r.radius,o.circlesIntersect(this.ballZ.position,this.ballZ.radius,this.crossbar.position,this.radius)&&(o.resolveCirclesCollision(t,this.ballZ,this.crossbar),r.position.x=this.ballZ.position.x,r.position.z=this.ballZ.position.y,r.velocity.x=.4*this.ballZ.velocity.x,r.velocity.z=.4*this.ballZ.velocity.y,e.onCrossbarHit.send(this),l=!0)),l},e.prototype.checkCollisionWithPlayer=function(t,e){return o.circlesIntersect(t.position,t.radius,this.leftPost.position,this.radius)?(o.resolveCirclesCollision(e,t,this.leftPost),u.collision.send({receiver:t,post:this.leftPost}),!0):o.circlesIntersect(t.position,t.radius,this.rightPost.position,this.radius)?(o.resolveCirclesCollision(e,t,this.rightPost),u.collision.send({receiver:t,post:this.rightPost}),!0):!1},e.prototype.update=function(t){this.net.update(t),this.leftPost.position.x=this.leftPost.oldPosition.x,this.leftPost.position.y=this.leftPost.oldPosition.y,this.leftPost.velocity.x=this.leftPost.velocity.y=0,this.rightPost.position.x=this.rightPost.oldPosition.x,this.rightPost.position.y=this.rightPost.oldPosition.y,this.rightPost.velocity.x=this.rightPost.velocity.y=0,this.crossbar.position.x=this.crossbar.oldPosition.x,this.crossbar.position.y=this.crossbar.oldPosition.y,this.crossbar.velocity.x=this.crossbar.velocity.y=0},{GoalPost:t,Goal:e}}),define("ball",function(){"use strict";function t(t,e,i,n){var r=i-t,s=Math.abs(r);return e=s/(.3*n),s?r*e/s-e:0}function e(t){t.radius="radius"in t?t.radius:f("BALL_RADIUS"),t.steering=!0,p.apply(this,arguments),this.pitch=t.pitch,this._gravity=r.copy(t.gravity||{}),this.swerveDamping=2,this.owner=null,this.owningTime=0,this.inHands=null,this.lastTouch=null,this.friction="friction"in t?t.friction:f("BALL_FRICTION"),this.drag=0,this._swerve=r.create(),this._swerveForce=r.create(),this.steering.add(new d),this.steering.arrive.deceleration=.25,this.rotationFrame=s.create(),this.rotationAxis=r.create(),this.rotation=s.create(),this.onKick=new m,this.states.global(e.states.Global)}var i=require("nebula/math/point2"),n=(require("nebula/math/point3"),require("nebula/math/vector2")),r=require("nebula/math/vector3"),s=require("nebula/math/matrix4"),o=require("nebula/numbers").clamp,a=require("nebula/numbers"),h=require("nebula/easings"),l=require("nebula/math/geometry"),u=require("nebula/physics2"),c=require("nebula/steerings/behaviors/separation").separation,p=(require("nebula/entities/base"),require("nebula/entities/entity3d")),d=require("nebula/steerings/behaviors/arrive").Arrive,f=require("settings"),m=require("nebula/signal"),g=require("nebula/states").State,y=(require("nebula/states").Wait,require("messages")),v=r.create(0,-1,1);return r.normalize(v,v),e.onBounce=new m,e.onKick=new m,e.states={},e.states.Global=g.extend("Global",{onTrap:function(t,e){return!0},onReleaseBall:function(t,e){return t.states.idle(),!0},onBallOutOfPlay:function(t,i){return i.goal?(t.owner&&y.releaseBall.sendTo(t.owner),t.inHands&&t.inHands.dropBall(),t.states.idle()):t.states.change(e.states.OutOfPlay),!0},onFreeze:function(t,e){return t.states.idle(),t.stop(),!0},onMagnet:function(t,i){return t.states.change(e.states.Magnet,i.sender),!0},onSupershotPrepare:function(t,i){return t.states.change(e.states.SupershotPrepare,i.sender),!0}}),e.states.Dribble=g.extend("Dribble",{enter:function(t,e){this.target=i.copy(t.position),t.owner=e,t.owningTime=0,t.lastTouch=e,t.steering.arrive.enable(this.target)},update:function(t,e){var i=t.owner,n=.52*i.radius+.08*i.speed,r=i._heading;this.target.x=i.position.x+r.x*n,this.target.y=i.position.y+r.y*n+.05,t.owningTime+=e},exit:function(t){t.owner=null,t.owningTime=0,t.steering.arrive.disable()}}),e.states.Magnet=g.extend("Magnet",{enter:function(t,e){this.save(t,"maxForce","maxSpeed"),this.target=i.copy(t.position),this.owner=e,t.maxForce=1,t.maxSpeed=20,t.steering.arrive.enable(this.target)},onTrap:function(t,e){return e.player===this.owner},update:function(e,i){var n=.75*this.owner.radius+.08*this.owner.speed,r=this.owner.isGoalkeeper?this.owner.facing:this.owner.heading;this.target.x=this.owner.position.x+r.x*n,this.target.y=this.owner.position.y+r.y*n+.05;var s=t(e.position.z,e.velocity.z,e.radius,e.steering.arrive.deceleration);Math.abs(s)>e.maxForce&&(s=e.maxForce*Math.sign(s)),e.velocity.z+=s},exit:function(t){this.restore(t),t.steering.arrive.disable()}}),e.states.SupershotPrepare=e.states.Dribble.extend("SupershotPrepare",{enter:function(t,i){this.initialZ=t.position.z,this.desiredZ=t.radius+.2,t.gravity.z=0,e.states.Dribble.prototype.enter.call(this,t,i)},onSupershotKick:function(t,i){return t.stop(),t.states.change(e.states.SupershotKick,i.force,i.shooter),!0},update:function(t,i){var n=h.cubic.out(Math.min(t.states.time/.15,1));t.position.z=t.oldPosition.z=this.initialZ+(this.desiredZ-this.initialZ)*n,e.states.Dribble.prototype.update.call(this,t,i)},exit:function(t){t.gravity.z=t._gravity.z,e.states.Dribble.prototype.exit.call(this,t)}}),e.states.SupershotKick=g.extend("SupershotKick",{enter:function(t,e,i){this.save(t,"friction","mass"),this.gravity=t._gravity.z,this.shooter=i,i.controller||(this.direction=n.create(),this.separation=n.create(),this.shooter.team.ai>=2&&(this.playersToAvoid=[].concat(this.shooter.team.fieldPlayers,this.shooter.team.opponents.fieldPlayers))),t.friction=f("SUPERSHOT_BALL_FRICTION"),t._gravity.z=0,t.applyImpulse(e),t.pitch.timeScale=1/3,t.mass=f("SUPERSHOT_BALL_MASS")},onTrap:function(t,e){var i=e.player;return i!==this.shooter&&y.canPlay.sendTo(i)&&l.circlesIntersect(i.position,i.radius,t.position,t.radius)&&(l.resolveCirclesCollision(e.elapsed,i,t),t.lastTouch=i,y.supershotHit.sendTo(i)),!1},update:function(t,e){if(t.speed<8&&t.states.time>=1)return void t.states.idle();var r=a.radians(90)*e;this.shooter.controller?n.notZero(this.shooter.controller.direction)&&(r*=n.length(this.shooter.controller.velocity),n.look(t.velocity,this.shooter.controller.direction,r,t.velocity)):(i.direction(t.position,this.shooter.team.opponents.goal.center,this.direction),this.shooter.team.ai>=2&&(c(t,this.playersToAvoid,2.5,this.separation),n.add(this.separation,this.direction,this.direction),n.normalize(this.direction,this.direction)),n.look(t.velocity,this.direction,r,t.velocity))},exit:function(t){this.restore(t),t._gravity.z=this.gravity,t.pitch.timeScale=1,y.supershotEnd.sendTo(this.shooter)}}),e.states.Lob=g.extend("Lob",{enter:function(t,e){this.target=e,this.save(t,"friction"),t.friction=0},update:function(t){t.states.time>.5&&t.rolling&&t.states.next()},exit:function(t){this.restore(t)}}),e.states.OutOfPlay=g.extend("OutOfPlay",{enter:function(t,e){t.owner&&y.releaseBall.sendTo(t.owner),t.inHands&&t.inHands.dropBall()},update:function(t,e){n.multiplyNumber(t.velocity,1-1*e,t.velocity),t.speed<.1&&t.states.idle()},exit:function(t){t.stop()}}),e.prototype=Object.create(p.prototype),e.prototype.headingTowards=function(t){var e=n.temp();return i.direction(this.position,t,e),n.dot(e,this.heading)},e.prototype.trap=function(t){this.states.change(e.states.Dribble,t)},e.prototype.kick=function(t,i){this.stop(),this.velocity.x+=t.x*i/this.mass,this.velocity.y+=t.y*i/this.mass,"z"in t?this.velocity.z+=t.z*i/this.mass:i>5&&r.rotate(this.velocity,r.temp(-t.y,t.x,t.z||0),-i*Math.PI/180*.94,this.velocity),this.onKick.send(),e.onKick.send(this,t,i)},e.prototype.swerve=function(t,e,i){this._swerve.x=i.x,this._swerve.y=i.y,this._swerve.z=i.z,this.kick(t,e)},e.prototype.lob=function(t){var n=.25*-Math.PI,s=i.distance(this.position,t),o=Math.sqrt(s*this._gravity.z/Math.sin(2*n)),a=r.temp();i.direction(this.position,t,a),r.rotate(a,r.temp(-a.y,a.x,a.z),n,a),this.kick(a,o),this.states.change(e.states.Lob,t)},e.prototype.timeToCoverDistance=function(t,e,i){return u.timeToCoverDistance(t,e,i,-this.deceleration)},e.prototype.timeToLobDistance=function(t,e){var n=i.distance(t,e),r=Math.sqrt(n*-this._gravity.z);return n/r},e.prototype.futurePosition=function(t,e){var i=this.velocity.z/this.speed;this.gravity.x+this.heading.x*this.deceleration,this.gravity.y+this.heading.y*this.deceleration,this.gravity.z+i*this.deceleration;e.x=this.position.x+.5*this.gravity.x*t*t+this.heading.x*this.speed*t,e.y=this.position.y+.5*this.gravity.y*t*t+this.heading.y*this.speed*t,e.z=this.position.z+.5*this.gravity.z*t*t+i*this.speed*t},e.prototype.placeAtPosition=function(t,e,i){this.stop(),this.oldPosition.x=this.position.x=t,this.oldPosition.y=this.position.y=e,this.oldPosition.z=this.position.z=i||this.radius,this.states.idle()},e.prototype.trajectory=function(t,e,i,n,s){var a=s.length-1,h=n/a,l=r.temp(i.x,i.y,i.z),u=r.temp(e.x,e.y,e.z),c=r.temp(),p=r.temp();r.copy(t,s[0]);for(var d=1;a>=d;d++)r.cross(l,u,c),u.x+=c.x*h,u.y+=c.y*h,u.z+=(this._gravity.z+c.z)*h,r.normalize(u,p),p.x*=-this.deceleration,p.y*=-this.deceleration,p.z*=-this.deceleration,u.x+=p.x*h,u.y+=p.y*h,u.z+=p.z*h,s[d].x=s[d-1].x+u.x*h,s[d].y=s[d-1].y+u.y*h,s[d].z=s[d-1].z+u.z*h,r.multiplyNumber(l,o(1-h*this.swerveDamping,0,1),l)},e.prototype.isMagnet=function(t){var i=this.states.is(e.states.Magnet);return i&&t&&(i=this.states.current.owner===t),i},e.prototype.update=function(t){if(this.inHands)return void(this.speed=0);this.rolling?this.gravity.z=0:this.gravity.z=this._gravity.z,p.prototype.update.call(this,t),this.speed>.01&&r.length(this._swerve)>.01?(r.cross(this._swerve,this.velocity,this._swerveForce),this.applyForce(this._swerveForce),r.multiplyNumber(this._swerve,o(1-t*this.swerveDamping,0,1),this._swerve)):this._swerve.x=this._swerve.y=this._swerve.z=0,this.rolling&&(this.oldPosition.z!==this.position.z&&e.onBounce.send(this),this.position.z=this.oldPosition.z=this.radius,this.velocity.z/=-2,Math.abs(this.velocity.z)<.25&&(this.velocity.z=0),this.speed=r.length(this.velocity));var i=this.speed*t/this.radius*.5;this.rolling||(i/=3),r.cross(v,this.velocity,this.rotationAxis),r.normalize(this.rotationAxis,this.rotationAxis),s.identity(this.rotationFrame),s.rotation(s.IDENTITY,i,this.rotationAxis,this.rotationFrame),s.multiply(this.rotationFrame,this.rotation,this.rotation)},Object.defineProperty(e.prototype,"rolling",{get:function(){return this.position.z<=this.radius}}),Object.defineProperty(e.prototype,"onGround",{get:function(){return 0===this.speed&&this.rolling}}),{Ball:e}}),define("player",function(){"use strict";function t(t,e){return"undefined"!=typeof t?t:e}function e(a){a.friction="friction"in a?a.friction:i("PLAYER_DECELERATION"),a.maxForce="maxForce"in a?a.maxForce:i("PLAYER_MAX_FORCE"),a.steering=!0,o.apply(this,arguments),this.position=r.create(this.position.x,this.position.y,0),this.velocity=r.create(this.velocity.x,this.velocity.y,0),this.facing=s.copy(this.heading),this.autoFacing=!0,this.height=i("PLAYER_HEIGHT"),this.radius=i("PLAYER_RADIUS"),this.trapRange=i("TRAP_RANGE"),this.clampToPitch=!1,this.walkSpeed=i("PLAYER_WALK_SPEED"),this.runSpeed=t(a.runSpeed,i("PLAYER_RUN_SPEED")),this.sprintSpeed=t(a.sprintSpeed,i("PLAYER_SPRINT_SPEED")),this.dribbleSpeed=t(a.dribbleSpeed,i("PLAYER_DRIBBLE_SPEED")),this.role=a.role||e.ROLE_ATTACKER,this.team=null,this.pitch=a.pitch,this._home=a.home||null,this.home=this._home?n.copy(this._home):null,this._distanceToBall=null,this._distanceToOpponentsGoal=null,this._distanceToHomeGoal=null,this.inFreezeRadius=!1,this.cooldowns={trap:0,slide:0},this.accuracy="undefined"!=typeof a.accuracy?a.accuracy:1,this.steering.add(new d),this.steering.add(new p),this.steering.add(new d("dribble")),this.steering.dribble.detectionRadius=2,this.steering.dribble.spacing=1,this.steering.dribble.weight=.5,this.steering.add(new h),this.steering.arrive.tolerance=.1,this.steering.arrive.deceleration=.25,this.steering.add(new l),this.steering.add(new u),this.steering.add(new c),this.steering.add(new m("marking")),this.steering.marking.deceleration=3,this.steering.marking.distance=3,this.steering.pursuit.predictability=1.5,this.steering.add(new f("boundaryAvoidance")),this.controller=null,this.user=null,this.run(),this.enableSmoothing(Math.ceil(this.pitch.game.updateFPS/2))}var i=require("settings"),n=require("nebula/math/point2"),r=require("nebula/math/point3"),s=require("nebula/math/vector2"),o=(require("nebula/math/vector3"),require("nebula/entities/utils"),require("nebula/entities/entity")),a=require("nebula/signal"),h=require("nebula/steerings/behaviors/arrive").Arrive,l=require("nebula/steerings/behaviors/seek").Seek,u=require("nebula/steerings/behaviors/evade").Evade,c=require("nebula/steerings/behaviors/pursuit").Pursuit,p=(require("nebula/steerings/behaviors/separation").Separation,require("nebula/steerings/behaviors/separation").separation,require("nebula/steerings/behaviors/interpose").Interpose),d=require("nebula/steerings/behaviors/obstacle_avoidance").ObstacleAvoidance,f=require("nebula/steerings/behaviors/wall_avoidance").WallAvoidance,m=require("nebula/steerings/behaviors/block").Block,g=require("nebula/math/geometry"),y=require("messages"),v=(require("nebula/physics2"),require("nebula/numbers").clamp,require("nebula/states").StateMachine,require("nebula/states").State,require("nebula/states").Wait,i("PLAYER_SHOOTING_CHANCE"),i("MIN_PASS_DISTANCE"),i("MIN_PASSING_FORCE"),i("MAX_PASSING_FORCE"),i("MIN_SHOOTING_FORCE"),i("MAX_SHOOTING_FORCE"),i("PLAYER_IN_BALL_RANGE_HEIGHT"),i("PLAYER_IN_BALL_RANGE"),i("PLAYER_IN_TARGET_RANGE"),i("PLAYER_RECEIVING_RANGE")),x=i("PLAYER_COMFORT_ZONE");return e.ROLE_GOALKEEPER=1,e.ROLE_DEFENDER=2,e.ROLE_MIDFIELDER=3,e.ROLE_ATTACKER=4,e.onBeforeKick=new a,e.onKick=new a,e.onHeader=new a,e.onPass=new a,e.onLob=new a,e.onReceivePass=new a,e.onShot=new a,e.onThrow=new a,e.onHeadKick=new a,e.onWalk=new a,e.onRun=new a,e.onSprint=new a,e.onBallHold=new a,e.onBallDrop=new a,e.onTrap=new a,e.onSteal=new a,e.onHitByBall=new a,e.onSlideTrap=new a,e.onSlideHit=new a,e.onTeamSelect=new a,e.onTeamUnselect=new a,e.prototype=Object.create(o.prototype),e.prototype.setDefaultHomeRegion=function(){},e.prototype.resetCooldowns=function(){for(var t in this.cooldowns)this.cooldowns[t]=0},e.prototype.walk=function(){this.maxSpeed=this.walkSpeed,e.onWalk.send(this)},e.prototype.run=function(){this.maxSpeed=this.runSpeed,e.onRun.send(this)},e.prototype.sprint=function(){this.maxSpeed=this.sprintSpeed,e.onSprint.send(this)},e.prototype.move=function(t){this.position.x<=0&&t.x<0||this.position.x>=this.pitch.width&&t.x>0||(this.velocity.x+=t.x*this.maxForce),this.position.y<=0&&t.y<0||this.position.y>=this.pitch.height&&t.y>0||(this.velocity.y+=t.y*this.maxForce),s.notZero(t)&&(this.look(t),s.truncateLength(this.velocity,this.maxSpeed*s.length(t),this.velocity)),this.clampToPitch&&(this.position.x<=-1?this.velocity.x=Math.max(0,this.velocity.x):this.position.x>=this.pitch.width+2&&(this.velocity.x=Math.min(0,this.velocity.x)),this.position.y<=-1?this.velocity.y=Math.max(0,this.velocity.y):this.position.y>=this.pitch.height+2&&(this.velocity.y=Math.min(0,this.velocity.y)))},e.prototype.placeAtPosition=function(t,e){this.stop(),this.oldPosition.x=this.position.x=t,this.oldPosition.y=this.position.y=e},e.prototype.futurePosition=function(t,e){var i=this._heading.x*-this.deceleration,n=this._heading.y*-this.deceleration;e.x=this.position.x+.5*i*t*t+this.velocity.x*t,e.y=this.position.y+.5*n*t*t+this.velocity.y*t},e.prototype.canReach=function(t,e){if(!y.canPlay.sendTo(this))return!1;var i=n.distance(t,this.position),r=this.sprintSpeed*e;return r>=i},e.prototype.look=function(t){var e=s.look(this._heading,t,this.maxTurnRate*this.pitch.elapsed,this._heading);return this.setHeading(this._heading),e},e.prototype.trackBall=function(){return this.hasBall?!0:this.lookAt(this.pitch.ball.position)},e.prototype.positionInFrontOfPlayer=function(t){var e=s.temp();return n.difference(t,this.position,e),s.dot(e,this.heading)>0},e.prototype.isOpponentInRadius=function(t){for(var e=this.team.opponents.players,i=0;i<e.length;i++)if(n.distance(this.position,e[i].position)<t)return!0;return!1},e.prototype.trap=function(t,n){if(!this.canTrapBall)return!1;var r=t.owner;if(r){if(!y.steal.send({receiver:r,opponent:this}))return!1;e.onSteal.send(r,this,t)}return e.onTrap.send(this,t),r&&r.release(),t.trap(this),t.stop(),this.team.controllingPlayer=this,this.team.activePlayer=null,this.team.opponents.controllingPlayer=null,this.team.receivingPlayer=null,this.team.opponents.receivingPlayer=null,n||this.lookAtNow(t.position),this.cooldowns.trap=i("TRAP_COOLDOWN"),!0},e.prototype.forceTrap=function(t){t.owner&&(e.onSteal.send(t.owner,this,t),t.owner.release()),e.onTrap.send(this,t),t.trap(this),t.stop(),this.team.controllingPlayer=this,this.team.activePlayer=null,this.team.opponents.controllingPlayer=null,this.team.receivingPlayer=null,this.team.opponents.receivingPlayer=null,this.lookAtNow(t.position),this.stop()},e.prototype.release=function(){this.hasBall&&y.releaseBall.sendTo(this.pitch.ball)},e.prototype.holdBall=function(){this.pitch.ball.lastTouch=this,this.pitch.ball.inHands=this,this.pitch.ball.stop(),e.onBallHold.send(this,this.pitch.ball)},e.prototype.dropBall=function(){this.pitch.ball.inHands=null,e.onBallDrop.send(this,this.pitch.ball)},e.prototype.willSlideIntoGoal=function(t,e){var r=n.temp(),o=s.temp(),a=i("SLIDE_SPEED"),h=i("SLIDE_TIME");return n.direction(this.position,e,o),g.raySegmentIntersect(this.position,o,t.from,t.to,r)?n.distance(this.position,r)<a*h:!1},e.prototype.headingTowards=function(t){var e=s.temp();return n.direction(this.position,t,e),s.dot(e,this.heading)},e.prototype.update=function(t){this.pitch.ball;this._distanceToBall=null,this._distanceToOpponentsGoal=null,this._distanceToHomeGoal=null,this.velocity.z<0&&this.position.z<=0?this.velocity.z=0:this.velocity.z-=9.81*t,o.prototype.update.call(this,t),this.position.z+=this.velocity.z*t,this.position.z<0&&(this.position.z=0),this.clampToPitch&&(g.clampPointInRectangle(this.position,-1,-1,this.pitch.width+2,this.pitch.height+2,this.position),g.clampPointInRectangle(this.oldPosition,-1,-1,this.pitch.width+2,this.pitch.height+2,this.oldPosition)),this.autoFacing&&(this.heading.x&&(this.facing.x=Math.sign(this.heading.x)),this.facing.y=0);for(var e in this.cooldowns)this.cooldowns[e]=Math.max(this.cooldowns[e]-t,0)},Object.defineProperties(e.prototype,{isAheadOfAttacker:{get:function(){var t=this.team.opponents.goal.center.x;return Math.abs(this.position.x-t)<Math.abs(this.team.controllingPlayer.position.x-t)}},distanceToBall:{get:function(){return null===this._distanceToBall&&(this._distanceToBall=n.distance(this.position,this.pitch.ball.position)),this._distanceToBall}},distanceToOpponentsGoal:{get:function(){return null===this._distanceToOpponentsGoal&&(this._distanceToOpponentsGoal=this.team.opponents.goal.distance(this.position)),this._distanceToOpponentsGoal}},distanceToHomeGoal:{get:function(){return null===this._distanceToHomeGoal&&(this._distanceToHomeGoal=this.team.goal.distance(this.position)),this._distanceToHomeGoal}},isDefender:{get:function(){return this.role===e.ROLE_DEFENDER}},isMidfielder:{get:function(){return this.role===e.ROLE_MIDFIELDER}},isAttacker:{get:function(){return this.role===e.ROLE_ATTACKER}},isGoalkeeper:{get:function(){return this.role===e.ROLE_GOALKEEPER}},isOnOpponentsSide:{get:function(){return Math.abs(this.position.x-this.team.goal.center.x)>this.pitch.width/2}},hasBall:{get:function(){return this.pitch.ball.owner===this}},inHotRegion:{get:function(){return Math.abs(this.position.y-this.team.opponents.goal.center.y)<this.team.pitch.height/3}},isClosestTeamMemberToBall:{get:function(){return this.team.playerClosestToBall===this;
}},isClosestPlayerOnPitchToBall:{get:function(){return this.isClosestTeamMemberToBall&&this.distanceToBall<this.team.opponents.distanceToBall}},isControllingPlayer:{get:function(){return this.team.controllingPlayer===this}},ballWithinReceivingRange:{get:function(){return this.distanceToBall<v}},shouldChaseBall:{get:function(){var t=this.team.ai>=2?this.team.activeFieldPlayerClosestToBall:this.team.fieldPlayerClosestToBall;return this===t&&!this.pitch.ballOutOfPlay&&!this.pitch.goalkeeperHasBall&&!this.team.receivingPlayer}},canKickBall:{get:function(){return this.hasBall||this.canTrapBall&&!this.pitch.ball.owner&&this.pitch.ball.position.z<this.pitch.ball.radius+.2}},canTrapBall:{get:function(){var t=this.pitch.ball;return this.cooldowns.trap||t.position.z>.75*this.height?!1:this.distanceToBall<this.trapRange&&t.speed<5?!0:!(this.distanceToBall>this.trapRange)}},isThreatened:{get:function(){for(var t,e=this.team.opponents.players,i=x[this.team.ai],r=0;r<e.length;r++)if(y.canPlay.sendTo(e[r])&&(t=n.distance(this.position,e[r].position),this.positionInFrontOfPlayer(e[r].position)&&i>t||i/2>t))return!0;return!1}},direction:{get:function(){return this.controller&&s.notZero(this.controller.direction)?this.controller.direction:this._heading}},goals:{get:function(){return this.team?this.team.skill.getGoalsByPlayer(this):0}}}),{Player:e}}),define("pitch",function(){"use strict";function t(t,e,i){this.from=t,this.to=e,this.normal=o.create(),this.mass=1,this.height=i,u.segmentNormal(t,e,this.normal)}function e(e){c.apply(this,arguments),this.game=e.game,this.width=e.width,this.height=e.height,this.center=h.create(this.width/2,this.height/2),this.ball=e.ball,this.ballOutOfPlay=!1,this.ballOutOfPlayPosition=h.create(),this.redTeam=null,this.blueTeam=null,this.players=[],this.powerups=[],this.time=0,this.halfTime=1/0,this.drawAllowed=!0,this.secondHalf=!1,this.goldenGoal=!1,this.matchEnded=!1,this.supermovesAllowed=!0,this.matchStartingTeam=null,this.goalWidth=e.goalWidth,this.leftGoal=new d(0,this.height/2-this.goalWidth/2,0,this.height/2+this.goalWidth/2,e.goalHeight,this),this.rightGoal=new d(this.width,this.height/2+this.goalWidth/2,this.width,this.height/2-this.goalWidth/2,e.goalHeight,this),this.redGoal=this.leftGoal,this.blueGoal=this.rightGoal,this._activeGoal=null,this.playingArea=new p(0,0,this.width,this.height),e.regionColumns&&e.regionRows?(this.regionColumns=e.regionColumns,this.regionRows=e.regionRows,this.regionWidth=this.width/this.regionColumns,this.regionHeight=this.height/this.regionRows,this.createRegions()):(this.regionColumns=this.regionRows=0,this.regionWidth=this.regionHeight=0,this.regions=[]),this.topLine=new t(h.create(0,0),h.create(this.width,0)),this.rightLine=new t(h.create(this.width,0),h.create(this.width,this.height)),this.topRightLine=new t(h.create(this.width,0),h.create(this.width,this.rightGoal.top)),this.bottomRightLine=new t(h.create(this.width,this.rightGoal.bottom),h.create(this.width,this.height)),this.bottomLine=new t(h.create(this.width,this.height),h.create(0,this.height)),this.leftLine=new t(h.create(0,this.height),h.create(0,0)),this.topLeftLine=new t(h.create(0,this.height),h.create(0,this.leftGoal.bottom)),this.bottomLeftLine=new t(h.create(0,this.leftGoal.top),h.create(0,0)),this.bounds=[this.topLine,this.rightLine,this.bottomLine,this.leftLine],this.leftBounds=[this.topLine,this.topRightLine,this.bottomRightLine,this.bottomLine,this.leftLine],this.rightBounds=[this.topLine,this.rightLine,this.bottomLine,this.bottomLeftLine,this.topLeftLine],this.walls=[],this.random=new l.Generator,this.setWalls([{start:[-3.6415214211076283,30.817057784506684],end:[-4.290409024398543,-3.0370931112793333],height:.45},{start:[-4.290409024398543,-3.0370931112793333],end:[39.25669513730561,-3.0370931112793333],height:.45},{start:[39.25669513730561,-3.0370931112793333],end:[38.64152142110763,30.817057784506684],height:.45},{start:[6.699628764454439,-2.402220539994953],end:[11.113888377322645,-2.402220539994953],height:1.5},{start:[23.953333850284487,-2.402220539994953],end:[28.37879716775388,-2.402220539994953],height:1.5}])}function i(t){return t}var n=require("settings"),r=require("nebula/signal"),s=require("nebula/numbers").clamp,o=require("nebula/math/vector2"),a=require("nebula/math/vector3"),h=require("nebula/math/point2"),l=require("nebula/random"),u=require("nebula/math/geometry"),c=(require("nebula/game"),require("nebula/entities/space")),p=require("region").Region,d=(require("ball").Ball,require("goal").Goal),f=require("nebula/states").State,m=require("nebula/states").Wait,g=require("messages"),y=require("player").Player;return e.matchStarted=new r,e.goalScored=new r,e.goldenGoal=new r,e.halfEnded=new r,e.states={},e.states.Global=f.extend("Global",{}),e.states.WaitForPlayers=f.extend("WaitForPlayers",{enter:function(t,e){this.delay=e||0,this.readyTime=0,this.prepared=!1},prepare:function(t){throw new Error("Override this function when inheriting this state")},update:function(t,e){t.allPlayersCanPlay&&(this.prepared?t.allPlayersReady&&(this.readyTime+=e,this.readyTime>=this.delay&&t.states.next()):(this.prepared=!0,this.prepare(t)))}}),e.states.WaitForPlayersAndPlay=f.extend("WaitForPlayers",{enter:function(t,e){this.delay=e||0,this.readyTime=0,this.prepared=!1,this.play=!1},prepare:function(t){throw new Error("Override this function when inheriting this state")},onPlay:function(t,e){return this.play=!0,!0},update:function(t,i){t.allPlayersCanPlay&&(this.prepared?t.allPlayersReady&&this.play&&(this.readyTime+=i,this.readyTime>=this.delay&&(t.states.queued?t.states.next():t.states.change(e.states.Match))):(this.prepared=!0,this.prepare(t)))}}),e.states.WaitForPlay=f.extend("WaitForPlay",{enter:function(t,e){this.prepared=!1},prepare:function(t){throw new Error("Override this function when inheriting this state")},onPlay:function(t,i){return t.states.queued?t.states.next():t.states.change(e.states.Match),!0},update:function(t,e){t.allPlayersCanPlay&&!this.prepared&&(this.prepared=!0,this.prepare(t))}}),e.states.BallOutOfPlay=m.extend("BallOutOfPlay",{enter:function(t,e,i){m.prototype.enter.call(this,t,e),t.ballOutOfPlay=!0,t.timeScale=1,g.ballOutOfPlay.send({receiver:t.ball,goal:i}),g.ballOutOfPlay.send({receiver:t.redTeam,goal:i}),g.ballOutOfPlay.send({receiver:t.blueTeam,goal:i})}}),e.states.GoalCelebration=m.extend("GoalCelebration",{enter:function(t,e,i,n){m.prototype.enter.call(this,t,e),g.goal.send({receivers:[t.redTeam,t.blueTeam],team:i,scorer:n})},update:function(t,e){m.prototype.update.call(this,t,e),(t.redTeam.controllerActionActive("shoot")||t.blueTeam.controllerActionActive("shoot"))&&t.states.next()}}),e.states.DelayedMatch=f.extend("DelayedMatch",{enter:function(t,e){t.ballOutOfPlay=!1,t.timeScale=1,g.play.sendTo(t.redTeam),g.play.sendTo(t.blueTeam)},update:function(t,i){t.time+=i,t.ballOutside||t.states.change(e.states.Match,!0)}}),e.states.Match=f.extend("Match",{enter:function(t,e){this.slowMotion=!1,this.slowMotionTime=0,t.ballOutOfPlay=!1,t.timeScale=1,e||(g.play.sendTo(t.redTeam),g.play.sendTo(t.blueTeam))},update:function(t,i){var n=t.activeGoal,r=t.ball;if(t.clampPoint(t.ball.position,t.ballOutOfPlayPosition),t.time+=i,t.time>t.halfTime&&t.states.time>=3&&(t.goalkeeperHasBall||n.distance(r.position)>=6)){if(!t.secondHalf)return void t.endHalf();if(t.drawAllowed||t.redTeam.score!==t.blueTeam.score)return void t.endMatch();t.goldenGoal||(t.goldenGoal=!0,e.goldenGoal.send(t))}var s=n.scored(r.oldPosition,r.position);if(s){var o=n===t.blueGoal?t.redTeam:t.blueTeam;o.score+=1;var a=o.controllingPlayer||o.skill.shootingPlayer||o.opponents.controllingPlayer||t.ball.lastTouch;return e.goalScored.send(t,o,a),t.states.change(e.states.BallOutOfPlay,.5,!0),t.states.queue(e.states.GoalCelebration,10,o,a),void(t.goldenGoal?t.states.queue(e.states.EndMatch):t.states.queue(e.states.Kickoff,o.opponents))}if(t.handleBallOutOfPitch()){t.handleTrapping(i);for(var h=0;h<t.players.length;h++)for(var l=0;l<t.powerups.length;l++)null===t.powerups[l].owner&&t.powerups[l].position.z<=t.players[h].height&&u.circlesIntersect(t.players[h].position,t.players[h].radius,t.powerups[l].position,t.powerups[l].radius)&&t.powerups[l].pickup(t.players[h]);var c=n.distance(r.position),p=u.raySegmentIntersect(r.position,r.heading,n.from,n.to);!this.slowMotion&&!r.owner&&p&&1.5>c&&r.speed>5?(t.timeScale=.1,this.slowMotionTime=0,this.slowMotion=!0):this.slowMotion&&(r.owner||this.slowMotionTime>=.4)&&(t.timeScale=1,this.slowMotion=!1),this.slowMotion&&(this.slowMotionTime+=i)}},exit:function(t){t.timeScale=1}}),e.states.GoalKick=e.states.WaitForPlay.extend("GoalKick",{enter:function(t,i){e.states.WaitForPlay.prototype.enter.call(this,t),this.startingTeam=i,t.ball.placeAtPosition(i.goalKickPosition.x,i.goalKickPosition.y,10)},prepare:function(t){g.goalKick.send({receiver:this.startingTeam,team:this.startingTeam}),g.goalKick.send({receiver:this.startingTeam.opponents,team:this.startingTeam})}}),e.states.Kickoff=e.states.WaitForPlayers.extend("Kickoff",{enter:function(t,i){e.states.WaitForPlayers.prototype.enter.call(this,t,1),this.startingTeam=i,t.ball.inHands&&t.ball.inHands.dropBall(),t.secondHalf&&0===t.time||t.ball.placeAtPosition(t.center.x,t.center.y,10)},prepare:function(t){g.kickoff.send({receiver:this.startingTeam,team:this.startingTeam}),g.kickoff.send({receiver:this.startingTeam.opponents,team:this.startingTeam}),t.states.queue(e.states.Match)}}),e.states.Corner=e.states.WaitForPlay.extend("Corner",{enter:function(t,i,n){e.states.WaitForPlay.prototype.enter.call(this,t),this.team=n,this.corner=o.create(),h.direction(i,t.center,this.corner),this.corner.x=.2*this.corner.x+i.x,this.corner.y=.2*this.corner.y+i.y,t.ball.placeAtPosition(this.corner.x,this.corner.y,10)},prepare:function(t){g.corner.send({receiver:this.team,corner:this.corner,team:this.team}),g.corner.send({receiver:this.team.opponents,corner:this.corner,team:this.team})}}),e.states.ThrowIn=e.states.WaitForPlay.extend("ThrowIn",{enter:function(t,i,n){e.states.WaitForPlay.prototype.enter.call(this,t),this.team=n,this.pos=o.copy(i),this.pos.y+=.25*Math.sign(this.pos.y-t.center.y),t.ball.placeAtPosition(this.pos.x,this.pos.y,10)},prepare:function(t){g.throwIn.send({receiver:this.team,position:this.pos,team:this.team}),g.throwIn.send({receiver:this.team.opponents,position:this.pos,team:this.team}),t.states.queue(e.states.DelayedMatch)}}),e.states.ChangeSides=e.states.WaitForPlayersAndPlay.extend("ChangeSides",{prepare:function(t){t.ball.inHands&&t.ball.inHands.dropBall(),t.redGoal=t.rightGoal,t.blueGoal=t.leftGoal,t.time=0,t.secondHalf=!0,g.changeSides.send({receiver:t.redTeam,goal:t.redGoal}),g.changeSides.send({receiver:t.blueTeam,goal:t.blueGoal}),t.ball.placeAtPosition(t.center.x,t.center.y,10),t.states.queue(e.states.Kickoff,t.matchStartingTeam.opponents)}}),e.states.EndMatch=e.states.WaitForPlayers.extend("EndMatch",{prepare:function(t){g.endMatch.sendTo(t.redTeam),g.endMatch.sendTo(t.blueTeam)}}),e.prototype=Object.create(c.prototype),e.prototype.pointInLeftPenaltyArea=function(t){var e=n("PENALTY_AREA_HEIGHT");return u.pointInRectangle(t,0,this.center.y-e/2,n("PENALTY_AREA_WIDTH"),e)},e.prototype.pointInRightPenaltyArea=function(t){var e=n("PENALTY_AREA_WIDTH"),i=n("PENALTY_AREA_HEIGHT");return u.pointInRectangle(t,this.width-e,this.center.y-i/2,e,i)},e.prototype.clampPoint=function(t,e){u.clampPointInRectangle(t,0,0,this.width,this.height,e)},e.prototype._enableNetWind=function(t){t.net.enableWind(o.angle(t.facing),.0075)},e.prototype._disableNetWind=function(t){t.net.disableWind()},e.prototype.createRegions=function(){this.regions=[];for(var t=0;t<this.regionColumns;t++){this.regions.push([]);for(var e=0;e<this.regionRows;e++)this.regions[t].push(new p(t*this.regionWidth,e*this.regionHeight,this.regionWidth,this.regionHeight))}},e.prototype.handleBallOutOfPitch=function(){var t=this.ball,i=u.pointRectangleDistance(t.position,0,0,this.width,this.height);if(!this.ballOutOfPlay&&i>t.radius){var n=t.lastTouch?t.lastTouch.team:null;return n?0===this.ballOutOfPlayPosition.x&&n.goal!==this.leftGoal||this.ballOutOfPlayPosition.x===this.width&&n.goal!==this.rightGoal?this.states.change(e.states.BallOutOfPlay,.5).queue(e.states.GoalKick,n.opponents):0===this.ballOutOfPlayPosition.x&&n.goal===this.leftGoal?this.ballOutOfPlayPosition.y<this.height/2?this.states.change(e.states.BallOutOfPlay,.5).queue(e.states.Corner,h.create(.05,.05),n.opponents):this.states.change(e.states.BallOutOfPlay,.5).queue(e.states.Corner,h.create(.05,this.height-.05),n.opponents):this.ballOutOfPlayPosition.x===this.width&&n.goal===this.rightGoal?this.ballOutOfPlayPosition.y<this.height/2?this.states.change(e.states.BallOutOfPlay,.5).queue(e.states.Corner,h.create(this.width-.05,.05),n.opponents):this.states.change(e.states.BallOutOfPlay,.5).queue(e.states.Corner,h.create(this.width-.05,this.height-.05),n.opponents):this.states.change(e.states.BallOutOfPlay,.5).queue(e.states.ThrowIn,this.ballOutOfPlayPosition,n.opponents):this.states.change(e.states.BallOutOfPlay,1/0),!1}return!0},e.prototype.handleTrapping=function(t){for(var e=this.ball,i=0;i<this.players.length;i++){var n=this.players[i];e.owner!==n&&u.circlesIntersect(n.position,n.trapRange,e.position,e.radius)&&g.trap.send({receiver:e,player:n,elapsed:t})&&g.trap.send({receiver:n,ball:e,elapsed:t})}},e.prototype.addPlayer=function(t){this.players.push(t)},e.prototype.removePlayer=function(t){var e=this.players.indexOf(t);if(!(e>=0))throw new Error("Player not found");this.players.splice(e,1)},e.prototype.removeAllPlayers=function(){this.players=[]},e.prototype._updatePlayers=function(t){for(var e,i,n=0;n<this.players.length;n++){e=this.players[n],e.update(t),this.redGoal.checkCollisionWithPlayer(e,t),this.blueGoal.checkCollisionWithPlayer(e,t);for(var r=n+1;r<this.players.length;r++)if(i=this.players[r],u.circlesIntersect(e.position,e.radius,i.position,i.radius)){var s=g.collision.send({receiver:e,player:i}),a=g.collision.send({receiver:i,player:e});if(s){var l=o.temp();h.direction(e.position,i.position,l),g.hit.send({sender:e,receiver:i,force:l,hitInTheHead:!1})}if(a){var l=o.temp();h.direction(i.position,e.position,l),g.hit.send({sender:i,receiver:e,force:l,hitInTheHead:!1})}s&&void 0===a?y.onSlideHit.send(e,i):void 0===s&&a&&y.onSlideHit.send(i,e),void 0===s&&void 0===a&&(u.separateCircles(t,e,i,h.distance(e.position,i.position),e.radius+i.radius),e.position.x+=this.random.uniform(-.01,.01),e.position.y+=this.random.uniform(-.01,.01),i.position.x+=this.random.uniform(-.01,.01),i.position.y+=this.random.uniform(-.01,.01))}}},e.prototype.update=function(t){if(!this._pause.isActive){this.elapsed=this.timeScale*t;var e=this.ball,i=e.radius/2,n=a.length(e.velocity)*this.elapsed+a.length(e.force)*this.elapsed*this.elapsed,r=s(Math.ceil(n/i),1,8),h=this.activeGoal;this.redTeam.update(this.elapsed),this.blueTeam.update(this.elapsed),h.update(this.elapsed),this._updatePlayers(this.elapsed);for(var l=1;r>=l;l++){e.update(this.elapsed/r),h.checkCollisionWithBall(this.elapsed/r);for(var c=0;c<this.walls.length;c++){var p=this.walls[c];(e.oldPosition.z-e.radius<=p.height||e.position.z-e.radius<=p.height)&&u.segmentCapsuleIntersect2(p.from,p.to,e.oldPosition,e.position,e.radius)&&(u.resolveCircleWallCollision(this.elapsed/r,e,p),o.multiplyNumber(e.velocity,.5,e.velocity))}this.states.update(this.elapsed/r)}this._updateEntities(this.elapsed)}},e.prototype.reset=function(){this.redGoal=this.leftGoal,this.blueGoal=this.rightGoal,this.time=0,this.ballOutOfPlay=!1,this.practice=!1,this.goldenGoal=!1,this.secondHalf=!1,this.matchEnded=!1,this.supermovesAllowed=!0,this.redTeam.reset(),this.blueTeam.reset()},e.prototype.beginMatch=function(t,i,n){var r=this.redTeam.isAI?n:0,s=this.blueTeam.isAI?n:0;this.reset(),this.halfTime=t,this.drawAllowed=i,g.beginMatch.send({receiver:this.redTeam,goal:this.leftGoal,opponents:this.blueTeam,ai:r}),g.beginMatch.send({receiver:this.blueTeam,goal:this.rightGoal,opponents:this.redTeam,ai:s}),this.players=this.redTeam.players.concat(this.blueTeam.players),this.matchStartingTeam=this.random.choice([this.redTeam,this.blueTeam]),this.states.change(m,1).queue(e.states.Kickoff,this.matchStartingTeam),e.matchStarted.send(this)},e.prototype.beginPractice=function(){this.reset(),this.supermovesAllowed=!1,g.beginPractice.send({receiver:this.redTeam,goal:this.leftGoal,opponents:this.blueTeam}),g.beginPractice.send({receiver:this.blueTeam,goal:this.rightGoal,opponents:this.redTeam}),this.players=this.redTeam.players.concat(this.blueTeam.players),this.states.change(e.states.Practice)},e.prototype.setWalls=function(e){if(this.walls=[],e)for(var i=0;i<e.length;i++){var n=e[i],r=h.create(n.start[0],n.start[1]),s=h.create(n.end[0],n.end[1]);this.walls.push(new t(r,s,n.height))}},e.prototype.endMatch=function(){this.matchEnded=!0,this.states.change(e.states.BallOutOfPlay,1).queue(e.states.EndMatch)},e.prototype.endHalf=function(){this.states.change(e.states.BallOutOfPlay,1).queue(e.states.ChangeSides),e.halfEnded.send(this)},e.prototype.isTopScorer=function(t){for(var e=0,i=!1,n=0;n<this.players.length;n++){var r=this.players[n].goals;r>e&&(e=r,i=!1),t.goals>=e&&(i=!0)}return i&&e>=4},Object.defineProperty(e.prototype,"matchTime",{get:function(){var t=Math.floor(45*Math.min(this.time/this.halfTime,1)*60);return this.secondHalf&&(t+=2700),t}}),Object.defineProperty(e.prototype,"absoluteTime",{get:function(){return(this.secondHalf?this.halfTime:0)+this.time}}),Object.defineProperty(e.prototype,"absoluteTimeLeft",{get:function(){return this.secondHalf?this.halfTime-this.time:2*this.halfTime-this.time}}),Object.defineProperty(e.prototype,"goalkeeperHasBall",{get:function(){return this.ball.owner&&this.ball.owner.isGoalkeeper||this.ball.inHands&&this.ball.inHands.isGoalkeeper}}),Object.defineProperty(e.prototype,"ballOutside",{get:function(){return!u.pointInRectangle(this.ball.position,0,0,this.width,this.height)}}),Object.defineProperty(e.prototype,"activeGoal",{get:function(){return(!this._activeGoal||Math.abs(this.ball.position.x-this.center.x)>1)&&(this._activeGoal=this.ball.position.x<this.width/2?this.leftGoal:this.rightGoal),this._activeGoal}}),Object.defineProperty(e.prototype,"allPlayersReady",{get:function(){return g.isReady.send({receivers:this.players}).every(i)}}),Object.defineProperty(e.prototype,"allPlayersCanPlay",{get:function(){return g.canPlay.send({receivers:this.players}).every(i)}}),{Pitch:e}}),define("sight",function(){"use strict";function t(t){t.steering=!0,i.apply(this,arguments),this.friction="undefined"!=typeof t.friction?t.friction:15,this.maxSpeed="undefined"!=typeof t.maxSpeed?t.maxSpeed:7,this.minX="undefined"!=typeof t.minX?t.minX:-(1/0),this.minY="undefined"!=typeof t.minY?t.minY:-(1/0),this.maxX="undefined"!=typeof t.maxX?t.maxX:1/0,this.maxY="undefined"!=typeof t.maxY?t.maxY:1/0,this.center=t.center,this.maxDistance="undefined"!=typeof t.maxDistance?t.maxDistance:1/0,this.minDistance=t.minDistance||0,this.steering.add(new n)}var e=require("nebula/math/geometry"),i=require("nebula/entities/entity"),n=require("nebula/steerings/behaviors/arrive").Arrive;return t.prototype=Object.create(i.prototype),t.prototype.update=function(t){i.prototype.update.call(this,t),e.clampPointInRectangle(this.position,this.minX,this.minX,this.maxX-this.minX,this.maxY-this.minY,this.position),e.clampPointInCircle(this.position,this.center,this.maxDistance,this.position),e.clampPointOutsideCircle(this.position,this.center,this.minDistance,this.position)},t}),define("goalkeeper",function(){"use strict";function t(t){t.role="role"in t?t.role:s.ROLE_GOALKEEPER,t.runSpeed="runSpeed"in t?t.runSpeed:e("GOALKEEPER_RUN_SPEED"),t.maxForce="maxForce"in t?t.maxForce:e("GOALKEEPER_MAX_FORCE"),s.apply(this,arguments),this.autoFacing=!1,this.walkSpeed=e("GOALKEEPER_WALK_SPEED"),this.sprintSpeed=e("GOALKEEPER_SPRINT_SPEED"),this.interceptRange=e("GOALKEEPER_INTERCEPT_RANGE"),this.trapRange=e("GOALKEEPER_TRAP_RANGE"),this.tendingRange=e("GOALKEEPER_TENDING_RANGE"),this.catchSpeed=e("GOALKEEPER_CATCH_SPEED"),this.steering.add(new a),this.steering.block.deceleration=.25,this.steering.obstacleAvoidance.enable([this.pitch.blueGoal.leftPost,this.pitch.blueGoal.rightPost,this.pitch.redGoal.leftPost,this.pitch.redGoal.rightPost],1/3),this.steering.pursuit.predictability=1,this.steering.add(new o("interceptBallPursuit")),this.disableSmoothing()}var e=require("settings"),i=require("nebula/math/vector2"),n=require("nebula/math/point2"),r=require("nebula/math/point3"),s=require("player").Player,o=require("nebula/steerings/behaviors/pursuit").Pursuit,a=require("nebula/steerings/behaviors/block").Block,h=(require("nebula/steerings/behaviors/wall_avoidance").WallAvoidance,require("nebula/numbers").radians),l=require("nebula/math/geometry"),u=require("nebula/physics2"),c=(require("nebula/physics3"),require("messages"));return t.prototype=Object.create(s.prototype),t.prototype.releaseControl=function(){this.states.change(ReturnHome).queue(TendGoal),this.controlled=!1},t.prototype.positionInFrontOfPlayer=function(t){var e=i.temp();return n.direction(this.position,t,e),i.dot(e,this.facing)>0},t.prototype.look=function(t){return i.look(this.facing,t,this.maxTurnRate*this.pitch.elapsed,this.facing)},t.prototype.lookAtNow=function(t){n.direction(this.position,t,this.facing)},t.prototype.trackBall=function(){return this.hasBall?(this.facing.x=this.heading.x,this.facing.y=this.heading.y):n.direction(this.position,this.pitch.ball.position,this.facing),!0},t.prototype["catch"]=function(t){if(!this.canCatchBall)return!1;var i=t.owner;if(i){if(!c.steal.send({receiver:i,opponent:this}))return!1;s.onSteal.send(i,this,t)}return t.trap(this),t.stop(),this.team.controllingPlayer=this,this.team.activePlayer=null,this.team.opponents.controllingPlayer=null,this.team.receivingPlayer=null,this.team.opponents.receivingPlayer=null,this.cooldowns.trap=e("TRAP_COOLDOWN"),!0},t.prototype.getGoalKickTarget=function(){var t=n.create(),r=h(this.pitch.random.uniform(-10,10)),s=this.pitch.random.uniform(e("GOALKEEPER_LOB_MIN_DISTANCE"),e("GOALKEEPER_LOB_MAX_DISTANCE"));return i.direction(r,t),t.x=this.position.x+t.x*s*this.team.goal.facing.x,t.y=this.position.y+t.y*s,t},t.prototype.shouldCatchBall=function(t,e){var r=this.pitch.ball;if(r.owner||!this.team.isGoalThreatened()||r.position.z>1.5*this.height)return!1;var s=i.temp();if(n.direction(r.position,this.position,s),i.dot(r.heading,s)>.5)return!1;if(l.nearestPointOnRay(this.position,r.position,r.heading,e),n.distance(this.position,e)<this.radius)return!1;var o=r.timeToCoverDistance(r.position,e,i.length(r.velocity)),a=u.timeToCoverDistance(this.position,e,this.catchSpeed,-4*t);return a>=o-.1&&o+.1>=a},Object.defineProperties(t.prototype,{shouldInterceptBall:{get:function(){var t=this.pitch.ball;return this.isClosestTeamMemberToBall&&!this.team.inControl&&t.speed<30/3.6&&t.position.z<=this.height&&this.team.fieldPlayers.length?!0:!t.owner&&this.team.isGoalThreatened()?!1:this.team.goal.distance(t.position)<=this.interceptRange&&(!this.team.inControl||!this.team.receivingPlayer&&!this.isControllingPlayer&&!t.owner)}},tooFarFromGoalmouth:{get:function(){return this.team.goal.distance(this.position)>this.interceptRange}},canTrapBall:{get:function(){var t=this.pitch.ball.position.z,e=this.trapRange;return this.position.z<=t&&t<=.8*this.height&&this.distanceToBall<e}},canCatchBall:{get:function(){return this.pitch.ball.position.z<=this.position.z+this.height&&this.positionInFrontOfPlayer(this.pitch.ball.position)}},shouldJumpToBall:{get:function(){var t=this.pitch.ball;if(t.owner||!this.team.isGoalThreatened())return!1;var e=i.temp();if(n.direction(t.position,this.position,e),i.dot(e,t.heading)<.9)return!1;var s=t.timeToCoverDistance(t.position,this.position,i.length(t.velocity)),o=r.temp();t.futurePosition(s,o);var a=(o.z-.7*this.height- -4.905*s*s)/s;return n.distance(o,this.position)<this.radius&&o.z>.6*this.height&&s>=.1&&.4>=s&&a>0?Math.min(a,3.7):0}},direction:{get:function(){return this.controller&&i.notZero(this.controller.direction)?this.controller.direction:this.facing}}}),{Goalkeeper:t}}),define("players/states",function(){"use strict";function t(t){t.isGoalkeeper?t.pitch.ballOutOfPlay?t.states.change(R,X):t.hasBall?t.team.isAI?t.states.change(St):t.user?t.states.change(Bt):t.team.closestUser(t.position).takeControl(t,Bt):i(t,!0):t.pitch.ballOutOfPlay?t.states.change(R,k):t.hasBall?t.team.isAI?t.states.change(gt):t.user?t.states.change(kt):t.team.closestUser(t.position).takeControl(t,kt):t.user?t.user.controller?t.states.change(Mt):t.states.idle():t.states.change(pt)}function e(t){t.lookAtNow(t.pitch.ball.position),t.setHeading(t.facing),t.states.change(j)}function i(t,e){e?t.states.change(R,wt):t.states.queue(R,wt)}function n(t,e){var i=t.isGoalkeeper?Ut:qt;if("undefined"==typeof e&&(e=t.states.current?t.states.current.constructor:null),e instanceof R)return t.states.current.state;for(var n=0;n<i.length;n++)if(i[n][0]===e)return 2===i[n].length?i[n][1]:i[n][0];return null}function r(t,e){var i=t.isGoalkeeper?zt:Gt;if("undefined"==typeof e&&(e=t.states.current?t.states.current.constructor:null),e instanceof O)return t.states.current.state;for(var n=0;n<i.length;n++)if(i[n][0]===e)return 2===i[n].length?i[n][1]:i[n][0];return null}var s=require("settings"),o=require("nebula/numbers"),a=require("nebula/math/point2"),h=require("nebula/math/vector2"),l=require("nebula/math/vector3"),u=require("nebula/math/point3"),c=(require("nebula/physics2"),require("nebula/random"),require("nebula/math/geometry")),p=require("nebula/steerings/behaviors/seek").seek,d=(require("nebula/steerings/behaviors/seek").Seek,require("nebula/steerings/behaviors/obstacle_avoidance").ObstacleAvoidance,require("nebula/steerings/behaviors/separation").separation),f=require("nebula/steerings/behaviors/separation").Separation,m=(require("nebula/steerings/behaviors/block").Block,require("nebula/entities/utils")),g=require("messages"),y=require("nebula/states").Interval,v=require("nebula/states").State,x=require("nebula/states").Wait,b=(require("nebula/states").Callback,require("player").Player),w=require("sight"),_=s("DEBUG"),T=s("LOB_MIN_DISTANCE"),E=s("LOB_MAX_DISTANCE"),S=s("MIN_PASS_DISTANCE"),A=s("MIN_PASSING_FORCE"),C=s("MAX_PASSING_FORCE"),P=s("MIN_SHOOTING_FORCE"),M=s("MAX_SHOOTING_FORCE"),O=v.extend("RequestHuman",{enter:function(t,e){this.state=e},update:function(t){var e=t.team;if(e.isAI)t.states.queued?t.states.next():t.states.change(this.state);else if(t.user&&t.controller)t.states.change(r(t,this.state));else{var i=e.users[e.currentUser];e.currentUser=(e.currentUser+1)%e.users.length,i.controller&&i.takeControl(t,r(t,this.state))}}}),R=v.extend("RequestAI",{enter:function(t,e){this.state=e},update:function(t){t.user?t.user.releaseControl(this.state):t.states.change(this.state)}}),k=v.extend("Ready",{onIsReady:!0,onPlay:function(e,i){return t(e),!0},update:function(t){t.trackBall()}}),I=v.extend("WaitForOthers",{onIsReady:!0,update:function(t){t.hasBall||t.trackBall(),0===t.pitch.ball.speed&&t.pitch.allPlayersReady&&t.states.next()}}),D=x.extend("Kick",{enter:function(t,e,i,n){x.prototype.enter.call(this,t,.5),this.save(t,"friction"),this.target=e?a.copy(e):null,this.force=i,this.accuracy=null!=n?n:t.accuracy,this.hasKicked=!1,t.friction=0},onTrap:!0,onSteal:function(e,i){return e.cooldowns.trap+=s("TRAP_COOLDOWN"),e.release(),t(e),!0},kick:function(t){var e=h.temp();this.target?a.direction(t.pitch.ball.position,this.target,e):(e.x=t.direction.x,e.y=t.direction.y),1!==this.accuracy&&h.rotate(e,Math.PI*t.pitch.random.uniform(-.25,.25)*(1-this.accuracy),e),t.pitch.ball.stop(),t.release(),t.pitch.ball.lastTouch=t,t.pitch.ball.kick(e,this.force),b.onKick.send(t,this.target,e,this.force)},update:function(t,e){this.target&&!t.positionInFrontOfPlayer(this.target)&&t.lookAt(this.target),!this.hasKicked&&t.states.time>=.1333&&(this.kick(t),this.hasKicked=!0),x.prototype.update.call(this,t,e)},exit:function(t){this.restore(t)}}),L=v.extend("Jump",{enter:function(t,e,i,n){this.kicked=!1,this.save(t,"friction","maxSpeed"),t.friction=0,t.maxSpeed=1/0,t.position.z=0,t.velocity.z+=4,this.target=e,this.force=i,this.accuracy=null!=n?n:t.accuracy},onTrap:!0,onBallOutOfPlay:function(t,e){return t.states.after(R,k),!0},kick:function(t){if(!this.kicked){this.kicked=!0;var e,i=t.pitch.ball,n=u.copy(t.position);n.z+=t.height,u.distance(n,i.position)>.5||(this.target?(e=h.temp(),a.direction(i.position,this.target,e)):e=h.copy(t.heading),1!==this.accuracy&&h.rotate(e,Math.PI*t.pitch.random.uniform(-.25,.25)*(1-this.accuracy),e),t.release(),t.pitch.ball.kick(e,this.force),b.onHeadKick.send(t,this.target,e,this.force))}},update:function(t){0===t.position.z&&t.states.next()},exit:function(t){this.restore(t)}}),F=D.extend("Swerve",{kick:function(t){1!==this.accuracy&&h.rotate(this.direction,Math.PI*t.pitch.random.uniform(-.5,.5)*(1-this.accuracy),this.direction),g.releaseBall.sendTo(t.pitch.ball),t.pitch.ball.lastTouch=t,t.pitch.ball.swerve(this.direction,this.force,this.swerve),b.onKick.send(t,this.target,this.direction,this.force,this.swerve),b.onShot.send(t)},enter:function(t,e,i,n,r,s){D.prototype.enter.call(this,t,e,n,r),this.direction=i,this.swerve=s}}),B=D.extend("Lob",{enter:function(t,e,i){D.prototype.enter.call(this,t,e,null,i)},kick:function(t){t.pitch.ball.stop(),g.releaseBall.sendTo(t.pitch.ball),t.pitch.ball.lastTouch=t,t.pitch.ball.lob(this.target);var e=m.findClosest(this.target,t.team.players);e.entity&&e.entity!==t?(g.receiveLob.send({receiver:e.entity,target:this.target,passer:t}),b.onLob.send(t,this.target,e.entity)):b.onLob.send(t,this.target)}}),N=D.extend("Pass",{enter:function(t,e,i,n,r){this.receiver=e,!i&&e&&(i=a.copy(e.position)),null==n&&(n=i?o.clamp(a.distance(i,t.pitch.ball.position)/10,0,1):0);var s=A+n*(C-A);D.prototype.enter.call(this,t,i,s,r)},kick:function(t){D.prototype.kick.call(this,t),this.receiver&&(g.receiveBall.send({receiver:this.receiver,target:this.target,passer:t}),b.onPass.send(this,this.receiver))}}),G=D.extend("DirectShot",{kick:function(t){var e=(t.team.opponents.goal,t.pitch.ball);this.target=a.create(),t.team.getCleanShootTarget(this.target)||(t.team.ai>=1?t.team.getBestShootTarget(this.target):t.team.opponents.goal.randomTarget(this.target)),e.stop(),D.prototype.kick.call(this,t),t.user&&b.onShot.send(t)},enter:function(t,e,i){var n=P+(M-P)*e;D.prototype.enter.call(this,t,null,n,i)}}),q=v.extend("PreciseShot",{trajectory:u.array(30),enter:function(t){t.pitch.timeScale=.2,this.trajectoryTime=.5,this.swerve=l.create(),this.velocity=l.create(),this.direction=h.copy(t.direction),this.ballStart=u.create()},getSwerveUp:function(t){throw new Error("Not implemented")},getSwerveDown:function(t){throw new Error("Not implemented")},getVelocity:function(t){throw new Error("Not implemented")},getDirection:function(t){throw new Error("Not implemented")},isShooting:function(t){throw new Error("Not implemented")},update:function(t,e){t.move(t._heading);var i=t.pitch.ball,n=P+(M-P)*(t.states.time/.4);this.getSwerveUp(t)?this.swerve.z+=8*e:this.getSwerveDown(t)&&(this.swerve.z-=8*e);var r=o.radians(180)*e*this.getVelocity(t);return i.futurePosition(.1333,this.ballStart),h.look(this.direction,this.getDirection(t),r,this.direction),h.multiplyNumber(this.direction,n/i.mass,this.velocity),i.trajectory(this.ballStart,this.velocity,this.swerve,this.trajectoryTime,this.trajectory),t.pitch.game.stadium.sight.trajectory(this.trajectory),t.pitch.game.stadium.sight.show(),t.states.time>=.4||!this.isShooting(t)?void t.states.replace(F,this.trajectory[this.trajectory.length-1],this.direction,n,1,this.swerve):void 0},exit:function(t){t.pitch.game.stadium.sight.hide(),t.pitch.timeScale=1}}),z=v.extend("Supershot",{enter:function(t){this.kicked=!1,t.pitch.timeScale=.25,g.supershotPrepare.send({receiver:t.pitch.ball,sender:t})},onSupershotEnd:function(e,i){return t(e),!0},onSupershotHit:!1,onTrap:!0,onHit:!0,kick:function(t){
var e=l.create();0===t.team.ai||t.user?(e.x=t.direction.x,e.y=t.direction.y):t.team.ai<3?a.direction(t.position,t.team.opponents.goal.randomTarget(),e):a.direction(t.position,t.team.opponents.goal.center,e),l.multiplyNumber(e,s("SUPERSHOT_FORCE"),e),g.supershotKick.send({receiver:t.pitch.ball,force:e,shooter:t}),b.onShot.send(t)},update:function(t){t.states.time>=.3&&!this.kicked&&(this.kick(t),this.kicked=!0)}}),U=v.extend("SlideWait",{time:s("SLIDE_DELAY"),onCanPlay:!1,onBallOutOfPlay:!0,update:function(e){e.states.time>=this.time?t(e):e.controller&&!e.pitch.ballOutOfPlay&&e.controller.togglePlayer.isActive&&!e.hasBall&&e.team.findControl(e.user)},exit:function(t){t.user&&t.user.clearActions()}}),j=v.extend("Slide",{enter:function(t){t.stop(),t.applyImpulse(t._heading,s("SLIDE_SPEED")),t.maxSpeed=1/0,t.steering.pause()},onCanPlay:!1,onCorner:!0,onThrowIn:!0,onKickoff:!0,onGoalKick:!0,onBallOutOfPlay:!0,onCollision:function(t,e){return e.post?(t.states.change(W,0,1,!1),void h.multiplyNumber(t.velocity,.5,t.velocity)):a.distance(t.position,e.player.position)<s("SLIDE_COLLISION_RADIUS")},onTrap:function(t,e){if(t.pitch.ballOutOfPlay)return!0;var i=e.ball;return i.position.z<.6*t.height&&a.distance(t.position,i.position)<=t.radius+i.radius&&t.trap(e.ball,!0)&&b.onSlideTrap.send(t,i),!0},update:function(t,e){if(t.states.time>=s("SLIDE_TIME"))if(t.pitch.ballOutOfPlay)t.states.change(R,k);else{if(t.hasBall&&t.team.users.length&&!t.user){var i=t.team.closestUser(t.position);i&&i.takeControl(t,null)}t.states.replace(U)}},exit:function(t){t.run(),t.steering.resume()}}),H=v.extend("Header",{enter:function(t){this.radius=s("HEADER_HEAD_RADIUS"),this.head=u.create(),this.kicked=!1,t.stop(),t.applyImpulse(t.facing,s("HEADER_SPEED")),t.maxSpeed=1/0,t.user&&t.user.clearActions()},onBallOutOfPlay:function(t,e){return t.states.after(R,k),!0},onReceiveBall:!0,onReceiveLob:!0,onHit:!0,update:function(t){var e=t.pitch.ball;if(this.head.x=t.position.x+.25*t.facing.x,this.head.y=t.position.y,this.head.z=t.height,!this.kicked&&!e.owner&&u.distance(this.head,e.position)<e.radius+this.radius&&t.positionInFrontOfPlayer(e.position)){if(t.positionInFrontOfPlayer(t.team.opponents.goal.center)){var i=t.team.opponents.goal.randomTarget(),n=h.temp();a.direction(e.position,i,n)}else var n=t.facing;e.stop(),e.lastTouch=t,e.kick(n,s("HEADER_FORCE")),b.onHeader.send(t),this.kicked=!0}t.states.time>=s("HEADER_TIME")&&t.states.replace(x,s("HEADER_DELAY"))},exit:function(t){t.run()}}),W=v.extend("Hit",{enter:function(t,e,i,n){this.time=1.4333+i,this.save(t,"friction"),t.hasBall&&(t.team.controllingPlayer===t&&(t.team.controllingPlayer=null),t.release(),e&&t.pitch.ball.applyImpulse(e,1)),t.steering.pause(),e&&t.applyImpulse(e),t.friction=t.isGoalkeeper?8:3},onCanPlay:!1,onCollision:!1,onCorner:!0,onThrowIn:!0,onKickoff:!0,onGoalKick:!0,onBallOutOfPlay:!0,onSupershotHit:!1,onTrap:!0,onReceiveLob:!0,onReceiveBall:!0,update:function(e){return!e.pitch.ballOutOfPlay&&e.controller&&e.controller.togglePlayer.isActive?void e.team.findControl(e.user):void(e.states.time>=this.time&&t(e))},exit:function(t){this.restore(t),t.steering.resume()}}),Y=v.extend("GoTo",{enter:function(t,e,i){this.target=e,this.distance="undefined"==typeof i?t.radius:i,t.steering.arrive.radius=0,t.steering.arrive.direction=null,t.isGoalkeeper&&(t.autoFacing=!0)},update:function(t){a.distance(this.target,t.position)<=this.distance?t.states.next():t.steering.arrive.enable(this.target)},exit:function(t){t.isGoalkeeper&&(t.autoFacing=!1),t.steering.arrive.disable()}}),X=Y.extend("ReturnHome",{enter:function(t,e){Y.prototype.enter.call(this,t,e||t.home,s("PLAYER_IN_TARGET_RANGE")),t.steering.obstacleAvoidance.enable(t.pitch.players),t.steering.obstacleAvoidance.detectionRadius=2,t.steering.obstacleAvoidance.spacing=.25,t.steering.obstacleAvoidance.weight=1.5},exit:function(t){Y.prototype.exit.call(this,t),t.steering.obstacleAvoidance.disable()}}),K=v.extend("Kickoff",{enter:function(t,e){this.play=!1,this.assistant=e;var i=h.copy(t.team.opponents.goal.facing);h.rotate(i,o.radians(45),i),t.steering.arrive.enable(t.pitch.center),t.steering.arrive.radius=.75*t.radius,t.steering.arrive.direction=i},onIsReady:function(t){return t.pitch.ball.onGround&&t.canKickBall&&t.speed<.01},onPlay:function(t,e){return this.play=!0,!0},update:function(t){t.steering.arrive.atTarget&&(t.stop(),t.trackBall()),this.play&&(this.assistant?t.states.replace(N,this.assistant,null,0,s("PASS_ACCURACY")):t.states.next())}}),V=x.extend("ThrowInPickUpBall",{enter:function(t){x.prototype.enter.call(this,t,2)},onHit:!0,update:function(t,e){!t.pitch.ball.inHands&&t.states.time>=.4&&t.holdBall(),x.prototype.update.call(this,t,e)}}),Z=v.extend("ThrowInThrow",{enter:function(t,e,i){x.prototype.enter.call(this,t,.6666),this.receiver=e,this.target=i||e.position,this.threw=!1},onHit:!0,"throw":function(t){var e=t.pitch.ball;g.releaseBall.sendTo(t.pitch.ball),e.placeAtPosition(t.position.x,t.position.y,t.height),e.lob(this.target),t.dropBall(),b.onThrow.send(t,this.target);var i=this.receiver;if(!i){var n=m.findClosest(this.target,t.team.players);n.entity&&n.entity!==t&&(i=n.entity)}i&&g.receiveLob.send({receiver:i,target:a.copy(this.target),passer:t})},update:function(t,e){t.lookAt(this.target),!this.threw&&t.states.time>=.4666&&(this["throw"](t),this.threw=!0),x.prototype.update.call(this,t,e)}}),J=v.extend("ReceiveBall",{enter:function(t){t.team.receivingPlayer=t},onReceiveBall:!0,onPlay:!0,onIsReady:!0,onTrap:function(t,e){var i=e.ball;return t.trap(i)&&t.states.next(),!0},update:function(t){t.trackBall()},exit:function(t){t.team.receivingPlayer=null}}),Q=v.extend("GoToCorner",{enter:function(t,e){var i=a.copy(e);i.x+=t.radius*t.team.goal.facing.x,i.y+=t.radius*Math.sign(e.y-t.pitch.center.y)*.2,t.steering.arrive.enable(i),t.steering.arrive.radius=0,t.sprint()},update:function(t){t.steering.arrive.atTarget&&(t.stop(),t.trackBall()&&t.states.next())},exit:function(t){t.run(),t.steering.arrive.disable()}}),$=v.extend("GoToGoalKick",{enter:function(t){this.save(t,"autoFacing");var e=h.copy(t.team.opponents.goal.facing);h.rotate(e,.15*Math.PI*t.team.goal.facing.x,e),t.steering.arrive.enable(t.team.goalKickPosition),t.steering.arrive.radius=.75*t.radius,t.steering.arrive.direction=e,t.sprint(),t.autoFacing=!0},update:function(t){t.steering.arrive.atTarget&&(t.stop(),t.trackBall()&&t.states.next())},exit:function(t){this.restore(t),t.run(),t.steering.arrive.disable()}}),tt=v.extend("GoalCelebration",{enter:function(t){if(this.save(t,"autoFacing"),t.autoFacing=!1,this.nextState=t.pitch.random.choice([et,nt,rt,st]),this.nextState===et){var e=[],i=t.team.players.slice(0);m.sortByDistance(i,t.position),i.shift();for(var n=-1;++n<i.length&&e.length<2;)g.joinGoalCelebrationPlane.send({receiver:i[n],player:t})&&e.push(i[n])}var r=h.create();t.steering.obstacleAvoidance.enable(t.pitch.players),t.steering.obstacleAvoidance.detectionRadius=2,t.steering.obstacleAvoidance.spacing=.25,t.steering.obstacleAvoidance.weight=1.5,this.target=a.create(),this.target.x=t.pitch.random.uniform(.4,.6)*t.pitch.width,this.target.y=t.pitch.random.uniform(.85,.95)*t.pitch.height,a.direction(t.position,this.target,r),t.steering.arrive.enable(this.target),t.steering.arrive.radius=t.radius,t.steering.arrive.direction=r},update:function(t){t.facing.y=1,t.facing.x=Math.sign(t.heading.x),(a.distance(this.target,t.position)<2||t.states.time>3)&&t.states.change(this.nextState)},exit:function(t){this.restore(t),t.steering.arrive.disable(),t.steering.obstacleAvoidance.disable()}}),et=x.extend("GoalCelebrationPlane",{time:3,enter:function(t){x.prototype.enter.call(this,t),this.save(t,"friction","autoFacing"),t.autoFacing=!1,t.steering.pause(),t.velocity.x=10*t.heading.x,t.velocity.y=10*t.heading.y,t.friction=3},exit:function(t){t.steering.resume(),this.restore(t),x.prototype.exit.call(this,t)}}),it=v.extend("GoalCelebrationPlaneAssist",{enter:function(t,e){this.save(t,"autoFacing"),t.autoFacing=!1,this.target=e,this.player=t;var i=h.create();t.steering.obstacleAvoidance.enable(t.pitch.players),t.steering.obstacleAvoidance.detectionRadius=2,t.steering.obstacleAvoidance.spacing=.25,t.steering.obstacleAvoidance.weight=1.5,a.direction(t.position,this.target.position,i),t.steering.arrive.enable(this.target.position),t.steering.arrive.radius=t.radius,t.steering.arrive.direction=i},update:function(t){t.facing.y=1,t.facing.x=Math.sign(t.heading.x),a.distance(t.position,this.target.position)<2?t.run():t.sprint(),this.target.states.current.constructor===et&&this.player.states.change(et)},exit:function(t){this.restore(t),t.steering.arrive.disable(),t.steering.obstacleAvoidance.disable(),t.run()}}),nt=x.extend("GoalCelebrationDance",{time:6}),rt=x.extend("GoalCelebrationDance2",{time:6}),st=x.extend("GoalCelebrationKneeslide",{time:6,enter:function(t){x.prototype.enter.call(this,t),this.save(t,"friction"),t.steering.pause(),t.velocity.x=10*t.heading.x,t.velocity.y=10*t.heading.y,t.friction=3},exit:function(t){this.restore(t),t.steering.resume(),x.prototype.exit.call(this,t)}}),ot=J.extend("AIReceiveBall2",{enter:function(t){J.prototype.enter.call(this,t),t.states.after(gt),t.team.activePlayer=t}}),at=v.extend("AICornerKick",{enter:function(t,e){this.pass=t.pitch.random.uniform()<s("CORNER_KICK_PASS_CHANCE")},onPlay:!0,update:function(t){t.trackBall();var e=t.team.findPass(t,s("MAX_PASSING_FORCE"),0,!1);if(this.pass&&e.receiver)g.play.sendTo(t.pitch),t.states.change(N,e.receiver,e.target,null,s("PASS_ACCURACY")).queue(dt);else{g.play.sendTo(t.pitch);var i=a.copy(t.team.opponents.goal.center);i.y+=t.pitch.random.uniform(-3,3),i.x+=t.pitch.random.uniform(2,4)*t.team.opponents.goal.facing.x,t.states.change(B,i,null).queue(dt)}}}),ht=v.extend("AIThrowIn",{enter:function(t,e){this.assistants=e},onPlay:!0,update:function(t){var e=t.pitch.random.choice(this.assistants);g.play.sendTo(t.pitch),t.states.change(Z,e).queue(dt)}}),lt=v.extend("AIMarking",{enter:function(t,e){t.steering.marking.enable(t.pitch.ball.position,e.position)},update:function(t){t.team.inControl&&t.states.change(dt)},exit:function(t){t.steering.marking.disable()}}),ut=y.extend("AIChaseBall",{enter:function(t){3===t.team.ai?this.baseInterval=.15:2===t.team.ai?this.baseInterval=.25:1===t.team.ai?this.baseInterval=.3:this.baseInterval=.5,this.interval=this.baseInterval,this.target=u.create(),3===t.team.ai?this.slideDelay=t.pitch.random.uniform(.5,1.75):2===t.team.ai?this.slideDelay=t.pitch.random.uniform(.75,2):1===t.team.ai?this.slideDelay=t.pitch.random.uniform(1.25,2.25):this.slideDelay=t.pitch.random.uniform(2,5),t.steering.obstacleAvoidance.enable(t.pitch.players),t.steering.obstacleAvoidance.detectionRadius=.75,t.steering.obstacleAvoidance.spacing=0,t.steering.obstacleAvoidance.weight=3,this.step(t),t.lookAtNow(this.target),t.team.activePlayer=t},step:function(t){t.pitch.ball.futurePosition(.1,this.target),t.pitch.clampPoint(this.target,this.target)},onTrap:function(e,i){var n=i.ball;return n.speed<50/3.6?(e.trap(n)&&t(e),!0):(e.states.change(x,.5).queue(ut),!1)},update:function(t,e){var i=t.pitch.ball;return!t.shouldChaseBall&&(t.team.inControl||t.states.time>=.25)?void t.states.change(pt):(y.prototype.update.call(this,t,e),t.distanceToBall<=1.5*t.radius||i.speed<2?(this.interval=1/0,t.lookAtNow(t.pitch.ball.position)):(this.interval=this.baseInterval,t.lookAt(this.target)),t.distanceToBall<t.radius&&i.position.z>t.height?t.stop():t.move(t._heading),3===t.team.ai?t.sprint():t.distanceToBall>3&&t.team.ai>0?t.sprint():t.run(),void(t.pitch.goalkeeperHasBall?t.states.change(pt):i.owner&&t.states.time>=this.slideDelay&&t.distanceToBall<2&&t.positionInFrontOfPlayer(i.owner.position)&&(t.team.ai>=1?t.willSlideIntoGoal(t.team.goal,t.team.ballFuturePosition)?t.willSlideIntoGoal(t.team.opponents.goal,t.team.ballFuturePosition)&&(t.lookAt(t.team.ballFuturePosition),t.states.change(j)):(t.lookAt(t.team.ballFuturePosition),t.states.change(j)):t.states.change(j))))},exit:function(t){t.steering.obstacleAvoidance.disable(),t.run()}}),ct=v.extend("AIPushForward",{enter:function(t){t.steering.obstacleAvoidance.enable(t.pitch.players),t.steering.obstacleAvoidance.detectionRadius=.75,t.steering.obstacleAvoidance.spacing=0,t.steering.obstacleAvoidance.weight=3,t.steering.seek.enable(t.pitch.ball.position),t.sprint()},onTrap:function(e,i){var n=i.ball;return n.speed<50/3.6?(e.trap(n)&&t(e),!0):(e.states.change(x,.5).queue(ct),!1)},update:function(t,e){var i=(t.pitch.ball,t.team.opponents);if(t.states.time>=.5)if(t.willSlideIntoGoal(t.team.opponents.goal,t.team.ballFuturePosition))t.lookAt(t.team.ballFuturePosition),t.states.change(j);else if(i.distanceToBall>=t.distanceToBall&&i.distanceToBall<=t.distanceToBall+1.5)t.lookAt(t.team.ballFuturePosition),t.states.change(j);else if(i.playerClosestToBall.distanceToBall<t.distanceToBall&&a.distance(i.playerClosestToBall.position,t.position)<2){var n=a.temp();return i.playerClosestToBall.futurePosition(.1,n),t.lookAt(n),void t.states.change(j).queue(ct)}return t.pitch.ball.owner?void t.states.change(pt):void 0},exit:function(t){t.steering.obstacleAvoidance.disable(),t.steering.seek.disable(),t.run()}}),pt=v.extend("AIDefend",{enter:function(t){this.target=a.create(),this.oldTarget=a.create(),this.offset=h.create(),this.deceleration=t.steering.arrive.deceleration,t.steering.arrive.enable(this.target)},update:function(t){if(t.team.inControl)return void t.states.change(dt);if(t.shouldChaseBall)return void t.states.change(ut);var e=t.pitch.ball,i=t.pitch.ballOutOfPlay?t.pitch.ballOutOfPlayPosition:e.position,n=i.x-t.pitch.center.x,r=i.y-t.pitch.center.y;n*=t.isAttacker?.5:t.isMidfielder?.25:.5,r*=.25,n=Math.floor(n)+.5+t.home.x,r=Math.floor(r)+.5+t.home.y,this.oldTarget.x===n&&this.oldTarget.y===r||(this.offset.x=t.pitch.random.uniform(-1,1),this.offset.y=t.pitch.random.uniform(-1,1)),this.oldTarget.x=n,this.oldTarget.y=r,this.target.x=n+this.offset.x,this.target.y=r+this.offset.y,c.clampPointInRectangle(this.target,2,.5,t.pitch.width-4,t.pitch.height-1,this.target),t.steering.arrive.atTarget&&t.trackBall();var s=a.distance(t.position,t.steering.arrive.target);s>4?(t.steering.arrive.deceleration=5,t.sprint()):1.5>s?(t.steering.arrive.deceleration=this.deceleration,t.walk()):(t.steering.arrive.deceleration=5,t.run())},exit:function(t){t.steering.arrive.disable(),t.steering.arrive.deceleration=this.deceleration,t.run()}}),dt=y.extend("AIAttack",{interval:1.5,enter:function(t){this.separation=h.create(),this.target=a.create(),t.steering.arrive.enable(this.target),this.deceleration=t.steering.arrive.deceleration,t.steering.arrive.deceleration=1},step:function(t){var e=t.pitch.ball.owner;e&&t.distanceToOpponentsGoal<e.distanceToOpponentsGoal&&a.distance(e.position,t.position)>=s("MIN_PASS_DISTANCE")&&t.team.ai<=1&&t.team.requestPass(t)},update:function(t,e){if(!t.team.inControl)return void t.states.change(pt);if(t.team.fieldPlayerClosestToBall===t&&!t.pitch.ball.owner&&t.pitch.ball.speed<4&&!t.team.receivingPlayer)return void t.states.change(ut);var i=t.team.controllingPlayer;a.difference(i.position,i.home,this.target),t.isDefender?this.target.x*=.75:t.isMidfielder&&(this.target.x*=1.25);var n=t.pitch.center.y-t.position.y;this.target.y*=.5;var r=t.pitch.width/t.distanceToOpponentsGoal*.75;r>0&&(this.target.y+=Math.sign(n)*Math.min(Math.abs(r),Math.abs(n))),this.target.x+=t.home.x,this.target.y+=t.home.y,d(t,t.team.players,40,this.separation),this.target.x+=8*this.separation.x,this.target.y+=4*this.separation.y,c.clampPointInRectangle(this.target,2,.5,t.pitch.width-4,t.pitch.height-1,this.target),t.steering.arrive.atTarget&&t.trackBall(),y.prototype.update.call(this,t,e)},exit:function(t){t.steering.arrive.disable(),t.steering.arrive.deceleration=this.deceleration}}),ft=v.extend("AIReceivePass",{enter:function(t,e){t.team.receivingPlayer=t,this.target=e,this.target&&t.steering.arrive.enable(this.target)},onTrap:function(e,i){var n=i.ball;return e.trap(n)&&(t(e),b.onReceivePass.send(e)),!0},update:function(e,i){var n=e.pitch.ball;return e.states.time>.75&&(n.owner||n.headingTowards(e.position)<.5||n.timeToCoverDistance(n.position,e.position,n.speed)<0)?(e.team.receivingPlayer=null,e.team.controllingPlayer=null,void(e.user?t(e):e.isGoalkeeper?e.states.change(Et):e.states.change(ut))):(e.user?e.controller.sprint.isActive?e.sprint():e.run():this.target&&(a.distance(e.position,e.steering.arrive.target)>3?e.sprint():e.run()),(e.ballWithinReceivingRange||e.isThreatened||!this.target)&&(e.steering.arrive.disable(),e.steering.pursuit.enable(n),e.steering.pursuit.predictability=.75),void(this.target&&e.steering.arrive.atTarget&&(e.stop(),e.steering.arrive.disable(),e.trackBall())))},exit:function(t){t.run(),t.team.receivingPlayer=null,t.steering.arrive.disable(),t.steering.pursuit.disable()}}),mt=v.extend("AIReceiveLob",{enter:function(t,e){var i=h.create(),n=a.create();c.clampPointInRectangle(e,.25,.25,t.pitch.width-.5,t.pitch.height-.5,n),this.target=n,a.direction(t.pitch.ball.position,n,i),t.steering.arrive.enable(n),t.steering.arrive.radius=t.height,t.steering.arrive.direction=i,t.team.receivingPlayer=t},onTrap:function(e,i){var n=i.ball;return e.trap(n)&&(t(e),b.onReceivePass.send(e)),!0},update:function(e){var i=e.pitch.ball;return e.states.time>=1&&(i.owner||i.headingTowards(e.position)<.5)?void t(e):(e.user?e.controller.sprint.isActive?e.sprint():e.run():a.distance(e.position,e.steering.arrive.target)>3?e.sprint():e.run(),void(e.steering.arrive.atTarget&&e.trackBall()))},exit:function(t){t.run(),t.team.receivingPlayer=null,t.steering.arrive.disable()}}),gt=y.extend("AIDribble",{interval:.1,enter:function(t){if(_&&!t.hasBall)throw new Error("no ball here");this.minComfortZoneTime=s("PLAYER_MIN_COMFORT_ZONE_TIME")[t.team.ai],this.forceDribbleTime=t.isOnOpponentsSide?t.pitch.random.uniform(.25,2):t.pitch.random.uniform(0,.5),this.lob=t.pitch.random.uniform()<s("LOB_CHANCE")[t.team.ai],this.target=a.create(t.team.opponents.goal.center.x,t.home.y+t.pitch.random.uniform(-1,1)),this.force=h.create(),this.seekForce=h.create(),this.separateForce=h.create(),this.shotTarget=a.create(),this.crossPassTarget=a.create(),this.approachingGoal=!1,this.save(t,"maxSpeed"),t.maxSpeed=t.dribbleSpeed,t.steering.boundaryAvoidance.distance=2,t.steering.boundaryAvoidance.enable(t.team.bounds,12)},onSteal:function(t,e){return t.cooldowns.trap+=s("TRAP_COOLDOWN"),t.states.change(x,.5).queue(pt),!0},onRequestPass:function(t,e){var i=a.distance(t.position,e.requester.position);return!e.requester.isGoalkeeper&&this.lob&&i>=s("LOB_MIN_DISTANCE")&&i<=s("LOB_MAX_DISTANCE")?t.states.change(B,e.requester.position,null):t.states.change(N,e.requester,null,null,s("PASS_ACCURACY")),t.states.queue(dt),!0},step:function(t){!this.approachingGoal&&t.distanceToOpponentsGoal<10?(t.team.opponents.goal.randomTarget(this.target),this.approachingGoal=!0):this.approachingGoal||(this.target.y+=t.pitch.random.uniform(-3,3),this.target.y=o.clamp(this.target.y,2,t.pitch.height-4));var e,i;3===t.team.ai?(e=1.5,i=6):2===t.team.ai?(e=1.75,i=5.5):1===t.team.ai?(e=2,i=5):(e=5,i=2),p(t,this.target,this.seekForce),d(t,t.team.opponents.players,e,this.separateForce),h.multiplyNumber(this.separateForce,i,this.separateForce),h.add(this.seekForce,this.separateForce,this.force),h.normalize(this.force,this.force)},update:function(t,e){if(_&&!t.hasBall)throw new Error("no ball here");if(y.prototype.update.call(this,t,e),t.look(this.force),t.move(t._heading),t.team.hasSupermove("supershot")&&t.headingTowards(t.team.opponents.goal.center)>.5&&t.distanceToOpponentsGoal>4&&t.isOnOpponentsSide&&t.states.time>1)return t.team.useSupermove(),void t.states.change(z);if(t.canKickBall)if(t.team.ai>=1){if(t.distanceToOpponentsGoal<7&&t.states.time<=e&&t.team.canShoot(t.position,M))return t.states.change(G,.4,null).queue(dt),void b.onShot.send(t);if(t.states.time>.25&&t.team.opponents.distanceToBall>2.5&&t.distanceToOpponentsGoal>=6&&t.distanceToOpponentsGoal<=10)return t.team.getBestShootTarget(this.shotTarget),void t.states.change(yt).queue(dt);if(t.team.ai>=3){var i=a.distance(t.position,t.team.opponents.goal.center);if(i>T&&7>i&&t.team.opponents.goalkeeper.distanceToHomeGoal>1.75)return t.states.change(B,t.team.opponents.goal.center,null),void t.states.queue(dt)}}else if(t.distanceToOpponentsGoal<5.5)return t.states.change(G,t.pitch.random.uniform(0,.1),null).queue(dt),void b.onShot.send(t);if(t.team.ai<=1){if(t.team.findCrossPass(t,T,E,null,this.crossPassTarget))return t.states.change(B,this.crossPassTarget,null),void t.states.queue(dt)}else if(t.states.time>=this.forceDribbleTime){var n=t.team.tactics.max;if(n){if(n.forward)return void t.states.change(N,null,n.position,0,null).queue(ct);if(n.pass)return void t.states.change(N,n.receiver,n.position,null,null).queue(dt);if(n.lob)return void t.states.change(B,n.position,null).queue(dt)}}if(t.isThreatened&&t.states.time>=this.minComfortZoneTime){var r=t.team.findPass(t,C,S,!1);if(r.receiver)!r.receiver.isGoalkeeper&&this.lob&&r.distance>=T&&r.distance<=E?t.states.change(B,r.target,null):t.states.change(N,r.receiver,r.target,null,s("PASS_ACCURACY")),t.states.queue(dt);else if(t.distanceToHomeGoal<12){var i=E-t.pitch.random.uniform(0,2);a.direction(t.position,t.team.opponents.goal.center,this.target),this.target.x=t.position.x+this.target.x*i,this.target.y=t.position.y+this.target.y*i,t.states.change(B,this.target,null).queue(dt)}}},exit:function(t){t.steering.boundaryAvoidance.disable(),this.restore(t)}}),yt=q.extend("AIPreciseShot",{enter:function(t){var e=t.pitch.ball;q.prototype.enter.call(this,t),this.aimingTarget=a.create(),this.aimingDirection=h.create(),t.team.ai>=2&&e.position.y<t.pitch.center.y-1.5?this.swerveDirection=1:t.team.ai>=2&&e.position.y>t.pitch.center.y+1.5?this.swerveDirection=-1:this.swerveDirection=0,t.team.opponents.goal===t.pitch.leftGoal&&(this.swerveDirection*=-1),t.team.ai>=2?t.team.getBestShootTarget(this.aimingTarget):t.team.opponents.goal.randomTarget(this.aimingTarget),a.direction(t.position,this.aimingTarget,this.direction);var i=3===t.team.ai?15:25;h.rotate(this.direction,o.radians(i)*t.pitch.random.uniform(.5,1)*t.pitch.random.sign(),this.direction)},onSteal:function(t,e){return t.cooldowns.trap+=s("TRAP_COOLDOWN"),t.states.change(x,.5).queue(ut),!0},getSwerveUp:function(t){return this.swerveDirection<0},getSwerveDown:function(t){return this.swerveDirection>0},getDirection:function(t){var e=t.team.ai<=2?t.pitch.random.uniform(-3,3):t.pitch.random.uniform(-1,1);return a.direction(this.ballStart,this.aimingTarget,this.aimingDirection),h.rotate(this.aimingDirection,o.radians(100*t.states.time*this.swerveDirection+e),this.aimingDirection),this.aimingDirection},getVelocity:function(t){return 3==t.team.ai?.8:1==t.team.ai?.6:.75},isShooting:function(t){var e=3==t.team.ai?.32:.28;return h.dot(this.direction,this.aimingDirection)<.98||t.states.time<e}}),vt=v.extend("AISupportAttacker",{enter:function(t){t.target=t.team.spots.best,t.steering.seek.enable()},update:function(t){return t.team.inControl?(h.equals(t.team.spots.best,t.target)||(t.target=t.team.spots.best),t.team.canShoot(t.position,M)&&t.team.requestPass(t),void(t.atTarget&&(t.steering.seek.disable(),t.trackBall(),t.isThreatened||t.team.requestPass(t)))):void t.states.change(x)},exit:function(t){t.steering.seek.disable()}}),xt=v.extend("AIGoalkeeperGoalKick",{enter:function(t){this.lob=t.pitch.random.uniform()<s("GOALKEEPER_LOB_CHANCE"),t.team.controllingPlayer=t},onPlay:!0,update:function(t){if(t.trackBall(),t.canKickBall)if(this.lob)g.play.sendTo(t.pitch),t.states.change(B,t.getGoalKickTarget(),null),i(t);else{var e=t.pitch.random.choice(t.team.defenders);g.play.sendTo(t.pitch),t.states.change(N,e,e.position,null,s("PASS_ACCURACY")),i(t)}}}),bt=v.extend("AIGoalkeeperCornerDefend",{enter:function(t){var e=a.copy(t.team.goal.center);e.x+=.5*t.team.goal.facing.x,t.steering.arrive.enable(e),t.steering.arrive.radius=0,t.steering.arrive.direction=null},onPlay:function(t){return i(t,!0),!0},onIsReady:function(t){return t.steering.arrive.atTarget},update:function(t){t.trackBall()},exit:function(t){t.steering.arrive.disable()}}),wt=v.extend("AIGoalkeeperTendGoal",{enter:function(t){this.target=a.create(),this.catchPoint=a.create(),t.steering.block.enable(t.pitch.ball.position,this.target),t.team.ai>1||!t.team.isAI?t.steering.block.deceleration=.25:1===t.team.ai?t.steering.block.deceleration=1.25:0===t.team.ai&&(t.steering.block.deceleration=3),t.steering.block.distance=t.tendingRange+t.pitch.random.uniform(-.25,.25)},onHumanSlide:function(t,i){return e(t),!0},update:function(t,e){var i=t.pitch.ball,n=t.team.goal,r=t.team.isGoalThreatened(this.target);if(r||(this.target.x=n.center.x,this.target.y=n.top+i.position.y/t.pitch.height*n.width),!i.owner&&r){var s=t.shouldJumpToBall;if(s)return void t.states.change(Tt,s);if(t.shouldCatchBall(e,this.catchPoint))return void t.states.change(_t,this.catchPoint,1)}return t.shouldInterceptBall?void t.states.change(Et):(a.distance(t.position,this.target)<1.5?t.walk():t.run(),void t.trackBall())},exit:function(t){t.steering.block.disable(),t.run()}}),_t=v.extend("AIGoalkeeperCatchBall",{enter:function(t,e,i){var n=h.temp();t.pitch.ball;this.time=1.4333+i,this.landed=!1,this.save(t,"trapRange","friction"),t.steering.pause(),t.friction=4,a.direction(t.position,e,n),h.multiplyNumber(n,t.catchSpeed,n),t.applyImpulse(n),t.position.z=0,t.velocity.z+=.5,t.trapRange=.5},onCanPlay:!1,onCorner:!0,onThrowIn:!0,onKickoff:!0,onGoalKick:!0,onGoal:!0,onBallOutOfPlay:!0,onReleaseBall:function(t){return t.dropBall(),!0},onPlay:function(t,e){return i(t),!0},onTrap:function(t,e){if(t.pitch.ballOutOfPlay)return!0;var i=e.ball;return(t.states.time<.2||i.rolling)&&t["catch"](i)&&(i.lastTouch=t,t.holdBall()),!0},update:function(e){var i=e.pitch.ball;this.landed||(e.facing.x=e.heading.x,e.facing.y=e.heading.y),i.inHands&&(i.oldPosition.x=i.position.x,i.oldPosition.y=i.position.y,i.oldPosition.z=i.radius+e.position.z,i.position.x=e.position.x+.25*e.heading.x,i.position.y=e.position.y+.25*e.heading.y,i.position.z=i.radius+e.position.z,e.states.time>this.time-1.0333-.2&&(e.dropBall(),this.landed||(this.landed=!0,b.onTrap.send(e,i)))),e.states.time>=this.time&&t(e)},exit:function(t){this.restore(t),t.steering.resume(),t.dropBall()}}),Tt=v.extend("AIGoalkeeperJumpToBall",{enter:function(t,e){t.stop(),t.steering.pause(),this.save(t,"friction","maxSpeed"),this.time=1.4333,t.friction=0,t.maxSpeed=1/0,t.position.z=0,t.velocity.z=e},onCanPlay:!1,onCorner:!0,onThrowIn:!0,onKickoff:!0,onGoalKick:!0,onBallOutOfPlay:function(t){return t.dropBall(),!0},onPlay:function(t,e){return i(t),!0},update:function(e){var i=e.pitch.ball;0===e.position.z&&e.velocity.z<=0&&(i.inHands&&(i.placeAtPosition(e.position.x+.25*Math.sign(e.facing.x),e.position.y),e.dropBall()),t(e))},exit:function(t){this.restore(t),t.steering.resume(),t.dropBall()}}),Et=v.extend("AIGoalkeeperInterceptBall",{enter:function(t){this.slide=t.pitch.random.uniform()<s("GOALKEEPER_SLIDE_CHANCE"),this.catchPoint=a.create(),t.steering.interceptBallPursuit.enable(t.pitch.ball),t.steering.interceptBallPursuit.predictability=1.25},onHumanSlide:function(t,i){return e(t),!0},update:function(t,n){var r=t.pitch.ball;t.team.goal;if(!t.shouldInterceptBall)return void i(t,!0);if(!t.team.users.length&&t.team.ai>=1&&(this.slide||t.states.time>=2)&&r.owner&&t.distanceToBall<2&&t.positionInFrontOfPlayer(r.position))return void e(t);if(!r.owner&&t.team.isGoalThreatened()){var s=t.shouldJumpToBall;if(s)return void t.states.change(Tt,s);if(t.shouldCatchBall(n,this.catchPoint))return void t.states.change(_t,this.catchPoint,1)}t.facing.x=t.heading.x,t.facing.y=t.heading.y,t.distanceToBall>1&&t.team.ai>=2&&t.sprint()},exit:function(t){t.run(),t.steering.interceptBallPursuit.disable()}}),St=v.extend("AIGoalkeeperPutBallBackInPlay",{enter:function(t){this.lob=t.pitch.random.uniform()<s("GOALKEEPER_LOB_CHANCE"),t.steering.boundaryAvoidance.distance=1.5,t.steering.boundaryAvoidance.enable(t.team.bounds,8),t.steering.add(new f("opponentsSeparation")),t.steering.opponentsSeparation.enable(t.team.opponents.players,2,.5),t.team.controllingPlayer=t},update:function(t){var e=s("MAX_PASSING_FORCE");if(t.speed?t.trackBall():(t.lookAtNow(t.pitch.center),t._heading.x=t.facing.x,t._heading.y=t.facing.y),a.distance(t.position,t.home)<1?t.steering.arrive.disable():t.steering.arrive.enable(t.home,.1),t.states.time>1&&t.canKickBall){var n=t.team.findPass(t,e,s("GOALKEEPER_MIN_PASS_DISTANCE"),!0,t.team.defenders);!this.lob&&n.receiver&&!n.receiver.isOpponentInRadius(3)&&n.receiver.distanceToHomeGoal>t.distanceToHomeGoal?t.states.change(N,n.receiver,n.target,null,s("PASS_ACCURACY")):(this.lob||t.states.time>s("GOALKEEPER_HOLDING_BALL_TIME_LIMIT"))&&t.states.change(B,t.getGoalKickTarget(),null),i(t)}},exit:function(t){t.steering.arrive.weight=1,t.steering.arrive.disable(),t.steering.boundaryAvoidance.disable(),t.steering.remove("opponentsSeparation")}}),At=J.extend("HumanReceiveBall",{enter:function(t){J.prototype.enter.call(this,t),t.states.after(kt)}}),Ct=v.extend("HumanCornerKick",{enter:function(t){var e=a.copy(t.position);e.x+=3*t.team.opponents.goal.facing.x,e.y+=.5*t.pitch.height*Math.sign(t.pitch.center.y-t.position.y),this.sight=new w({position:e,minX:0,minY:0,maxX:t.pitch.width,maxY:t.pitch.height,center:t.position,maxDistance:s("CORNER_KICK_MAX_DISTANCE"),minDistance:s("CORNER_KICK_MIN_DISTANCE")}),t.pitch.entities.add(this.sight)},onPlay:!0,update:function(t,e){if(t.lookAt(this.sight.position),this.sight.applyImpulse(t.controller.velocity,30*e),t.controller.pass.isActive){g.play.sendTo(t.pitch);var i=m.findClosest(this.sight.position,t.team.AIPlayers,[t.team.goalkeeper]);i.entity?(t.user.takeControl(i.entity),t.states.change(B,this.sight.position,1).queue(dt)):t.states.change(B,this.sight.position,1).queue(Mt)}},exit:function(t){t.pitch.entities.remove(this.sight)}}),Pt=Ct.extend("HumanThrowIn",{enter:function(t){Ct.prototype.enter.call(this,t);var e=s("THROW_IN_MIN_DISTANCE");this.sight.position.x=t.position.x,this.sight.position.y=t.position.y+e*Math.sign(t.pitch.center.y-t.position.y),this.sight.minDistance=e,this.sight.maxDistance=s("THROW_IN_MAX_DISTANCE")},onHit:!0,update:function(t,e){if(t.lookAt(this.sight.position),this.sight.applyImpulse(t.controller.velocity,30*e),t.controller.pass.isActive){g.play.sendTo(t.pitch);var i=m.findClosest(this.sight.position,t.team.AIPlayers,[t.team.goalkeeper]);return void(i.entity?(t.user.takeControl(i.entity),t.states.change(Z,null,this.sight.position).queue(dt)):t.states.change(Z,null,this.sight.position).queue(Mt))}}}),Mt=v.extend("HumanMove",{enter:function(t){t.hasBall&&t.release()},onReleaseBall:!0,onTrap:function(t,e){return h.notZero(t.controller.velocity)&&t.trap(e.ball)&&(t.user.clearActions(),t.states.change(kt)),!0},update:function(t,e){return!t.pitch.ballOutOfPlay&&t.controller.togglePlayer.isActive?void t.team.findControl(t.user):t.controller.slide.isActive&&!t.cooldowns.slide?(t.setHeading(t.direction),t.cooldowns.slide=s("SLIDE_COOLDOWN"),void t.states.change(j)):_&&t.controller.trap.isActive?(t.forceTrap(t.pitch.ball),void t.states.change(kt)):(t.controller.sprint.isActive?t.sprint():t.run(),void t.move(t.controller.velocity))},exit:function(t){t.user.clearActions(),t.run()}}),Ot=v.extend("HumanSelectTeam",{enter:function(t){this.ready=!1},onIsReady:function(t,e){return this.ready},update:function(t,e){t.controller.togglePlayer.isActive&&(this.ready=!this.ready,this.ready?b.onTeamSelect.send(t):b.onTeamUnselect.send(t)),this.ready||(t.controller.sprint.isActive?t.sprint():t.run(),t.move(t.controller.velocity))},exit:function(t){b.onTeamUnselect.send(t),t.user.clearActions(),t.run()}}),Rt=L.extend("HumanJump",{update:function(t,e){L.prototype.update.call(this,t,e),t.controller.shoot.isActive&&this.kick(t)}}),kt=v.extend("HumanDribble",{enter:function(t){this.inactive=0,this.save(t,"maxSpeed"),t.maxSpeed=t.dribbleSpeed},onSteal:function(t,e){return t.cooldowns.slide+=.1,
t.cooldowns.trap+=s("TRAP_COOLDOWN"),t.states.change(Mt),!0},onHumanShoot:function(t,e){return t.controller.shoot.isActive||t.states.change(G,.4,null).queue(Mt),!0},onHumanLob:function(t,e){var i=Math.min(1.5,t.controller.lob.condition.control.pressTime)/1.5;return t.states.change(Ft,i).queue(Mt),!0},onHumanPass:function(t,e){return t.states.change(Lt).queue(Mt),!0},update:function(t,e){if(_&&!t.hasBall)throw new Error("no ball here");if(!t.isGoalkeeper&&h.isZero(t.controller.velocity)){if(this.inactive+=e,this.inactive>=.15)return void t.states.change(Mt)}else this.inactive=0;if(t.controller.powerup.isActive){if(t.team.hasSupermove("supershot"))return t.team.useSupermove(),void t.states.change(z)}else if(t.controller.shoot.isActive)return void t.states.change(Dt);t.move(t.controller.velocity)},exit:function(t){this.restore(t)}}),It=q.extend("HumanPreciseShot",{onSteal:function(t,e){return t.cooldowns.trap+=s("TRAP_COOLDOWN"),t.states.change(Mt),!0},getSwerveUp:function(t){return t.team.opponents.goal===t.pitch.rightGoal?t.controller.swerveUp.isActive:t.controller.swerveDown.isActive},getSwerveDown:function(t){return t.team.opponents.goal===t.pitch.rightGoal?t.controller.swerveDown.isActive:t.controller.swerveUp.isActive},getDirection:function(t){return t.direction},getVelocity:function(t){return h.length(t.controller.velocity)},isShooting:function(t){return t.controller.shoot.isActive}}),Dt=v.extend("HumanSelectShoot",{onSteal:function(t,e){return t.cooldowns.trap+=s("TRAP_COOLDOWN"),t.states.change(Mt),!0},update:function(t){t.move(t._heading),t.controller.shoot.isActive?t.states.time>=.2&&t.states.change(It).queue(Mt):t.states.change(G,t.states.time/.2*.25,null).queue(Mt)}}),Lt=N.extend("HumanPass",{enter:function(t,e,i){var n,r,o,l=1/0,u=h.temp(),c=null,p=t.pitch.ball;null==e&&(e=t.direction),null==i&&(i=.7);for(var d=0;d<t.team.players.length;d++){var f=t.team.players[d];o=p.timeToCoverDistance(p.position,f.position,s("MAX_PASSING_FORCE")),f!==t&&g.canPlay.sendTo(f)&&o>=0&&(a.direction(t.position,f.position,u),r=h.dot(u,e),n=a.distance(t.position,f.position),l>n&&r>=i&&(c=f,l=n))}if(c){var m=a.create();t.team.getBestPass(t,c,s("MAX_PASSING_FORCE"),!1,m)||c.futurePosition(.1333,m),N.prototype.enter.call(this,t,c,m,null,s("PASS_ACCURACY"))}else N.prototype.enter.call(this,t,null,null,0,1)},kick:function(t){return t.controller&&t.controller.throughBall.isActive&&(this.force=C,this.target=null),N.prototype.kick.call(this,t)}}),Ft=B.extend("HumanLob",{enter:function(t,e){var i,n;t.isGoalkeeper?(i=s("GOALKEEPER_LOB_MIN_DISTANCE"),n=s("GOALKEEPER_LOB_MAX_DISTANCE")):(i=s("LOB_MIN_DISTANCE"),n=s("LOB_MAX_DISTANCE"));var r=i+(n-i)*e,o=a.copy(t.pitch.ball.position);o.x+=t.direction.x*r,o.y+=t.direction.y*r,B.prototype.enter.call(this,t,o,null)}}),Bt=v.extend("HumanPutBallBackInPlay",{enter:function(t){t.user.clearActions(),t.steering.arrive.enable(t.home,.1),t.steering.boundaryAvoidance.distance=1.5,t.steering.boundaryAvoidance.enable(t.pitch.bounds,8),t.steering.add(new f("opponentsSeparation")),t.steering.opponentsSeparation.enable(t.team.opponents.players,2,.5)},onHit:!0,onHumanLob:function(t,e){var n=Math.min(1.5,t.controller.lob.condition.control.pressTime)/1.5;return t.states.change(Ft,n),t.user.releaseControl(),i(t),!0},onHumanPass:function(t,e){return t.states.change(Lt),i(t),t.user.releaseControl(),!0},update:function(t,e){if(t.speed)t.trackBall();else{var i=t.direction;t.setHeading(i),t.facing.x=i.x,t.facing.y=i.y}return t.controller.powerup.isActive&&t.team.hasSupermove("supershot")?(t.team.useSupermove(),void t.states.change(z)):(a.distance(t.position,t.home)<1?t.steering.arrive.disable():t.steering.arrive.enable(t.home,.1),void(t.states.time>=3&&t.user.findControl()))},exit:function(t){t.steering.boundaryAvoidance.disable(),t.steering.arrive.weight=1,t.steering.arrive.disable(),t.steering.remove("opponentsSeparation")}}),Nt=v.extend("HumanGoalKick",{onPlay:!0,enter:function(t){t.team.controllingPlayer=t},update:function(t){if(t.controller)if(t.controller.lob.isActive){var e=Math.min(1.5,t.controller.lob.condition.control.pressTime)/1.5;g.play.sendTo(t.pitch),t.states.change(Ft,e),i(t)}else t.controller.pass.isActive&&(g.play.sendTo(t.pitch),t.states.change(Lt,null,.9),i(t))}}),Gt=[[k],[W],[Y],[F,kt],[mt],[ft],[G,kt],[gt,kt],[yt,kt],[ut,Mt],[dt,Mt],[pt,Mt],[mt,Mt],[at,Ct],[ht,Pt],[ot,At]],qt=[[k],[W],[F,gt],[j],[U],[X],[Y],[mt],[ft],[null,pt],[It,gt],[Dt,gt],[Ft,pt],[Lt,pt],[Mt,pt],[kt,gt],[G,gt],[Ct,at],[Pt,ht],[At,ot],[Ot,k]],zt=[[U],[z],[xt,Nt],[St,Bt]],Ut=[[U],[z],[k],[Y],[X],[mt],[ft],[wt],[Ft],[Lt],[Bt,St],[Nt,xt]];return{RequestHuman:O,RequestAI:R,Ready:k,WaitForOthers:I,Kick:D,Jump:L,Swerve:F,Lob:B,Pass:N,DirectShot:G,PreciseShot:q,Supershot:z,SlideWait:U,Slide:j,Header:H,Hit:W,GoTo:Y,ReturnHome:X,Kickoff:K,ThrowInPickUpBall:V,ThrowInThrow:Z,ReceiveBall:J,GoToCorner:Q,GoToGoalKick:$,GoalCelebration:tt,GoalCelebrationPlane:et,GoalCelebrationPlaneAssist:it,GoalCelebrationDance:nt,GoalCelebrationDance2:rt,GoalCelebrationKneeslide:st,AIReceiveBall2:ot,AICornerKick:at,AIThrowIn:ht,AIMarking:lt,AIChaseBall:ut,AIDefend:pt,AIAttack:dt,AIReceivePass:ft,AIReceiveLob:mt,AIPreciseShot:yt,AIDribble:gt,AISupportAttacker:vt,AIGoalkeeperGoalKick:xt,AIGoalkeeperCornerDefend:bt,AIGoalkeeperTendGoal:wt,AIGoalkeeperCatchBall:_t,AIGoalkeeperJumpToBall:Tt,AIGoalkeeperInterceptBall:Et,AIGoalkeeperPutBallBackInPlay:St,HumanReceiveBall:At,HumanCornerKick:Ct,HumanThrowIn:Pt,HumanMove:Mt,HumanSelectTeam:Ot,HumanJump:Rt,HumanDribble:kt,HumanPreciseShot:It,HumanSelectShoot:Dt,HumanPass:Lt,HumanLob:Ft,HumanPutBallBackInPlay:Bt,HumanGoalKick:Nt,transitionToAI:n,transitionToHuman:r}}),define("players/global",function(){"use strict";function t(t,e,i){t.states.global(i||(t.isGoalkeeper?m:f)),t.states.is(e)||t.states.change(e)}function e(t,e,i){t.states.global(i||(t.isGoalkeeper?y:g)),t.states.is(e)||t.states.change(e)}function i(t){t.states.global(null),t.states.idle(),t.user&&(t.user.player=null,t.user=t.controller=null)}var n=require("settings"),r=require("nebula/math/point2"),s=require("nebula/math/vector2"),o=require("nebula/math/geometry"),a=require("nebula/states").State,h=require("nebula/states").Wait,l=require("player").Player,u=require("players/states"),c=require("nebula/numbers").radians,p=n("PLAYER_TURN_RATE"),d=n("PLAYER_HUMAN_TURN_RATE"),f=a.extend("AIGlobal",{onCanPlay:!0,onBallOutOfPlay:function(t,e){return t.states.change(u.Ready),!0},onGoal:function(t,e){return t.user&&t.user.releaseControl(null),t===e.scorer&&t.team===e.team&&t.states.change(u.GoalCelebration),!0},onJoinGoalCelebrationPlane:function(t,e){return t.user&&t.user.releaseControl(null),t.states.change(u.GoalCelebrationPlaneAssist,e.player),!0},onCorner:function(t,e){if(t.team===e.team)if(t===e.player)t.user&&t.user.releaseControl(null),t.states.change(u.GoToCorner,e.corner),t.states.queue(u.WaitForOthers),t.states.queue(u.RequestHuman,u.AICornerKick);else if(e.position)t.states.change(u.GoTo,e.position,2*t.radius);else{var i=r.copy(t.home);i.x+=t.pitch.width*t.team.goal.facing.x*.15,t.states.change(u.GoTo,i,.5)}else if(e.position)t.states.change(u.GoTo,e.position,.1);else{var i=r.copy(t.home);i.x-=t.pitch.width*t.team.goal.facing.x*.15,t.states.change(u.GoTo,i,.5)}return!0},onThrowIn:function(t,e){if(t.team===e.team)if(t===e.player)t.user&&t.user.releaseControl(null),t.states.change(u.GoToCorner,e.position),t.states.queue(h,.75),t.states.queue(u.ThrowInPickUpBall),t.states.queue(u.WaitForOthers),t.states.queue(u.RequestHuman,u.AIThrowIn),t.states.queue(u.AIThrowIn,e.assistants);else if(e.assistants.indexOf(t)>=0){var i=r.copy(e.position);o.clampPointInRectangle(i,2,2,t.pitch.width-4,t.pitch.height-4,i),o.clampPointOutsideCircle(i,e.position,4,i),t.states.change(u.GoTo,i,3)}else t.states.change(u.Ready);else t.states.change(u.ReturnHome);return!0},onKickoff:function(t,e){if(t===e.starting)t.user&&t.user.releaseControl(null),t.states.change(u.Kickoff,e.assistant).queue(u.AIAttack);else if(t===e.assistant){var i=r.copy(t.pitch.center);i.x-=1.25*t.team.goal.facing.x,i.y+=1*t.team.goal.facing.x,t.states.change(u.GoTo,i,.1),t.states.queue(u.RequestHuman,u.AIReceiveBall2),t.states.queue(u.AIReceiveBall2)}else{var i=r.copy(t.home);o.clampPointOutsideCircle(i,t.pitch.center,7,i),t.states.change(u.ReturnHome,i)}return!0},onGoalKick:function(t,e){return t.states.change(u.ReturnHome),!0},onReceiveBall:function(t,e){if(e.passer.user)e.passer.user.takeControl(t,null);else if(t.team.users.length&&!t.user){var i=t.team.closestUser(t.position);i&&i.takeControl(t,null)}return t.states.change(u.AIReceivePass,e.target),!0},onReceiveLob:function(t,e){if(e.passer.user)e.passer.user.takeControl(t,null);else if(t.team.users.length&&!t.user){var i=t.team.closestUser(t.position);i&&i.takeControl(t,null)}return t.states.change(u.AIReceiveLob,e.target),!0},onSupershotHit:function(t,e){return t.states.change(u.Hit,null,1,!1),!0},onHit:function(t,e){return t.states.change(u.Hit,e.force,1,e.hitInTheHead),!0},onReleaseBall:function(t,e){return t.states.change(u.AIDefend),!0},onBeginMatch:function(t,e){t.resetCooldowns(),t.team.blue?t.home.x=t.pitch.width-t._home.x:t.home.x=t._home.x},onBeginPractice:function(t,e){t.resetCooldowns(),t.team.blue?t.home.x=t.pitch.width-t._home.x:t.home.x=t._home.x,t.placeAtPosition(t.home.x,t.home.y),t.states.change(u.Ready)},onChangeSides:function(t,e){t.team.red?t.home.x=t.pitch.width-t._home.x:t.home.x=t._home.x,t.states.change(u.ReturnHome)},onEndMatch:function(t,e){var i=r.copy(t.pitch.center),n=r.copy(t.pitch.center);i.y=t.pitch.height,i.x+=t.pitch.random.uniform(-2,2),n.y=t.pitch.height+8,t.states.change(h,1),t.states.queue(u.GoTo,i),t.states.queue(u.GoTo,n)},onTrap:function(t,e){var i=e.ball;return i.speed>=48/3.6&&i.position.z<t.position.z+t.height&&o.circlesIntersect(t.position,t.radius,i.position,i.radius)&&(i.lastTouch=t,o.resolveCirclesCollision(e.elapsed,t,i),t.states.change(u.Hit,null,1,i.position.z>t.position.z+t.height/2),l.onHitByBall.send(t)),!0},update:function(t){t.team&&(t.maxTurnRate=c(p[t.team.ai]))}}),m=f.extend("AIGoalkeeperGlobal",{onCollision:!1,onBallOutOfPlay:function(t,e){return t.states.change(u.RequestAI,u.ReturnHome),!0},onGoalKick:function(t,e){return t.team===e.team?(t.states.change(u.GoToGoalKick),t.states.queue(u.WaitForOthers),t.states.queue(u.RequestHuman,u.AIGoalkeeperGoalKick)):t.states.change(u.ReturnHome),!0},onJoinGoalCelebrationPlane:function(t,e){return!1},onKickoff:function(t,e){return t.states.change(u.ReturnHome),!0},onCorner:function(t,e){return t.team!==e.team?t.states.change(u.AIGoalkeeperCornerDefend):t.states.change(u.ReturnHome),!0},onThrowIn:function(t,e){return t.states.change(u.ReturnHome),!0},onHit:!0,onTrap:function(t,e){if(t.pitch.ballOutOfPlay)return!0;var i=e.ball;return i.speed<50/3.6?t.position.z>0?o.circlesIntersect(t.position,.8*t.trapRange,i.position,i.radius)&&t["catch"](i)&&(i.lastTouch=t,t.holdBall(),l.onTrap.send(t,i)):t.trap(i)&&(t.applyImpulse(s.copy(i.velocity),.2),t.states.change(h,.25),t.states.queue(u.RequestHuman,u.AIGoalkeeperPutBallBackInPlay)):i.position.z<t.position.z+t.height&&o.circlesIntersect(t.position,t.radius,i.position,i.radius)&&(i.lastTouch=t,o.resolveCirclesCollision(e.elapsed,t,i),t.states.change(u.Hit,null,1,i.position.z>t.position.z+t.height/2),l.onHitByBall.send(t)),!0},onReleaseBall:function(t,e){return t.states.change(u.AIGoalkeeperTendGoal),!0}}),g=f.extend("HumanGlobal",{enter:function(t){this.save(t,"maxTurnRate","clampToPitch"),t.clampToPitch=!0,t.maxTurnRate=c(d)},onUserDisconnect:function(t){t.states.idle()},onUserConnect:function(t){t.pitch.ballOutOfPlay?t.states.change(u.Ready):t.states.change(u.HumanMove)},onBallOutOfPlay:function(t,e){return t.user.releaseControl(u.Ready),!0},onSupershotHit:function(t,e){var i=t.states.is(u.Ready);return t.states.change(u.Hit,null,1,!1),i||t.states.queue(u.HumanMove),!0},onReceiveBall:function(t,e){return t.states.change(u.AIReceivePass,e.target),!0},onReceiveLob:function(t,e){return t.states.change(u.AIReceiveLob,e.target),!0},onReleaseBall:function(t,e){return t.pitch.ballOutOfPlay?t.states.change(u.Ready):t.states.change(u.HumanMove),!0},update:function(){},exit:function(t){this.restore(t)}}),y=m.extend("HumanGoalkeeperGlobal",{onReleaseBall:function(t,e){return t.user.releaseControl(u.AIGoalkeeperTendGoal),!0}}),v=g.extend("HumanSelectTeamGlobal",{onHit:function(t,e){return g.prototype.onHit.call(this,t,e),t.states.queue(u.HumanSelectTeam),!0}});return{AIGlobal:f,AIGoalkeeperGlobal:m,HumanGlobal:g,HumanGoalkeeperGlobal:y,HumanSelectTeamGlobal:v,forceAI:t,forceHuman:e,forceIdle:i}}),define("users",function(){"use strict";function t(t,e,i,n){this.id=t,this.team=e,this.controller=i,this.player=null,this.lastAction=null,this.lastActionTime=0,this.powerups=[],this.color=w[t],this.online="undefined"!=typeof n?n:!1,this.history={}}function e(){for(var t=0;t<C.length;t++)C[t].online=!1,C[t].player&&C[t].releaseControl(null),C[t].team&&C[t].changeTeam(null)}function i(t){for(var e=0;e<C.length;e++)C[e].update(t)}function n(t){for(var e=0;e<C.length;e++)C[e].changeTeam(t)}function r(t){for(var e=0;e<C.length;e++)if(C[e].controller&&C[e].controller[t].isActive)return!0;return!1}function s(){for(var t=0,e=0;e<C.length;e++)C[e].player&&(t+=1);return t}function o(){for(var t=0;t<C.length;t++)if(C[t].online)return C[t];return null}function a(t,e){for(var i="undefined"==typeof e?v:e,n=0;n<C.length;n++){var r=C[n].controller;r&&-1!==r.apis.indexOf(i)&&E.send(C[n])}}function h(t,e){for(var i=0;i<C.length;i++)C[i].controller===t&&S.send(C[i],e)}function l(t,e){for(var i=0;i<C.length;i++)C[i].controller===t&&A.send(C[i],e)}var u=require("settings"),c=require("nebula/math/point2"),p=require("nebula/math/point3"),d=require("nebula/math/vector2"),f=(require("nebula/states").Wait,require("players/states")),m=require("players/global"),g=require("messages"),y=require("nebula/signal"),v=require("nebula/input/keyboard"),x=require("nebula/input/gamepad"),b=require("controller"),w=u("USER_COLORS"),_=new y,T=new y,E=new y,S=new y,A=new y,C=[];t.prototype.on=function(){this.online=!0},t.prototype.off=function(){this.lastAction=null,this.lastActionTime=0,this.history={},this.online=!1},t.prototype.disconnect=function(){this.player&&(this.player.controller=null),this.controller=null,this.off()},t.prototype.toggle=function(){this.online?this.off():this.on()},t.prototype.releaseControl=function(t){var e=this.player;if(e){if("undefined"==typeof t&&(t=f.transitionToAI(e),!t))throw new Error("Cannot release control from state "+e.states.name);t&&!e.states.is(t)&&e.states.change(null),m.forceAI(e,t),e.user=null,e.controller=null,this.player=null}},t.prototype.takeControl=function(t,e,i){if(t.user)throw new Error("Cannot take control, player already controlled");this.releaseControl(),"undefined"==typeof e&&(e=f.transitionToHuman(t)),e&&!t.states.is(e)&&t.states.change(null),this.player=t,t.user=this,t.controller=this.controller,this.clearActions(),m.forceHuman(t,e,i)},t.prototype._findPlayer=function(t,e,i){for(var n,r,s,o=null,a=1/0,h=null,l=d.temp(),u=e&&d.notZero(e),p=0;p<this.team.players.length;p++)n=this.team.players[p],r=c.distance(n.position,t),c.direction(n.position,t,l),!n.isGoalkeeper&&!n.user&&a>r&&i>=r&&!this.history[n.id]&&(u&&d.dot(e,l)>0||!u)&&(s=f.transitionToHuman(n),s&&g.canPlay.sendTo(n)&&(o=n,a=r,h=s));return o},t.prototype.findControl=function(){if(!this.online)return null;var t=this.team.pitch.ball,e=this.controller&&d.notZero(this.controller.direction),i=e?this.controller.direction:null,n=p.temp();t.futurePosition(.5,n);var r=this._findPlayer(t.position,null,2);return r||(r=this._findPlayer(n,i,1/0)),!r&&e&&(r=this._findPlayer(n,null,1/0)),r&&(this.player&&(this.history[this.player.id]=u("USER_TOGGLE_PLAYER_TIMEOUT")),this.takeControl(r,f.transitionToHuman(r))),r},t.prototype.changeTeam=function(t){this.history={},this.team&&this.team.removeUser(this),this.player&&this.releaseControl(),this.team=t||null,this.team&&this.team.addUser(this)},t.prototype.clearActions=function(){this.lastAction=null},t.prototype.update=function(t){if(this.controller){this.controller.update(t);var e=this.lastAction;this.controller.shoot.isActive?this.lastAction=g.humanShoot:this.controller.lob.isActive?this.lastAction=g.humanLob:this.controller.pass.isActive?this.lastAction=g.humanPass:this.lastAction&&(this.lastActionTime-=t,this.lastActionTime<=0&&(this.lastAction=null)),!e&&this.lastAction&&(this.lastActionTime=.5),this.player&&this.lastAction&&this.lastAction.sendTo(this.player)&&(this.lastAction=null);for(var i in this.history)this.history[i]=Math.max(this.history[i]-t,0)}},x.onConnect(function(t){var e=require("profiles"),i=t.index+1,n=new b(t,e.current["gamepadLayout"+i]),r=null;if(i>=C.length){for(var s=0;s<C.length;s++)if(!C[s].controller){r=C[s];break}if(!r)return}else r=C[i];r.controller=n,r.player&&(r.player.controller=n,g.userConnect.sendTo(r.player)),_.send(r,!0)}),x.onDisconnect(function(t){for(var e=0;e<C.length;e++)C[e].controller&&C[e].controller.is(t)&&(C[e].disconnect(),C[e].player&&g.userDisconnect.sendTo(C[e].player),T.send(C[e],!0))});for(var P=0;P<w.length;P++)C[P]=new t(P,null,null,!1);return v.onDown(a),x.onDown(a),b.onDown(h),b.onRepeat(l),{User:t,list:C,detach:e,update:i,changeTeam:n,action:r,playing:s,first:o,onConnect:_,onDisconnect:T,onInput:E,onControllerDown:S,onControllerRepeat:A}}),define("skill",function(){"use strict";function t(t){this.team=t,this.reset(),n.states.Corner.onEnter(this.corner,this),n.states.BallOutOfPlay.onEnter(this.ballOutOfPlay,this),n.goalScored(this.goal,this),s.Slide.onEnter(this.slide,this),r.onSlideHit(this.slideHit,this),r.onSlideTrap(this.slideTrap,this),r.onHitByBall(this.hit,this),r.onTrap(this.trap,this),r.onReceivePass(this.pass,this),r.onShot(this.shot,this)}var e=require("settings"),i=require("nebula/signal"),n=require("pitch").Pitch,r=require("player").Player,s=require("players/states"),o=e("SKILL_GOAL_SCORE"),a=e("SKILL_GOAL_CONCEDE"),h=e("SKILL_POSSESSION"),l=e("SKILL_DRIBBLING"),u=e("SKILL_SHOT"),c=e("SKILL_PASS"),p=e("SKILL_SLIDE_HIT"),d=e("SKILL_SLIDE_TRAP"),f=e("SKILL_BLOCKED_SHOT"),m=e("SKILL_INTERCEPT"),g=e("SKILL_STEAL"),y=e("SKILL_TRAP");return t.onChange=new i,t.prototype.reset=function(){this.time=0,this.possession=0,this.possessionTime=0,this.corners=0,this.slides=0,this.slideHits=0,this.slideTraps=0,this.slideAccuracy=0,this.offensiveScore=0,this.offensive=0,this.defensiveScore=0,this.defensive=0,this.passes=0,this.interceptions=0,this.shots=0,this.blockedShots=0,this.shotsOffTarget=0,this.total=0,this.score=0,this.meters=0,this.shootingPlayer=null,this.goals=[],this.goalsByPlayer={}},t.prototype.update=function(e){if(this.time+=e,this.team.inControl){this.possessionTime+=e;var i=e*h;this.team.hasBall&&!this.team.goalkeeperHasBall&&(i+=e*l),this.offensiveScore+=i,t.onChange.send(this,i)}this.possession=this.possessionTime/(this.possessionTime+this.team.opponents.skill.possessionTime)*100,this.slides&&(this.slideAccuracy=100*Math.min(1,Math.max(this.slideHits,this.slideTraps)/this.slides));for(var n=0;n<this.team.players.length;n++)this.meters+=this.team.players[n].speed*e;this.offensive=Math.floor(this.offensiveScore/this.time*100),this.defensive=Math.floor(this.defensiveScore/this.time*100),this.total=this.defensive+this.offensive},t.prototype.corner=function(t,e,i){i===this.team&&(this.corners+=1)},t.prototype.ballOutOfPlay=function(t,e,i){!i&&this.shootingPlayer&&(this.shotsOffTarget+=1,this.shootingPlayer=null)},t.prototype.getGoalsByPlayer=function(t){return this.goalsByPlayer[t.id]||0},t.prototype.goal=function(e,i,n){i===this.team?(this.score+=1,this.offensiveScore+=o,this.goals.push({scorer:n,realTime:this.team.pitch.absoluteTime,matchTime:this.team.pitch.matchTime}),null==this.goalsByPlayer[n.id]&&(this.goalsByPlayer[n.id]=0),this.goalsByPlayer[n.id]+=1,t.onChange.send(this,o)):(this.defensiveScore+=a,t.onChange.send(this,a)),this.shootingPlayer=null},t.prototype.slide=function(t){t.team===this.team&&(this.slides+=1)},t.prototype.slideHit=function(e,i){e.team===this.team&&i.team!==this.team&&(this.defensiveScore+=p,this.slideHits+=1,t.onChange.send(this,p))},t.prototype.slideTrap=function(e){var i=0;e.team===this.team&&(i+=d,this.defensiveScore+=d,this.slideTraps+=1,this.team.opponents.skill.shootingPlayer&&(i+=f,this.defensiveScore+=f,this.blockedShots+=1,this.team.opponents.skill.shootingPlayer=null)),i&&t.onChange.send(this,i)},t.prototype.hit=function(e){e.team===this.team&&this.team.opponents.skill.shootingPlayer&&(this.defensiveScore+=f,this.blockedShots+=1,t.onChange.send(this,f))},t.prototype.trap=function(e){if(e.team===this.team)if(this.team.opponents.skill.shootingPlayer)this.defensiveScore+=f,this.blockedShots+=1,this.team.opponents.skill.shootingPlayer=null,t.onChange.send(this,f);else if(this.team.opponents.receivingPlayer)this.defensiveScore+=m,this.interceptions+=1,t.onChange.send(this,m);else if(this.team.opponents.controllingPlayer){var i=e.pitch.ball;i.owner&&i.owner.team!==e.team?(this.defensiveScore+=g,t.onChange.send(this,g)):(this.defensiveScore+=y,t.onChange.send(this,y))}},t.prototype.pass=function(e){e.team===this.team&&(this.offensiveScore+=c,this.passes+=1,t.onChange.send(this,c))},t.prototype.shot=function(e){e.team===this.team&&(this.offensiveScore+=u,this.shots+=1,this.shootingPlayer=e,t.onChange.send(this,u))},t}),define("team",function(){"use strict";function t(t,e,i){for(var n=0;n<e.length;n++)if(a.distance(t,e[n])<i)return!0;return!1}function e(t,e,i,n,r,s,o){this.team=t,this._best=null,this.passingWeight=n,this.scoringWeight=r,this.passDistanceWeight=s,this.optimalPassDistance=o,this.spots=[];for(var h,l,u=this.team.pitch.width/e/4+1,c=this.team.pitch.height/i/2,p=1;i-2>p;p++)for(var d=0;e-2>d;d++)h=u+d/(e-1)*this.team.pitch.width*.5,l=c+p/(i-1)*this.team.pitch.height,this.team.red?this.spots.push({position:a.create(this.team.pitch.width-h,l),score:0}):this.spots.push({position:a.create(h,l),score:0})}function i(t){d.apply(this,arguments),this.pitch=t.pitch,this.goal=null,this._aiBase=0,this._ai=0,this.score=0,this.allPlayers=t.players,this.players=[],this.fieldPlayers=[],this.attackers=[],this.midfielders=[],this.defenders=[],this.goalkeeper=null,this.activePlayer=null,this.receivingPlayer=null,this._playerClosestToBall=null,this._fieldPlayerClosestToBall=null,this._activeFieldPlayerClosestToBall=null,this.controllingPlayer=null,this.supportingPlayer=null,this.spots=new e(this,E,S,A,C,P,M),this.spotsLastUpdate=null,this.users=[],this.currentUser=0,this._controlChangeQueue=[],this.cooldowns={goalkeeperSlide:0},this.ballFuturePosition=h.create(),this.skill=new y(this),this._pass1Trial=a.array(1),this._pass7Trials=a.array(7),this.tactics=new v(null,1,1,24,18,4,this.updateTactics,this),this.supermovesScore=0,this.supermovesScoreNeeded=r("SUPERMOVE_SCORE"),this.supermoves=[],this.supermovesOrder=null,this.supermovesNext=0,y.onChange({sender:this.skill,receiver:this.updateSupermoves,context:this})}function n(t){return!t.user}var r=require("settings"),s=require("nebula/signal"),o=require("nebula/math/vector2"),a=require("nebula/math/point2"),h=require("nebula/math/point3"),l=require("nebula/math/geometry"),u=require("nebula/physics2"),c=require("nebula/numbers").clamp,p=require("nebula/math/transformations"),d=require("nebula/entities/base"),f=require("nebula/entities/utils"),m=require("messages"),g=require("nebula/states").State,y=(require("users").User,require("skill")),v=require("influence_map"),x=(r("TRAP_RANGE"),r("PLAYER_RUN_SPEED"),r("LOB_MIN_DISTANCE")),b=r("LOB_MAX_DISTANCE"),w=r("MIN_PASSING_FORCE"),_=r("MAX_PASSING_FORCE"),T=r("MAX_SHOOTING_FORCE"),E=r("SUPPORT_SPOTS_COLS"),S=r("SUPPORT_SPOTS_ROWS"),A=r("SUPPORT_SPOTS_PASSING_WEIGHT"),C=r("SUPPORT_SPOTS_SHOOTING_WEIGHT"),P=r("SUPPORT_SPOTS_DISTANCE_WEIGHT"),M=r("SUPPORT_SPOTS_OPTIMAL_DISTANCE");r("SUPPORT_SPOTS_UPDATE_DELAY");return e.prototype.determineBestPosition=function(){var t,e,i,n=0,r=a.temp(),s=this.team.pitch.ball;this._best=null;for(var o=0;o<this.spots.length;o++)t=this.spots[o],t.score=1,this.team.isPassSafeFromAllOpponents(s.position,t.position,null,_)&&(t.score+=this.passingWeight),this.team.canShoot(t.position,T,r)&&(t.score+=this.scoringWeight),e=a.distance(s.position,t.position),i=Math.abs(this.optimalPassDistance-e),i<this.optimalPassDistance&&(t.score+=this.passDistanceWeight*((this.optimalPassDistance-i)/this.optimalPassDistance)),t.score>n&&(n=t.score,this._best=t);return this._best},Object.defineProperty(e.prototype,"best",{get:function(){return this._best||this.determineBestPosition(),this._best.position}}),i.onSupermoveProgress=new s,i.onSupermoveGain=new s,i.onSupermoveUse=new s,i.prototype=Object.create(d.prototype),i.prototype.distance=function(t){return f.distance(t,this.players)},i.prototype.hasSupermove=function(t){return this.supermoves[0]===t},i.prototype.useSupermove=function(){var t=this.supermoves.shift();return this.supermovesScore=0,i.onSupermoveProgress.send(this,this.supermovesScore),i.onSupermoveUse.send(this,t),t},i.prototype.addSupermove=function(t){this.supermoves.push(t),i.onSupermoveGain.send(this,t)},i.prototype.setGoal=function(t){this.goal=t,this.goalKickPosition=a.copy(this.goal.center),this.goalKickPosition.x+=5.5*this.goal.facing.x/3,this.goalKickPosition.y+=9.15*this.goal.facing.x/3,this.goal===this.pitch.leftGoal?this.tactics.reposition(a.create(this.pitch.width-1,2.333333),-1,1):this.tactics.reposition(a.create(1,2.333333),1,1)},i.prototype.resetCooldowns=function(){for(var t in this.cooldowns)this.cooldowns[t]=0},i.prototype.addUser=function(t){this.users.push(t),t.findControl()},i.prototype.removeUser=function(t){for(var e=0;e<this.users.length;e++)if(this.users[e]===t)return this.users.splice(e,1),void(this.currentUser>=this.users.length&&(this.currentUser=0));throw new Error("Cannot remove user, user not assigned to this team")},i.prototype.setPlayers=function(t){this.players=[],this.fieldPlayers=[],this.attackers=[],this.defenders=[],this.midfielders=[],this.goalkeeper=null;for(var e=0;e<t.length;e++){var i=t[e];i.team=this,this.players.push(i),i.isGoalkeeper?this.goalkeeper=i:(this.fieldPlayers.push(i),i.isAttacker?this.attackers.push(i):i.isDefender?this.defenders.push(i):i.isMidfielder&&this.midfielders.push(i))}},i.prototype.getPlayersForKickOff=function(){function t(t,i){var n=a.distance(e,t.home),r=a.distance(e,i.home);return r>n?-1:n>r?1:0}var e=this.pitch.center;return this.fieldPlayers.slice().sort(t).slice(0,2)},i.prototype.topCornerPosition=function(t){t.x=this.goal.center.x,t.y=0},i.prototype.bottomCornerPosition=function(t){t.x=this.goal.center.x,t.y=this.pitch.height},i.prototype.canShoot=function(t,e,i){var n=this.opponents.goal,r=this.pitch.ball;i||(i=a.temp());for(var s=0;9>s;s++)if(i.x=n.center.x,i.y=n.top+n.leftPost.radius+r.radius+s/8*(n.innerWidth-r.radius),this.isPassSafeFromOpponent(t,i,null,this.opponents.goalkeeper,e))return!0;return!1},i.prototype.returnFieldPlayersToHome=function(){for(var t=0;t<this.fieldPlayers.length;t++)m.goHome.sendTo(this.fieldPlayers[t]);this.states.change(i.states.Defending)},i.prototype.returnAllPlayersToHome=function(){m.goHome.send({receivers:this.players})},i.prototype.closestOpponentForMarking=function(t,e){for(var i,n=1/0,r=null,s=0;s<e.length;s++)e[s].isOnOpponentsSide&&!e[s].hasBall&&(i=a.distance(t.region,e[s].position),n>i&&(r=e[s],n=i));return r},i.prototype.markOpponents=function(){var t,e,i=this.opponents.players.slice();m.interceptBall.sendTo(this.playerClosestToBall);for(var n=0;n<this.players.length;n++)e=this.players[n],e!==this.playerClosestToBall&&(e.isDefender||e.isMidfielder)&&(t=this.closestOpponentForMarking(e,i),t&&(m.markOpponent.send({receiver:e,opponent:t}),i.splice(i.indexOf(t),1)))},i.prototype.determineBestSupportingAttacker=function(){for(var t,e,i=1/0,n=null,r=this.spots.best,s=0;s<this.attackers.length;s++)e=this.attackers[s],e.hasBall||e===this.receivingPlayer||(t=a.distance(e.position,r),i>t&&(t=i,n=e));return n},i.prototype.findSupport=function(){return},i.prototype.requestPass=function(t){this.pitch.ball.owner&&this.isPassSafeFromAllOpponents(this.pitch.ball.position,t.position,t,_)&&m.requestPass.send({receiver:this.pitch.ball.owner,requester:t})},i.prototype.isOpponentWithinRadius=function(t,e){for(var i=this.opponents.players,n=0;n<i.length;n++)if(a.distance(t,i[n].position)<e)return!0;return!1},i.prototype.isPassSafeFromOpponent=function(t,e,i,n,r,s){var h=o.temp(),l=a.temp();a.temp();if(a.direction(t,e,h),p.pointToLocalSpace(n.position,h,t,l),!m.canPlay.sendTo(n))return!0;if(l.x<0)return!0;if("undefined"==typeof s&&(s=this.pitch.ball.timeToCoverDistance(a.ZERO,a.temp(l.x,0),r)),0>s)return!0;var u=n.runSpeed;this.ai>=2&&!n.isGoalkeeper&&(u=n.sprintSpeed);var c=u*s+n.trapRange;return a.distance(t,e)<a.distance(t,n.position)?i?a.distance(e,n.position)>a.distance(e,i.position):a.distance(e,n.position)>c:Math.abs(l.y)>c},i.prototype.isPassSafeFromAllOpponents=function(t,e,i,n,r){for(var s=0;s<this.opponents.players.length;s++)if(!this.isPassSafeFromOpponent(t,e,i,this.opponents.players[s],n,r))return!1;return!0},i.prototype.isLobSafeFromAllOpponents=function(t,e){var i=a.distance(t,e);return i>=x&&b>=i?this.distance(e)<this.opponents.distance(e)-1:!1},i.prototype.getBestPass=function(t,e,i,n,r){var s,o=this.pitch.ball,a=o.timeToCoverDistance(o.position,e.position,i);if(0>a)return!1;if(n||e.isGoalkeeper)s=this._pass1Trial,s[0].x=e.position.x,s[0].y=e.position.y;else{s=this._pass7Trials;var h=3===this.ai?e.sprintSpeed:e.runSpeed,c=.8*u.range(h,-e.deceleration,a),p=s[0];e.futurePosition(.1333,p),l.tangentPoints(p,c,o.position,s[1],s[2]),l.tangentPoints(p,2*c/3,o.position,s[3],s[4]),l.tangentPoints(p,1*c/3,o.position,s[5],s[6])}for(var d,f=1/0,m=0;m<s.length;m++)d=Math.abs(s[m].x-this.opponents.goal.center.x),f>d&&this.pitch.playingArea.contains(s[m])&&this.isPassSafeFromAllOpponents(o.position,s[m],e,i)&&(f=d,r.x=s[m].x,r.y=s[m].y);return f!==1/0},i.prototype.findPass=function(t,e,i,n,r){var s,o,h,l,u=null,c=a.temp(),p=a.temp(),d=1/0;r||(r=this.players);for(var f=0;f<r.length;f++)s=r[f],t!==s&&m.canPlay.sendTo(s)&&(l=a.distance(t.position,s.position),l>=i&&14>l&&t.positionInFrontOfPlayer(s.position)&&this.getBestPass(t,s,e,n,c)&&(o=Math.abs(c.x-this.opponents.goal.center.x),d>o&&(d=o,u=s,h=l,p.x=c.x,p.y=c.y)));return{receiver:u,target:u?p:null,distance:h}},i.prototype.findCrossPass=function(t,e,i,n,r){var s=this.opponents.goal;n||(n=this.players);for(var o=0;o<n.length;o++){var h=n[o];if(h!==t&&m.canPlay.sendTo(h)){var u=a.distance(t.position,h.position);if(u>=e&&i>=u&&s.distance(h.position)<6)return h.futurePosition(.75,r),l.clampPointInRectangle(r,.5,.5,h.pitch.width-1,h.pitch.height-1,r),!0}}return!1},i.prototype.getCleanShootTarget=function(t){var e=this.opponents.goal,i=this.pitch.ball;t.x=e.center.x;for(var n=i.radius;n<e.width/2-2*i.radius;n+=i.radius){if(t.y=e.center.y-n,this.isPassSafeFromAllOpponents(i.position,t,null,T))return!0;if(t.y=e.center.y+n,this.isPassSafeFromAllOpponents(i.position,t,null,T))return!0}return!1},i.prototype.getBestShootTarget=function(t){for(var e,i=this.opponents.goal,n=this.pitch.ball,r=-(1/0),s=a.temp(),o=n.radius;o<i.width/2;o+=n.radius)s.y=i.center.y-o,e=this.opponents.distance(s),e>r&&(r=e,t.y=s.y),s.y=i.center.y+o,e=this.opponents.distance(s),e>r&&(r=e,t.y=s.y);t.x=i.center.x},i.prototype.closestUser=function(t){for(var e,i=null,n=1/0,r=0;r<this.users.length;r++)this.users[r].player&&(e=a.distance(this.users[r].player.position,t),n>e&&(i=this.users[r],n=e));return i},i.prototype.findControl=function(t){this._controlChangeQueue.push([t])},i.prototype.takeControl=function(t,e){this._controlChangeQueue.push([t,e])},i.prototype.isGoalThreatened=function(t){var e=this.pitch.ball;t||(t=a.temp());var i=l.raySegmentIntersect(e.position,e.heading,this.goal.rightPost.position,this.goal.leftPost.position,t);return i?e.timeToCoverDistance(e.position,t,e.speed)>=0:!1;
},i.prototype.assignPlayers=function(){for(var t=0;t<this._controlChangeQueue.length;t++){var e=this._controlChangeQueue[t][0];if(e.online&&2===this._controlChangeQueue[t].length){var i=this._controlChangeQueue[t][1];e.takeControl(i)}else e.findControl()}this._controlChangeQueue.length>0&&(this._controlChangeQueue=[]);for(var t=0;t<this.users.length;t++)this.users[t].player||this.users[t].findControl()},i.prototype.updateSupermoves=function(t,e){if(this.pitch.supermovesAllowed&&!this.supermoves.length&&e>0&&(this.supermovesScore+=e,i.onSupermoveProgress.send(this,this.supermovesScore),this.supermovesScore>=this.supermovesScoreNeeded)){var n=this.supermovesOrder[this.supermovesNext];this.addSupermove(n),this.supermovesNext<this.supermovesOrder.length-1?this.supermovesNext+=1:(this.pitch.random.shuffle(this.supermovesOrder),this.supermovesNext=0)}},i.prototype.controllerActionActive=function(t){for(var e=0;e<this.users.length;e++)if(this.users[e].controller&&this.users[e].controller[t].isActive)return!0;return!1},i.prototype.canReach=function(t,e,i){for(var n=null,r=1/0,s=0;s<this.fieldPlayers.length;s++){var o=this.fieldPlayers[s];(i&&!o.hasBall||!i)&&o.distanceToOpponentsGoal<r&&o.canReach(t,e)&&(n=o,r=n.distanceToOpponentsGoal)}return n},i.prototype.randomPosition=function(e,i,n,r,s,o){for(var h=a.create();;)if(h.x=this.pitch.random.uniform(e,i),h.y=this.pitch.random.uniform(n,r),!t(h,s,o))break;s.push(h)},i.prototype.updateTactics=function(t){var e=this.pitch.random.uniform(0,.2),i=this.pitch.ball,n=null,r=null,s=this.opponents.goal,h=a.distance(i.position,t.position),u=i.timeToCoverDistance(i.position,t.position,_),c=i.timeToLobDistance(i.position,t.position);if(t.forward=t.shot=t.lob=t.pass=!1,t.receiver=null,h>=2){if(e+=.2*(t.position.x-i.position.x)*this.goal.facing.x,u>=0&&(n=this.canReach(t.position,u,!0)),c>=0&&(r=this.canReach(t.position,c,!0)),u>=0&&n&&h>3&&this.isPassSafeFromAllOpponents(i.position,t.position,n,_,u))t.pass=!0,t.receiver=n,e+=2;else if(c>=0&&r&&h>=x+1&&this.isLobSafeFromAllOpponents(i.position,t.position))t.lob=!0,t.receiver=r,e+=.5;else if(h>=3.5){var p=Math.abs(t.position.x-s.center.x),d=o.temp();a.direction(i.position,s.center,d);var f=l.pointInCone2(t.position,i.position,d,8,7),m=i.timeToCoverDistance(i.position,t.position,w),g=this.pitch.ball.owner;g&&p>5&&f&&s.distance(t.position)<g.distanceToOpponentsGoal-2&&this.isPassSafeFromAllOpponents(i.position,t.position,null,null,m)&&this.distance(t.position)<this.opponents.distance(t.position)-1&&(t.forward=!0,e+=3)}if(t.pass||t.lob){this.canShoot(t.position,T)&&(e+=2,t.shot=!0);var y=Math.abs(7-h)/7;e+=2.5*(1-y)}}t.value=e},i.prototype.reset=function(){return this.states.idle(),this.tactics.clear(),this.setPlayers(this.allPlayers),this._aiBase=0,this._ai=0,this.score=0,this.activePlayer=null,this.controllingPlayer=null,this.receivingPlayer=null,this.resetCooldowns(),this.supermovesOrder=r("SUPERMOVES").slice(),this.pitch.random.shuffle(this.supermovesOrder),this.supermovesNext=0,this.supermovesScore=0,this.supermoves=[],this.skill.reset(),!0},i.prototype.update=function(t){this._activeFieldPlayerClosestToBall=this._fieldPlayerClosestToBall=this._playerClosestToBall=null,this.pitch.ball.futurePosition(.25+this.pitch.ball.position.z/2,this.ballFuturePosition),d.prototype.update.call(this,t);for(var e in this.cooldowns)this.cooldowns[e]=Math.max(this.cooldowns[e]-t,0)},Object.defineProperties(i.prototype,{winning:{get:function(){return Math.max(0,this.score-this.opponents.score)}},losing:{get:function(){return Math.max(0,this.opponents.score-this.score)}},ai:{get:function(){return c(this._aiBase+this._ai,0,3)},set:function(t){return this._aiBase=t}},opponents:{get:function(){return this===this.pitch.redTeam?this.pitch.blueTeam:this.pitch.redTeam}},red:{get:function(){return this===this.pitch.redTeam}},blue:{get:function(){return this===this.pitch.blueTeam}},ballOnOwnHalf:{get:function(){return Math.abs(this.goal.center.x-this.pitch.ball.position.x)<this.pitch.width/2}},isAI:{get:function(){return 0===this.users.length}},AIPlayers:{get:function(){return this.players.filter(n)}},playerClosestToBall:{get:function(){var t,e=1/0,i=null;if(!this._playerClosestToBall){var n=this.pitch.ball,r=h.temp();n.futurePosition(.4+n.position.z/2,r);for(var s=0;s<this.players.length;s++)t=a.distance(this.players[s].position,r),e>t&&(i=this.players[s],e=t);this._playerClosestToBall=i}return this._playerClosestToBall}},fieldPlayerClosestToBall:{get:function(){var t,e=1/0,i=null;if(!this._fieldPlayerClosestToBall){var n=this.pitch.ball,r=h.temp();n.futurePosition(.4+n.position.z/2,r);for(var s=0;s<this.players.length;s++)this.players[s].isGoalkeeper||(t=a.distance(this.players[s].position,r),e>t&&(i=this.players[s],e=t));this._fieldPlayerClosestToBall=i}return this._fieldPlayerClosestToBall}},activeFieldPlayerClosestToBall:{get:function(){var t,e=1/0,i=null;if(!this._activeFieldPlayerClosestToBall){var n=this.pitch.ball,r=h.temp();n.futurePosition(.4+n.position.z/2,r);for(var s=0;s<this.players.length;s++)!this.players[s].isGoalkeeper&&m.canPlay.sendTo(this.players[s])&&(t=a.distance(this.players[s].position,r),e>t&&(i=this.players[s],e=t));this._activeFieldPlayerClosestToBall=i}return this._activeFieldPlayerClosestToBall}},distanceToBall:{get:function(){return this.playerClosestToBall.distanceToBall}},inControl:{get:function(){return Boolean(this.controllingPlayer)}},hasBall:{get:function(){return this.pitch.ball.owner&&this.pitch.ball.owner.team===this}},goalkeeperHasBall:{get:function(){return this.goalkeeper&&this.pitch.ball.owner===this.goalkeeper}},bounds:{get:function(){return this.goal===this.pitch.leftGoal?this.pitch.leftBounds:this.pitch.rightBounds}},activeAIPlayer:{get:function(){return this.activePlayer||this.receivingPlayer||this.controllingPlayer}}}),i.states={},i.states.Global=g.extend("Global",{onBallOutOfPlay:function(t,e){return t.states.idle(),t.tactics.clear(),m.ballOutOfPlay.send({receivers:t.players}),!0},onGoal:function(t,e){return m.goal.send({receivers:t.players,team:e.team,scorer:e.scorer}),!0},onBeginMatch:function(t,e){return t.reset(),t.setGoal(e.goal),t.ai=e.ai,m.beginMatch.send({receivers:t.players,goal:e.goal}),!0},onBeginPractice:function(t,e){return t.reset(),t.setGoal(e.goal),t.blue?t.setPlayers([t.goalkeeper]):t.setPlayers(t.attackers.concat(t.midfielders)),m.beginPractice.send({receivers:t.players,goal:e.goal}),!0},onChangeSides:function(t,e){return t.setGoal(e.goal),m.changeSides.send({receivers:t.players,goal:e.goal}),!0},onEndMatch:function(t,e){return m.endMatch.send({receivers:t.players}),!0},onPlay:function(t,e){return m.play.send({receivers:t.players}),t.inControl?t.states.change(i.states.Attacking):t.states.change(i.states.Defending),!0},onKickoff:function(t,e){t.states.idle();var i=null,n=null;if(t===e.team){var r=t.getPlayersForKickOff();i=t.controllingPlayer=r[0],n=r[1]||null}return m.kickoff.send({receivers:t.players,starting:i,assistant:n}),!0},onGoalKick:function(t,e){return t.states.idle(),m.goalKick.send({receivers:t.players,team:e.team}),!0},onCorner:function(t,e){if(t.states.idle(),t===e.team){var i=t.pitch.random.choice(t.midfielders)||t.pitch.random.choice(t.fieldPlayers);t.controllingPlayer=i;for(var n=t.opponents.goal.center,r=t.opponents.goal.facing.x,s=[],o=0;o<t.attackers.length;o++)t.randomPosition(n.x+2*r,n.x+5*r,n.y-3,n.y+4,s,2.5),m.corner.send({receiver:t.attackers[o],player:i,position:s[o],corner:e.corner,team:e.team});m.corner.send({receivers:t.midfielders,player:i,corner:e.corner,team:e.team}),m.corner.send({receivers:t.defenders,player:i,corner:e.corner,team:e.team}),m.corner.send({receiver:t.goalkeeper,player:i,corner:e.corner,team:e.team})}else{var n=t.goal.center,r=t.goal.facing.x,s=[];t.controllingPlayer=null;for(var o=0;o<t.fieldPlayers.length;o++)t.fieldPlayers[o].isAttacker||(t.randomPosition(n.x+2*r,n.x+5*r,n.y-3,n.y+4,s,1.5),m.corner.send({receiver:t.fieldPlayers[o],team:e.team,position:s[o]}));m.corner.send({receivers:t.attackers,team:e.team}),m.corner.send({receiver:t.goalkeeper,team:e.team})}return!0},onThrowIn:function(t,e){if(t.states.idle(),t===e.team){var i=t.fieldPlayers.slice();f.sortByDistance(i,e.position),t.controllingPlayer=i[0],m.throwIn.send({receivers:t.players,player:t.controllingPlayer,position:e.position,assistants:i.slice(1,3),team:e.team})}else t.controllingPlayer=null,m.throwIn.send({receivers:t.players,team:e.team});return!0},onSuperspeedStart:function(t,e){return m.superspeedStart.send({receivers:t.players}),!0}}),i.states.Defending=g.extend("Defending",{enter:function(t){t.isAI&&t.tactics.clear(),t.losing>=2?t._ai=1:t.winning>=3?t._ai=-1:t._ai=0},update:function(t,e){return t.inControl?void t.states.change(i.states.Attacking):(t.goalkeeper&&!t.cooldowns.goalkeeperSlide&&t.controllerActionActive("goalkeeperSlide")&&m.humanSlide.sendTo(t.goalkeeper)&&(t.cooldowns.goalkeeperSlide+=4),t.assignPlayers(),void t.skill.update(e))}}),i.states.Attacking=g.extend("Attacking",{enter:function(t){t.isAI&&t.tactics.calculate(),this.hadBall=!0,t.losing>=2?t._ai=1:t.winning>=3?t._ai=-1:t._ai=0},update:function(t,e){if(t.isAI){var n=t.hasBall;!this.hadBall&&n?t.tactics.calculate():n&&t.tactics.update(e),this.hadBall=n}return!t.inControl||t.pitch.ball.owner&&t.pitch.ball.owner.team!==t?(t.controllingPlayer=null,void t.states.change(i.states.Defending)):(t.goalkeeper&&!t.cooldowns.goalkeeperSlide&&t.controllerActionActive("goalkeeperSlide")&&m.humanSlide.sendTo(t.goalkeeper)&&(t.cooldowns.goalkeeperSlide+=4),t.assignPlayers(),void t.skill.update(e))}}),{Team:i}}),define("camera",function(){"use strict";function t(t){t.steering=!0,n.apply(this,arguments),this.pitch=t.pitch,this.predictability=0,this.target=r.create(),this.steering.add(new e),this.steering.arrive.deceleration=2,this.steering.add(new i),this.steering.interpose.deceleration=2,this._zoom=1,this._oldZoom=1,this._targetZoom=1,this._zoomTime=0,this._zoomDuration=2,h.states.SupershotKick.onEnter({receiver:this.onSuperShotEnter,context:this}),h.states.SupershotKick.onExit({receiver:this.onSuperShotExit,context:this})}var e=(require("nebula/numbers").clamp,require("nebula/steerings/behaviors/arrive").Arrive),i=require("nebula/steerings/behaviors/interpose").Interpose,n=(require("nebula/entities/entity"),require("nebula/entities/entity3d")),r=(require("nebula/math/vector2"),require("nebula/math/point2")),s=require("nebula/physics2"),o=require("nebula/states").State,a=require("nebula/easings"),h=require("ball").Ball;return t.states={},t.states.Global=o.extend("Global",{update:function(t,e){t._zoomTime=Math.min(t._zoomDuration,t._zoomTime+e);var i=a.cubic.inOut(t._zoomTime/t._zoomDuration);t._zoom=t._oldZoom+(t._targetZoom-t._oldZoom)*i}}),t.states.Follow=o.extend("Follow",{enter:function(t,e,i){this.oldPredictability=t.predictability,this.entity=e,"undefined"!=typeof i&&(t.predictability=i),t.steering.arrive.enable(t.target)},update:function(t){s.futurePosition(this.entity.position,this.entity.velocity,0,t.predictability,t.target)},exit:function(t){t.steering.arrive.disable(),t.predictability=this.oldPredictability}}),t.states.Interpose=o.extend("Interpose",{enter:function(t,e,i){t.steering.interpose.enable(e,i)},exit:function(t){t.steering.interpose.disable()}}),t.states.FollowBall=t.states.Follow.extend("FollowBall",{update:function(e,i){this.entity=e.pitch.ball.owner||e.pitch.ball,t.states.Follow.prototype.update.call(this,e,i)}}),t.states.GoTo=o.extend("GoTo",{enter:function(t,e){t.target.x=e.x,t.target.y=e.y,t.steering.arrive.enable(t.target)},exit:function(t){t.steering.arrive.disable()}}),t.prototype=Object.create(n.prototype),t.prototype.follow=function(e,i){this.states.change(t.states.Follow,e,i)},t.prototype.interpose=function(e,i){this.states.change(t.states.Interpose,e,i)},t.prototype.followBall=function(){this.states.change(t.states.FollowBall,null,1)},t.prototype.stop=function(){this.states.idle(),n.prototype.stop.call(this)},t.prototype.goTo=function(e){this.states.change(t.states.GoTo,e)},t.prototype.lookAt=function(t){this.stop(),this.position.x=t.x,this.position.y=t.y},t.prototype.instantZoom=function(t){this._zoom=this._oldZoom=this._targetZoom=t},t.prototype.onSuperShotEnter=function(){this._maxSpeed=this.maxSpeed,this.maxSpeed=1.3*this.maxSpeed},t.prototype.onSuperShotExit=function(){this.maxSpeed=this._maxSpeed},Object.defineProperty(t.prototype,"zoom",{get:function(){return this._zoom},set:function(t){this._oldZoom=this._zoom,this._zoomTime=0,this._targetZoom=t}}),{Camera:t}}),define("sound_entity",function(){"use strict";function t(t){t=t||{},i.apply(this,arguments),this.target=t.target,this.panner=e.ctx.createPanner(),this.panner.maxDistance=1e3,this.panner.rolloffFactor=.1,this.parentAudioNode=t.parentAudioNode||e.gainNode,this.panner.connect(this.parentAudioNode)}var e=require("nebula/audio"),i=require("nebula/entities/entity3d");return t.prototype=Object.create(i.prototype),t.prototype.update=function(t){i.prototype.update.call(this,t),this.target&&(this.position.x=this.target.position.x,this.position.y=this.target.position.y,this.position.z=this.target.position.z||0),this.panner.setPosition(this.position.x,this.position.z,this.position.y)},t}),define("particle",function(){"use strict";function t(t){t=t||{},e.call(this,t),this.maxLife=this.life=t.life||5}var e=require("nebula/entities/entity3d");return t.prototype=Object.create(e.prototype),t.prototype.reset=function(t){this.dead=!1,this.maxLife=this.life=t.life||5,t.position?(this.position.x=t.position.x,this.position.y=t.position.y,this.position.z=t.position.z):this.position.x=this.position.y=this.position.z=0,this.oldPosition.x=this.position.x,this.oldPosition.y=this.position.y,this.oldPosition.z=this.position.z,this.velocity.x=this.velocity.y=this.velocity.z=0,t.gravity?(this.gravity.x=t.gravity.x,this.gravity.y=t.gravity.y,this.gravity.z=t.gravity.z):this.gravity.x=this.gravity.y=this.gravity.z=0,this.mass="mass"in t?t.mass:1,this.maxSpeed="maxSpeed"in t?t.maxSpeed:1/0,this.minForce="minForce"in t?t.minForce:0,this.maxForce="maxForce"in t?t.maxForce:1/0,this.maxTurnRate="maxTurnRate"in t?t.maxTurnRate:1/0,this.damping="damping"in t?t.damping:0,this.friction="friction"in t?t.friction:0,this.drag="drag"in t?t.drag:0,this.deceleration=0,this.heading.x=1,this.heading.y=this.heading.z=0,this.force.x=this.force.y=this.force.z=0},t.prototype.update=function(t){this.life-=t,this.life<=0&&(this.dead=!0),e.prototype.update.call(this,t)},t}),define("particle_manager",function(){"use strict";function t(t){var e;return null===o.head?e=n.createNode(new i(t)):(e=o.head,e.data.reset(t),o.detachNode(e)),r.appendNode(e),e.data}function e(t){for(var e,i=s.head;null!==i;)e=i.next,s.detachNode(i),o.appendNode(i),i=e;for(i=r.head;null!==i;){if(i.data.update(t),e=i.next,void 0===e)throw new Error;i.data.dead&&(r.detachNode(i),s.appendNode(i)),i=e}}var i=require("particle"),n=require("nebula/linked_list"),r=new n,s=new n,o=new n,a={update:e,aliveParticles:r,deadParticles:o,bufferedParticles:s,getUnusedParticle:t};return Object.defineProperty(a,"length",{get:function(){return r.length+s.length+o.length}}),a}),define("emitter",function(){"use strict";function t(t){t=t||{},r.apply(this,arguments),this.createParticle=t.createParticle||this.createParticle,this.direction=a.copy(t.direction||a.create(1,0,0)),this.spreadX=i.radians(t.spreadX||0),this.spreadY=i.radians(t.spreadY||0),"emitForce"in t?this.emitForce=t.emitForce:(this.emitMinForce="undefined"==typeof t.emitMinForce?1:t.emitMinForce,this.emitMaxForce="undefined"==typeof t.emitMaxForce?1:t.emitMaxForce),"particleLife"in t?this.particleLife=t.particleLife:(this.particleMinLife=t.particleMinLife||5,this.particleMaxLife=t.particleMaxLife||5),this.target=t.target,this.particleCap=t.particleCap||1e3,this.disabled=t.disabled||!1,this.spawnRate="undefined"!=typeof t.spawnRate?t.spawnRate:1,this._count=0}var e,i=require("nebula/numbers"),n=require("nebula/random"),r=require("nebula/entities/entity3d"),s=require("nebula/signal"),o=require("nebula/math/matrix4"),a=require("nebula/math/vector3"),h=require("nebula/math/point3"),l=(require("particle"),require("particle_manager")),u=(o.create(),o.create(),a.create(1,0,0)),c=a.create(0,1,0),p=h.create(0,0,0);return t.onEmit=new s,t.prototype=Object.create(r.prototype),t.prototype.createParticle=function(t){return l.getUnusedParticle({position:t,life:n.uniform(this.particleMinLife,this.particleMaxLife)})},t.prototype.update=function(t){if(!this.disabled){this.target&&(this.position.x=this.target.position.x,this.position.y=this.target.position.y,this.position.z=this.target.position.z||0),this._count+=Math.min(this.spawnRate,this.particleCap)*t;var e=Math.floor(this._count);if(this._count-=e,1===e)this.emit(1);else for(var i=0;e>i;i++)this.emit(i/(e-1));r.prototype.update.call(this,t)}},t.prototype.emit=function(i){p.x=this.oldPosition.x+(this.position.x-this.oldPosition.x)*i,p.y=this.oldPosition.y+(this.position.y-this.oldPosition.y)*i,p.z=this.oldPosition.z+(this.position.z-this.oldPosition.z)*i,e=this.createParticle(p),a.normalize(this.direction,e.velocity),a.rotate(e.velocity,u,n.uniform(-this.spreadY/2,this.spreadY/2),e.velocity),a.rotate(e.velocity,c,n.uniform(-this.spreadX/2,this.spreadX/2),e.velocity),a.multiplyNumber(e.velocity,n.uniform(this.emitMinForce,this.emitMaxForce),e.velocity),t.onEmit.send(this,e)},Object.defineProperties(t.prototype,{emitForce:{set:function(t){return this.emitMinForce=this.emitMaxForce=t}},particleLife:{set:function(t){return this.particleMinLife=this.particleMaxLife=t}}}),t}),define("skin_merger",function(){"use strict";function t(t,e,i){t=t||{},i=i||{};var n={arm_left:{arm_left:e.arm_left},arm_right:{arm_right:e.arm_right},hand_left:{hand_left:e.hand_left},hand_right:{hand_right:e.hand_right},head:{head_front:e.head_front,head_back:e.head_back},leg_left_knee:{leg_left_knee:e.leg_left_knee},leg_right_knee:{leg_right_knee:e.leg_right_knee},neck:{neck:e.neck},eyebrows:{eyebrows:i.eyebrows},eyes:{eyes:i.eyes,eyes_closed:i.eyes_closed,eyes_dead:i.eyes_dead,eyes_hit:i.eyes_hit},hair:{hair_front:i.hair_front,hair_back:i.hair_back},mouth:{mouth_normal:i.mouth_normal,mouth_smile:i.mouth_smile,mouth_dead:i.mouth_dead},nose:{nose:i.nose},arm_left_sleeve:{arm_left_sleeve:t.arm_left_sleeve||e.arm_left_sleeve},arm_right_sleeve:{arm_right_sleeve:t.arm_right_sleeve||e.arm_right_sleeve},chest_shirt:{shirt_back:t.shirt_back||e.shirt_back,shirt_front:t.shirt_front||e.shirt_front},leg_left_shoe:{leg_left_shoe:t.leg_left_shoe||e.leg_left_shoe},leg_left_shorts:{leg_left_shorts:t.leg_left_shorts||e.leg_left_shorts},leg_left_sock:{leg_left_sock:t.leg_left_sock||e.leg_left_sock},leg_right_shoe:{leg_right_shoe:t.leg_right_shoe||e.leg_right_shoe},leg_right_shorts:{leg_right_shorts:t.leg_right_shorts||e.leg_right_shorts},leg_right_sock:{leg_right_sock:t.leg_right_sock||e.leg_right_sock},pelvis_shorts:{pelvis_shorts:t.pelvis_shorts||e.pelvis_shorts}};return t.number&&(delete t.number.width,delete t.number.height,n.number={number:t.number}),i.hair_accessory_1_front&&(n.hair_accessory_1={hair_accessory_1_front:i.hair_accessory_1_front,hair_accessory_1_back:i.hair_accessory_1_back}),i.face_accessory_1&&(n.face_accessory_1={face_accessory_1:i.face_accessory_1}),i.face_accessory_2&&(n.face_accessory_2={face_accessory_2:i.face_accessory_2}),i.face_accessory_3&&(n.face_accessory_3={face_accessory_3:i.face_accessory_3}),t.hand_left_glove&&(n.hand_left_glove={hand_left_glove:t.hand_left_glove}),t.hand_right_glove&&(n.hand_right_glove={hand_right_glove:t.hand_right_glove}),JSON.parse(JSON.stringify(n))}require("settings");return t}),define("races",function(){"use strict";function t(){s=[];for(var t=r.races,e=0;e<t.length;e++){var i=n.loader.resources[t[e]].data;s.push(i)}return s}function e(t){for(var e=0;e<s.length;e++)if(s[e].id===t)return s[e];return null}function i(){return s}var n=require("pixi"),r=require("assets"),s=[];return{load:t,get:e,all:i}}),define("teams",function(){"use strict";function t(t){for(var e=JSON.parse(JSON.stringify(c.loader.resources["data/player.json"].data)),i={},n=0;n<t.players.length;n++){var r=t.players[n];for(var s in t.kits)i[t.id+(n+1)+s]=y(t.kits[s],d.get(r.race).skin,r.skin),i[t.id+(n+1)+s].number&&(i[t.id+(n+1)+s].number.number.name="images/player/kit/numbers/"+r.number+".png")}return e.skins=i,x.readSkeletonData(e).skins}function e(){b=[];for(var t=v.teams,e=0;e<t.length;e++){var i=c.loader.resources[t[e]].data;i.name||(i.name=i.id),b.push(i)}return b}function i(t,e){for(var i=[],n=t.length,r=0;r<t.length;r++){var s=new Image;s.onload=function(){n-=1,!n&&e&&e(i)},s.src=t[r],i.push(s)}}function n(e,n){var r="string"==typeof e?a(e):e,s=[r.flag_thumbnail],o=m.range(2,20,1);o=f.sample(o,6),f.shuffle(o);for(var h=0;h<r.players.length;h++)r.players[h].number=r.players[h].number||o[h];r.skins=t(r),i(s,function(t){r._flag_thumbnail=t[0],n()})}function r(t){var e="string"==typeof t?a(t):t;delete e._flag_thumbnail}function s(){for(var t=0;t<b.length;t++)b[t]._atlas&&r(b[t])}function o(t){return p.filter(b,t)}function a(t){for(var e=0;e<b.length;e++)if(b[e].id===t)return b[e];return null}function h(){return u(b)}function l(){return b.map(function(t){return t.id})}function u(t){return t=t.slice(),Object.defineProperty(t,"ids",{get:w}),t}var c=require("pixi"),p=require("nebula/query"),d=(require("nebula/objects"),require("image_packer"),require("races")),f=require("nebula/random"),m=require("nebula/numbers"),g=require("spine/skeleton_json"),y=require("skin_merger"),v=require("assets"),x=new g,b=[],w=function(){return this.map(function(t){return t.id})};return{load:e,loadResources:n,unloadResources:r,unloadAllResources:s,filter:o,get:a,all:h,ids:l,manager:u}}),define("shaders/outline",["pixi"],function(t){"use strict";function e(){var e=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","    vec4 t = texture2D(uSampler, vTextureCoord);","    if (t.a > 0.0) {","        float p = 0.001;","        float a = 0.0;","        a += texture2D(uSampler, vec2(vTextureCoord.x+p, vTextureCoord.y)).a;","        a += texture2D(uSampler, vec2(vTextureCoord.x-p, vTextureCoord.y)).a;","        a += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y+p)).a;","        a += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y-p)).a;","        float avg = a * 0.25;","        if (avg < 1.0) {","            float o = 0.25 * (1.0-avg);","            t.r = max(0.0, t.r - o);","            t.g = max(0.0, t.g - o);","            t.b = max(0.0, t.b - o);","        }","    }","    gl_FragColor = t * vColor;","}"];t.AbstractFilter.call(this,null,e.join(""))}return e.prototype=Object.create(t.AbstractFilter.prototype),e.prototype.constructor=e,e}),define("renderers/base",["pixi"],function(t){"use strict";function e(e){t.Container.call(this),this.stadium=e.stadium,this.entity=e.entity,this.entity&&(this.dead=this.entity.dead)}return e.prototype=Object.create(t.Container.prototype),e.prototype.update=function(t){this.entity&&(this.dead=this.entity.dead)},e.prototype.baseRendererUpdate=e.prototype.update,e.prototype.render=function(){this.entity&&this.stadium.worldToScreen(this.entity.position,this.position)},e.prototype.remove=function(){this.parent.removeChild(this)},e}),define("renderers/sprite",["pixi","renderers/base"],function(t,e){"use strict";function i(i){e.apply(this,arguments),i.texture?this.sprite=new t.Sprite(i.texture):this.sprite=t.Sprite.fromImage(i.image),this.sprite.anchor.set(.5,.5),this.addChild(this.sprite)}return i.prototype=Object.create(e.prototype),i.prototype.render=function(t){e.prototype.render.call(this,t),this.entity&&(this.sprite.position.y=-this.entity.position.z*this.stadium.pixelsZ)},i}),define("renderers/movie_clip",["pixi","renderers/base"],function(t,e){"use strict";function i(i){e.apply(this,arguments),i.textures&&(this.sprite=new t.extras.MovieClip(i.textures)),this._currentFrame=0,this.speed="undefined"!=typeof i.speed?i.speed:1,this.sprite.anchor.set(.5,.5),this.addChild(this.sprite)}return i.prototype=Object.create(e.prototype),i.prototype.render=function(t){this._currentFrame+=this.speed*t,this.sprite.gotoAndStop(this._currentFrame),this.entity&&this.stadium.worldToScreen(this.entity.position,this.position)},i}),define("renderers/particles/grass",function(){"use strict";function t(t,e,n){i.Sprite.call(this,t),this.anchor.set(.5,.5),this.stadium=e,this.spawn(n,t)}function e(t){i.ParticleContainer.call(this,1e3,{alpha:!0,rotation:!0,scale:!0,uvs:!0},1e3),this.texture=i.Texture.fromFrame("grass/single.png"),this.stadium=t,this.emitters=[],this.firstSlot=null}var i=require("pixi"),n=require("emitter");return t.prototype=Object.create(i.Sprite.prototype),t.prototype.spawn=function(t,e){this.texture=e,this.visible=!0,this.particle=t,this.rotationSpeed=Math.PI+3*Math.random()*Math.PI,this.rotation=Math.random()*Math.PI*2},t.prototype.render=function(t){this.particle.position.z<=0&&this.particle.velocity.z<=0?(this.particle.position.z=0,this.particle.friction=10):this.rotation+=t*this.rotationSpeed,this.stadium.worldToScreen(this.particle.position,this.position),this.scale.x=this.scale.y=this.particle.life/this.particle.maxLife*2,this.particle.dead&&(this.particle=null,this.visible=!1)},e.prototype=Object.create(i.ParticleContainer.prototype),e.prototype.createEmitter=function(t,e){var i=new n({target:t});return i.texture=e||this.texture,n.onEmit({sender:i,receiver:this._createSprite,context:this}),this.emitters.push(i),i},e.prototype._createSprite=function(e,i){if(i.position.x+=.15*(2*Math.random()-1),i.position.y+=.15*(2*Math.random()-1),i.gravity.z=-4,i.drag=3,null!==this.firstSlot){this.children[this.firstSlot].spawn(i,e.texture);for(var n=this.firstSlot+1;n<this.children.length;n++)if(!this.children[n].visible)return void(this.firstSlot=n);this.firstSlot=null}else this.addChild(new t(e.texture,this.stadium,i))},e.prototype.render=function(t){for(var e=0;e<this.emitters.length;e++)this.emitters[e].update(t);for(var e=0;e<this.children.length;e++){var i=this.children[e];i.visible&&i.render(t),!i.visible&&(null===this.firstSlot||e<this.firstSlot)&&(this.firstSlot=e)}},e}),define("renderers/ball",["pixi"],function(t){"use strict";function e(t,e,i,n,r,s){for(var o=t.data,a=e.data,h=Math.min(t.width,t.height)/2,l=h*h,u=t.width,c=t.height,p=u*c,d=e.width,f=(e.height,e.width-1),m=e.height-1,g=Math.sin(r)*Math.cos(s),y=Math.sin(s),v=Math.cos(r)*Math.cos(s),x=Math.PI,b=Math.PI/2,w=2*Math.PI,_=n[0],T=n[1],E=n[2],S=n[3],A=n[4],C=n[5],P=n[6],M=n[7],O=n[8],R=n[9],k=n[10],I=n[11],D=0;p>D;D++){var L=D%u-h,F=Math.floor(D/c)-h;if(!(F*F+L*L>=l)){var B=Math.sqrt(l-L*L-F*F),N=L/h*g+F/h*y+B/h*v;N=Math.max(.7,Math.min(2*N,1));var G=(L*_+F*T+B*E+S)/h,q=(L*A+F*C+B*P+M)/h,z=(L*O+F*R+B*k+I)/h,U=Math.floor((Math.atan2(G,z)+x)*f/w),j=Math.floor((Math.asin(q)+b)*m/x),H=4*(j*d+U),W=a[H],Y=a[H+1],X=a[H+2],K=4*D;o[K+0]=W*N,o[K+1]=Y*N,o[K+2]=X*N,o[K+3]=255}}i.putImageData(t,0,0)}function i(e){var i={rotation:{type:"mat4",value:e}},n=["precision mediump float;","varying vec2 vTextureCoord;","uniform mat4 rotation;","uniform sampler2D uSampler;","float PIP2   = 1.5707963;","float PI     = 3.1415629;","float TWOPI  = 6.2831853;","void main(void) {","    float x = vTextureCoord.x*2.0 - 1.0;","    float y = vTextureCoord.y*2.0 - 1.0;","    float d = x * x + y * y;","    if (d > 1.0)","        discard;","    float z = sqrt(1.0 - d);","    vec4 point = vec4(x, y, z, 1.0) * rotation;","    vec2 coord = vec2((atan(point.x, point.z) + PI) / TWOPI, (asin(point.y) + PIP2) / PI);","    gl_FragColor = texture2D(uSampler, coord) * (1.0 - smoothstep(0.8, 1.0, d));","}"];t.AbstractFilter.call(this,null,n.join(""),i)}function n(){a.apply(this,arguments),this.ballWidth=this.entity.radius*this.stadium.pixelsX*2,this.ballHeight=this.entity.radius*this.stadium.pixelsZ*2,this.sprite=new t.Container,this.addChild(this.sprite),this.ball=t.Sprite.fromImage("images/ball/texture.png"),this.ball.width=this.ballWidth,this.ball.height=this.ballHeight,this.ball.anchor.set(.5,.5),this.ball.shader=new i(this.entity.rotation),this.sprite.addChild(this.ball),this.shadow=t.Sprite.fromImage("images/ball/shadow.png"),this.shadow.scale.set(1/3,1/3),this.shadow.anchor.set(.5,.5),this.sprite.addChild(this.shadow),this.fx=new t.Container,this.addChild(this.fx),this.airPoints=r.array(15),this.airPointsTime=0,this.airTextureNormal=t.Texture.fromImage("images/ball_air_flow.png"),this.airTextureSupershot=t.Texture.fromImage("images/powerups/supershot/air_flow.png"),this.air=new t.mesh.Rope(this.airTextureNormal,this.airPoints),this.stadium.sortables.addChild(this.air),o.states.SupershotKick.onEnter(this.onSuperShotKickEnter.bind(this)),o.states.SupershotKick.onExit(this.onSuperShotKickExit.bind(this))}var r=(require("nebula/format"),require("nebula/math/point2")),s=require("nebula/numbers").clamp,o=(require("emitter"),require("ball").Ball),a=require("renderers/base");require("renderers/sprite"),require("renderers/movie_clip");return i.prototype=Object.create(t.AbstractFilter.prototype),n.prototype=Object.create(a.prototype),n.prototype.onSuperShotKickEnter=function(){this.air.texture=this.airTextureSupershot,this.air.blendMode=t.BLEND_MODES.ADD},n.prototype.onSuperShotKickExit=function(){this.air.texture=this.airTextureNormal,this.air.blendMode=t.BLEND_MODES.NORMAL},n.prototype.render=function(t){this.stadium.worldToScreenFlat(this.entity.position,this.position);var e=this.entity;e.inHands?(this.shadow.position.y=0,this.ball.position.y=0,this.ball.parent.parent&&(this.ball.rotation=-this.ball.parent.parent.rotation+Math.PI)):(this.sprite.position.y=-e.position.z*this.stadium.pixelsZ+2,this.ball.rotation=0,this.stadium.shadows.drawShadow(this.position.x,this.position.y+1,10+e.radius*this.stadium.pixelsX*2-4,10+e.radius*this.stadium.pixelsY*2-2,Math.max(0,1-.2*e.position.z)));var i=this.air.position.x,n=this.air.position.y;this.air.position.x=this.position.x,this.air.position.y=this.position.y+this.sprite.position.y;for(var r=this.airPoints.length-1;r>0;r--)this.airPoints[r].x-=this.air.position.x-i,this.airPoints[r].y-=this.air.position.y-n;if(this.airPointsTime+=this.stadium.pitch.elapsed,this.airPointsTime>=.02){for(var r=this.airPoints.length-1;r>1;r--)this.airPoints[r].x=this.airPoints[r-1].x,this.airPoints[r].y=this.airPoints[r-1].y;this.airPoints[1].x=i-this.air.position.x,this.airPoints[1].y=n-this.air.position.y,this.airPointsTime-=.02}this.air.alpha=e.inHands?0:s((e.speed-4)/10,0,1);var o=e.inHands?1:1+(e.position.z-e.radius)/6;this.ball.width=this.ballWidth*o,this.ball.height=this.ballHeight*o,this.shadow.scale.set(1/3*o,1/3*o),this.fx.position.y=this.sprite.position.y},n.sphere=e,n}),define("renderers/control_indicator",["pixi"],function(t){"use strict";function e(e){t.Container.call(this),this.stadium=e.stadium,this.indicators=[],this.offScreenIndicators=[];for(var i=0;i<a.length;i++)this._createIndicator(a[i]);this._createIndicator(h[0]),this._createIndicator(h[1]),this._createIndicator(h[2]),this._createIndicator(h[3]),this._createIndicator(h[0]),this._createIndicator(h[1]),this._createIndicator(h[2]),this._createIndicator(h[3])}var i=require("settings"),n=(require("nebula/numbers"),require("nebula/math/point2")),r=require("users"),s=require("nebula/math/geometry"),o=(require("players/states"),i("DEBUG")),a=i("USER_COLORS"),h=i("AI_COLORS");i("PLAYER_RADIUS");return e.prototype=Object.create(t.Container.prototype),e.prototype._createIndicator=function(e){var i=new t.Container;i.scale.y=.58,i.emptyShadowSprite=t.Sprite.fromFrame("indicators/controlled_no_ball.png"),i.emptyShadowSprite.position.y=2/i.scale.y,i.emptyShadowSprite.anchor.set(.5,.5),i.emptyShadowSprite.tint=0,i.emptyShadowSprite.alpha=.5,i.addChild(i.emptyShadowSprite),i.emptySprite=t.Sprite.fromFrame("indicators/controlled_no_ball.png"),i.emptySprite.anchor.set(.5,.5),i.emptySprite.tint=e,i.addChild(i.emptySprite),i.ballShadowSprite=t.Sprite.fromFrame("indicators/controlled_with_ball.png"),
i.ballShadowSprite.position.y=2/i.scale.y,i.ballShadowSprite.anchor.set(.5,.5),i.ballShadowSprite.tint=0,i.ballShadowSprite.alpha=.5,i.addChild(i.ballShadowSprite),i.ballSprite=t.Sprite.fromFrame("indicators/controlled_with_ball.png"),i.ballSprite.anchor.set(.5,.5),i.ballSprite.tint=e,i.addChild(i.ballSprite),i.visible=!1,i.teammatesShadows=new t.Container,i.teammatesShadows.position.y=2/i.scale.y,i.addChild(i.teammatesShadows),i.teammates=new t.Container,i.addChild(i.teammates);for(var n=0;5>n;n++){var r=t.Sprite.fromFrame("indicators/teammates.png");r.anchor.set(-3,.5),r.tint=e,r.scale.set(.25,.25),i.teammates.addChild(r),r=t.Sprite.fromFrame("indicators/teammates.png"),r.anchor.set(-3,.5),r.tint=0,r.alpha=.5,r.scale.set(.25,.25),i.teammatesShadows.addChild(r)}var s=new t.Container;s.scale.y=i.scale.y,r=t.Sprite.fromFrame("indicators/teammates.png"),r.anchor.set(0,.5),r.tint=0,r.alpha=.5,r.position.y=2/i.scale.y,s.addChild(r),r=t.Sprite.fromFrame("indicators/teammates.png"),r.anchor.set(0,.5),r.tint=e,s.addChild(r),this.addChild(i),this.addChild(s),this.indicators.push(i),this.offScreenIndicators.push(s)},e.prototype._showIndicator=function(t,e,i,r,o,a){var h=75,l=2*h,u=i.hasBall;t.visible=!0,t.ballSprite.visible=t.ballShadowSprite.visible=u,t.emptySprite.visible=t.emptyShadowSprite.visible=!u,t.teammates.visible=t.teammatesShadows.visible=u,this.stadium.worldToScreenFlat(i.position,t.position);var c=0;if(i.team)for(var p=0;p<i.team.players.length;p++)i.team.players[p]!==i&&(t.teammatesShadows.children[c].visible=t.teammates.children[c].visible=!0,t.teammatesShadows.children[c].rotation=t.teammates.children[c].rotation=n.angle(i.team.players[p].position,i.position),c++);for(;5>c;c++)t.teammatesShadows.children[c].visible=t.teammates.children[c].visible=!1;this.stadium.worldToScreenFlat(i.position,e.position),s.clampPointInRectangle(e.position,r.x+h,r.y+.58*h,o-l,a-.58*l,e.position),e.children[0].rotation=e.children[1].rotation=n.angle(t.position,e.position),e.visible=!s.pointInRectangle(t.position,r.x,r.y,o,a)},e.prototype.render=function(){var t=this.stadium.cameraWidth,e=this.stadium.cameraHeight,i=n.temp();this.stadium.getCameraPosition(i);for(var s=0;s<r.list.length;s++){var a=r.list[s],h=this.indicators[s],l=this.offScreenIndicators[s];a&&a.player?this._showIndicator(h,l,a.player,i,t,e):h.visible=l.visible=!1}for(var s=0;8>s;s++)this.indicators[r.list.length+s].visible=this.offScreenIndicators[r.list.length+s].visible=!1;if(this.stadium.pitch.redTeam.isAI){var u=this.stadium.pitch.redTeam.activeAIPlayer;if(u){var c=o?this.stadium.pitch.redTeam.ai:this.stadium.pitch.redTeam._aiBase,p=r.list.length+c;this._showIndicator(this.indicators[p],this.offScreenIndicators[p],u,i,t,e)}}if(this.stadium.pitch.blueTeam.isAI){var u=this.stadium.pitch.blueTeam.activeAIPlayer;if(u){var c=o?this.stadium.pitch.blueTeam.ai:this.stadium.pitch.blueTeam._aiBase,p=r.list.length+4+c;this._showIndicator(this.indicators[p],this.offScreenIndicators[p],u,i,t,e)}}},e}),define("renderers/net",["pixi"],function(t){"use strict";function e(t){var e=t.gl;"undefined"==typeof o&&(o=new t.shaderManager.primitiveShader.constructor(t.shaderManager)),t.shaderManager.setShader(o),o.uniforms.translationMatrix.transpose=!1,o.uniforms.translationMatrix.value=p,o.uniforms.projectionMatrix.value=t.currentRenderTarget.projectionMatrix.toArray(!0),o.uniforms.projectionMatrix.transpose=!1,o.uniforms.alpha.value=1,o.uniforms.tint.value=c,o.syncUniforms(),"undefined"==typeof r&&(r=e.createBuffer(),s=e.createBuffer()),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,h,e.DYNAMIC_DRAW),e.vertexAttribPointer(o.attributes.aVertexPosition,2,e.FLOAT,!1,24,0),e.vertexAttribPointer(o.attributes.aColor,4,e.FLOAT,!1,24,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),e.bufferData(e.ELEMENT_ARRAY_BUFFER,l,e.DYNAMIC_DRAW),e.drawElements(e.LINES,u/6,e.UNSIGNED_SHORT,0)}function i(t){this.position=a.create(),this.position1=t.triangle.a.position,this.position2=t.triangle.b.position,this.position3=t.triangle.c.position,this.stadium=t.stadium}function n(e){t.DisplayObject.call(this),this.stadium=e.stadium,this.net=e.net,this.netTriangleRenderers=[];for(var n=0;n<this.net.triangles.length;n+=2)this.netTriangleRenderers.push(new i({stadium:this.stadium,triangle:this.net.triangles[n]}))}for(var r,s,o,a=require("nebula/math/point2"),h=(require("nebula/math/point3"),new Float32Array(2448)),l=new Uint16Array(408),u=0,c=new Float32Array([1,1,1]),p=new Float32Array([1,0,0,0,1,0,0,0,1]),d=0;d<l.length;d++)l[d]=d;for(var d=0;d<h.length;d+=48)h[d+2]=0,h[d+3]=0,h[d+4]=0,h[d+5]=.125,h[d+8]=0,h[d+9]=0,h[d+10]=0,h[d+11]=.125,h[d+14]=0,h[d+15]=0,h[d+16]=0,h[d+17]=.125,h[d+20]=0,h[d+21]=0,h[d+22]=0,h[d+23]=.125,h[d+26]=1,h[d+27]=1,h[d+28]=1,h[d+29]=1,h[d+32]=1,h[d+33]=1,h[d+34]=1,h[d+35]=1,h[d+38]=1,h[d+39]=1,h[d+40]=1,h[d+41]=1,h[d+44]=1,h[d+45]=1,h[d+46]=1,h[d+47]=1;return i.prototype.renderWebGL=function(t,n,r){n instanceof i||(u=0);var s=this.stadium,o=s.scale.x,a=s.scale.y,l=s.pitch.width,c=s.pitch.height,p=s.pixelsX,d=s.pixelsY,f=s.pixelsZ;this.position.y=s.pitchOffsetPixelsY+Math.min(this.position1.y,this.position2.y,this.position3.y)*d;var m=s.position.x/o+s.pitchOffsetPixelsX,g=s.position.y/a+s.pitchOffsetPixelsY,y=m+this.position1.x*p+s.topBottomDiffPixels*(1-this.position1.y/c)*-(2*this.position1.x/l-1),v=g+this.position1.y*d-this.position1.z*f,x=m+this.position2.x*p+s.topBottomDiffPixels*(1-this.position2.y/c)*-(2*this.position2.x/l-1),b=g+this.position2.y*d-this.position2.z*f,w=m+this.position3.x*s.pixelsX+s.topBottomDiffPixels*(1-this.position3.y/c)*-(2*this.position3.x/l-1),_=g+this.position3.y*d-this.position3.z*f;y*=o,v*=a,x*=o,b*=a,w*=o,_*=a;var T=u;h[T+0]=y-1,h[T+1]=v+1,h[T+6]=x-1,h[T+7]=b+1,h[T+12]=y-1,h[T+13]=v+1,h[T+18]=w-1,h[T+19]=_+1,h[T+24]=y,h[T+25]=v,h[T+30]=x,h[T+31]=b,h[T+36]=y,h[T+37]=v,h[T+42]=w,h[T+43]=_,u+=48,r instanceof i&&u!==h.length||(t.currentRenderer.flush(),e(t),t.drawCount++,t.currentRenderer.start(),u===h.length&&(u=0))},n.prototype=Object.create(t.DisplayObject.prototype),n}),define("renderers/player",["pixi","pixi/spine"],function(t,e){"use strict";function i(t){this._spineData=t,this.blinkDelay=0,this.autoBlink=!0,this.facingCamera=!0,this.eyebrowPoints=u.array(3),this.ballContainer=null,this.skinName=null,e.call(this,y.readSkeletonData(t)),this.setAnimationMixes()}function n(e){p.apply(this,arguments),this.visible=!1,this.autoEmotions=!0,this.defaultScale=.5,this.spine=new i(e.spine),this.spine.scale.set(this.defaultScale,this.defaultScale),this.addChild(this.spine),this.renderTexture=new t.RenderTexture(this.stadium.game.renderer,256,256),this.sprite=new t.Sprite(this.renderTexture),this.sprite.anchor.set(.5,1),this.sprite.scale.set(this.defaultScale,this.defaultScale),this.sprite.shader=new g,this.addChild(this.sprite),this.tempMatrix=new t.Matrix,this.moveAnimations=["idle","idle_back","walk","walk_back","walk_backwards","walk_backwards_back","run","run_back","run2","run2_back","run_backwards","run_backwards_back","sprint","sprint_back"],l&&(this.stateLabel=new t.Text("",{font:'700 18px "Arial Narrow", sans-serif',fill:"#fff",align:"center",stroke:"#000",strokeThickness:3}),this.stateLabel.position.x=0,this.stateLabel.position.y=-100,this.stateLabel.anchor.x=.5,this.stateLabel.anchor.y=1,this.addChild(this.stateLabel)),o.onKick({sender:this.entity,receiver:this.onKick,context:this}),o.onHeadKick({sender:this.entity,receiver:this.onHeadKick,context:this}),o.onBallHold({sender:this.entity,receiver:this.onBallHold,context:this}),o.onBallDrop({sender:this.entity,receiver:this.onBallDrop,context:this}),o.onTeamSelect({sender:this.entity,receiver:this.onTeamSelect,context:this}),o.onTeamUnselect({sender:this.entity,receiver:this.onTeamUnselect,context:this}),a.AIGoalkeeperJumpToBall.onEnter({sender:this.entity,receiver:this.onJumpToBallEnter,context:this}),a.AIGoalkeeperJumpToBall.onExit({sender:this.entity,receiver:this.onJumpToBallExit,context:this}),a.ThrowInPickUpBall.onEnter({sender:this.entity,receiver:this.onThrowInPickUpBallEnter,context:this}),a.ThrowInThrow.onEnter({sender:this.entity,receiver:this.onThrowInThrowEnter,context:this}),a.Hit.onEnter({sender:this.entity,receiver:this.onHitEnter,context:this}),a.Hit.onExit({sender:this.entity,receiver:this.onHitExit,context:this}),a.Kick.onEnter({sender:this.entity,receiver:this.onKickEnter,context:this}),a.Jump.onEnter({sender:this.entity,receiver:this.onJumpEnter,context:this}),a.Slide.onEnter({sender:this.entity,receiver:this.onSlideEnter,context:this}),a.Slide.onExit({sender:this.entity,receiver:this.onSlideExit,context:this}),a.Supershot.onEnter({sender:this.entity,receiver:this.onSupershotEnter,context:this}),a.Supershot.onExit({sender:this.entity,receiver:this.onSupershotExit,context:this}),a.GoalCelebration.onEnter({sender:this.entity,receiver:this.onGoalCelebrationEnter,context:this}),a.GoalCelebration.onExit({sender:this.entity,receiver:this.onGoalCelebrationExit,context:this}),a.GoalCelebrationPlaneAssist.onEnter({sender:this.entity,receiver:this.onGoalCelebrationEnter,context:this}),a.GoalCelebrationPlaneAssist.onExit({sender:this.entity,receiver:this.onGoalCelebrationPlaneExit,context:this}),a.GoalCelebrationPlane.onEnter({sender:this.entity,receiver:this.onGoalCelebrationPlaneEnter,context:this}),a.GoalCelebrationPlane.onExit({sender:this.entity,receiver:this.onGoalCelebrationPlaneExit,context:this}),a.GoalCelebrationDance.onEnter({sender:this.entity,receiver:this.onGoalCelebrationDanceEnter,context:this}),a.GoalCelebrationDance.onExit({sender:this.entity,receiver:this.onGoalCelebrationDanceExit,context:this}),a.GoalCelebrationDance2.onEnter({sender:this.entity,receiver:this.onGoalCelebrationDance2Enter,context:this}),a.GoalCelebrationDance2.onExit({sender:this.entity,receiver:this.onGoalCelebrationDance2Exit,context:this}),a.GoalCelebrationKneeslide.onEnter({sender:this.entity,receiver:this.onGoalCelebrationKneeslideEnter,context:this}),a.GoalCelebrationKneeslide.onExit({sender:this.entity,receiver:this.onGoalCelebrationKneeslideExit,context:this}),a.AIGoalkeeperCatchBall.onEnter({sender:this.entity,receiver:this.onCatchBallEnter,context:this});this.stadium.pitch;this.grassEmitter=this.stadium.grass.createEmitter(this.entity),this.hitEmitter=new d({spawnRate:0,spreadX:235,spreadY:235,particleMaxLife:.666,particleMinLife:.1225,emitMinForce:.5,emitMaxForce:2});var n=t.BaseTexture.fromImage("images/particles/hit.png");this.dustTextures=[new t.Texture(n,new t.Rectangle(0,0,32,32)),new t.Texture(n,new t.Rectangle(32,0,32,32)),new t.Texture(n,new t.Rectangle(64,0,32,32)),new t.Texture(n,new t.Rectangle(96,0,32,32)),new t.Texture(n,new t.Rectangle(0,32,32,32))],d.onEmit({sender:this.hitEmitter,receiver:this.onHitEmit.bind(this)})}var r=require("settings"),s=require("nebula/format"),o=(require("nebula/numbers"),require("nebula/random"),require("nebula/easings"),require("player").Player),a=require("players/states"),h=require("nebula/signal"),l=r("DEBUG"),u=require("nebula/math/point2"),c=require("nebula/math/vector2"),p=require("renderers/base"),d=require("emitter"),f=(require("renderers/sprite"),require("renderers/movie_clip")),m=require("spine/skeleton_json"),g=require("shaders/outline"),y=(require("nebula/colors/rgb"),new m),v=new t.Rectangle(0,0,0,0);return i.prototype=Object.create(e.prototype),i.onSkinChange=new h,i.onSkinReplace=new h,i.prototype.reset=function(){this.state.setAnimationByName(0,"idle",!0),this.setAnimation("emotion_eyes_normal",!0,1),this.setAnimation("emotion_mouth_normal",!0,2),this.update(0)},i.prototype.createSprite=function(e,i){var n=e.name,r=null;-1!==n.indexOf("eyebrows")&&(r=this.eyebrowPoints);var s=t.Texture.fromFrame(n),o=new t.Sprite(s);s=t.Texture.fromCanvas(t.CanvasTinter.getTintedTexture(o,i)),r[0].x=-s.width/2,r[2].x=s.width/2;var a=new t.mesh.Rope(s,r);return a.scale=e.scale,a.rotation=e.rotation,a},i.prototype.unloadSkin=function(){for(var e=0;e<this.skeleton.slots.length;e++)this.skeleton.slots[e].attachment=null;for(var e in this.spriteContainers)this.spriteContainers[e].texture=t.Texture.EMPTY;this.sprites={}},i.prototype.replaceSkins=function(t){this.spineData.skins=t,i.onSkinReplace.send(this)},i.prototype.setSkin=function(e){this.skinName=e,this.skeleton.setSkinByName(e),this.setAnimation("emotion_eyes_normal",!0,1),this.setAnimation(this.currentAnimation(2)||"emotion_mouth_normal",!0,2),this.update(0),this.ballContainer||(this.ballContainer=new t.Container),this.ballContainer.scale.x=this.ballContainer.scale.y=1/this.scale.x,this.spriteContainers.hand_right_accessory.addChild(this.ballContainer),i.onSkinChange.send(this)},i.prototype.setAnimationMixes=function(){for(var t=[],e=this.skeleton.data.animations,i=0;i<e.length;i++)t.push(e[i].name);for(var i=0;i<t.length;i++)for(var n=t[i],r=i+1;r<t.length;r++){var s=t[r],o="_back"===n.substr(-5),a="_back"===s.substr(-5);o!==a&&(this.state.data.setMixByName(n,s,0),this.state.data.setMixByName(s,n,0))}this.state.data.defaultMix=.1},i.prototype.animationExists=function(t){for(var e=this.skeleton.data.animations,i=0;i<e.length;i++)if(e[i].name===t)return!0;return!1},i.prototype.currentAnimation=function(t){return"undefined"==typeof t&&(t=0),this.state.getCurrent(t)?this.state.getCurrent(t).animation.name:null},i.prototype.setAnimation=function(t,e,i){"undefined"==typeof i&&(i=0);var n=this.currentAnimation(i),r=this.facingCamera?"":"_back";if(!n||n!==t+r||this.state.tracks[i].loop!=e){var s=t+r;this.animationExists(s)||(s=t),this.state.setAnimationByName(i,s,e)}},i.prototype.removeAnimation=function(t){"undefined"==typeof t&&(t=0),this.state.clearTrack(t)},i.prototype.addAnimation=function(t,e,i,n){"undefined"==typeof n&&(n=0);var r=this.facingCamera?"":"_back",s=t+r;this.animationExists(s)||(s=t),this.state.addAnimationByName(n,s,e,i)},i.prototype.setDirection=function(t){this.scale.x=Math.abs(this.scale.x)*t,this.sprites.chest_shirt&&(this.sprites.chest_shirt.scale.x=t),this.sprites.number&&(this.sprites.number.scale.x=t)},i.prototype.setFacing=function(t){if(-.5>t){if(this.facingCamera){this.facingCamera=!1;for(var e=0;e<this.state.tracks.length;e++){for(var i=this.state.tracks[e];i;){var n=i.animation.name,r=this.stateData.skeletonData.findAnimation(n+"_back");r&&(i.animation=r),i=i.next}for(i=this.state.tracks[e],i&&(i=i.previous);i;){var n=i.animation.name,r=this.stateData.skeletonData.findAnimation(n+"_back");r&&(i.animation=r),i=i.previous}}}}else if(!this.facingCamera){this.facingCamera=!0;for(var i=this.state.tracks[0];i;){var n=i.animation.name;"_back"===n.substr(-5)&&(n=n.slice(0,-5)),i.animation=this.stateData.skeletonData.findAnimation(n),i=i.next}for(i=this.state.tracks[0],i&&(i=i.previous);i;){var n=i.animation.name;"_back"===n.substr(-5)&&(n=n.slice(0,-5)),i.animation=this.stateData.skeletonData.findAnimation(n),i=i.previous}}},i.prototype.blink=function(t){this.blinkDelay-=t,this.blinkDelay>0||"emotion_eyes_normal"!==this.currentAnimation(1)||(this.blinkDelay=1+3*Math.random(),this.setAnimation("emotion_eyes_blink",!0,1),this.addAnimation("emotion_eyes_normal",!0,.125,1))},i.prototype.update=function(t){this.facingCamera&&this.autoBlink&&this.blink(t),e.prototype.update.call(this,t)},i.prototype.mergeBounds=function(e,i,n,r){var s,o=1/0,a=1/0,h=-(1/0),l=-(1/0);return e&&e.visible&&e.texture!==t.Texture.EMPTY&&(s=e.getBounds(),o=Math.min(s.x,o),a=Math.min(s.y,a),h=Math.max(s.x+s.width,h),l=Math.max(s.y+s.height,l)),i&&i.visible&&i.texture!==t.Texture.EMPTY&&(s=i.getBounds(),o=Math.min(s.x,o),a=Math.min(s.y,a),h=Math.max(s.x+s.width,h),l=Math.max(s.y+s.height,l)),n&&n.visible&&n.texture!==t.Texture.EMPTY&&(s=n.getBounds(),o=Math.min(s.x,o),a=Math.min(s.y,a),h=Math.max(s.x+s.width,h),l=Math.max(s.y+s.height,l)),r&&r.visible&&r.texture!==t.Texture.EMPTY&&(s=r.getBounds(),o=Math.min(s.x,o),a=Math.min(s.y,a),h=Math.max(s.x+s.width,h),l=Math.max(s.y+s.height,l)),v.x=o,v.y=a,v.width=h-o,v.height=l-a,o!==1/0?v:null},i.prototype.getLeftArmBounds=function(){return this.mergeBounds(this.sprites.arm_left,this.sprites.arm_left_sleeve,this.sprites.hand_left)},i.prototype.getRightArmBounds=function(){return this.mergeBounds(this.sprites.arm_right,this.sprites.arm_right_sleeve,this.sprites.hand_right)},i.prototype.getLeftLegBounds=function(){return this.mergeBounds(this.sprites.leg_left_knee,this.sprites.leg_left_shoe,this.sprites.leg_left_shorts,this.sprites.leg_left_sock)},i.prototype.getRightLegBounds=function(){return this.mergeBounds(this.sprites.leg_right_knee,this.sprites.leg_right_shoe,this.sprites.leg_right_shorts,this.sprites.leg_right_sock)},i.prototype.getChestBounds=function(){return this.mergeBounds(this.sprites.chest_shirt,this.sprites.pelvis_shorts)},i.prototype.getHeadBounds=function(){return this.mergeBounds(this.sprites.head,this.sprites.hair)},i.prototype.getLeftShoeBounds=function(){return this.mergeBounds(this.sprites.leg_left_shoe)},i.prototype.getRightShoeBounds=function(){return this.mergeBounds(this.sprites.leg_right_shoe)},n.onAnimationEvent=new h,n.prototype=Object.create(p.prototype),n._hitUpdate=function(t){this.baseRendererUpdate(t),this._currentFrame=(1-this.entity.life/this.entity.maxLife)*(this.sprite.textures.length-1)},n.prototype.onHitEmit=function(t,e){var i=new f({entity:e,stadium:this.stadium,textures:this.dustTextures});i.sprite.anchor.y=1,i.sprite.width=10,i.sprite.height=25,i.sprite.rotation=Math.atan2(-e.velocity.z,e.velocity.x)+Math.PI/2,i.update=n._hitUpdate,this.stadium.pitch.entities.add(i),this.stadium.sortables.addChild(i)},n.prototype._onAnimationEvent=function(t,e){n.onAnimationEvent.send(e.data.name,this,e.data)},n.prototype.onKick=function(t,e,i,n){this.grassEmitter.emitMaxForce=n,this.grassEmitter.particleMaxLife=2,this.grassEmitter.direction.x=i.x,this.grassEmitter.direction.y=i.y,this.grassEmitter.direction.z=.25,this.grassEmitter.spawnRate=10,this.grassEmitter.update(1*t.pitch.timeScale)},n.prototype.onHeadKick=function(t,e,i,n){this.hitEmitter.direction.x=i.x,this.hitEmitter.direction.y=i.y,this.hitEmitter.direction.z=1,this.hitEmitter.oldPosition.x=this.hitEmitter.position.x=this.entity.position.x,this.hitEmitter.oldPosition.y=this.hitEmitter.position.y=this.entity.position.y+.05,this.hitEmitter.oldPosition.z=this.hitEmitter.position.z=this.entity.position.z+this.entity.height,this.hitEmitter.spawnRate=20,this.hitEmitter.update(1*t.pitch.timeScale),this.hitEmitter.spawnRate=0,this.checkFacing(),this.spine.setAnimation("head_kick",!1),this.spine.addAnimation("idle",!0,0)},n.prototype.onBallHold=function(t){var e=this.stadium.ballRenderer;this.spine.ballContainer.addChild(e.sprite),e.sprite.position.y=0},n.prototype.onBallDrop=function(t){var e=this.stadium.ballRenderer;e.addChild(e.sprite)},n.prototype.onTeamSelect=function(){this.checkFacing(),this.spine.setAnimation("waving",!0,3),this.spine.setAnimation("emotion_mouth_smile",!0,2)},n.prototype.onTeamUnselect=function(){this.checkFacing(),this.spine.setAnimation("emotion_mouth_normal",!0,2),this.spine.removeAnimation(3)},n.prototype.onJumpToBallEnter=function(){this.checkFacing(),this.spine.setAnimation("jump",!1),this.spine.setAnimation("hands_in_front",!0,3),this.spine.addAnimation("idle",!1,0)},n.prototype.onJumpToBallExit=function(){this.checkFacing(),this.spine.setAnimation("idle",!1,0),this.spine.setAnimation("hands_in_front",!1,3)},n.prototype.onKickEnter=function(){this.checkFacing(),this.spine.setAnimation("shoot",!1),this.spine.addAnimation("idle",!1,0)},n.prototype.onSlideEnter=function(){this.checkFacing(),this.spine.setAnimation("slide",!1),this.spine.addAnimation("idle",!1,0)},n.prototype.onCatchBallEnter=function(t,e,i){this.checkFacing(),this.spine.setAnimation("fall_forward",!1),this.spine.addAnimation("laying_on_stomach",!1,0),this.spine.addAnimation("stand_up_from_stomach",!1,i),this.spine.addAnimation("idle",!0,0)},n.prototype.onSlideExit=function(){this.spine.setAnimation("idle",!1)},n.prototype.onSupershotEnter=function(){this.checkFacing(),this.spine.setAnimation("supershot",!1),this.spine.addAnimation("idle",!1,0)},n.prototype.onSupershotExit=function(){this.spine.setAnimation("idle",!1)},n.prototype.onHitEnter=function(t,e,i,n,s){this.hitEmitter.direction.x=-t.velocity.x,this.hitEmitter.direction.y=-t.velocity.y,this.hitEmitter.direction.z=0,this.hitEmitter.oldPosition.x=this.hitEmitter.position.x=this.entity.position.x,this.hitEmitter.oldPosition.y=this.hitEmitter.position.y=this.entity.position.y+.05,this.hitEmitter.oldPosition.z=this.hitEmitter.position.z=.25,this.hitEmitter.spawnRate=10,this.hitEmitter.update(1*t.pitch.timeScale),this.hitEmitter.spawnRate=0;var o=this.entity.positionInFrontOfPlayer(u.temp(this.entity.position.x+t.velocity.x,this.entity.position.y+t.velocity.y)),a=this.entity.positionInFrontOfPlayer(u.temp(this.entity.position.x+this.entity.velocity.x,this.entity.position.y+this.entity.velocity.y));this.checkFacing(),a&&this.entity.speed>r("PLAYER_WALK_SPEED",0)&&!n||o&&n?(this.spine.setAnimation("fall_forward",!1),this.spine.addAnimation("laying_on_stomach",!1,0),this.spine.addAnimation("stand_up_from_stomach",!1,i)):(this.spine.setAnimation("fall_backwards",!1),this.spine.addAnimation("sitting",!1,0),this.spine.addAnimation("stand_up_from_sitting",!1,i)),this.spine.addAnimation("idle",!0,0),this.spine.setAnimation("emotion_eyes_dead",!1,1),this.spine.addAnimation("emotion_eyes_normal",!0,i,1),this.spine.setAnimation("emotion_mouth_dead",!0,2),this.spine.addAnimation("emotion_mouth_normal",!0,i+.4,2)},n.prototype.onHitExit=function(){this.checkFacing(),this.spine.setAnimation("idle",!0),this.spine.setAnimation("emotion_eyes_normal",!0,1),this.spine.setAnimation("emotion_mouth_normal",!0,2)},n.prototype.onJumpEnter=function(){this.checkFacing(),this.spine.setAnimation("jump",!1),this.spine.addAnimation("idle",!0,0)},n.prototype.onThrowInPickUpBallEnter=function(){this.checkFacing(),this.spine.setAnimation("pick_up",!1),this.spine.addAnimation("throw_prepare",!1,0),this.spine.addAnimation("throw_holding_ball_up",!0,0)},n.prototype.onThrowInThrowEnter=function(){this.checkFacing(),this.spine.setAnimation("throw",!1),this.spine.addAnimation("idle",!1,0)},n.prototype.onGoalCelebrationEnter=function(){this.checkFacing(),this.autoEmotions=!1,this.spine.eyebrowPoints[1].y=-10,this.spine.setAnimation("waving",!0,3),this.spine.setAnimation("emotion_mouth_smile",!0,2)},n.prototype.onGoalCelebrationExit=function(){this.checkFacing(),this.autoEmotions=!0,this.spine.setAnimation("idle",!1),this.spine.setAnimation("emotion_mouth_normal",!0,2),this.spine.removeAnimation(3)},n.prototype.onGoalCelebrationPlaneEnter=function(){this.checkFacing(),this.autoEmotions=!1,this.spine.eyebrowPoints[1].y=-10,this.spine.setAnimation("fall_forward",!1),this.spine.addAnimation("laying_on_stomach",!1,0),this.spine.addAnimation("stand_up_from_stomach",!1,2),this.spine.setAnimation("emotion_mouth_smile",!0,2),this.spine.removeAnimation(3)},n.prototype.onGoalCelebrationPlaneExit=function(){this.checkFacing(),this.autoEmotions=!0,this.spine.setAnimation("idle",!1),this.spine.setAnimation("emotion_mouth_normal",!0,2),this.spine.removeAnimation(3)},n.prototype.onGoalCelebrationDanceEnter=function(){this.checkFacing(),this.autoEmotions=!1,this.spine.eyebrowPoints[1].y=-10,this.spine.setAnimation("dance",!0),this.spine.setAnimation("emotion_mouth_smile",!0,2),this.spine.removeAnimation(3)},n.prototype.onGoalCelebrationDanceExit=function(){this.checkFacing(),this.autoEmotions=!0,this.spine.setAnimation("idle",!1),this.spine.setAnimation("emotion_mouth_normal",!0,2),this.spine.removeAnimation(3)},n.prototype.onGoalCelebrationDance2Enter=function(){this.checkFacing(),this.autoEmotions=!1,this.spine.eyebrowPoints[1].y=-10,this.spine.setAnimation("dance2",!0),this.spine.setAnimation("emotion_mouth_smile",!0,2),this.spine.removeAnimation(3)},n.prototype.onGoalCelebrationDance2Exit=function(){this.checkFacing(),this.autoEmotions=!0,this.spine.setAnimation("idle",!1),this.spine.setAnimation("emotion_mouth_normal",!0,2),this.spine.removeAnimation(3)},n.prototype.onGoalCelebrationKneeslideEnter=function(){this.checkFacing(),this.autoEmotions=!1,this.spine.eyebrowPoints[1].y=-10,this.spine.setAnimation("knee_slide",!1),this.spine.addAnimation("on_knees",!0),this.spine.setAnimation("emotion_mouth_smile",!0,2),this.spine.setAnimation("waving",!0,3)},n.prototype.onGoalCelebrationKneeslideExit=function(){this.checkFacing(),this.autoEmotions=!0,this.spine.setAnimation("idle",!1),this.spine.setAnimation("emotion_mouth_normal",!0,2),this.spine.removeAnimation(3)},n.prototype.checkDirection=function(){var t=Math.sign(this.entity.facing.x||this.entity.heading.x||this.entity.team.goal.facing.x);this.spine.setDirection(t)},n.prototype.checkFacing=function(){this.spine.setFacing(this.entity.isGoalkeeper||!this.entity.autoFacing?this.entity.facing.y:this.entity.heading.y)},n.prototype.update=function(t){p.prototype.update.call(this,t),this.grassEmitter.spawnRate=this.entity.speed*(1+3*Math.random()),this.grassEmitter.direction.x=-this.entity.heading.x,this.grassEmitter.direction.y=-this.entity.heading.y,this.grassEmitter.direction.z=2,c.rotate(this.grassEmitter.direction,(Math.random()-.5)*Math.PI*.25,this.grassEmitter.direction),this.grassEmitter.emitForce=1,this.grassEmitter.particleLife=1,this.entity.speed>this.entity.sprintSpeed&&(this.grassEmitter.spawnRate*=3,this.grassEmitter.emitForce=2,this.grassEmitter.direction.z/=3)},n.prototype.render=function(t){this.stadium.worldToScreenFlat(this.entity.position,this.position),this.checkFacing(),this.spine.update(t);var e=this.spine.currentAnimation();e||this.spine.setAnimation("idle",!0);var i=this.entity.speed-.05,n=0===this.entity.velocity.x?!1:Math.sign(this.entity.facing.x)!==Math.sign(this.entity.velocity.x);if(this.moveAnimations.indexOf(e)>=0){var r=this.spine.state.tracks[0].time/this.spine.state.tracks[0].endTime%1,o=this.spine.currentAnimation();i>this.entity.runSpeed?this.spine.setAnimation("sprint",!0):i>this.entity.walkSpeed?n?this.spine.setAnimation("run_backwards",!0):i>.8*this.entity.runSpeed?this.spine.setAnimation("run2",!0):this.spine.setAnimation("run",!0):i>0?n?this.spine.setAnimation("walk_backwards",!0):this.spine.setAnimation("walk",!0):this.spine.setAnimation("idle",!0),this.spine.currentAnimation()!==o&&(this.spine.state.tracks[0].time=this.spine.state.tracks[0].endTime*r)}this.checkDirection(),l&&(this.stateLabel.text=s("%d\n%s\n%s",this.entity.id,this.entity.controlled?"controlled":this.entity.states.name,this.spine.currentAnimation())),this.autoEmotions&&(this.spine.eyebrowPoints[1].y=20*(Math.min(1,i/this.entity.runSpeed)-.5)),this.tempMatrix.tx=.5*this.renderTexture.width,this.tempMatrix.ty=this.renderTexture.height-10,this.renderTexture.render(this.spine,this.tempMatrix,!0),this.sprite.position.y=-this.entity.position.z*this.stadium.pixelsZ+10*this.spine.scale.y,this.sprite.scale.x=this.spine.scale.x,this.hitEmitter.update(t)},n.prototype.renderWebGL=function(t){this.spine.visible=!1,p.prototype.renderWebGL.call(this,t),this.spine.visible=!0},n.prototype.add=function(){this.spine.state.onEvent=this._onAnimationEvent.bind(this)},n.prototype.remove=function(){this.grassEmitter.spawnRate=0,this.spine.state.onEvent=null},{PlayerRenderer:n,PlayerSpine:i}}),define("renderers/shadow",function(){"use strict";function t(t,i,n,r,s){e.Sprite.call(this),r=r||1024,s=s||512,this.shadowTexture=new e.RenderTexture(t,r,s),this.offscreenScale={x:i/r,y:n/s},this.offscreenScaleInv={x:1/this.offscreenScale.x,y:1/this.offscreenScale.y},this.texture=this.shadowTexture,this.alpha=1/3,this.scale.set(this.offscreenScale.x,this.offscreenScale.y),this.offscreenStage=new e.Container,this._shadowIndex=0,this.autoShadows=new e.ParticleContainer(1e3,{alpha:!0,rotation:!0,scale:!0,uvs:!0},1e3),this.offscreenStage.addChild(this.autoShadows),this.spriteShadows=new e.Container,this.spriteShadows.scale.set(this.offscreenScaleInv.x,this.offscreenScaleInv.x),this.offscreenStage.addChild(this.spriteShadows),this.shadowCircle=e.Texture.fromImage("images/shadow.png")}var e=require("pixi");return t.prototype=Object.create(e.Sprite.prototype),t.prototype.addSprite=function(t){this.spriteShadows.addChild(t)},t.prototype.removeSprite=function(t){this.spriteShadows.removeChild(t)},t.prototype.drawShadow=function(t,i,n,r,s){var o=this.autoShadows.children[this._shadowIndex];o||(o=new e.Sprite(this.shadowCircle),o.anchor.set(.5,.5),this.autoShadows.addChild(o)),o.position.x=t*this.offscreenScaleInv.x,o.position.y=i*this.offscreenScaleInv.y,o.width=n*this.offscreenScaleInv.x,o.height=r*this.offscreenScaleInv.y,o.alpha="undefined"!=typeof s?s:1,this._shadowIndex++},t.prototype.reset=function(){this.autoShadows.removeChildren(),this._shadowIndex=0},t.prototype.drawPlayer=function(t,e,i){var n=t.getLeftArmBounds();n&&this.drawShadow(n.x+n.width/2,e.y-5,10+.5*n.width,10,i),n=t.getRightArmBounds(),n&&this.drawShadow(n.x+n.width/2,e.y+5,10+.5*n.width,10,i),n=t.getLeftLegBounds(),n&&this.drawShadow(n.x+n.width/2,e.y-3,10+.5*n.width,10,i),n=t.getRightLegBounds(),n&&this.drawShadow(n.x+n.width/2,e.y+3,10+.5*n.width,10,i),n=t.getChestBounds(),n&&this.drawShadow(n.x+n.width/2,e.y,10+.8*n.width,25,i),n=t.getHeadBounds(),n&&this.drawShadow(n.x+n.width/2,e.y,10+.8*n.width,25,i)},t.prototype.updateTransform=function(){this.visible&&(this.shadowTexture.clear(),this.shadowTexture.render(this.offscreenStage),e.Sprite.prototype.updateTransform.call(this))},t.prototype._renderWebGL=function(t){e.Sprite.prototype._renderWebGL.call(this,t);for(var i=this._shadowIndex;i<this.autoShadows.children.length;i++)this.autoShadows.removeChildAt(i);this._shadowIndex=0},t}),define("renderers/sight",function(){"use strict";function t(t){e.Container.call(this),this.stadium=t.stadium,this._objectPosition=i.create(),this._renderPosition=i.create(),this._from=i.create(),this._to=i.create();var r=e.Texture.fromFrame("indicators/sight.png"),s=new e.Sprite(r),o=e.Texture.fromCanvas(e.CanvasTinter.getTintedTexture(s,0));this.container=new e.Container,this.points=n.array(30),this.line=new e.mesh.Rope(r,this.points),this.shadow=new e.mesh.Rope(o,this.points),this.shadow.position.y=2,this.shadow.alpha=.5,this.container.addChild(this.shadow),this.container.addChild(this.line),this.addChild(this.container),this.hide()}var e=require("pixi"),i=require("nebula/math/point2"),n=require("nebula/math/point3"),r=(require("nebula/math/vector2"),require("settings"));r("USER_COLORS",[]);return t.prototype=Object.create(e.Container.prototype),t.prototype.show=function(){this.visible=!0},t.prototype.hide=function(){this.visible=!1},t.prototype.trajectory=function(t){for(var e=0;e<this.points.length;e++)this.stadium.worldToScreenFlat(t[e],this.points[e])},t}),define("renderers/sight2",function(){"use strict";function t(t){e.Container.call(this),this.stadium=t.stadium,this.scale.y=.58,this.player=null,this.cameraTarget=i.create(),this.shadow=e.Sprite.fromFrame("indicators/crosshair.png"),this.shadow.position.y=2/this.scale.y,this.shadow.tint=0,this.shadow.alpha=.5,this.shadow.anchor.set(.5,.5),this.addChild(this.shadow),this.crosshair=e.Sprite.fromFrame("indicators/crosshair.png"),this.crosshair.anchor.set(.5,.5),this.addChild(this.crosshair)}var e=require("pixi"),i=require("nebula/math/point2");require("nebula/math/point3"),require("nebula/math/vector2"),require("players/states");return t.prototype=Object.create(e.Container.prototype),t.prototype.render=function(){this.shadow.rotation+=Math.PI/180,this.crosshair.rotation=this.shadow.rotation,this.player&&this.player.states.current.sight&&this.stadium.worldToScreen(this.player.states.current.sight.position,this.position)},t}),define("renderers/interface/text",function(){"use strict";function t(t){e.Text.apply(this,[t||""]),this.tempCanvas=document.createElement("canvas"),this.tempContext=this.tempCanvas.getContext("2d");var i=this.context.createLinearGradient(0,0,0,100);i.addColorStop(0,"#f2f2f2"),i.addColorStop(1,"#d3d4d4"),this.style={fill:i,lineHeight:300,
dropShadow:!0,dropShadowAngle:2*Math.PI,dropShadowColor:"#7297a8",dropShadowDistance:5,innerShadow:!0,innerShadowAngle:45*Math.PI/180,innerShadowColor:"#ffffff",innerShadowDistance:3,stroke:"#163f66",strokeThickness:5},this.style.fontSize=200,this.style.fontFamily=""}var e=require("pixi");return t.prototype=Object.create(e.Text.prototype),t.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.font,this.tempContext.font=this.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],n=0,r=this.determineFontProperties(this.font),s=0;s<e.length;s++){var o=this.context.measureText(e[s]).width;i[s]=o,n=Math.max(n,o)}var a=n+this.style.strokeThickness;this.style.dropShadow&&(a+=this.style.dropShadowDistance),this.canvas.width=(a+this.context.lineWidth)*this.resolution;var h=this.style.lineHeight||r.fontSize+this.style.strokeThickness,l=h*(e.length-1)+r.fontSize;this.style.dropShadow&&(l+=this.style.dropShadowDistance),this.canvas.height=l*this.resolution,this.tempCanvas.width=this.canvas.width,this.tempCanvas.height=this.canvas.height,this.context.scale(this.resolution,this.resolution),this.tempContext.scale(this.resolution,this.resolution),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.tempContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.context.lineJoin=this.style.lineJoin,this.tempContext.font=this.font,this.tempContext.strokeStyle=this.style.stroke,this.tempContext.lineWidth=this.style.strokeThickness,this.tempContext.textBaseline="alphabetic",this.tempContext.lineJoin=this.style.lineJoin;var u,c;if(this.style.strokeThickness){this.context.fillStyle=this.style.stroke;for(var p=Math.sin(this.style.dropShadowAngle)*(this.style.dropShadowDistance+1),d=Math.cos(this.style.dropShadowAngle)*(this.style.dropShadowDistance+1),f=Math.max(this.style.dropShadowDistance+1,1),m=0;f>m;m++)for(s=0;s<e.length;s++)u=this.style.strokeThickness/2,c=this.style.strokeThickness/2+s*h+r.ascent,"right"===this.style.align?u+=n-i[s]:"center"===this.style.align&&(u+=(n-i[s])/2),this.context.strokeText(e[s],u+p*m/f,c+d*m/f)}if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var p=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,d=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(s=0;s<e.length;s++)u=this.style.strokeThickness/2,c=this.style.strokeThickness/2+s*h+r.ascent,"right"===this.style.align?u+=n-i[s]:"center"===this.style.align&&(u+=(n-i[s])/2),this.style.fill&&this.context.fillText(e[s],u+p,c+d)}for(this.context.fillStyle=this.style.fill,s=0;s<e.length;s++)u=this.style.strokeThickness/2,c=this.style.strokeThickness/2+s*h+r.ascent,"right"===this.style.align?u+=n-i[s]:"center"===this.style.align&&(u+=(n-i[s])/2),this.style.fill&&this.context.fillText(e[s],u,c);if(this.style.innerShadow){var g=this.tempContext.globalCompositeOperation;for(this.tempContext.fillStyle=this.style.innerShadowColor,s=0;s<e.length;s++)u=this.style.strokeThickness/2,c=this.style.strokeThickness/2+s*h+r.ascent,"right"===this.style.align?u+=n-i[s]:"center"===this.style.align&&(u+=(n-i[s])/2),this.tempContext.fillText(e[s],u,c);this.tempContext.globalCompositeOperation="destination-out";var p=Math.sin(this.style.innerShadowAngle)*this.style.innerShadowDistance,d=Math.cos(this.style.innerShadowAngle)*this.style.innerShadowDistance;for(s=0;s<e.length;s++)u=this.style.strokeThickness/2,c=this.style.strokeThickness/2+s*h+r.ascent,"right"===this.style.align?u+=n-i[s]:"center"===this.style.align&&(u+=(n-i[s])/2),this.tempContext.fillText(e[s],u+p,c+d);this.tempContext.globalCompositeOperation=g,this.context.drawImage(this.tempCanvas,0,0)}this.updateTexture()},Object.defineProperty(t.prototype,"font",{get:function(){return this.style.fontSize+"px "+this.style.fontFamily}}),t}),define("renderers/interface/sign",function(){"use strict";function t(t,i){e.Container.call(this),this.id=t,this.time=0,this.life=10,this.letterDelay=.06,this.letterShowDuration=.33,this.timeScale=i.timeScale||1,this.outDelay=i.outDelay||0,this.wiggle=Boolean(i.wiggle),this.visible=!1,this.text=i.text,"scale"in i&&this.scale.set(i.scale,i.scale),this.fontSize=i.fontSize||200,this.updateText()}var e=require("pixi"),i=require("nebula/easings");return t.prototype=Object.create(e.Container.prototype),t.prototype.updateText=function(){var t=0,i=String(this.text);this.removeChildren();for(var n=0;n<i.length;n++){var r=e.Sprite.fromFrame("char_"+this.fontSize+"_"+i[n]);r.anchor.set(.5,.5),t+=r.width,this.addChild(r)}this.children[0].position.x=-t/2+this.children[0].width/2;for(var n=1;n<this.children.length;n++)this.children[n].position.x=this.children[n-1].position.x+this.children[n-1].width/2+this.children[n].width/2},t.prototype.show=function(){this.visible=!0,this.time=0},t.prototype.hide=function(){this.visible=!1},t.prototype.update=function(t){this.time+=t;for(var e=0;e<this.children.length;e++){var n=this.children[e],r=e*this.letterDelay,s=e*this.letterDelay+this.outDelay,o=0;this.time-r>0&&(o=this.time-s>0?i.back.out(1-Math.max(0,Math.min((this.time-s)/this.letterShowDuration,1))):i.back.out(Math.max(0,Math.min((this.time-r)/this.letterShowDuration,1)))),n.scale.set(o,o)}},t.prototype.render=function(t){if(this.visible&&(this.update(t*this.timeScale),this.time>=this.life&&(this.visible=!1),this.wiggle))for(var e=0;e<this.children.length;e++)this.children[e].rotation=Math.cos(14*this.time+e*Math.PI)*Math.PI/20,this.children[e].y=8*Math.sin(4*this.time+e*Math.PI/4)},t}),define("renderers/interface/skill",function(){"use strict";function t(t){i.Container.call(this),this.team=null,this.scale.x=t?-1:1,this.bar=new i.Container,this.addChild(this.bar),this.barBackground=i.Sprite.fromFrame("interface/match/powerup_bar_background.png"),this.barBackground.position.set(1,0),this.bar.addChild(this.barBackground),this.barFill=i.Sprite.fromFrame("interface/match/powerup_bar_fill.png"),this.barFill.position.set(1,0),this.bar.addChild(this.barFill),this.barMask=new i.Graphics,this.bar.addChild(this.barMask),this.barFill.mask=this.barMask,this.barOverlay=i.Sprite.fromFrame("interface/match/powerup_bar_overlay_"+(t?"left":"right")+".png"),this.bar.addChild(this.barOverlay),this.icon=new i.Container,this.icon.position.set(170,-18),this.addChild(this.icon),this.icon.glow=i.Sprite.fromFrame("interface/match/powerup_glow.png"),this.icon.glow.anchor.set(.5,.5),this.icon.glow.alpha=0,this.icon.glow.blendMode=i.BLEND_MODES.ADD,this.icon.addChild(this.icon.glow);var r=function(t){return 1-.5*(Math.cos(t*Math.PI*2*2)+1)},s=function(t){return Math.sin(t*Math.PI*2)};this.glowAnimation=new n.Timeline(this.icon.glow),this.glowAnimation.to({rotation:e.radians(360),"scale.x":{to:.75,easing:r},"scale.y":{to:.75,easing:r}},10),this.glowAnimation.to({rotation:0,"scale.x":1,"scale.y":1},0),this.glowAnimation.repeat(1/0),this.icon.glow2=i.Sprite.fromFrame("interface/match/powerup_glow.png"),this.icon.glow2.anchor.set(.5,.5),this.icon.glow2.alpha=0,this.icon.glow2.blendMode=i.BLEND_MODES.ADD,this.icon.addChild(this.icon.glow2),this.glow2Animation=new n.Timeline(this.icon.glow2),this.glow2Animation.to({rotation:{to:e.radians(10),easing:s},"scale.x":{to:1.2,easing:r},"scale.y":{to:.8,easing:r}},2),this.glow2Animation.to({rotation:0,"scale.x":1,"scale.y":1},0),this.glow2Animation.repeat(1/0),this.glowShow=new n.Timeline(this.icon),this.glowShow.to({"glow.alpha":.5,"glow2.alpha":1},.25),this.glowHide=new n.Timeline(this.icon),this.glowHide.to({"glow.alpha":0,"glow2.alpha":0},.25),this.iconContainer=new i.Container,this.icon.addChild(this.iconContainer),this.icon.thumbnail=new i.Sprite,this.icon.thumbnail.position.set(-25,-25),this.icon.thumbnail.scale.x=this.scale.x,this.icon.thumbnail.anchor.set(t?1:0,0),this.iconContainer.addChild(this.icon.thumbnail),this.iconAnimation=new n.Timeline(this.iconContainer),this.iconAnimation.to({rotation:{to:e.radians(5),easing:s},"scale.x":{to:1.1,easing:r},"scale.y":{to:.9,easing:r}},1.5),this.iconAnimation.to({rotation:0,"scale.x":1,"scale.y":1},0),this.iconAnimation.repeat(1/0),this.setBar(0)}var e=require("nebula/numbers"),i=require("pixi"),n=require("nebula/tweens"),r=require("team").Team;require("skill");return t.prototype=Object.create(i.Container.prototype),t.prototype.enable=function(t){this.team=t,r.onSupermoveProgress({sender:t,receiver:this.updateBar,context:this}),r.onSupermoveGain({sender:t,receiver:this.setSupermove,context:this}),r.onSupermoveUse({sender:t,receiver:this.clearSupermove,context:this})},t.prototype.disable=function(){this.team&&(r.onSupermoveProgress.disconnect({sender:this.team,receiver:this.updateBar,context:this}),r.onSupermoveGain.disconnect({sender:this.team,receiver:this.setSupermove,context:this}),r.onSupermoveUse.disconnect({sender:this.team,receiver:this.clearSupermove,context:this}),this.team=null)},t.prototype.swapTeam=function(){var t=this.team;this.disable(),this.enable(t.opponents),n.stop(this.glowShow),n.stop(this.glowHide),n.stop(this.glowAnimation),n.stop(this.glow2Animation),n.stop(this.iconAnimation),this.team.supermoves.length?(this.setSupermove(this.team,this.team.supermoves[0]),this.icon.glow.alpha=1,this.icon.glow2.alpha=1):(this.clearSupermove(),this.icon.glow.alpha=0,this.icon.glow2.alpha=0,this.iconContainer.rotation=0,this.iconContainer.scale.set(1,1))},t.prototype.setSupermove=function(t,e){e===this.team.supermoves[0]&&(this.setIcon("images/powerups/"+e+"/icon.png"),n.play(this.glowShow),n.play(this.glowAnimation),n.play(this.glow2Animation),n.play(this.iconAnimation))},t.prototype.clearSupermove=function(){this.setIcon("interface/match/powerup_placeholder.png"),n.play(this.glowHide),n.stop(this.glowAnimation),n.stop(this.glow2Animation),n.stop(this.iconAnimation),this.iconContainer.rotation=0,this.iconContainer.scale.set(1,1)},t.prototype.setIcon=function(t){var e=i.Texture.fromImage(t),n=e.frame,r=i.Texture.fromFrame("interface/match/powerup_overlay.png"),s=i.Texture.fromFrame("interface/match/powerup_mask.png");this.icon.thumbnail.texture!==i.Texture.EMPTY&&this.icon.thumbnail.texture.destroy(!0),this.icon.thumbnail.texture=i.Texture.fromCanvas(this.applyIconMask(e.baseTexture.source,50,50,1-n.x,1-n.y,s.baseTexture.source,1-s.frame.x,-s.frame.y,r.baseTexture.source,-r.frame.x,-r.frame.y,this.scale.x<0))},t.prototype.updateBar=function(t,e){this.setBar(Math.min(1,e/this.team.supermovesScoreNeeded))},t.prototype.setBar=function(t){t=e.clamp(t,0,1),this.bar._value=t;var i=184;this.barMask.clear(),this.barMask.lineStyle(0);var n=t*i||1;n>0&&(this.barMask.beginFill(0,1),this.barMask.drawRect(0,0,n,16),this.barMask.endFill())},t.prototype.reset=function(){this.barValue=0,this.clearSupermove()},t.prototype.applyIconMask=function(t,e,i,n,r,s,o,a,h,l,u,c,p){var d=document.createElement("canvas");d.width=e,d.height=i;var f=d.getContext("2d");f.save(),f.drawImage(t,n,r);var m=f.getImageData(0,0,d.width,d.height);(c||p)&&(f.translate(d.width/2,d.height/2),f.scale(c?-1:1,p?-1:1),f.translate(-d.width/2,-d.height/2)),f.fillStyle=0,f.fillRect(0,0,d.width,d.height),f.drawImage(s,o,a);for(var g=f.getImageData(0,0,d.width,d.height),y=0;y<m.data.length;y+=4)m.data[y+3]=g.data[y];return f.putImageData(m,0,0),f.drawImage(h,l,u),f.restore(),d},Object.defineProperty(t.prototype,"barValue",{get:function(){return this.bar._value},set:function(t){this.setBar(t)}}),t}),define("renderers/interface/score",function(){"use strict";function t(t){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={mask:{type:"sampler2D",value:t}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D mask;","void main(void) {","float alpha = texture2D(mask, vTextureCoord).r;","vec4 fragment = texture2D(uSampler, vTextureCoord);","gl_FragColor = fragment * alpha;","}"]}function e(t,e,i){var r=a.create(),s=a.create();a.fromNumber(e,r),a.fromNumber(i,s);var o=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float angle;","uniform vec4 uFrame;","uniform vec4 color1;","uniform vec4 color2;","float PI     = 3.1415629;","float TWOPI  = 6.2831853;","void main(void) {","    vec2 r = (vTextureCoord.xy - uFrame.xy) / uFrame.zw;","    float x = r.x*2.0 - 1.0;","    float y = r.y*2.0 - 1.0;","    float d = x * x + y * y;","    vec4 f = texture2D(uSampler, vTextureCoord);","    if (d < 0.5) {","        d = 1.0 - f.a;","        if (d > 0.0) {","            float a = atan(x, -y);","            if (a < 0.0) {","                a += TWOPI;","            }","            if (a < angle * TWOPI) {","                f += color2 * d;","            } else {","                f += color1 * d;","            };","        };","    }","    gl_FragColor = f;","}"],h={uFrame:{type:"4fv",value:[t.x0,t.y0,t.x2-t.x0,t.y2-t.y0]},angle:{type:"1f",value:.5},color1:{type:"4fv",value:[r.r,r.g,r.b,1]},color2:{type:"4fv",value:[s.r,s.g,s.b,1]}};n.AbstractFilter.call(this,null,o.join("\n"),h)}function i(t){n.Container.call(this),this.frame=n.Sprite.fromFrame("interface/match/score_frame.png"),this.frame.position.set(-204,-30),this.addChild(this.frame),this.swapFlags=this.swapFlags.bind(this),this.swapScore=this.swapScore.bind(this),this.swapPowerups=this.swapPowerups.bind(this),this.redFlag=new n.Sprite,this.redFlag.anchor.set(.5,.5),this.redFlag.position.set(-127,0),this.addChild(this.redFlag),this.blueFlag=new n.Sprite,this.blueFlag.anchor.set(.5,.5),this.blueFlag.position.set(128,0),this.addChild(this.blueFlag),this.redFlagRight=this.redFlagLeft=this.blueFlagRight=this.blueFlagLeft=n.Texture.EMPTY,this.flagAnimation=new s.Timeline(this),this.flagAnimation.to({"redFlag.scale.x":0,"redFlag.scale.y":0,"blueFlag.scale.x":0,"blueFlag.scale.y":0},.25,"back.in").call(this.swapFlags),this.flagAnimation.to({"redFlag.scale.x":1,"redFlag.scale.y":1,"blueFlag.scale.x":1,"blueFlag.scale.y":1},.25,"exponential.out"),this.redScore=new n.Text("0",h),this.redScore.position.set(-50,2),this.redScore.anchor.set(.5,.5),this.addChild(this.redScore),this.blueScore=new n.Text("0",h),this.blueScore.position.set(50,2),this.blueScore.anchor.set(.5,.5),this.addChild(this.blueScore),this.time=new n.Text("00:00",l),this.time.position.set(0,22),this.time.anchor.set(.5,0),this.addChild(this.time),this.scoreAnimation=new s.Timeline(this),this.scoreAnimation.to({"redScore.alpha":0,"blueScore.alpha":0},.25,"exponential.out").call(this.swapScore),this.scoreAnimation.to({"redScore.alpha":1,"blueScore.alpha":1},.25,"exponential.in"),this.timeColor1=16635191,this.timeColor2=11954216,this.clock=n.Sprite.fromFrame("interface/match/clock.png"),this.clock.anchor.set(.5,.5),this.clock.position.set(0,-4),this.clock.shader=new e(this.clock.texture._uvs,this.timeColor1,this.timeColor2),this.addChild(this.clock),this.skull=n.Sprite.fromFrame("interface/match/skull.png"),this.skull.anchor.set(.5,.5),this.skull.visible=!1,this.addChild(this.skull),this.skullAnimation=new s.Timeline(this.skull),this.skullAnimation.to({"scale.x":1,"scale.y":1},.25,"exponential.out"),this.skullAnimation.to({"scale.x":1.25,"scale.y":1.25},.25,"exponential.in"),this.skullAnimation.repeat(1/0),this.redTeamSkill=new o(!0),this.redTeamSkill.position.set(-25,22),this.addChild(this.redTeamSkill),this.blueTeamSkill=new o,this.blueTeamSkill.position.set(25,22),this.addChild(this.blueTeamSkill),this.skillAnimation=new s.Timeline(this),this.skillAnimation.wait(.0312).to({"blueTeamSkill.icon.scale.x":0,"blueTeamSkill.icon.scale.y":0,"redTeamSkill.icon.scale.x":0,"redTeamSkill.icon.scale.y":0},.25,"back.in").call(this.swapPowerups),this.skillAnimation.to({"blueTeamSkill.icon.scale.x":1,"blueTeamSkill.icon.scale.y":1,"redTeamSkill.icon.scale.x":1,"redTeamSkill.icon.scale.y":1},.25,"exponential.out")}var n=require("pixi"),r=require("nebula/format"),s=require("nebula/tweens"),o=require("renderers/interface/skill"),a=(require("nebula/objects"),require("nebula/colors/rgb")),h={font:'400 24px "Mikodacs", "Nikumaru", sans-serif',fill:"#fff",align:"center",dropShadow:!0,dropShadowColor:"#000",dropShadowDistance:1},l={font:'400 12px "F25 Bank Printer", sans-serif',fill:"#fff",align:"center",dropShadow:!0,dropShadowColor:"#000",dropShadowDistance:1};return t.prototype=Object.create(n.AbstractFilter.prototype),t.prototype.constructor=t,e.prototype=Object.create(n.AbstractFilter.prototype),e.prototype.constructor=e,i.prototype=Object.create(n.Container.prototype),i.prototype.swapFlags=function(){this.redFlag.texture===this.redFlagLeft?(this.blueFlag.texture=this.redFlagRight,this.redFlag.texture=this.blueFlagLeft):(this.blueFlag.texture=this.blueFlagRight,this.redFlag.texture=this.redFlagLeft)},i.prototype.swapScore=function(){var t=this.blueScore.position.x;this.blueScore.position.x=this.redScore.position.x,this.redScore.position.x=t},i.prototype.swapPowerups=function(){this.redTeamSkill.swapTeam(),this.blueTeamSkill.swapTeam()},i.prototype.setFlags=function(t,e){var i=n.Texture.fromFrame("interface/match/flag_overlay.png"),r=n.Texture.fromFrame("interface/match/flag_mask.png");t?(this.redFlagRight=n.Texture.fromCanvas(this.applyFlagMask(t,66,34,1,1,r.baseTexture.source,1-r.frame.x,-r.frame.y,i.baseTexture.source,-i.frame.x,-i.frame.y)),this.redFlagLeft=n.Texture.fromCanvas(this.applyFlagMask(t,66,34,1,1,r.baseTexture.source,1-r.frame.x,-r.frame.y,i.baseTexture.source,-i.frame.x,-i.frame.y,!0))):(this.redFlagRight.destroy(!0),this.redFlagLeft.destroy(!0),this.redFlagRight=this.redFlagLeft=n.Texture.EMPTY),e?(this.blueFlagRight=n.Texture.fromCanvas(this.applyFlagMask(e,66,34,1,1,r.baseTexture.source,1-r.frame.x,-r.frame.y,i.baseTexture.source,-i.frame.x,-i.frame.y)),this.blueFlagLeft=n.Texture.fromCanvas(this.applyFlagMask(e,66,34,1,1,r.baseTexture.source,1-r.frame.x,-r.frame.y,i.baseTexture.source,-i.frame.x,-i.frame.y,!0))):(this.blueFlagRight.destroy(!0),this.blueFlagLeft.destroy(!0),this.blueFlagRight=this.blueFlagLeft=n.Texture.EMPTY),this.redFlag.texture=this.redFlagLeft,this.blueFlag.texture=this.blueFlagRight},i.prototype.setGoals=function(t,e){this.redScore.text=t,this.blueScore.text=e},i.prototype.setClock=function(t,e,i){i?this.timeColor2:this.timeColor1,i?this.timeColor1:this.timeColor2;this.clock.shader.uniforms.angle.value=t;var n=Math.floor(e/60);this.time.text=r("%02i:%02i",n,e%60)},i.prototype.secondHalf=function(){s.stop(this.flagAnimation),s.play(this.flagAnimation),s.stop(this.scoreAnimation),s.play(this.scoreAnimation),s.stop(this.skillAnimation),s.play(this.skillAnimation);var t=this.redTeamSkill.barValue,e=this.blueTeamSkill.barValue;s.create(this.redTeamSkill).to({barValue:e},.5,"back.inOut"),s.create(this.blueTeamSkill).to({barValue:t},.5,"back.inOut")},i.prototype.goldenGoal=function(){this.clock.visible=!1,this.skull.visible=!0,s.play(this.skullAnimation)},i.prototype.reset=function(){this.redScore.position.set(-50,2),this.blueScore.position.set(50,2),this.redTeamSkill.reset(),this.blueTeamSkill.reset(),this.clock.visible=!0,this.skull.visible=!1,this.skull.scale.set(1,1),this.time.text="00:00",this.setGoals(0,0),this.visible=!1,s.stop(this.skullAnimation)},i.prototype.applyFlagMask=function(t,e,i,n,r,s,o,a,h,l,u,c,p){var d=document.createElement("canvas");d.width=e,d.height=i;var f=d.getContext("2d");f.save(),f.drawImage(t,n,r);var m=f.getImageData(0,0,d.width,d.height);(c||p)&&(f.translate(d.width/2,d.height/2),f.scale(c?-1:1,p?-1:1),f.translate(-d.width/2,-d.height/2)),f.fillStyle=0,f.fillRect(0,0,d.width,d.height),f.drawImage(s,o,a);for(var g=f.getImageData(0,0,d.width,d.height),y=0;y<m.data.length;y+=4)m.data[y+3]=g.data[y];return f.putImageData(m,0,0),f.drawImage(h,l,u),f.restore(),d},i}),define("renderers/interface/avatar",function(){"use strict";function t(t){i.Container.call(this),this.spine=new s(t.spine),this.spine.autoBlink=!1,this.spine.scale.set(.75,.75),this.spine.position.set(50,140),this.isLeft=t.isLeft,t.isLeft||(this.spine.scale.x*=-1),this.tempStage=new i.Container,this.tempStage.addChild(this.spine),this.background=i.Sprite.fromFrame("interface/match/avatar_background2.png"),this.background.anchor.set(.5,1),this.background.position.set(-6,8),this.addChild(this.background),this.texture=new i.RenderTexture(require("main").renderer,100,100),this.sprite=new i.Sprite(this.texture),this.sprite.anchor.set(.5,1),this.sprite.shader=new a,this.addChild(this.sprite),this.bar=i.Sprite.fromFrame("interface/match/avatar_bar.png"),this.bar.anchor.set(.5,0),this.bar.position.y=-5,this.addChild(this.bar),this.barOverlay=i.Sprite.fromFrame("interface/match/avatar_overlay.png"),this.barOverlay.anchor.set(.5,0),this.barOverlay.position.y=-5,this.addChild(this.barOverlay),this.goalCounter=new i.Text(0,{font:'normal 15px "Mikodacs", "Nikumaru"',fill:"#fff",dropShadow:!0,dropShadowColor:"#000000",dropShadowAngle:2*Math.PI,dropShadowDistance:1}),this.goalCounter.anchor.set(.5,.5),this.goalCounter.position.set(-34.5,-2.5),this.addChild(this.goalCounter),this.icons=new i.Container,this.icons.position.set(-35.5,-12),this.addChild(this.icons),this.iconHatTrick=i.Sprite.fromFrame("interface/match/icon_hat.png"),this.icons.addChild(this.iconHatTrick),this.iconTopScorer=i.Sprite.fromFrame("interface/match/icon_crown.png"),this.icons.addChild(this.iconTopScorer);for(var e=0;e<this.icons.children.length;e++)this.icons.children[e].anchor.set(.5,1),this.icons.children[e].visible=!1;this.texture.render(this.tempStage,null,!0),this.player=t.player,this.onSkinChange=this.onSkinChange.bind(this),this.onSkinReplace=this.onSkinReplace.bind(this),this.enable(),this.changeAnimation=new n.Timeline(this),this.changeAnimation.wait(.0625*t.teamIndex).to({"scale.x":0,"scale.y":0},.25,"back.in").call(this._changePlayer.bind(this)),this.changeAnimation.to({"scale.x":1,"scale.y":1},.25,"exponential.out"),this.showAnimation=new n.Timeline(this),this.showAnimation.wait(.0625*t.teamIndex).to({alpha:1},.25),this.hideAnimation=new n.Timeline(this),this.hideAnimation.wait(.0625*t.teamIndex).to({alpha:0},.25)}var e=require("settings"),i=require("pixi"),n=require("nebula/tweens"),r=require("pitch").Pitch,s=require("renderers/player").PlayerSpine,o=e("AI_COLORS"),a=require("shaders/outline");return t.prototype=Object.create(i.Container.prototype),t.prototype.enable=function(){this.setGoalInfo(),r.goalScored({receiver:this.setGoalInfo,context:this}),s.onSkinChange({sender:this.player.spine,receiver:this.onSkinChange}),s.onSkinReplace({sender:this.player.spine,receiver:this.onSkinReplace})},t.prototype.disable=function(){r.goalScored.disconnect({receiver:this.setGoalInfo,context:this}),s.onSkinChange.disconnect({sender:this.player.spine,receiver:this.onSkinChange}),s.onSkinReplace.disconnect({sender:this.player.spine,receiver:this.onSkinReplace})},t.prototype.show=function(t){t?this.alpha=1:n.play(this.showAnimation)},t.prototype.hide=function(t){t?this.alpha=0:n.play(this.hideAnimation)},t.prototype.setGoalInfo=function(){var t=this.player.entity.goals;this.iconTopScorer.visible=this.player.entity.pitch.isTopScorer(this.player.entity),this.iconHatTrick.visible=!this.iconTopScorer.visible&&t>=3,this.goalCounter.text=t},t.prototype.onSkinChange=function(){this.spine.unloadSkin(),this.spine.setSkin(this.player.spine.skinName),this.spine.reset(),this.renderSpine()},t.prototype.onSkinReplace=function(){this.spine.replaceSkins(this.player.spine.spineData.skins)},t.prototype.changePlayer=function(t){this._newPlayer=t,n.play(this.changeAnimation)},t.prototype._changePlayer=function(){this.disable(),this.player=this._newPlayer,this.enable(),this.onSkinReplace(),this.onSkinChange()},t.prototype.update=function(t){var e=this.player.spine.currentAnimation(1),i=!1;e!==this.spine.currentAnimation(1)&&(this.spine.setAnimation(e,!0,1),i=!0);var n=this.player.spine.currentAnimation(2);n!==this.spine.currentAnimation(2)&&(this.spine.setAnimation(n,!0,2),i=!0),i&&this.renderSpine(),this.player.entity.team.isAI&&this.player.entity===this.player.entity.team.activeAIPlayer?this.bar.tint=o[this.player.entity.team._aiBase]:this.player.entity.user?this.bar.tint=this.player.entity.user.color:this.bar.tint=3355443},t.prototype.renderSpine=function(){this.spine.update(0),this.spine.sprites.chest_shirt.scale.x=Math.sign(this.spine.scale.x),this.spine.sprites.number&&(this.spine.sprites.number.scale.x=Math.sign(this.spine.scale.x)),this.texture.render(this.tempStage,null,!0)},t}),define("renderers/podium",function(){"use strict";function t(t,i,r,a,l,u,c){s.Container.call(this),c||(c=["red","orange","yellow","green","teal","blue","purple","pink"]),this.moveFlash=this.moveFlash.bind(this),this.time=0,this.states=new n(this),this.players=[],this.sortables=new s.Container,this.award=new s.Container,this.sortables.addChild(this.award);var p=s.Sprite.fromImage("images/cup.png");p.anchor.set(.5,1),this.award.addChild(p),this.addChild(s.Sprite.fromImage("images/stadium/podium_background.jpg")),this.shadows=new e(t.renderer,1920,1080,480,270),this.addChild(this.shadows),this.addPlayers(i,r),this.addPlayers(a,l),this.thief=this.players[o.integer(7,11)],this.flash=s.Sprite.fromImage("images/particles/flash.png"),this.flash.anchor.set(.5,.5),this.addChild(this.flash),this.flashAnimation=new h.Timeline(this.flash),this.flashAnimation.from({"scale.x":0,"scale.y":0,alpha:1}).to({"scale.x":1,"scale.y":1,alpha:{to:0,easing:"exponential.in"}},.125,"exponential.out").call(this.moveFlash),this.flashAnimation.repeat(1/0),h.play(this.flashAnimation),this.confetti=new s.Container;for(var f=0;500>f;f++){var m=s.Sprite.fromFrame("particles/confetti/"+c[f%c.length]+".png");m.anchor.set(.5,.5),this.randomizeConfetti(m),m.y=o.uniform(-200,900),this.confetti.addChild(m)}this.addChild(this.sortables),this.addChild(this.confetti),this.states.change(d),this.setShadowsOptions=this.setShadows.bind(this);var g=require("menu");this._shadowControl=g.graphics.find.shadows,this._shadowControl.onChange(this.setShadowsOptions),this.setShadowsOptions()}var e=require("renderers/shadow"),i=require("renderers/player").PlayerSpine,n=require("nebula/states").StateMachine,r=require("nebula/states").State,s=require("pixi"),o=require("nebula/random"),a=require("settings"),h=require("nebula/tweens"),l=require("nebula/numbers"),u=a("PLAYER_RUN_SPEED"),c=(a("PLAYER_SPRINT_SPEED"),a("PLAYER_HEIGHT")/150,150/a("PLAYER_HEIGHT")),p=.5*u*c,d=r.extend("Start",{enter:function(t){t.award.x=960,t.award.y=830;var e=t.players.slice(0,6);o.shuffle(e);for(var i=0;i<e.length;i++){var n=e[i],r=3>i?-1:1;n.y=840,n.x=960+(200+i%3*170)*r,n.setDirection(r),n.setAnimation("idle",!0),n.setAnimation("waving",!0,3),n.setAnimation("emotion_mouth_smile",!0,2),n.update(3*Math.random())}for(var i=6;i<t.players.length;i++)t.players[i].visible=!1},update:function(t,e){t.states.time>5&&t.states.change(f)}}),f=r.extend("Sneaking",{enter:function(t){var e=t.thief;e.visible=!0,e.x=-200,e.y=829,e.setAnimation("run",!0)},update:function(t,e){t.thief.x<910?t.thief.x+=p*e*t.thief.scale.y:t.states.change(m)}}),m=r.extend("Stealing",{enter:function(t){t.thief;t.thief.setAnimation("pick_up",!1)},update:function(t,e){t.states.time>=.4&&(t.thief.setAnimation("hands_in_front",!0,4),t.sortables.removeChild(t.award),t.award.inHands=!0,t.award.position.set(20,20),t.award.scale.set(1,1),t.thief.ballContainer.addChild(t.award)),t.states.time>=1&&t.states.change(g)}}),g=r.extend("RunningAway",{enter:function(t){var e=t.thief;e.setAnimation("run",!0),e.setAnimation("hands_in_front",!0,4),this.direction=1,this.padding=200},update:function(t,e){t.thief.x+=this.direction*p*e*t.thief.scale.y,t.thief.x>1920&&t.states.change(y)}}),y=r.extend("Running",{enter:function(t){this.direction=1,this.padding=200,this.players=[t.thief].concat(t.players.slice(0,6)),this.playersToMove=t.players.slice(0,6),o.shuffle(this.playersToMove),this.lastRunDelay=o.uniform(0,.125)},update:function(t,e){var i=!0;if(this.playersToMove.length&&(this.lastRunDelay-=e,this.lastRunDelay<=0)){var n=this.playersToMove.shift();n.setAnimation("run",!0),n.setAnimation("emotion_mouth_normal",!0,2),n.removeAnimation(3),n.setDirection(this.direction),this.lastRunDelay=o.uniform(0,.125)}for(var r=0;r<this.players.length;r++){var n=this.players[r];"run"===n.currentAnimation()?(n.x+=this.direction*p*e*n.scale.y,(1===this.direction&&n.x<1920+this.padding||-1===this.direction&&n.x>-this.padding)&&(i=!1)):i=!1}if(i){this.direction*=-1;var s=o.uniform(780,840),a=1-Math.max(0,Math.min(1,(840-s)/60));a=.5*a+.5;for(var r=0;r<this.players.length;r++){var n=this.players[r];n.setDirection(this.direction),t.award.scale.x=this.direction,n.y=s,0===r?n.x=-1===this.direction?1920+this.padding:-this.padding:n.x=this.players[r-1].x-this.direction*(1===r?500:o.uniform(100,200))*a}}}});return t.prototype=Object.create(s.Container.prototype),t.sort=function(t,e){return t.y-e.y},t.prototype.setShadows=function(){this.shadows.visible=this._shadowControl.value},t.prototype.addPlayers=function(t,e){for(var n=0;n<t.players.length;n++){var r=new i(s.loader.resources["data/player.json"].data);r.replaceSkins(t.skins),r.setSkin(t.id+(n+1)+("G"===t.players[n].role?"goalkeeper":e)),this.players.push(r),this.sortables.addChild(r)}},t.prototype.moveFlash=function(){this.flash.position.set(o.uniform(0,1920),o.uniform(284,700)),this.flash.rotation=o.uniform(0,2*Math.PI)},t.prototype.randomizeConfetti=function(t){t.y=o.uniform(-200,-50),t.x=o.uniform(0,1920),t.rotation=o.uniform(0,2*Math.PI),t.anchor.set(.5,.5),t.velocity=300,t.turnRate=o.uniform(100,200),t.depth=o.uniform(.2,1),t.sin=o.uniform(0,2*Math.PI);var e=.25*t.depth;t.scale.set(e,e)},t.prototype.resize=function(t,e){var i=Math.max(e/1080,t/1920),n=Math.max(i,Math.min(t/1920,e/1080));this.scale.set(n,n),this.x=.5*(t-1920*n),this.y=.7*(e-1080*n)},t.prototype.rescaleRectangle=function(t){return t.x=(t.x-this.x)/this.scale.x,t.y=(t.y-this.y)/this.scale.y,t.width/=this.scale.x,t.height/=this.scale.y,t},t.prototype.update=function(e){this.states.update(e),this.time+=e,this.sortables.children.sort(t.sort);for(var i=0;i<this.sortables.children.length;i++){var n=this.sortables.children[i],r=1-Math.max(0,Math.min(1,(840-n.y)/60));r=.5*r+.5;var s=Math.sign(n.scale.x),o=Math.sign(n.scale.y);n.scale.set(s*r,o*r)}for(var i=0;i<this.players.length;i++)this.players[i].update(e),this.players[i].setDirection(Math.sign(this.players[i].scale.x));for(var i=0;i<this.confetti.children.length;i++){var a=this.confetti.children[i];a.y+=a.velocity*a.depth*e,a.x+=2*a.depth*Math.sin(this.time+a.sin),a.rotation+=a.turnRate*Math.PI/180*e;var h=l.scale(a.depth,.2,1,.6,1);a.alpha=1-l.clamp(l.scale(a.y,944*h,1180*h,0,1),0,1),(0===a.alpha||a.y>1080)&&this.randomizeConfetti(a)}},t.prototype.updateTransform=function(){var t=this.rescaleRectangle(this.award.getBounds()),e=Math.abs(this.thief.scale.x);this.award.inHands?this.shadows.drawShadow(this.thief.x+50*this.thief.scale.x,this.thief.y,t.width*e*.5,10*e):this.shadows.drawShadow(t.x+t.width/2,t.y+t.height,.5*t.width,10);for(var i=0;i<this.players.length;i++){var n=this.players[i];n.visible&&n.sprites.arm_left&&(t=this.rescaleRectangle(n.getLeftArmBounds()),this.shadows.drawShadow(t.x+t.width/2,n.y,t.width,10*n.scale.y),t=this.rescaleRectangle(n.getRightArmBounds()),this.shadows.drawShadow(t.x+t.width/2,n.y,t.width,10*n.scale.y),t=this.rescaleRectangle(n.getLeftLegBounds()),this.shadows.drawShadow(t.x+t.width/2,n.y,t.width,10*n.scale.y),t=this.rescaleRectangle(n.getRightLegBounds()),this.shadows.drawShadow(t.x+t.width/2,n.y,t.width,10*n.scale.y),t=this.rescaleRectangle(n.getChestBounds()),this.shadows.drawShadow(t.x+t.width/2,n.y,1.5*t.width,20*n.scale.y),t=this.rescaleRectangle(n.getHeadBounds()),this.shadows.drawShadow(t.x+t.width/2,n.y,1.5*t.width,20*n.scale.y))}this.containerUpdateTransform()},t}),define("renderers/stadium",["pixi","nebula/format"],function(t,e){
"use strict";function i(e){t.Container.call(this),this._redTeam=null,this._blueTeam=null,this.viewportScale=1,this.game=e.game,this.pitch=e.pitch,this.pitchOffsetPixelsX=810,this.pitchOffsetPixelsY=764,this.topBottomDiffPixels=170,this.centerLinePixels=1321,this.bottomLinePixels=3500,this.topLinePixels=this.bottomLinePixels-2*this.topBottomDiffPixels,this.pixelsX=this.bottomLinePixels/this.pitch.width,this.pixelsY=this.centerLinePixels/this.pitch.height,this.pixelsZ=this.pixelsX,this.groundScaleY=this.pixelsY/this.pixelsX,this.filterArea=new t.Rectangle(0,0,1920,1080),this.baseTexture=new t.RenderTexture(this.game.renderer,4096,2048);var i=new t.Sprite(this.baseTexture);i.width=5120,i.height=2560,this.addChild(i),this.baseTexture.render(t.Sprite.fromImage("images/stadium/base.jpg")),this.bottomLayer=new t.Container,this.addChild(this.bottomLayer);var n=t.Sprite.fromFrame("stadium/goal_left/bottom.png");n.position.set(770,1338),this.bottomLayer.addChild(n);var n=t.Sprite.fromFrame("stadium/goal_right/bottom.png");n.position.set(4198,1336),this.bottomLayer.addChild(n),this.shadows=new c(this.game.renderer,this.width,this.height),this.addChild(this.shadows),this.pitch.entities.add(this.shadows),e.addShadows?this.addShadows():this.removeShadows(),this.controlIndicator=new g({stadium:this}),this.addChild(this.controlIndicator),this.pitch.entities.add(this.controlIndicator),this.sight=new d({stadium:this}),this.addChild(this.sight),this.pitch.entities.add(this.sight),this.userSights=[],this.userSightCircles=[];for(var r,s=0;s<A.length;s++){var r=new f({stadium:this});r.crosshair.tint=A[s],r.visible=!1,this.userSights.push(r),this.addChild(r),this.pitch.entities.add(r)}this.aiSights=[],this.aiSightCircles=[];for(var o=0;2>o;o++)for(var s=0;s<C.length;s++){var r=new f({stadium:this});r.crosshair.tint=C[s],r.visible=!1,this.aiSights.push(r),this.addChild(r),this.pitch.entities.add(r)}this.grass=new w(this),this.addChild(this.grass),this.sortables=new t.Container,this.addChild(this.sortables),n=t.Sprite.fromImage("stadium/goal_left/post.png"),n.position.set(901,1344),n.anchor.set(0,1),this.sortables.addChild(n),n=t.Sprite.fromImage("stadium/goal_left/crossbar.png"),n.position.set(879,1515),n.anchor.set(0,1),this.sortables.addChild(n),n=t.Sprite.fromImage("stadium/goal_left/net_holder.png"),n.position.set(694,1338),n.anchor.set(0,.913),this.sortables.addChild(n),n=t.Sprite.fromImage("stadium/goal_left/net_holder.png"),n.position.set(670,1509),n.anchor.set(0,.913),this.sortables.addChild(n),n=t.Sprite.fromImage("stadium/goal_right/post.png"),n.position.set(4208,1344),n.anchor.set(0,1),this.sortables.addChild(n),n=t.Sprite.fromImage("stadium/goal_right/crossbar.png"),n.position.set(4207,1515),n.anchor.set(0,1),this.sortables.addChild(n),n=t.Sprite.fromImage("stadium/goal_right/net_holder.png"),n.position.set(4298,1338),n.anchor.set(0,.954),this.sortables.addChild(n),n=t.Sprite.fromImage("stadium/goal_right/net_holder.png"),n.position.set(4322,1509),n.anchor.set(0,.954),this.sortables.addChild(n);var m=t.Sprite.fromImage("stadium/booth_left.png");m.position.set(1586,621),m.anchor.set(0,.767),m.scale.set(1.25,1.25),this.sortables.addChild(m),m=t.Sprite.fromImage("stadium/booth_right.png"),m.position.set(3040,621),m.anchor.set(0,.757),m.scale.set(1.25,1.25),this.sortables.addChild(m),m=t.Sprite.fromImage("stadium/flag.png"),m.position.set(978,767),m.anchor.set(.257,.753),this.sortables.addChild(m),m=t.Sprite.fromImage("stadium/flag.png"),m.position.set(4140,766),m.anchor.set(.257,.753),this.sortables.addChild(m),m=t.Sprite.fromImage("stadium/flag.png"),m.position.set(4307,2086),m.anchor.set(.257,.753),this.sortables.addChild(m),m=t.Sprite.fromImage("stadium/flag.png"),m.position.set(810,2086),m.anchor.set(.257,.753),this.sortables.addChild(m),this.players=[];for(var s=0;s<e.players.length;s++)this.players.push(new u({stadium:this,entity:e.players[s],spine:t.loader.resources["data/player.json"].data}));this.ballRenderer=new l({stadium:this,entity:this.pitch.ball}),this.sortables.addChild(this.ballRenderer),this.pitch.entities.add(this.ballRenderer),this.blueGoalNetRenderer=new p({net:this.pitch.blueGoal.net,stadium:this}),this.redGoalNetRenderer=new p({net:this.pitch.redGoal.net,stadium:this}),this.topLayer=new t.Container,this.addChild(this.topLayer),m=t.Sprite.fromImage("stadium/booth_top.png"),m.position.set(2560,0),m.anchor.set(.5,0),m.scale.set(1.25,1.25),this.topLayer.addChild(m),m=t.Sprite.fromImage("images/stadium/fans.png"),m.position.set(0,2560),m.anchor.set(0,1),m.scale.set(5,5),this.topLayer.addChild(m),a.states.ChangeSides.onEnter({sender:this.pitch,receiver:this.onChangeSides,context:this}),a.states.Kickoff.onEnter({sender:this.pitch,receiver:this.onMatchStart,context:this}),a.states.Corner.onEnter({sender:this.pitch,receiver:this.onCornerEnter,context:this}),a.states.Corner.onExit({sender:this.pitch,receiver:this.onMatchStart,context:this}),a.states.GoalCelebration.onEnter({sender:this.pitch,receiver:this.onGoalCelebrationEnter,context:this}),a.states.GoalCelebration.onExit({sender:this.pitch,receiver:this.onGoalCelebrationExit,context:this}),this.camera=new h({pitch:this.pitch,position:this.pitch.ball.position,maxForce:.5,maxSpeed:10}),this.camera.states.global(h.states.Global),this.pitch.entities.add(this.camera),this.camera.position.x=this.pitch.center.x,this.camera.position.y=this.pitch.center.y,this.camera.followBall(),e.showParticles?this.showParticles():this.hideParticles(),this.game.entities.add(this),this.superShotGlowContainer=new t.Container,this.superShotGlowContainer.scale.set(0,0),this.superShotGlow=new t.Container,this.superShotGlowContainer.addChild(this.superShotGlow),this.superShotOverlayContainer=new t.Container,this.superShotOverlayContainer.alpha=0,this.superShotOverlayContainer.part1=new t.Container,this.superShotOverlayContainer.part2=new t.Container,this.superShotOverlayContainer.part1.scale.set(1.125,1.125),this.superShotOverlayContainer.addChild(this.superShotOverlayContainer.part1),this.superShotOverlayContainer.addChild(this.superShotOverlayContainer.part2);for(var y=1;y>-2;y-=2)for(var v=1;v>-2;v-=2){var x=t.Sprite.fromImage("images/powerups/supershot/overlay.png");x.scale.set(y,v),x.tint=0,x.alpha=.75,x.blendMode=t.BLEND_MODES.MULTIPLY,this.superShotOverlayContainer.part1.addChild(x);var x=t.Sprite.fromImage("images/powerups/supershot/overlay.png");x.scale.set(y,v),x.alpha=.75,x.blendMode=t.BLEND_MODES.ADD,this.superShotOverlayContainer.part2.addChild(x)}for(var b=5,s=0;b>s;s++){var x=t.Sprite.fromImage("images/powerups/supershot/glow.png");x.rotation=2*Math.PI*s/b,x.scale.set(1,.25),x.anchor.set(0,.5),x.blendMode=t.BLEND_MODES.ADD,this.superShotGlow.addChild(x)}var x=t.Sprite.fromImage("images/powerups/supershot/glow_center.png");x.anchor.set(.5,.5),x.blendMode=t.BLEND_MODES.ADD,this.superShotGlowContainer.addChild(x),this.addChild(this.superShotGlowContainer),this.addChild(this.superShotOverlayContainer),this.superShotOverlayContainer.animation=new T.Timeline(this.superShotOverlayContainer),this.superShotOverlayContainer.animation.from({alpha:0,"part1.scale.x":1.5,"part1.scale.y":1.5,"part2.scale.x":1.5,"part2.scale.y":1.5}).to({alpha:1,"part1.scale.x":1,"part1.scale.y":1,"part2.scale.x":1,"part2.scale.y":1},.6),this.superShotOverlayContainer.animation.wait(.6),this.superShotOverlayContainer.animation.to({alpha:0,"part1.scale.x":2,"part1.scale.y":2,"part2.scale.x":2,"part2.scale.y":2},1,"exponential.out"),this.superShotGlowContainer.animation=new T.Timeline(this.superShotGlowContainer),this.superShotGlowContainer.animation.from({alpha:1,"scale.x":0,"scale.y":0}).to({"scale.x":1,"scale.y":1},1.2),this.superShotGlowContainer.animation.to({"scale.x":40,"scale.y":40},.125,"exponential.out"),this.superShotGlowContainer.animation.to({alpha:0},.125,"exponential.out"),_.Supershot.onEnter({receiver:this.onSuperShotEnter,context:this}),_.HumanCornerKick.onEnter(this.onCornerKickEnter.bind(this)),_.HumanCornerKick.onExit(this.onCornerKickExit.bind(this))}var n=require("settings"),r=(n("DEBUG"),require("nebula/math/vector2")),s=require("nebula/math/point2"),o=(require("nebula/math/point3"),require("nebula/signal")),a=require("pitch").Pitch,h=(require("ball").Ball,require("player").Player,require("camera").Camera),l=require("renderers/ball"),u=require("renderers/player").PlayerRenderer,c=(require("renderers/player").PlayerSpine,require("renderers/shadow")),p=require("renderers/net"),d=require("renderers/sight"),f=require("renderers/sight2"),m=require("particle"),g=require("renderers/control_indicator"),y=require("nebula/numbers").clamp,v=require("emitter"),x=(require("nebula/query"),require("spine/skeleton_json")),b=require("teams"),w=(require("races"),require("skin_merger"),require("renderers/particles/grass")),_=require("players/states"),T=require("nebula/tweens"),E=(require("nebula/random"),require("nebula/easings")),S=n("GOAL_HEIGHT",10),A=n("USER_COLORS"),C=n("AI_COLORS");new x;return i.onChange=new o,i.prototype=Object.create(t.Container.prototype),i.prototype.onKick=function(t,e,i){for(var n=4,r=s.temp(),o=s.temp(),a=0;n>a;a++)r.x=t.position.x+.5*i.x*a/n,r.y=t.position.y+.5*i.y*a/n,this.worldToScreen(r,o),this.dirt.drawDirt(o.x,o.y,10,10)},i.prototype.onBounce=function(t){var e=y(Math.abs(t.velocity.z),0,1),i=t.radius*this.pixelsX*e,n=t.radius*this.pixelsY*e,r=s.temp();this.worldToScreen(t.position,r),this.dirt.drawDirt(r.x,r.y,2*i-2,2*n-2)},i.prototype.drawDirtFromPlayer=function(t,e){var i,n,r,o,a=s.temp();this.worldToScreen(e.entity.position,a),"step_left"===t?(r=e.spine.getLeftShoeBounds(),o=-3):"step_right"===t&&(r=e.spine.getRightShoeBounds(),o=3),r&&(i=r.x/this.scale.x-this.position.x/this.scale.x,n=r.width/this.scale.x,this.dirt.drawDirt(i+n/2,a.y+o,2*n,n))},i.prototype.onSuperShotEnter=function(){T.play(this.superShotOverlayContainer.animation),T.play(this.superShotGlowContainer.animation)},i.prototype.onCornerKickEnter=function(t){this.userSights[t.user.id].visible=!0,this.userSights[t.user.id].player=t,this.camera.interpose(t.states.current.sight,t)},i.prototype.onCornerKickExit=function(t){this.userSights[t.user.id].visible=!1,this.userSights[t.user.id].player=null,this.camera.followBall()},i.prototype.resize=function(t,e){var i=Math.max(e/2560,t/2560);this.viewportScale=Math.max(i,Math.min(t/1920,e/810))},i.prototype.loadMatch=function(t,e,i,n,r){function s(){o-=1,o||(a.loadRedTeamKit(t,e),a.loadBlueTeamKit(i,n),r&&r())}var o=2,a=this;this._redTeam=t,this._blueTeam=i,b.loadResources(t,s),b.loadResources(i,s)},i.prototype.loadRedTeamKit=function(t,e){for(var i=0;i<this.pitch.redTeam.allPlayers.length;i++){var n=this.players[i];n.spine.replaceSkins(t.skins),n.spine.setSkin(t.id+(i+1)+(n.entity.isGoalkeeper?"goalkeeper":e))}},i.prototype.loadBlueTeamKit=function(t,e){for(var i=0;i<this.pitch.blueTeam.allPlayers.length;i++){var n=this.players[i+6];n.spine.replaceSkins(t.skins),n.spine.setSkin(t.id+(i+1)+(n.entity.isGoalkeeper?"goalkeeper":e))}},i.prototype.showPlayer=function(t){for(var e=0;e<this.players.length;e++)if(this.players[e].entity===t)return this.players[e].visible=!0,this.sortables.addChild(this.players[e]),void this.pitch.entities.add(this.players[e]);throw new Error("Nothing to show, player not found")},i.prototype.hidePlayer=function(t){for(var e=0;e<this.players.length;e++)if(this.players[e].entity===t)return this.players[e].visible=!1,this.sortables.removeChild(this.players[e]),void this.pitch.entities.remove(this.players[e]);throw new Error("Nothing to hide, player not found")},i.prototype.addShadows=function(){this.shadows.visible=!0},i.prototype.removeShadows=function(){this.shadows.visible=!1},i.prototype.showParticles=function(){for(var t=0;t<this.pitch.entities.length;t++)this.pitch.entities.list[t]instanceof v&&(this.pitch.entities.list[t].disabled=!1)},i.prototype.hideParticles=function(){for(var t=0;t<this.pitch.entities.length;t++)this.pitch.entities.list[t]instanceof v&&(this.pitch.entities.list[t].disabled=!0)},i.prototype.getBounds=function(){return this._bounds.x=this.position.x*this.scale.x,this._bounds.y=this.position.y*this.scale.y,this._bounds.width=5120,this._bounds.height=2560,this._bounds},i.sortPlainObjects=function(t,e){return t instanceof Array?t[1]-e[1]:t.y-e.y},i.sort=function(t,e){return t.position.y-e.position.y},i.prototype.worldToScreenFlat=function(t,e){e.x=this.pitchOffsetPixelsX+t.x*this.pixelsX+this.topBottomDiffPixels*(1-t.y/this.pitch.height)*-(2*t.x/this.pitch.width-1),e.y=this.pitchOffsetPixelsY+t.y*this.pixelsY},i.prototype.worldToScreen=function(t,e){e.x=this.pitchOffsetPixelsX+t.x*this.pixelsX+this.topBottomDiffPixels*(1-t.y/this.pitch.height)*-(2*t.x/this.pitch.width-1),e.y=this.pitchOffsetPixelsY+t.y*this.pixelsY,t.z&&(e.y-=t.z*this.pixelsZ)},i.prototype.worldToCamera=function(t,e){this.worldToScreen(t,e),e.x+=this.position.x,e.y+=this.position.y},i.prototype.worldToCameraFlat=function(t,e){this.worldToScreenFlat(t,e),e.x+=this.position.x,e.y+=this.position.y},i.prototype.onChangeSides=function(t,e,i){this.camera.goTo(t.center)},i.prototype.onCornerEnter=function(t,e,i){var n=s.copy(e);n.y+=.5*(i.opponents.goal.center.y-n.y),this.camera.goTo(n)},i.prototype.onMatchStart=function(t,e,i){this.camera.followBall()},i.prototype.onGoalCelebrationEnter=function(t,e,i,n){this.camera.zoom=2,this.camera.follow(n,.5)},i.prototype.onGoalCelebrationExit=function(t,e,i){this.camera.followBall(),this.camera.zoom=1},i.prototype.getCameraPosition=function(t){s.scaleNumber(this.position,-1/this.viewportScale/this.camera.zoom,t)},i.prototype.updateTransform=function(){if(this.visible){for(var t=s.temp(),e=0;e<this.players.length;e++){var i=this.players[e];if(i.visible&&i.spine.sprites.arm_left&&(this.worldToScreenFlat(i.entity.position,t),this.shadows.drawPlayer(i.spine,t,i.alpha),i.frozen)){var n=1-E.cubic["in"](i.entity.states.current.progress);this.shadows.drawShadow(t.x,t.y,128*n,64*n)}}this.containerUpdateTransform()}},i.prototype.render=function(t){if(this.visible){this.filterArea.width=this.game.viewportWidth,this.filterArea.height=this.game.viewportHeight,this.scale.set(this.camera.zoom*this.viewportScale,this.camera.zoom*this.viewportScale);var e=r.temp();this.worldToScreenFlat(this.camera.position,e),this.position.x=y(this.game.viewportWidth/2-e.x*this.scale.x,-this.width+this.game.viewportWidth,0),this.position.y=y(this.game.viewportHeight/2-e.y*this.scale.y,-this.height+this.game.viewportHeight,0),this.pitch.paused||this.grass.render(t*this.pitch.timeScale),this.sortables.children.sort(i.sort);var n=this.pitch.activeGoal,s=n.net===this.redGoalNetRenderer.net?this.redGoalNetRenderer.netTriangleRenderers:this.blueGoalNetRenderer.netTriangleRenderers;if(s.sort(i.sort),this.superShotGlowContainer.visible=Boolean(this.superShotGlowContainer.alpha),this.superShotGlowContainer.alpha){this.superShotGlowContainer.position.x=this.ballRenderer.position.x,this.superShotGlowContainer.position.y=this.ballRenderer.position.y+this.ballRenderer.sprite.position.y-2,this.superShotGlow.rotation=2*this.superShotGlowContainer.scale.y*Math.PI;for(var o=0;o<this.superShotGlow.children.length;o++)this.superShotGlow.children[o].scale.y=Math.pow(this.superShotGlowContainer.scale.y,2)}this.superShotOverlayContainer.visible=Boolean(this.superShotOverlayContainer.alpha),this.superShotOverlayContainer.alpha&&(this.superShotOverlayContainer.position.x=e.x,this.superShotOverlayContainer.position.y=e.y,this.superShotOverlayContainer.scale.x=this.game.viewportWidth/1920/this.scale.x,this.superShotOverlayContainer.scale.y=this.game.viewportHeight/1080/this.scale.y,this.superShotOverlayContainer.part1.rotation=2*Math.random()*Math.PI/180,this.superShotOverlayContainer.part2.rotation=2*Math.random()*Math.PI/180)}},i.prototype._render=function(t){if(this.visible){for(var e=0,i=this.children.length,n=this.ballRenderer.entity.position.z>=S;this.children[e]!==this.sortables&&i>e;)this.children[e].renderWebGL(t),e++;for(var r=null,s=0,o=this.pitch.activeGoal,a=o.net===this.redGoalNetRenderer.net?this.redGoalNetRenderer.netTriangleRenderers:this.blueGoalNetRenderer.netTriangleRenderers,h=0,l=this.sortables.children.length;l>h;h++){var u=this.sortables.children[h];if(u!==this.ballRenderer||!n){if(!(u.entity instanceof m))for(var c=s;c<a.length;c++,s++){var p=a[c];if(!(p.position.y<u.position.y)){p.renderWebGL(t,r,null),r=p;break}p.renderWebGL(t,r,a[c+1]),r=p}u.renderWebGL(t,this.sortables.children[h-1],this.sortables.children[h+1]),r=u}}for(var c=s;c<a.length;c++){var p=a[c];p.renderWebGL(t,r,a[c+1]),r=p}for(n&&this.ballRenderer.renderWebGL(t),e++;this.children[e]!==this.sortables&&i>e;)this.children[e].renderWebGL(t),e++}},i.prototype.renderWebGL=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._mask||this._filters?(t.currentRenderer.flush(),this._filters&&this._filters.length&&t.filterManager.pushFilter(this,this._filters),this._mask&&t.maskManager.pushMask(this,this._mask),t.currentRenderer.start(),this._render(t),t.currentRenderer.flush(),this._mask&&t.maskManager.popMask(this,this._mask),this._filters&&t.filterManager.popFilter(),t.currentRenderer.start()):this._render(t))},Object.defineProperties(i.prototype,{cameraWidth:{get:function(){return this.game.viewportWidth/this.viewportScale/this.camera.zoom}},cameraHeight:{get:function(){return this.game.viewportHeight/this.viewportScale/this.camera.zoom}}}),i}),define("gui/choice_container",["nebula/gui/container","nebula/gui/base","nebula/gui/button"],function(t,e,i){"use strict";function n(e){t.apply(this,arguments),e=e||{},this.choices=[],this.onSelect=e.onSelect,this.allowDisabled=Boolean(e.allowDisabled),this.allowLocked=Boolean(e.allowLocked),this.selectOnFocus=e.selectOnFocus||!1,this.selectMultiple=Boolean(e.selectMultiple),this.selectMultiple&&this.actions.enter.length--}var r=require("nebula/query"),s=require("nebula/objects");return n.prototype=Object.create(t.prototype),n.prototype.defaultTemplatePath="gui/choice_container.txt",n.prototype.defaultChoiceTemplatePath="gui/button.txt",n.prototype.removeChoices=function(){for(var t=this.children.length-1;t>=0;t--)this.choices.indexOf(this.children[t])>-1&&this.children.splice(t,1);this.choices=[]},n.prototype.addChoices=function(t){for(var e=0;e<t.length;e++)this.addChoice(t[e])},n.prototype.addChoice=function(t){var e=new i({label:t.name,data:t,templatePath:this.defaultChoiceTemplatePath});this.choices.push(e),this.children.push(e)},n.prototype.focus=function(){for(var e=this.previous,i=0;i<this.choices.length;i++)if(e.lastFocusedChild&&this.choices[i].data.value===e.lastFocusedChild.value){this.choices[i].focus(!1),this.lastFocusedChild=this.choices[i];break}t.prototype.focus.apply(this,arguments)},n.prototype.selectChoice=function(){var t=this.focusedChild;if(t&&!(t.disabled&&!this.allowDisabled||t.data.locked&&!this.allowLocked)){this.onSelect&&this.onSelect(t.data.value);var e=this.previous;this.selectMultiple?(t.selected?t.unSelect():t.select(),e.lastFocusedChild.value=s.getValues(r.filter(this.choices,{selected:!0}),["*.data.value"],!0)):e.lastFocusedChild.value=t.data.value,e.updateWidget()}},n.prototype.focusChild=function(){t.prototype.focusChild.apply(this,arguments),this.selectOnFocus&&this.selectChoice()},n.prototype.defaultActions=t.prototype.extendDefaultActions(t.prototype.defaultActions,{enter:["selectChoice","close"]}),Object.defineProperty(n.prototype,"selectedChild",{get:function(){for(var t=0;t<this.children.length;t++)if(this.children[t].selected)return this.children[t];return null}}),Object.defineProperty(n.prototype,"availableChoices",{get:function(){return this.choices.slice()}}),Object.defineProperty(n.prototype,"availableValues",{get:function(){return s.getValues(this.choices,["*.data.value"],!0)}}),n}),define("gui/select",["nebula/gui/button","gui/choice_container","nebula/html","nebula/signal"],function(t,e,i,n){"use strict";function r(t,e){return"undefined"==typeof t?e:t}function s(i){i=i||{},i.showPreviousContainer=r(i.showPreviousContainer,!0),t.apply(this,arguments),this.choiceContainer=new e({id:this.id+"-choice-container",classes:i.containerClasses,showPreviousContainer:i.showPreviousContainer,selectOnFocus:i.selectOnFocus}),i.defaultChoiceTemplatePath&&(this.choiceContainer.defaultChoiceTemplatePath=i.defaultChoiceTemplatePath),this.choiceContainer.addChoices(i.choices),this._value=this.choiceContainer.choices[0].data,this._lastValue=this._value,this.onChange=new n,this.onChange.connect(this._replaceWidget.bind(this))}return s.prototype=Object.create(t.prototype),s.prototype.openChoiceContainer=function(){this.disabled||this.choiceContainer.open()},s.prototype.defaultActions=t.prototype.extendDefaultActions(t.prototype.defaultActions,{enter:["openChoiceContainer"]}),Object.defineProperty(s.prototype,"value",{get:function(){return this._value instanceof Array?this._value:this._value.value},set:function(t){if(t instanceof Array){for(var e=this.choiceContainer.availableValues,i=0;i<t.length;i++)if(-1===e.indexOf(t[i]))throw new Error("Invalid value in supplied array");return this._lastValue=this._value,this._value=t,void(this._lastValue!==this._value&&this.onChange.send(this,this.value))}for(var i=0;i<this.choiceContainer.choices.length;i++)if(t===this.choiceContainer.choices[i].data.value)return this._lastValue=this._value,this._value=this.choiceContainer.choices[i].data,void(this._lastValue!==this._value&&this.onChange.send(this,this.value));throw new Error("Invalid value")}}),s}),define("gui/team_container",["gui/choice_container"],function(t){"use strict";function e(){t.apply(this,arguments)}var i=require("nebula/query"),n=require("nebula/objects");return e.prototype=Object.create(t.prototype),e.prototype.defaultTemplatePath="gui/team_container.txt",e.prototype.defaultChoiceTemplatePath="gui/team.txt",e.prototype.selectChoice=function(){var t=this.focusedChild;if(t&&!(t.disabled&&!this.allowDisabled||t.data.locked&&!this.allowLocked)&&(this.onSelect&&this.onSelect(t.data),this.previous)){var e=this.previous;e.lastFocusedChild&&(this.selectMultiple?(t.selected?t.unSelect():t.select(),e.lastFocusedChild.value=n.getValues(i.filter(this.choices,{selected:!0}),["*.data"],!0)):e.lastFocusedChild.value=t.data),e.updateWidget()}},e.prototype.focusChild=function(){t.prototype.focusChild.apply(this,arguments);var e=this.focusedChild;e&&e.data&&e.data["new"]&&(e.data["new"]=!1)},e.prototype.open=function(){var e=null,i=null;return this.children.length&&(this.choices[0].data.isRandom&&(e=this.children.shift()),this.choices[1].data.isTeam&&(i=this.children.shift()),i&&this.children.unshift(i),e&&this.children.unshift(e)),t.prototype.open.apply(this,arguments)},Object.defineProperty(e.prototype,"availableChoices",{get:function(){for(var t=[],e=0;e<this.choices.length;e++)this.choices[e].data.isRandom||this.choices[e].data.locked||t.push(this.choices[e].data);return t}}),Object.defineProperty(e.prototype,"availableValues",{get:function(){return n.getValues(this.choices,["*.data"],!0)}}),e}),define("gui/team_select",["nebula/gui/button","nebula/html"],function(t,e){"use strict";function i(){t.apply(this,arguments)}return i.prototype=Object.create(t.prototype),i.prototype.defaultTemplatePath="gui/team_select.txt",i.prototype.updateWidget=function(){t.prototype.updateWidget.apply(this,arguments);var i=this.widget.querySelector(".flag"),n=this.widget.querySelector(".thumbnail"),r=this.widget.querySelector("figcaption");this.value?(i.setAttributeNS("http://www.w3.org/1999/xlink","href",this.value.flag),n.setAttribute("src",this.value.thumbnail),r.innerHTML=e.escape(this.value.name),this.value.isRandom?this.widget.classList.add("random"):this.widget.classList.remove("random")):(i.removeAttribute("xlink:href"),n.removeAttribute("src"),r.innerHTML=e.escape(this.label),this.widget.classList.remove("random"))},i}),define("gui/in_game_menu",["nebula/gui/container"],function(t){"use strict";function e(e){t.apply(this,arguments)}var i=require("settings"),n=i("GAMEPAD_BUTTON_MAP",{}),r=require("users");return e.prototype=Object.create(t.prototype),e.prototype.defaultTemplatePath="gui/in_game.txt",e.prototype.reset=function(){this.widget.classList.remove("second-half")},e.prototype.setPlayerKeyIndicatorsPosition=function(t,e){if(this.widget){var i=this.widget.querySelector('.user-key-group.fixed[data-user="'+(t+1)+'"]');i.style.transform="translate("+e.x+"px, "+e.y+"px)"}},e.prototype.onControllerChange=function(){if(this.widget){for(var t=this.widget.querySelectorAll("[data-user]"),e=0;e<t.length;e++)t[e].classList.remove("connected");for(var e=0;e<r.list.length;e++)for(var i=r.list[e],t=this.widget.querySelectorAll('[data-user="'+(i.id+1)+'"]'),s=0;s<t.length;s++){var o=t[s],a=o.querySelectorAll(".key, .gamepad-button");if(o.classList.toggle("connected",i.controller),o.classList.toggle("playing",i.player),i.controller)for(var h=0;h<a.length;h++){var l=a[h],u=i.controller[l.getAttribute("data-action")].condition.str.replace(/[\|\-\+]/,"");0===e?l.innerHTML=i.controller.apis[0].keys[u].name:(l.innerHTML=u,l.setAttribute("data-map",n[u]||""))}}}},e.prototype.showUserKeys=function(){this.widget&&this.widget.classList.add("show-user-keys")},e.prototype.hideUserKeys=function(){this.widget&&this.widget.classList.remove("show-user-keys")},e.prototype.showHelpText=function(){this.widget&&this.widget.classList.remove("hide-help-text")},e.prototype.hideHelpText=function(){this.widget&&this.widget.classList.add("hide-help-text")},e}),define("gui/tournament",["nebula/gui/container"],function(t){"use strict";function e(e){t.apply(this,arguments),this.classes=this.classes+" tournament",this.teams=e.teams,this.tournament=e.tournament}return e.prototype=Object.create(t.prototype),e.prototype.defaultTemplatePath="gui/tournament.txt",e.prototype.focusChild=function(e){if(t.prototype.focusChild.apply(this,arguments),this.focused){var i=e&&e.direction||vector2.create();if(!(Math.abs(i.y)<.75)){var n=this.widget.querySelector(".scrollable-content");if(n){this.gui.container.classList.add("no-scale");var r=parseInt(n.getAttribute("data-scroll-x"),10)||0,s=parseInt(n.getAttribute("data-scroll-y"),10)||0,o=n.getBoundingClientRect(),a=n.parentNode.getBoundingClientRect();s-=200*i.y,s=Math.min(0,Math.max(s,a.height-o.height)),this.setScrollPosition(n,r,s),this.gui.container.classList.remove("no-scale")}}}},e.prototype.updateEvents=function(t,e){var i=document.createElement("div");i.innerHTML=this.html;for(var n=0;n<t.length;n++){var r=this.widget.querySelector("#"+t[n].data.alias),s=i.querySelector("#"+t[n].data.alias);r.parentNode.replaceChild(s,r)}},e.prototype.updateWidget=function(){t.prototype.updateWidget.apply(this,arguments),this.updateEvents(this.tournament.children);var e=this.widget.querySelector(".next");e&&e.classList.remove("next");var i=this.tournament.findUserMatch();if(i){var n=this.widget.querySelector("#"+i.data.alias);n||(n=this.widget.querySelector("#"+i.parent.data.alias)),n.classList.add("next"),n&&this.scrollToElement(n)}else{var r=this.widget.querySelector(".scrollable-content");r.style.left="0px",r.style.top="0px"}},e.prototype.defaultActions={moveFocus:[e.prototype.focusChild]},e}),define("gui/leaderboards",["nebula/gui/container"],function(t){"use strict";function e(e){t.apply(this,arguments),this.classes=this.classes+" tournament",this.api=e.api,this.leagues=[{name:"leagues.platinum",score:s,limit:r,league:"platinum"},{name:"leagues.gold",score:a,limit:o,league:"gold"},{name:"leagues.silver",score:l,limit:h,league:"silver"},{name:"leagues.bronze",score:0,limit:0,league:"bronze"}],this._friends=null,this.api.onEntriesDownloading(this.onEntriesDownloading,this),this.api.onEntriesDownloaded(this.onEntriesDownloaded,this),this._leaderboardPerPage=14}var i=require("settings"),n=require("greenworks"),r=i("LEADERBOARD_PLATINUM_LIMIT"),s=i("LEADERBOARD_PLATINUM_SCORE"),o=i("LEADERBOARD_GOLD_LIMIT"),a=i("LEADERBOARD_GOLD_SCORE"),h=i("LEADERBOARD_SILVER_LIMIT"),l=i("LEADERBOARD_SILVER_SCORE"),u=["bronze","silver","gold","platinum"];return e.prototype=Object.create(t.prototype),e.prototype.defaultTemplatePath="gui/leaderboards.txt",e.prototype.loadPrevious=function(){if(this._friends){var t=this.min,e=this.max;t=Math.max(0,t-this.leaderboardPerPage),e=Math.min(this._friends.length,t+this.leaderboardPerPage),this.min=t,this.max=e,this.leaderboards=this._friends.slice(t,e),this.updateWidget()}else{var t=this.min,e=this.max;this.api.lastResults?this.api.lastResults.league:null;if(t=Math.max(1,t-this.leaderboardPerPage),t===this.min)return;e=t+this.leaderboardPerPage-1,this.api.downloadEntriesRange(t,e)}},e.prototype.loadNext=function(){if(this._friends){var t=this.min,e=this.max;e=Math.min(this._friends.length,e+this.leaderboardPerPage),t=Math.max(0,e-this.leaderboardPerPage),this.min=t,this.max=e,this.leaderboards=this._friends.slice(t,e),this.updateWidget()}else{if(this.leaderboards.length<this.leaderboardPerPage)return;var t=this.min,e=this.max,i=this.api.lastResults?this.api.lastResults.league:null,n=this.api.getEntryCount(),s=e+this.leaderboardPerPage;if(e="platinum"===i?Math.min(r,s,n):"gold"===i?Math.min(o,s,n):"silver"===i?Math.min(h,s,n):Math.min(s,n),e===this.max)return;t=e-this.leaderboardPerPage+1,this.api.downloadEntriesRange(t,e)}},e.prototype.onEntriesDownloading=function(){this.loading=!0,this.updateWidget()},e.prototype.onEntriesDownloaded=function(t,e){this.leaderboards=[];var i=1/0,r=-(1/0);if(e.hasOwnProperty("length")){this._friends=null;for(var s=0;s<e.length;s++){var o=e[s];i=Math.min(i,o.rank),r=Math.max(r,o.rank),this.leaderboards.push({id:o.rank,name:o.user.screenName||o.user.id,league:this.api.lastResults.league,avatar:o.avatar,fame:o.score,wins:o.details[0]||0,draws:o.details[1]||0,loses:o.details[2]||0,goalsFor:o.details[3]||0,goalsAgainst:o.details[4]||0,isUser:o.user.accountId===this.api.userId,isFriend:n.getFriendRelationship(o.user.accountId)})}}else{for(var a=u.length-1;a>=0;a--)for(var h=u[a],s=0;s<e[h].length;s++){var o=e[h][s];this.leaderboards.push({id:o.rank,name:o.user.screenName||o.user.id,league:h,avatar:o.avatar,fame:o.score,wins:o.details[0]||0,draws:o.details[1]||0,loses:o.details[2]||0,goalsFor:o.details[3]||0,goalsAgainst:o.details[4]||0,isUser:o.user.accountId===this.api.userId,isFriend:!1})}this._friends=this.leaderboards,i=0,r=Math.min(this.leaderboardPerPage,this.leaderboards.length),this.leaderboards=this.leaderboards.slice(i,r)}this.min=i,this.max=r,this.loading=!1,this.updateWidget()},e.prototype.focusChild=function(e){if(t.prototype.focusChild.apply(this,arguments),this.focused){var i=e&&e.direction||vector2.create();Math.abs(i.y)<.75||(i.y<0?this.loadPrevious():this.loadNext())}},e.prototype.updateWidget=function(){if(t.prototype.updateWidget.apply(this,arguments),this.widget){var e=document.createElement("div");e.innerHTML=this.html;var i=this.widget.querySelector("#leaderboards"),n=e.querySelector("#leaderboards");i.parentNode.replaceChild(n,i)}},e.prototype.defaultActions={moveFocus:[e.prototype.focusChild]},Object.defineProperty(e.prototype,"leaderboardPerPage",{get:function(){return this._friends?2*this._leaderboardPerPage:this._leaderboardPerPage}}),e}),define("gui/help",["nebula/gui/container"],function(t){"use strict";function e(){t.apply(this,arguments),this.classes=this.classes+" help wysiwyg"}return e.prototype=Object.create(t.prototype),e.prototype.defaultTemplatePath="gui/help.txt",e.prototype.focusChild=function(e){if(t.prototype.focusChild.apply(this,arguments),this.focused){var i=e&&e.direction||vector2.create();if(!(Math.abs(i.y)<.75)){var n=this.widget.querySelector(".scrollable-content");if(n){this.gui.container.classList.add("no-scale");var r=parseInt(n.getAttribute("data-scroll-x"),10)||0,s=parseInt(n.getAttribute("data-scroll-y"),10)||0,o=n.getBoundingClientRect(),a=n.parentNode.getBoundingClientRect();s-=200*i.y,s=Math.min(0,Math.max(s,a.height-o.height)),this.setScrollPosition(n,r,s),this.gui.container.classList.remove("no-scale")}}
}},e.prototype.defaultActions={moveFocus:[e.prototype.focusChild]},e}),define("gui/input_binder",["nebula/gui/button","nebula/html","nebula/signal"],function(t,e,i){"use strict";function n(e){e=e||{},t.apply(this,arguments),this.api=e.api,this._waitForInput=!1,this.lastValue,this.value,this._onApiUp=this.onApiUp.bind(this),this._onApiDown=this.onApiDown.bind(this)}var r=require("settings"),s=r("GAMEPAD_BUTTON_MAP",{});return n.prototype=Object.create(t.prototype),n.prototype.defaultTemplatePath="gui/input_binder.txt",n.prototype.onApiUp=function(t){this._waitForInput=!1},n.prototype.onApiDown=function(t){this.value=t.codeName||t.name,this.lastValue=this.value,this.updateWidget(),this.api.onUp.once(this._onApiUp)},n.prototype.input=function(e,i){return this._waitForInput?(i.apis[0]!==this.api&&"back"===e&&(this._waitForInput=!1,this.value=this.lastValue,this.updateWidget(),this.api.onDown.disconnect(this._onApiDown)),!0):void t.prototype.input.apply(this,arguments)},n.prototype.waitForInput=function(){this._waitForInput=!0,this.lastValue=this.value,this.value="",this.updateWidget(),this.api.onDown.once(this._onApiDown)},n.prototype.updateWidget=function(){if(t.prototype.updateWidget.apply(this,arguments),this.widget){var e=this.widget.querySelector(".label"),i=this.widget.querySelector(".key, .gamepad-button");e.innerHTML=this.value?"Change":"Press a key",this.value&&("keyboard"===this.api.type?(i.innerHTML=this.api.keys[this.value].name,i.removeAttribute("data-map")):(i.innerHTML=this.value,i.setAttribute("data-map",s[this.value]||"")))}},n.prototype.defaultActions=t.prototype.extendDefaultActions(t.prototype.defaultActions,{enter:["waitForInput"]}),n}),define("gui/alert",["nebula/gui/container","nebula/gui/button"],function(t,e){"use strict";function i(t,e){return"undefined"==typeof t?e:t}function n(n){n=n||{},t.apply(this,arguments),this.text=n.text||"",this.image=n.image,this.video=n.video,this.add(new e({id:"ok",label:n.buttonLabelOk||"OK",actions:{enter:[this.gui.back]}})),this.showPreviousContainer=i(n.showPreviousContainer,!0)}return n.prototype=Object.create(t.prototype),n.prototype.defaultTemplatePath="gui/alert.txt",n.prototype.defaultActions=t.prototype.extendDefaultActions(t.prototype.defaultActions,{back:["preventActionPropagation"]}),n}),define("gui/confirm",["gui/alert","nebula/gui/button"],function(t,e){"use strict";function i(i){i=i||{},t.apply(this,arguments),this.add(new e({id:"cancel",label:i.buttonLabelCancel||"Cancel",actions:{enter:[this.gui.back]}}),!0)}return i.prototype=Object.create(t.prototype),i}),define("leaderboard",function(){"use strict";function t(t,n,o){i.findLeaderboard(t,function(i){r[t]=new e(t,i),s.send(t,r[t]),n&&n(r[t])},function(t){o&&o(t)})}function e(t,e){this.code=t,this.id=e,this.name=i.getLeaderboardName(this.id),this.sortMethod=i.getLeaderboardSortMethod(this.id),this.displayType=i.getLeaderboardDisplayType(this.id),this.getEntryCount()}var i=require("greenworks"),n=require("nebula/signal"),r={},s=new n,o=new n,a=new n;return e.prototype.getEntryCount=function(){return this.entryCount=i.getLeaderboardEntryCount(this.id)},e.prototype.uploadScore=function(t,e,n,r){var s=this;i.uploadLeaderboardScore(this.id,i.LeaderboardUploadScoreMethod.ForceUpdate,t||0,e||[],function(t,e,i){o.send(s,t,e,i),n&&n(t,e,i)},function(t){r&&r(t)})},e.prototype.downloadEntriesOfFriends=function(t,e){var n=this;i.downloadLeaderboardEntries(this.id,i.LeaderboardDataRequest.Friends,0,0,function(e){a.send(n,e),t&&t(e)},function(i){if("No leaderboard entries found."===i){var r=[];a.send(n,r),t&&t(r)}else e&&e(i)})},e.prototype.downloadEntriesAroundUser=function(t,e,n,r){var s=this;t>0&&(t=-t),i.downloadLeaderboardEntries(this.id,i.LeaderboardDataRequest.GlobalAroundUser,t,e,function(t){a.send(s,t),n&&n(t)},function(t){if("No leaderboard entries found."===t){var e=[];a.send(s,e),n&&n(e)}else r&&r(t)})},e.prototype.downloadUserEntry=function(t,e){this.downloadEntriesAroundUser(0,0,t,e)},e.prototype.downloadEntriesRange=function(t,e,n,r){var s=this;i.downloadLeaderboardEntries(this.id,i.LeaderboardDataRequest.Global,t,e,function(t){a.send(s,t),n&&n(t)},function(t){if("No leaderboard entries found."===t){var e=[];a.send(s,e),n&&n(e)}else r&&r(t)})},{load:t,onLoad:s,onScoreUploaded:o,onEntriesDownloaded:a,list:r,Leaderboard:e}}),define("signs",function(){"use strict";var t=require("pixi"),e=require("renderers/interface/sign"),i=require("renderers/interface/text"),n=(require("image_packer"),require("pitch").Pitch);new i;this._atlas=null,this.resize=function(t,e){var i=Math.min(t/1920,e/1080);this.all.scale.set(i,i),this.all.position.set(.5*t,.5*e)},this.load=function(i){this.all=new t.Container,this.goal=new e("goal",{wiggle:!0,outDelay:5,fontSize:200,text:"GOOOAL!"}),this.goalKick=new e("goalkick",{outDelay:3,fontSize:100,text:"GOAL KICK!"}),this.cornerKick=new e("cornerkick",{outDelay:3,fontSize:100,text:"CORNER KICK!"}),this.throwIn=new e("throwin",{outDelay:3,fontSize:100,text:"THROW IN!"}),this.halfTime=new e("halftime",{outDelay:3,fontSize:100,text:"HALF TIME!"}),this.goal.position.y=216,this.goalKick.position.y=-270,this.cornerKick.position.y=-270,this.throwIn.position.y=-270,this.halfTime.position.y=-270,this.all.addChild(this.goal),this.all.addChild(this.goalKick),this.all.addChild(this.cornerKick),this.all.addChild(this.throwIn),this.all.addChild(this.halfTime),i.stage.addChild(this.all),i.pitch.entities.add(this.goal),i.pitch.entities.add(this.goalKick),i.pitch.entities.add(this.cornerKick),i.pitch.entities.add(this.throwIn),i.pitch.entities.add(this.halfTime),n.goalScored(this.goal.show,this.goal),n.states.GoalKick.onEnter(this.goalKick.show,this.goalKick),n.states.Corner.onEnter(this.cornerKick.show,this.cornerKick),n.states.ThrowIn.onEnter(this.throwIn.show,this.throwIn),n.halfEnded(this.halfTime.show,this.halfTime)},this.hide=function(){this.goal.hide(),this.goalKick.hide(),this.cornerKick.hide(),this.throwIn.hide(),this.halfTime.hide()}}),define("ui",function(){"use strict";var t=require("pixi"),e=require("renderers/interface/score"),i=require("renderers/interface/avatar");this.resize=function(t,e){var i=Math.min(t/1920,e/1080),n=Math.floor(.5*t);this.topLeft.position.set(0,0),this.top.position.set(n,0),this.topRight.position.set(t-1,0),this.bottomLeft.position.set(0,e-1),this.bottom.position.set(n,e-1),this.bottomRight.position.set(t-1,e-1),this.topLeft.scale.set(i,i),this.top.scale.set(i,i),this.topRight.scale.set(i,i),this.bottomLeft.scale.set(i,i),this.bottom.scale.set(i,i),this.bottomRight.scale.set(i,i)},this.load=function(n){this.all=new t.Container,this.topLeft=new t.Container,this.top=new t.Container,this.topRight=new t.Container,this.bottomLeft=new t.Container,this.bottom=new t.Container,this.bottomRight=new t.Container,this.all.addChild(this.topLeft),this.all.addChild(this.top),this.all.addChild(this.topRight),this.all.addChild(this.bottomLeft),this.all.addChild(this.bottom),this.all.addChild(this.bottomRight),this.score=new e,this.score.position.set(0,50),this.top.addChild(this.score);var r=n.stadium.players.length/2;this.avatars=new Array(n.stadium.players.length);for(var s=0;s<this.avatars.length;s++){this.avatars[s]=new i({player:n.stadium.players[s],spine:t.loader.resources["data/player.json"].data,isLeft:r>s,teamIndex:s%r});var o=s%(this.avatars.length/2)+1;this.avatars[s].position.y=100,this.avatars[s].isLeft?(this.avatars[s].position.x=100*o,this.topLeft.addChild(this.avatars[s])):(this.avatars[s].position.x=-100*o,this.topRight.addChild(this.avatars[s])),this.avatars[s].hide(!0),this.score.visible=!1}n.stage.addChild(this.all)},this.reset=function(){this.score.reset();for(var t=0;t<this.avatars.length;t++)this.avatars[t].hide(!0)},this.hide=function(){this.score.visible=!1;for(var t=0;t<this.avatars.length;t++)this.avatars[t].hide()},this.show=function(){this.score.visible=!0;for(var t=0;t<this.avatars.length;t++)this.avatars[t].show()},this.update=function(t){for(var e=0;e<this.avatars.length;e++)this.avatars[e].update(t)}}),define("validator",function(){"use strict";function t(t){this.message=t}function e(e,i){if("number"!=typeof e)throw new t("Invalid type");var n="undefined"!=typeof i.min?n:-(1/0),r="undefined"!=typeof i.max?r:1/0;if(n>e||e>r)throw new t("Value is out of range ["+n+", "+r+"]");return e}function i(e,i){if("string"!=typeof e)throw new t("Invalid type");return e}function n(e,i){if("boolean"!=typeof e)throw new t("Invalid type");return e}function r(e,i){if(-1===i.choices.indexOf(e))throw new t("Invalid choice");return e}function s(e,i){if(!Array.isArray(e))throw new t("Invalid type");return e}function o(e,i){try{JSON.parse(e)}catch(n){throw new t("Invalid type")}return e}function a(e,i){function n(t,e){s[t]=s[t]||[],s[t].push(e)}var r={},s={};for(var o in e)if(-1===Object.keys(i).indexOf(o)){n(o,"Property does not exist in supplied rules.");continue}for(var o in i){var a=e[o],h=i[o],l=!0;try{if(-1===Object.keys(e).indexOf(o)&&h.required!==!1)throw new t("Property does not exist in supplied object");if(void 0===a&&h.required!==!1)throw new t("Property is required");if(h.required!==!1)if("function"==typeof h.type)a=h.type(a,h);else{if(!c[h.type])throw new Error("Cannot validate. Unknown type.");a=c[h.type](a,h)}}catch(p){if(!(p instanceof t))throw p;l=!1,n(o,p.message)}l?r[o]=a:"undefined"!=typeof h["default"]?(n(o,"Using default"),r[o]=h["default"]):n(o,"No default supplied - ignoring")}var d={};return d.cleaned=r,Object.keys(s).length?d.errors=s:d.errors=null,u&&d.errors&&console.log(JSON.stringify({input:e,rules:i,errors:d.errors,output:d.cleaned},null,4)),d}function h(e,i){var n={};n.errors=[];try{if(void 0===e&&i.required!==!1)throw new t("Property is required");if(i.required!==!1)if("function"==typeof i.type)e=i.type(e,i);else{if(!c[i.type])throw new Error("Cannot validate. Unknown type.");e=c[i.type](e,i)}}catch(r){if(!(r instanceof t))throw r;n.errors.push(r.message)}return n.errors.length?"undefined"!=typeof i["default"]?(n.errors.push("Using default"),n.cleaned=i["default"]):n.errors.push("No default supplied - ignoring"):(n.cleaned=e,delete n.errors),n}var l=require("settings"),u=l("VALIDATOR_DEBUG",!1),c={number:e,string:i,"boolean":n,choice:r,array:s,json:o};return a.registry=c,a.validateValue=h,a.ValidationError=t,a}),define("tournament",function(){"use strict";function t(t){for(var e=[],i=0;t>i;i++)e[i]="Team-"+i;return e}function e(t,e){for(var i=[],n=0,r=0;r<t.length;r++)for(var s=r+1;s<t.length;s++)i.push({alias:e+"-"+ ++n,type:"Match",teams:[Number(t[r]),Number(t[s])],drawAllowed:!0});return i}function i(t){for(var e=[],i={},n=t.length,r=0;r<t.length;r++)i[t[r].teams[0]]=0,i[t[r].teams[1]]=0;for(var s=Object.keys(i).map(Number),o=function(t,e){return i[t]-i[e]||d.sign()};e.length<n;){s.sort(o);for(var a=s[0],h=null,l=1;!h;){for(var u=s[l],r=0;r<t.length;r++)if(t[r].teams[0]===a&&t[r].teams[1]===u||t[r].teams[1]===a&&t[r].teams[0]===u){h=t[r];break}l++}e.push(t[r]),t.splice(r,1),i[a]++,i[u]++}for(var r=0;n>r;r++)t[r]=e[r]}function n(t,n,r){for(var s=[],o=t.length/n,a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],h=0;n>h;h++){var l=t.slice(h*o,(h+1)*o),u=e(l,a[h]);i(u),s[h]={alias:a[h],type:"Group",events:u}}return{alias:"group-stage",type:"Group",order:"alternate",qualifiers:r,events:s}}function r(t,e){var i=[];e=0===t?e||[[0,1],[2,3],[4,5],[6,7],[8,9],[10,11],[12,13],[14,15]]:1===t?[["A.1","A.16"],["A.5","A.12"],["A.3","A.14"],["A.7","A.10"],["A.2","A.15"],["A.6","A.11"],["A.4","A.13"],["A.8","A.9"]]:2===t?[["A.1","B.8"],["B.3","A.6"],["B.2","A.7"],["A.4","B.5"],["B.1","A.8"],["A.3","B.6"],["A.2","B.7"],["B.4","A.5"]]:4===t?[["A.1","B.4"],["C.2","D.3"],["B.1","C.4"],["D.2","A.3"],["C.1","D.4"],["A.2","B.3"],["D.1","A.4"],["B.2","C.3"]]:[["A.1","H.2"],["B.1","G.2"],["C.1","F.2"],["D.1","E.2"],["E.1","D.2"],["F.1","C.2"],["G.1","B.2"],["H.1","A.2"]];for(var n=0;8>n;n++){if(!(e[n]instanceof Array))throw new Error("Invalid team array");i[n]={alias:"rs"+(n+1),type:"Match",teams:e[n]}}return{alias:"rs",type:"Group",events:i}}function s(t,e){var i=[];e=0===t?e||[0,1,2,3,4,5,6,7]:1===t?["A.1","A.8","A.3","A.6","A.2","A.7","A.4","A.5"]:2===t?["A.1","B.4","A.2","B.3","B.1","A.4","B.2","A.3"]:4===t?["A.1","D.2","B.1","C.2","C.1","B.2","D.1","A.2"]:["A.1","B.1","C.1","D.1","E.1","F.1","G.1","H.1"];for(var n=0;4>n;n++)i[n]={alias:"qf"+(n+1),type:"Match",teams:[e[2*n],e[2*n+1]]};return{alias:"qf",type:"Group",events:i}}function o(t,e){var i=[];if(0===t)e=e||[0,1,2,3];else if(1===t)e=["A.1","A.3","A.2","A.4"];else if(2===t)e=["A.1","B.2","A.2","B.1"];else{if(4!==t)throw new Error("Too much teams");e=["A.1","B.1","C.1","D.1"]}for(var n=0;2>n;n++)i[n]={alias:"sf"+(n+1),type:"Match",teams:[e[2*n],e[2*n+1]]};return{alias:"sf",type:"Group",events:i}}function a(t,e){var i=e.points-t.points;return i?i:(i=e.maxPoints-t.maxPoints)?i:(i=e.difference-t.difference)?i:(i=e["for"]-t["for"],i?i:0)}function h(t,e){return t.progress-e.progress}function l(t,e,i){this.root=i,this.data=t,this.parent=e}function u(t,e,i){l.apply(this,arguments),this._skip=!1}function c(t,e,i){l.apply(this,arguments),this.children=[];for(var n=0;n<this.data.events.length;n++)this.children.push(new g[this.data.events[n].type](this.data.events[n],this,i));this.aliases=this.getAliases()}function p(t){if(c.apply(this,[t,null,this]),this._userTeams={},Array.isArray(t.userTeam))for(var e=0;e<t.userTeam.length;e++)this._userTeams[t.userTeam[e]]=!0;else this._userTeams[t.userTeam]=!0}var d=require("nebula/random"),f=require("settings"),m=(require("nebula/query"),{});m.world_cup=function(){return m.customCup("world_cup","classic_1","international",10,t(8))},m.customCup=function(e,i,a,h,l,u){l=l||t(32),u=u?32===l.length?8:4:0;for(var c={alias:e||"customCup",ball:i||"classic_1",time:h||10,stadium:a||"team",type:"Group",teams:l.slice(),events:[]},p=0;p<l.length;p++)l[p]=p;if(!u&&l.length>16)throw new Error("Too much teams");return u&&c.events.push(n(l,u,2)),l.length>=16&&(!u||2*u>=16)&&(c.events.push(r(u)),l=["rs1.1","rs2.1","rs3.1","rs4.1","rs5.1","rs6.1","rs7.1","rs8.1"],u=0),l.length>=8&&(c.events.push(s(u,l)),l=["qf1.1","qf2.1","qf3.1","qf4.1"],u=0),l.length>=4&&c.events.push(o(4>=u?u:0,l)),c.events.push({alias:"f",type:"Group",events:[{alias:"f1",type:"Match",teams:["sf1.2","sf2.2"]},{alias:"f2",type:"Match",teams:["sf1.1","sf2.1"]}]}),c};var g={};return l.prototype.toString=function(t){return t?JSON.stringify(this.data,null,4):JSON.stringify(this.data)},l.prototype.find=function(){return null},l.prototype.getAliases=function(t){return t=t||{},t[this.data.alias]=this,t},l.prototype.findByAlias=function(t){return this.data.alias===t?this:null},Object.defineProperty(l.prototype,"progress",{get:function(){return Number(Boolean(this.data.results))}}),u.prototype=Object.create(l.prototype),u.prototype.skip=function(){this._skip=!0},u.prototype.unSkip=function(){this._skip=!1},u.prototype.find=function(t){var e=this.root.findTeam(this.data.teams[0]),i=this.root.findTeam(this.data.teams[1]);return this.data.results||this._skip||"number"!=typeof e||"number"!=typeof i?null:t?this.isUserMatch?this:null:this},u.prototype.getMatches=function(){return this},u.prototype.setTeams=function(){this.data.teams[0]=this.root.findTeam(this.data.teams[0]),this.data.teams[1]=this.root.findTeam(this.data.teams[1])},u.prototype.setResults=function(t){this.data.results=t},Object.defineProperty(u.prototype,"points",{get:function(){var t=[],e=this.data.results.goals[0],i=this.data.results.goals[1],n={team:this.data.teams[0],points:0},r={team:this.data.teams[1],points:0};return e>i?n.points+=3:i>e?r.points+=3:(n.points+=1,r.points+=1),t.push(n,r),t.sort(a),t}}),Object.defineProperty(u.prototype,"isUserMatch",{get:function(){var t=this.root.findTeam(this.data.teams[0]),e=this.root.findTeam(this.data.teams[1]),i=[];return Array.isArray(this.root.data.userTeam)?(i[0]=-1!==this.root.data.userTeam.indexOf(this.root.data.teams[t]),i[1]=-1!==this.root.data.userTeam.indexOf(this.root.data.teams[e])):"string"==typeof this.root.data.userTeam&&(i[0]=this.root.data.userTeam===this.root.data.teams[t],i[1]=this.root.data.userTeam===this.root.data.teams[e]),i[0]||i[1]?i:null}}),Object.defineProperty(u.prototype,"winner",{get:function(){if(!this.data.results)return-1;var t=this.data.results.goals[0],e=this.data.results.goals[1],i=this.root.findTeam(this.data.teams[0]),n=this.root.findTeam(this.data.teams[1]);return t>e?i:e>t?n:-1}}),Object.defineProperty(u.prototype,"loser",{get:function(){if(!this.data.results)return-1;var t=this.data.results.goals[0],e=this.data.results.goals[1],i=this.root.findTeam(this.data.teams[0]),n=this.root.findTeam(this.data.teams[1]);return t>e?n:e>t?i:-1}}),g.Match=u,c.prototype=Object.create(l.prototype),c.prototype.unSkip=function(){for(var t=0;t<this.children.length;t++)this.children[t].unSkip()},c.prototype.find=function(t){var e;if("alternate"===this.data.order){for(var i=this.children.slice().sort(h),n=0;n<i.length;n++)if(e=i[n].find(t))return e}else for(var n=0;n<this.children.length;n++)if(e=this.children[n].find(t))return e;return null},c.prototype.findUserMatch=function(){return this.find(!0)},c.prototype.getMatches=function(){var t=[],e=this.children.slice();if("alternate"===this.data.order){for(var i=[],n=0,r=0;r<e.length;r++)i[r]=e[r].getMatches(),n+=i[r].length;for(r=0;t.length!==n;){var s=i[r].shift();s&&t.push(s),r=(r+1)%e.length}}else for(var r=0;r<e.length;r++)t=t.concat(e[r].getMatches());return t},c.prototype.getAliases=function(t){t=t||{},t[this.data.alias]=this;for(var e=0;e<this.children.length;e++)this.children[e].getAliases(t);return t},c.prototype.findByAlias=function(t){var e;if(this.data.alias===t)return this;for(var i=0;i<this.children.length;i++)if(e=this.children[i].findByAlias(t))return e;return null},c.prototype.countPoints=function(t){t=t||{};for(var e=0;e<this.children.length;e++){var i=this.children[e],n=i.data;if(i instanceof u){var r=t[n.teams[0]]=t[n.teams[0]]||{team:n.teams[0],points:0,won:0,draw:0,lost:0,"for":0,against:0,maxPoints:0,difference:0},s=t[n.teams[1]]=t[n.teams[1]]||{team:n.teams[1],points:0,won:0,draw:0,lost:0,"for":0,against:0,maxPoints:0,difference:0};if(n.results){var o=n.results.goals[0],a=n.results.goals[1];r["for"]+=o,s["for"]+=a,r.against+=a,s.against+=o,o>a?(r.won++,s.lost++,r.points+=3,r.maxPoints=Math.max(r.maxPoints,3)):a>o?(r.lost++,s.won++,s.points+=3,s.maxPoints=Math.max(s.maxPoints,3)):(r.draw++,s.draw++,r.points+=1,s.points+=1,r.maxPoints=Math.max(r.maxPoints,1),s.maxPoints=Math.max(s.maxPoints,1)),r.difference=r["for"]-r.against,s.difference=s["for"]-s.against}}else i.countPoints(t)}return t},Object.defineProperty(c.prototype,"progress",{get:function(){var t=this.children.length;if(!t)return 1;for(var e=0,i=0;t>i;i++)e+=this.children[i].progress;return e/t}}),Object.defineProperty(c.prototype,"points",{get:function(){var t=this.countPoints(),e=[];for(var i in t)e.push(t[i]);return e.sort(a),e}}),g.Group=c,p.prototype=Object.create(c.prototype),p.prototype.findTeam=function(t){var e=this;if("number"==typeof t)return t;t=t.split(".");for(var i=0;i<t.length;i++){if(parseInt(t[i],10))return 1===e.progress?e.points[parseInt(t[i],10)-1].team:null;if(e=e.findByAlias(t[i]),!e)break}throw new Error("Team not found")},p.prototype.play=function(t){if(t||(t=this.find()),t){if(t.data.teams[0]=this.findTeam(t.data.teams[0]),t.data.teams[1]=this.findTeam(t.data.teams[1]),!t.data.results){var e=d.integer(1,9),i=d.integer(1,9);e===i&&(i+=d.sign()),t.setResults({goals:[e,i]})}f("DEBUG")&&f("TOURNAMENT_DEBUG",!1)&&console.log(t.parent.data.alias,this.data.teams[t.data.teams[0]],"vs",this.data.teams[t.data.teams[1]]);for(var n=t;n&&(n=n.parent);)f("DEBUG")&&f("TOURNAMENT_DEBUG",!1)&&(console.log(n.data.alias),console.table(n.points));return this.updateTeams(this),t}},p.prototype.updateTeams=function(t){if(t.children)for(var e=0;e<t.children.length;e++)this.updateTeams(t.children[e]);if(t instanceof u){var i=this.findTeam(t.data.teams[0]),n=this.findTeam(t.data.teams[1]);null!==i&&(t.data.teams[0]=i),null!==n&&(t.data.teams[1]=n)}},g.Tournament=p,p.templates=m,p}),define("profiles",function(){"use strict";function t(t){return localStorage.setItem("player1",JSON.stringify(t))}function e(t,e){this.id=t,this.data=e||{},this.data.version=i("VERSION");for(var n in s)this.addFieldGroup(n,s[n])}var i=require("settings"),n=require("validator"),r=require("nebula/signal"),s=i("DEFAULT_OPTIONS"),o=i("DEBUG");e.prototype.addFieldGroup=function(t,e){this[t]={},this.data[t]=this.data[t]||{};for(var i in e)this.addProperty(t,i)},e.prototype.addProperty=function(t,e){var i=this.data[t];Object.defineProperty(this[t],e,{get:function(){return i[e]},set:function(r){i[e]=r;var a=n(i,s[t]);o&&a.errors&&console.log("Errors when setting `"+e+"`",a.errors),i[e]=a.cleaned[e]}}),this[t][e]=i[e]},e.prototype.save=function(){for(var e in this.data)if(e in s){var i=n(this.data[e],s[e]);for(var r in this.data[e])-1===Object.keys(i.cleaned).indexOf(r)&&delete this.data[e][r]}a.onProfileDataChange.send(),t(this.data)},e.prototype.reset=function(){var t=i("DEFAULT_OPTIONS",{});for(var e in t)for(var n in t[e])this[e][n]=void 0;a.onProfileDataChange.send(),this.save()};var a={};return a.onProfileChange=new r,a.onProfileDataChange=new r,a.current=null,a.all={},a.load=function(){var t=localStorage.getItem("player1")||null;t&&(t=JSON.parse(t),a.all.player1=t)},a.createProfile=function(t){if(a.all[t])throw new Error("Profile already exists");return a.all[t]={},a.all[t]},a.changeProfile=function(t){if(!a.all[t])throw new Error("Invalid profile id");return a.current=new e(t,a.all[t]),a.onProfileChange.send(a.current),a.current},a}),define("fame",function(){"use strict";function t(t){return s(h+t)}function e(e){return e=e||o.current.fame.score,t(e)===o.current.fame.token}function i(e){e=Math.round(e),o.current.fame.score=e,o.current.fame.token=t(e),o.current.save(),l.send(e)}function n(){return e()?o.current.fame.score:0}function r(t){i(n()+t)}var s=require("nebula/md5"),o=require("profiles"),a=require("nebula/signal"),h="K0pan1t0156r3at",l=new a;return{onChange:l,isValid:e,set:i,get:n,add:r,token:t}}),define("leaderboard_leagues",function(){"use strict";function t(){this.offline=!1,this.lastResults=null,this.onEntriesDownloading=new r,this.onEntriesDownloaded=new r,this.onOffline=new r,this.onLoaded=new r,this.onDataLoading=new r,this.onDataLoaded=new r,this.onPromotion=new r,this.onRelegation=new r,i.loaded&&s.onChange(this.setScore.bind(this))}var e=require("settings"),i=require("greenworks"),n=require("leaderboard"),r=require("nebula/signal"),s=require("fame"),o=require("profiles"),a=e("LEADERBOARD_PLATINUM_LIMIT"),h=e("LEADERBOARD_PLATINUM_SCORE"),l=e("LEADERBOARD_GOLD_LIMIT"),u=e("LEADERBOARD_GOLD_SCORE"),c=e("LEADERBOARD_SILVER_LIMIT"),p=e("LEADERBOARD_SILVER_SCORE"),d=["bronze","silver","gold","platinum"];return t.prototype.load=function(t,e){function i(){s--,0===s&&(o.onLoaded.send(),t&&t())}function r(){s--,0===s&&(o.offline=!0,o.onOffline.send(),e&&e())}var s=4,o=this;n.load("platinum",i,r),n.load("gold",i,r),n.load("silver",i,r),n.load("bronze",i,r)},t.prototype.getUserLeagueStats=function(t){function e(e,n,s){s?r[e].last=n:r[e].user=n,i--,0===i&&t(r)}var i=4,r={platinum:{user:null,last:null},gold:{user:null,last:null},silver:{user:null,last:null},bronze:{user:null,last:null}};n.list.platinum.downloadUserEntry(function(t){e("platinum",t[0])}),n.list.gold.downloadUserEntry(function(t){e("gold",t[0])}),n.list.silver.downloadUserEntry(function(t){e("silver",t[0])}),n.list.bronze.downloadUserEntry(function(t){e("bronze",t[0])}),n.list.platinum.getEntryCount()>a&&(i++,n.list.platinum.downloadEntriesRange(a,a,function(t){e("platinum",t[0],!0)})),n.list.gold.getEntryCount()>l&&(i++,n.list.gold.downloadEntriesRange(l,l,function(t){e("gold",t[0],!0)})),n.list.silver.getEntryCount()>c&&(i++,n.list.silver.downloadEntriesRange(c,c,function(t){e("silver",t[0],!0)}))},t.prototype.processLeagueStats=function(t,e){for(var i={score:e||0,league:"",rank:1/0,userId:null,scoreLimit:[h,u,p]},n=Object.keys(t),r=0;r<n.length;r++){if(!t[n[r]].user)return i;i.userId=t[n[r]].user.user.accountId,e||(i.score=Math.max(i.score,Math.abs(t[n[r]].user.score)))}if(i.score>=h)if(t.platinum.last&&t.platinum.last.score>i.score);else{if(i.league="platinum",!t.platinum.user)return i;i.rank=t.platinum.user.rank}if(!i.league&&i.score>=u)if(t.gold.last&&t.gold.last.score>i.score);else{if(i.league="gold",!t.gold.user)return i;i.rank=t.gold.user.rank}if(!i.league&&i.score>=p)if(t.silver.last&&t.silver.last.score>i.score);else{if(i.league="silver",!t.silver.user)return i;i.rank=t.silver.user.rank}if(!i.league){if(i.league="bronze",!t.bronze.user)return i;i.rank=t.bronze.user.rank}return t.platinum.last&&(i.scoreLimit[0]=Math.max(i.scoreLimit[0],t.platinum.last.score)),t.gold.last&&(i.scoreLimit[1]=Math.max(i.scoreLimit[1],t.gold.last.score)),t.silver.last&&(i.scoreLimit[2]=Math.max(i.scoreLimit[2],t.silver.last.score)),i},t.prototype.getScore=function(t){this.onDataLoading.send(this),this.getUserLeagueStats(function(e){var i=this.processLeagueStats(e);this.lastResults=i,this.onDataLoaded.send(this),t&&t(i)}.bind(this))},t.prototype.getOrSetScore=function(t){this.getScore(function(e){e.rank===1/0?this.reset(function(){this.getScore(t)}.bind(this)):t&&t(e)}.bind(this))},t.prototype.filterEntries=function(t,e){for(var i=t.length;--i>=0;)t[i].score<0?t.splice(i,1):"platinum"===e&&(t[i].rank>a||t[i].score<h)?t.splice(i,1):"gold"===e&&(t[i].rank>l||t[i].score<u)?t.splice(i,1):"silver"===e&&(t[i].rank>c||t[i].score<p)&&t.splice(i,1)},t.prototype.reset=function(t,e){function i(e,i,n){s--,0===s&&t&&t(e,i,n)}function r(t){e&&e(t)}var s=4,a=[o.current.stats.wins,o.current.stats.draws,o.current.stats.loses,o.current.stats.goalsScored,o.current.stats.goalsConceded];n.list.platinum.uploadScore(0,a,i,r),n.list.gold.uploadScore(0,a,i,r),n.list.silver.uploadScore(0,a,i,r),n.list.bronze.uploadScore(0,a,i,r)},t.prototype.setScore=function(t,e,i){if(this.onDataLoading.send(this),t=Math.round(t),this.lastResults){var r=d.indexOf(this.lastResults.league);this.getUserLeagueStats(function(s){function a(t,i,n){c--,0===c&&(p.onDataLoaded.send(p),e&&e(t,i,n))}function h(t){i&&i(t)}var l=this.processLeagueStats(s,t);if(!l.league||!l.userId)return void this.onDataLoaded.send(this);this.lastResults=l;var u=d.indexOf(this.lastResults.league);u>r?this.onPromotion.send(this.lastResults.league):r>u&&this.onRelegation.send(this.lastResults.league);var c=4,p=this,f=[o.current.stats.wins,o.current.stats.draws,o.current.stats.loses,o.current.stats.goalsScored,o.current.stats.goalsConceded];n.list.platinum.uploadScore(l.score*("platinum"===l.league?1:-1),f,a,h),n.list.gold.uploadScore(l.score*("gold"===l.league?1:-1),f,a,h),n.list.silver.uploadScore(l.score*("silver"===l.league?1:-1),f,a,h),n.list.bronze.uploadScore(l.score*("bronze"===l.league?1:-1),f,a,h)}.bind(this))}},t.prototype.getEntryCount=function(){return n.list[this.lastResults.league].getEntryCount()},t.prototype.generateAvatar=function(t){var e=i.getMediumFriendAvatar(t.user.accountId),n=i.getImageData(e),r=document.createElement("canvas");r.width=n.width,r.height=n.height;for(var s=r.getContext("2d"),o=s.createImageData(n.width,n.height),a=0;a<o.data.length;a++)o.data[a]=n.rgba[a];s.putImageData(o,0,0),t.avatar=r.toDataURL()},t.prototype.downloadEntriesOfFriends=function(t,e){function r(){l.onEntriesDownloaded.send(l,h),t&&t(h)}function s(t,e){if(a--,l.filterEntries(e,t),h[t]=e,0===a){for(var n in h)u+=h[n].length;if(!u)return void r();for(var n in h)for(var s=0;s<h[n].length;s++)i.requestUserInformation(h[n][s].user.accountId,!0,o)}}function o(t,e,i){if(u--,0===u){for(var n in h)for(var s=0;s<h[n].length;s++)l.generateAvatar(h[n][s]);r()}}this.onEntriesDownloading.send(this);var a=4,h={},l=this,u=0;n.list.platinum.downloadEntriesOfFriends(function(t){s("platinum",t)},e),n.list.gold.downloadEntriesOfFriends(function(t){s("gold",t)},e),n.list.silver.downloadEntriesOfFriends(function(t){s("silver",t)},e),n.list.bronze.downloadEntriesOfFriends(function(t){s("bronze",t)},e)},t.prototype.downloadEntriesAroundUser=function(t,e,r,s){function o(){c.onEntriesDownloaded.send(c,l),r&&r(l)}function a(t){if(l=t,c.filterEntries(l,u),!l.length)return void o();p=l.length;for(var e=0;e<l.length;e++)i.requestUserInformation(l[e].user.accountId,!0,h)}function h(t,e,i){if(p--,0===p){for(var n=0;n<l.length;n++)c.generateAvatar(l[n]);o()}}this.onEntriesDownloading.send(this);var l,u=this.lastResults.league,c=this,p=1;n.list[u].downloadEntriesAroundUser(t,e,a,s)},t.prototype.downloadEntriesRange=function(t,e,r,s){function o(){c.onEntriesDownloaded.send(c,l),r&&r(l)}function a(t){if(l=t,c.filterEntries(l,u),!l.length)return void o();p=l.length;for(var e=0;e<l.length;e++)i.requestUserInformation(l[e].user.accountId,!0,h)}function h(t,e,i){if(p--,0===p){for(var n=0;n<l.length;n++)c.generateAvatar(l[n]);o()}}this.onEntriesDownloading.send(this);var l,u=this.lastResults.league,c=this,p=1;n.list[this.lastResults.league].downloadEntriesRange(t,e,a,s)},Object.defineProperty(t.prototype,"userId",{get:function(){return this.lastResults?this.lastResults.userId:null}}),new t}),define("menu",function(){"use strict";function t(t,e,i){i=i||{},i.label=i.label||e.label,i.actions=i.actions||{},i.actions.enter=i.actions.enter||[],"function"==typeof i.actions.enter&&(i.actions.enter=[i.actions.enter]),e&&i.actions.enter.push(e.open);var n=new l(i);return t.children.push(n),n}function e(t){var e=new l({label:"Back",id:"backButton",actions:{enter:a.back}});return t.children.push(e),t.backButton=e,e}function i(){T.downloadEntriesAroundUser(6,7)}function n(){T.downloadEntriesOfFriends()}function r(t,i){t.add(new y({api:i,id:"up",label:"Up"})).add(new y({api:i,id:"down",label:"Down"})).add(new y({api:i,id:"left",label:"Left"})).add(new y({api:i,id:"right",label:"Right"})).add(new y({api:i,id:"sprint",label:"Sprint"})).add(new y({api:i,id:"slide",label:"Slide tackle"})).add(new y({api:i,id:"goalkeeperSlide",label:"GK slide tackle"})).add(new y({api:i,id:"togglePlayer",label:"Toggle player"})).add(new y({api:i,id:"toggleTeam",label:"Toggle controller"})).add(new y({api:i,id:"pass",label:"Pass"})).add(new y({api:i,id:"lob",label:"Lob pass"})).add(new y({api:i,id:"shoot",label:"Shoot"})).add(new y({api:i,id:"swerveUp",label:"Swerve left"})).add(new y({api:i,id:"swerveDown",label:"Swerve right"})).add(new y({api:i,id:"powerup",label:"Super-move"})).add(new y({api:i,id:"pause",label:"Pause"})).add(new y({api:i,id:"back",label:"Menu back"})).add(new y({api:i,id:"enter",label:"Menu accept"})).add(new l({id:"reset",label:"Reset to defaults"})).add(new l({id:"save",label:"Save"})),e(t)}function s(t,e){var i=C.main.find.play,n=i.label,r=C[t]=new h({label:n,templatePath:"gui/cup_team_select.txt"}),s=C[t].teamSelectMenu=new c({label:"Select team",showPreviousContainer:!0});s.addChoice(A),i.addAction("enter",r.open),r.add(new u({id:"teams1",label:"Select team",classes:"left",actions:{enter:s.open}})).add(new l({id:"startButton",label:"Start game"})).add(new l({id:"backButton",label:"Back",classes:"right",actions:{enter:a.back}})),r.find.teams1.value=s.choices[0].data}var o=require("nebula/numbers"),a=require("nebula/gui/gui"),h=require("nebula/gui/container"),l=require("nebula/gui/button"),u=require("gui/team_select"),c=require("gui/team_container"),p=require("gui/select"),d=require("gui/tournament"),f=require("gui/leaderboards"),m=require("gui/help"),g=require("gui/in_game_menu"),y=require("gui/input_binder"),v=(require("gui/alert"),require("settings")),x=require("nebula/input/gamepad"),b=require("nebula/input/keyboard"),w=require("nebula/objects"),_=require("profiles"),T=require("leaderboard_leagues"),E=require("fame"),S=(require("nebula/format"),[{name:"Off",value:!1},{name:"On",value:!0}]),A=w.copy(v("RANDOM_TEAM"),{name:"Random Team"},{}),C={},P=function(){return!0};C.gui=a,
Object.defineProperty(C,"isActive",{get:function(){return C.gui.top!==C.inGame&&C.gui.top!==C.loading}}),C.hide=function(){C.gui.container.style.display="none"},C.show=function(){C.gui.container.style.display="block"},C.intro=new h({id:"intro",label:"_intro_",templatePath:"gui/intro.txt",actions:{back:h.prototype.preventActionPropagation}}),C.loading=new h({id:"loading",label:"Loading",templatePath:"gui/loading.txt",actions:{back:h.prototype.preventActionPropagation}}),C.inGame=new g({label:"_game_",actions:{back:h.prototype.preventActionPropagation}}),C.main=new h({label:"Main menu",templatePath:"gui/main_menu.txt",actions:{back:h.prototype.preventActionPropagation}}),C.help=new h({id:"help",label:"How to Play"}),C.helpBasics=new m({label:"Basics",data:"help_basics.txt"}),C.helpPassing=new m({label:"Passing",data:"help_passing.txt"}),C.helpShooting=new m({label:"Shooting",data:"help_shooting.txt"}),C.helpSlideTackle=new m({label:"Slide tackle",data:"help_slide_tackle.txt"}),C.helpSuperMoves=new m({label:"Super-moves",data:"help_super_moves.txt"}),C.helpAdvanced=new m({label:"Advanced techniques",data:"help_advanced.txt"}),C.helpGoalkeeper=new m({label:"Goalkeeper",data:"help_goalkeeper.txt"}),C.options=new h({label:"Options"}),C.audio=new h({label:"Audio"}),C.graphics=new h({label:"Video"}),C.controls=new h({label:"Controls"}),C.keyboard=new h({label:"Keyboard",templatePath:"gui/controls_keyboard.txt"}),C.gamepad1=new h({label:"Gamepad 1",templatePath:"gui/controls_keyboard.txt"}),C.gamepad2=new h({label:"Gamepad 2",templatePath:"gui/controls_keyboard.txt"}),C.gamepad3=new h({label:"Gamepad 3",templatePath:"gui/controls_keyboard.txt"}),C.gamepad4=new h({label:"Gamepad 4",templatePath:"gui/controls_keyboard.txt"}),C.pause=new h({label:"Pause",classes:"transparent",templatePath:"gui/pause.txt"}),C.tournament=new d({label:"World Cup"}),C.fullVersion=new h({label:"Full version",templatePath:"gui/full_version.txt"}),C.leaderboards=new f({label:"Leaderboards",api:T}),C.showInGameMenu=function(){for(;a.stack.length&&a.top!==C.inGame;)a.pop();document.body.classList.remove("loading")},C.showLoadingScreen=function(){for(;a.stack.length&&a.top!==C.inGame;)a.pop();C.loading.open(),document.body.classList.add("loading")},C.showIntroScreen=function(){for(;a.stack.length&&a.top!==C.inGame;)a.pop();C.intro.open()},C.main.add(new l({id:"play",label:"Play"})),t(C.main,C.help),t(C.main,C.options),t(C.main,C.fullVersion,{templatePath:"gui/button_steam.txt"}),T.onLoaded(function(){C.main.find.leaderboard_button.disabled=!1,C.main.find.leaderboard_button.actions.enter[0]=C.leaderboards.open,C.main.updateWidget()}),C.gui.onOpen({sender:C.leaderboards,receiver:i}),C.leaderboards.add(new l({id:"findMe",label:"Global",actions:{enter:[i]}})).add(new l({id:"showFriends",label:"Friends",actions:{enter:[n]}})),e(C.leaderboards),t(C.help,C.helpBasics),t(C.help,C.helpPassing),t(C.help,C.helpShooting),t(C.help,C.helpSlideTackle),t(C.help,C.helpSuperMoves),t(C.help,C.helpAdvanced),t(C.help,C.helpGoalkeeper),e(C.help),e(C.helpBasics),e(C.helpPassing),e(C.helpShooting),e(C.helpSlideTackle),e(C.helpSuperMoves),e(C.helpAdvanced),e(C.helpGoalkeeper),t(C.options,C.graphics),t(C.options,C.audio),t(C.options,C.controls),e(C.options),C.gui.onClose(function(t){t===C.options&&_.current.save()});for(var M=[],O=0;100>=O;O+=10)M.push({name:O+"%",value:O/100});C.audio.add(new p({id:"enabled",label:"Audio",choices:S,selectOnFocus:!0})).add(new p({id:"fxVolume",label:"Effects volume",choices:M,selectOnFocus:!0,defaultChoiceTemplatePath:"gui/button_small.txt"})).add(new p({id:"musicVolume",label:"Music volume",choices:M,selectOnFocus:!0,defaultChoiceTemplatePath:"gui/button_small.txt"})),e(C.audio),C.graphics.add(new p({id:"shadows",label:"Shadows",choices:S,selectOnFocus:!0})).add(new p({id:"particles",label:"Particles",choices:S,selectOnFocus:!0})),e(C.graphics),C.gui.onOpen({sender:C.pause,receiver:function(){for(var t=["shadows"],e=0;e<t.length;e++){var i=C.graphics.find[t[e]].choiceContainer;i.showPreviousContainer=!1,i.classes="transparent"}}}),C.gui.onClose({sender:C.pause,receiver:function(){for(var t=["shadows"],e=0;e<t.length;e++){var i=C.graphics.find[t[e]].choiceContainer;i.showPreviousContainer=!0,i.classes=""}}}),t(C.controls,C.keyboard),t(C.controls,C.gamepad1),t(C.controls,C.gamepad2),t(C.controls,C.gamepad3),t(C.controls,C.gamepad4),e(C.controls),r(C.keyboard,b),r(C.gamepad1,x),r(C.gamepad2,x),r(C.gamepad3,x),r(C.gamepad4,x),s("world_cup"),C.tournament.add(new l({id:"continueButton",label:"Play match",actions:{enter:P}})).add(new l({id:"backButton",label:"Exit",classes:"right",actions:{enter:P}})).add(new l({id:"endGameButton",label:"End Tournament",classes:"right",actions:{enter:P}})).addAction("back",P),C.pause.add(new l({id:"backButton",label:"Resume",actions:{enter:[a.back]}})).add(new l({label:"How to Play",actions:{enter:C.help.open}})).add(new l({label:"Options",actions:{enter:C.options.open}})).add(new l({label:"Quit",id:"exitToMenu"})).addAction("back",P),C.fullVersion.add(new l({templatePath:"gui/slider_image.txt",data:{imagePath:"images/full_version/01.jpg"}})).add(new l({templatePath:"gui/slider_image.txt",data:{imagePath:"images/full_version/02.jpg"}})).add(new l({templatePath:"gui/slider_image.txt",data:{imagePath:"images/full_version/03.jpg"}})).add(new l({templatePath:"gui/slider_image.txt",data:{imagePath:"images/full_version/04.jpg"}})).add(new l({templatePath:"gui/slider_image.txt",data:{imagePath:"images/full_version/05.jpg"}})).add(new l({templatePath:"gui/slider_image.txt",data:{imagePath:"images/full_version/06.jpg"}})).add(new l({templatePath:"gui/slider_image.txt",data:{imagePath:"images/full_version/07.jpg"}})).add(new l({templatePath:"gui/slider_image.txt",data:{imagePath:"images/full_version/08.jpg"}})).add(new l({id:"steam",label:"Buy on Steam",templatePath:"gui/button_steam.txt",actions:{enter:function(t){"keyboard"!==t.apis[0].type&&window.open("http://store.steampowered.com/app/399820")}}})),e(C.fullVersion);var R=function(t){var e=t.widget.querySelector(".fame-widget");e&&(e.querySelector(".value").innerHTML=o.format(E.get(),0,"."," "))},k=function(){for(var t=0;t<C.gui.stack.length;t++)R(C.gui.stack[t])};return C.gui.onOpen(R),C.gui.onRedraw(k),E.onChange(k),T.onPromotion(k),T.onRelegation(k),C}),define("modes/global",function(){"use strict";var t=require("settings"),e=require("nebula/states").State,i=require("nebula/input/keyboard"),n=require("menu"),r=require("users"),s=t("DEBUG"),o=e.extend("Global",{enter:function(t){this.game=t,r.onInput(this.userInput,this),r.onControllerDown(this.controllerDown,this),r.onControllerRepeat(this.controllerRepeat,this)},userInput:function(t){n.isActive&&n.gui.setController(t.controller)},controllerDown:function(t,e){n.isActive?n.gui.input(t.controller,e):e&&"pause"===e.name&&(this.game.pitch.pause(),n.show(),n.pause.open(),n.gui.input(t.controller,e))},controllerRepeat:function(t,e){n.isActive&&n.gui.input(t.controller,e)},update:function(t,e){r.update(e),s&&i.keys.z.isDown&&(t.pitch.ball.velocity.z+=.25)},exit:function(){r.onControllerRepeat.disconnect(this.controllerRepeat,this),r.onControllerDown.disconnect(this.controllerDown,this),r.onInput.disconnect(this.userInput,this)}});return o}),define("modes/match",function(){"use strict";var t=require("settings"),e=require("nebula/colors/rgb"),i=require("nebula/math/vector2"),n=require("nebula/math/point2"),r=require("nebula/math/point3"),s=require("nebula/states").State,o=require("nebula/gui/container"),a=require("nebula/gui/button"),h=require("menu"),l=require("players/states"),u=require("players/global"),c=require("users"),p=require("messages"),d=(require("teams"),require("pixi"),require("ui")),f=require("profiles"),m=require("nebula/audio"),g=require("nebula/numbers"),y=require("fame"),v=t("DEBUG",!1),x=s.extend("Match",{enter:function(t,e,i,n,r,s,o){this._players=[t.red1,t.red2,t.red3,t.red4,t.red5,t.blue1,t.blue2,t.blue3,t.blue4,t.blue5],this.fastPlay=o||!1,this.summaryMenu=null,this.loaded=!1,this.drawAllowed="boolean"==typeof r?r:!0,this.playing=!1,this.halfEnded=!1,this.options={redTeam:e,blueTeam:i,time:n,kits:this.selectKits(e,i),ai:s},this.loadMatch(t,e,this.options.kits[0],i,this.options.kits[1])},parseColor:function(t){var i=parseInt(t.slice(0,2),16),n=parseInt(t.slice(2,4),16),s=parseInt(t.slice(4,6),16),o={};return e.toYIQ({r:i,g:n,b:s},o),r.create(o.y,o.i,o.q)},selectKits:function(t,e){var i=this.parseColor(t.kitColors.home),n=this.parseColor(t.kitColors.away),s=this.parseColor(e.kitColors.home),o=this.parseColor(e.kitColors.away),a=r.distance(i,s),h=r.distance(i,o),l=r.distance(n,s);return Math.max(a,h,l)===a?["home","home"]:h>l?["home","away"]:["away","home"]},updateClock:function(){var t=this.machine.owner;h.isActive||d.score.setClock(Math.min(t.pitch.matchTime/5400,1),t.pitch.matchTime,t.pitch.secondHalf)},loadMatch:function(t,e,i,n,r){h.showLoadingScreen();var s=this;setTimeout(function(){t.stadium.loadMatch(e,i,n,r,s.selectTeams.bind(s,t))},250)},onUserConnect:function(t,e){var i=e.sender;return this.playing&&i.team&&(i.online=!0),!0},onUserDisconnect:function(t,e){return!this.loaded||this.playing?!0:(this.removeUser(t,e.sender),!0)},getIdlePlayer:function(){for(var t=0;t<this._players.length;t++)if(!this._players[t].user)return this._players[t];return null},removeUser:function(t,e){e.online=!1,e.player&&t.removePlayer(e.player),h.inGame.onControllerChange()},addUser:function(t,e){var n=this.getIdlePlayer(),r=i.temp();e.online=!0,e.takeControl(n,l.HumanSelectTeam,u.HumanSelectTeamGlobal),i.direction(c.list.indexOf(e)/c.list.length*Math.PI*2,r),n.position.x=n.oldPosition.x=t.pitch.center.x+3*r.x,n.position.y=n.oldPosition.y=t.pitch.center.y+3*r.y,n.stop(),n.setHeading(i.temp(0,1)),t.addPlayer(n),h.inGame.onControllerChange()},selectTeams:function(t){document.body.classList.remove("loading"),d.score.setFlags(this.options.redTeam._flag_thumbnail,this.options.blueTeam._flag_thumbnail),d.score.reset(),d.score.visible=!0,h.inGame.reset(),h.showInGameMenu(),t.entities.prepend(t.pitch),t.pitch.reset(),t.pitch.resume(),t.onEnter.send(),this.fastPlay||(h.inGame.showHelpText(),h.inGame.showUserKeys(),h.inGame.onControllerChange()),t.pitch.ball.placeAtPosition(t.pitch.center.x,t.pitch.height+10,0),t.stadium.camera.lookAt(t.pitch.center),this.loaded=!0;for(var e=0;e<d.avatars.length;e++)d.avatars[e].changePlayer(t.stadium.players[e])},assignUsersToTeams:function(t){for(var e=0;e<c.list.length;e++){var i=c.list[e];i.player&&(i.player.position.x<t.pitch.center.x?i.changeTeam(t.pitch.redTeam):i.changeTeam(t.pitch.blueTeam))}},preparePlayers:function(t){for(var e=0;e<t.allPlayers.length;e++){var i=t.allPlayers[e],r=n.copy(t.pitch.center);r.x+=t.pitch.random.uniform(-2,2),r.y=i.pitch.height,i.oldPosition.x=i.position.x=t.pitch.center.x,i.oldPosition.y=i.position.y=t.pitch.height+8,i.user&&i.user.releaseControl(null),u.forceAI(i,null),i.states.change(l.GoTo,r),i.states.queue(l.ReturnHome),t.addPlayer(i)}},startMatch:function(t){this.assignUsersToTeams(t),h.inGame.hideUserKeys(),h.hide(),t.removeAllPlayers(),this.preparePlayers(t),d.score.redTeamSkill.enable(t.pitch.redTeam),d.score.blueTeamSkill.enable(t.pitch.blueTeam),d.score.redTeamSkill.setBar(0),d.score.blueTeamSkill.setBar(0),t.stadium.camera.followBall(),t.pitch.beginMatch(60*this.options.time/2,this.drawAllowed,this.options.ai),t.clock.forever({interval:.1,callback:this.updateClock,context:this}),this.playing=!0;for(var e=0;e<t.stadium.players.length;e++){var i,n=t.stadium.players[e],r=n.entity;r.team.red?(i=this.options.redTeam.id+(e+1)+(r.isGoalkeeper?"goalkeeper":this.options.kits[0]),n.spine.replaceSkins(this.options.redTeam.skins)):(i=this.options.blueTeam.id+(e-5)+(r.isGoalkeeper?"goalkeeper":this.options.kits[1]),n.spine.replaceSkins(this.options.blueTeam.skins)),n.spine.setSkin(i)}d.show()},calculateFame:function(t){return 0},onChangeSides:function(t){d.score.secondHalf();for(var e=d.avatars.length,i=0;e>i;i++)d.avatars[i].changePlayer(t.stadium.players[(i+e/2)%e]);this.userInfo={redTeam:t.pitch.redTeam.users.slice(),blueTeam:t.pitch.blueTeam.users.slice()},t.clock.schedule({delay:3,callback:this.showSummary,context:this})},onGoal:function(t){d.score.setGoals(t.pitch.redTeam.score,t.pitch.blueTeam.score)},onGoldenGoal:function(t){d.score.goldenGoal()},onEndMatch:function(t){this.halfEnded=!0,this.userInfo={redTeam:t.pitch.redTeam.users.slice(),blueTeam:t.pitch.blueTeam.users.slice()},d.hide(),d.score.redTeamSkill.disable(),d.score.blueTeamSkill.disable(),t.clock.schedule({delay:3,callback:this.showSummary,context:this})},showSummary:function(){var t=this.machine.owner;h.show(),this.summaryMenu&&this.summaryMenu.close(),this.summaryMenu=new o({templatePath:"gui/match_summary.txt",classes:"transparent"}),this.summaryMenu.add(new a({id:"continue",label:"Continue",actions:{enter:[this.summaryContinue.bind(this,t)]}})),this.summaryMenu.addAction("back",function(){return!0}),this.summaryMenu.redTeamInfo=this.options.redTeam,this.summaryMenu.blueTeamInfo=this.options.blueTeam,this.summaryMenu.redTeam=t.pitch.redTeam,this.summaryMenu.blueTeam=t.pitch.blueTeam,this.summaryMenu.userInfo=this.userInfo,this.summaryMenu.matchFame=this.calculateFame(t),this.summaryMenu.open(),f.current.save(),d.hide()},summaryContinue:function(t){this.halfEnded?this.endGame(t):(this.halfEnded=!0,this.summaryMenu.close(),h.hide(),p.play.sendTo(t.pitch),d.show())},endGame:function(t){t.entities.remove(t.pitch),t.endGame(),t.onExit.send(),y.add(this.calculateFame(t))},updatePlayerSkins:function(t){for(var e,i=0;i<t.stadium.players.length;i++){var n=t.stadium.players[i],r=n.entity;r.user&&(r.position.x<t.pitch.center.x?(e=this.options.redTeam.id+(i+1)+this.options.kits[0],n.spine.replaceSkins(this.options.redTeam.skins)):(e=this.options.blueTeam.id+(i+1)+this.options.kits[1],n.spine.replaceSkins(this.options.blueTeam.skins)),n.spine.skinName!==e&&(n.spine.unloadSkin(),n.spine.setSkin(e)))}},updateUserKeyIndicators:function(t){for(var e=n.temp(),i=0;i<t.pitch.players.length;i++){var r=t.pitch.players[i];r.user&&r.user.online&&(t.stadium.worldToCamera(r.position,e),h.inGame.setUserKeyIndicatorsPosition(r.user.id,e))}},update:function(t,e){if(!t.pitch.paused&&this.loaded){if(m.ctx.listener.setPosition(g.clamp(t.stadium.camera.position.x,0,t.pitch.width),0,t.stadium.camera.position.y),v&&this.playing)for(var i=0;i<c.list.length;i++)c.list[i].controller&&c.list[i].controller.toggleTeam.isActive&&(c.list[i].online=!0,null===c.list[i].team?c.list[i].changeTeam(t.pitch.redTeam):c.list[i].team===t.pitch.redTeam?c.list[i].changeTeam(t.pitch.blueTeam):c.list[i].team===t.pitch.blueTeam&&c.list[i].changeTeam(null));if(this.playing)return void d.update(e);for(var i=0;i<c.list.length;i++)c.list[i].controller&&c.list[i].controller.toggleTeam.isActive&&(c.list[i].online?this.removeUser(t,c.list[i]):this.addUser(t,c.list[i]));this.updatePlayerSkins(t);var n=!0;if(!this.fastPlay)for(var i=0;i<t.pitch.players.length;i++)if(t.pitch.players[i].user&&!p.isReady.sendTo(t.pitch.players[i])){n=!1;break}n&&(this.fastPlay||c.playing())&&this.startMatch(t)}},exit:function(t){t.entities.remove(t.pitch,!0),h.inGame.hideUserKeys(),d.score.redTeamSkill.disable(),d.score.blueTeamSkill.disable(),t.clock.cancel(this.updateClock,this),t.clock.cancel(this.showSummary,this),this.summaryMenu&&this.summaryMenu.close(),t.clock.cancel(this.swapSkins,this)}});return x}),define("modes/tournament",function(){"use strict";var t=require("settings"),e=require("nebula/signal"),i=require("menu"),n=require("modes/match"),r=(require("nebula/random"),require("tournament")),s=require("teams"),o=require("profiles"),a=require("users"),h=(require("messages"),require("nebula/query")),l=(require("controller"),require("nebula/strings"),require("fame")),u=n.extend("Tournament",{enter:function(t,e,n){this._players=[t.red1,t.red2,t.red3,t.red4,t.red5,t.blue1,t.blue2,t.blue3,t.blue4,t.blue5],this.summaryMenu=null,this.loaded=!1,this.playing=!1,this.drawAllowed=!1,this.halfEnded=!1,this.options={redTeam:null,blueTeam:null,time:null,kits:[],ai:e.ai||0},this.podium=null;for(var o,a=[],h=(s.all(),0);h<e.teams.length;h++){if(o=s.get(e.teams[h]),!o)throw new Error("Team not found");a.push(o)}this.currentGame=new r(e),i.tournament.label="World Cup",i.tournament.teams=a,i.tournament.tournament=this.currentGame,i.tournament.find.continueButton.actions.enter[0]=this["continue"].bind(this,t),i.tournament.find.backButton.actions.enter[0]=this.exitGame.bind(this,t),i.tournament.find.endGameButton.actions.enter[0]=this["continue"].bind(this,t),i.tournament.actions.back[1]=this.skipMatch.bind(this,t),n&&this.save(),this.fixMatches(t),i.showLoadingScreen(),i.tournament.open(),i.tournament.updateWidget()},save:function(){o.current.game.save=this.currentGame.data,o.current.save()},skipMatch:function(t){var e=this.currentGame.findUserMatch();e?(e.skip(),e=this.currentGame.findUserMatch(),e||this.currentGame.unSkip()):this.currentGame.unSkip(),i.tournament.updateWidget()},simulateMatch:function(t,e){this.currentGame.play(e)},simulateMatches:function(t){for(var e,i,n=null,r=0;r<this.currentGame.children.length&&(n=this.currentGame.children[r],!(n.progress<1));r++);if(1!==n.progress){var s=h.filter(n.getMatches(),{isUserMatch:null}),o=h.filter(n.getMatches(),{isUserMatch_not:null});if(s.length){o.length?(e=Math.ceil(s.length/o.length),i=h.filter(s,{progress:0}).slice(0,e)):i=h.filter(this.currentGame.getMatches(),{progress:0});for(var r=0;r<i.length;r++)this.simulateMatch(t,i[r]);h.filter(this.currentGame.getMatches(),{progress:0,isUserMatch_not:null}).length||this.simulateMatches(t)}}},fixMatches:function(t){var e=this.currentGame.findUserMatch();for(e||(this.currentGame.unSkip(),e=this.currentGame.findUserMatch());!e&&1!==this.currentGame.progress;)this.simulateMatches(t),e=this.currentGame.findUserMatch()},"continue":function(t){var e=this.currentGame.findUserMatch();if(!e)return void(1===this.currentGame.progress?this.win(t):(this.fixMatches(t),i.tournament.updateWidget()));var n=this.currentGame.data.userTeam;n instanceof Array||(n=[n]);var r=this.currentGame.data.teams[this.currentGame.findTeam(e.data.teams[0])],o=this.currentGame.data.teams[this.currentGame.findTeam(e.data.teams[1])],a=[];n.indexOf(r)>-1&&a.push(s.get(r)),n.indexOf(o)>-1&&a.push(s.get(o)),a.length&&(i.showInGameMenu(),this.options={userTeam:a,redTeam:s.get(r),blueTeam:s.get(o),time:this.currentGame.data.time,kits:this.selectKits(s.get(r),s.get(o)),ai:this.currentGame.data.ai||0},this.drawAllowed=Boolean(e.data.drawAllowed),this.loadMatch(t,this.options.redTeam,this.options.kits[0],this.options.blueTeam,this.options.kits[1]),this.currentMatch=e)},selectTeams:function(t){n.prototype.selectTeams.apply(this,arguments),i.inGame.hideHelpText(),this.isMultiplayer()},assignUsersToTeams:function(t){if(2===this.options.userTeam.length)return void n.prototype.assignUsersToTeams.apply(this,arguments);for(var e=0;e<a.list.length;e++){var i=a.list[e];i.player&&(this.options.redTeam===this.options.userTeam[0]?i.changeTeam(t.pitch.redTeam):i.changeTeam(t.pitch.blueTeam))}},startMatch:function(t){if(2===this.options.userTeam.length){for(var e=!1,i=!1,r=0;r<a.list.length;r++){var s=a.list[r];s.player&&(s.player.position.x<t.pitch.center.x?e=!0:i=!0)}if(!e||!i)return}n.prototype.startMatch.apply(this,arguments)},onEndMatch:function(t){u.onEndMatch.send(this),n.prototype.onEndMatch.apply(this,arguments)},updatePlayerSkins:function(t){if(this.options.userTeam.length>1)return void n.prototype.updatePlayerSkins.apply(this,arguments);for(var e,i=0;i<t.stadium.players.length;i++){var r=t.stadium.players[i],s=r.entity;s.user&&(this.options.userTeam[0]===this.options.redTeam?(e=this.options.redTeam.id+(i+1)+this.options.kits[0],r.spine.replaceSkins(this.options.redTeam.skins)):(e=this.options.blueTeam.id+(i+1)+this.options.kits[1],r.spine.replaceSkins(this.options.blueTeam.skins)),r.spine.skinName!==e&&r.spine.setSkin(e))}},calculateFame:function(e){if(!e.pitch.matchEnded||this.isMultiplayer())return 0;var i=Math.max(0,e.pitch.redTeam.skill.offensiveScore+e.pitch.redTeam.skill.defensiveScore)+Math.max(0,e.pitch.blueTeam.skill.offensiveScore+e.pitch.blueTeam.skill.defensiveScore),n=i*t("FAME_PER_AI")[this.currentGame.data.ai];return this.userDrewMatch(e)?n*=t("FAME_WHEN_DREW"):this.userWonMatch(e)||(n*=t("FAME_WHEN_LOSE")),Math.round(n)},endGame:function(t){this.halfEnded=!1,this.playing=!1,t.entities.remove(t.pitch),t.reset(),t.onExit.send(),document.body.classList.add("loading"),this.isMultiplayer()||(this.userWonMatch(t)?o.current.stats.wins+=1:this.userDrewMatch(t)?o.current.stats.draws+=1:o.current.stats.loses+=1,o.current.stats.goalsScored+=this.userScoredGoals(t),o.current.stats.goalsConceded+=this.userConcededGoals(t));var e=this.currentMatch;if(e.setResults({goals:[t.pitch.redTeam.score,t.pitch.blueTeam.score]}),this.currentGame.play(e),this.currentGame.unSkip(),this.simulateMatches(t),this.currentGame.data.ai++,this.save(),this.currentMatch=null,this.isMultiplayer()||l.add(this.calculateFame(t)),this.isUserWinner()){var n=this.currentGame.aliases.f2,r=this.currentGame.data.teams[n?n.winner:this.currentGame.points[0].team];r===this.options.redTeam.id?this.showCelebration(t,this.options.redTeam,this.options.kits[0],this.options.blueTeam,this.options.kits[1]):this.showCelebration(t,this.options.blueTeam,this.options.kits[1],this.options.redTeam,this.options.kits[0])}else i.tournament.open(),i.tournament.updateWidget();this.fixMatches(t),t.clock.cancel(this.updateClock,this),t.clock.cancel(this.showSummary,this)},exitGame:function(t){t.endGame(),t.onExit.send()},userScoredGoals:function(t){return this.currentGame.data.userTeam===this.options.redTeam.id?t.pitch.redTeam.score:t.pitch.blueTeam.score},userConcededGoals:function(t){return this.currentGame.data.userTeam===this.options.redTeam.id?t.pitch.blueTeam.score:t.pitch.redTeam.score},userWonMatch:function(t){var e=this.currentGame.data.userTeam;return e===this.options.redTeam.id&&t.pitch.redTeam.score>t.pitch.blueTeam.score||e===this.options.blueTeam.id&&t.pitch.redTeam.score<t.pitch.blueTeam.score},userDrewMatch:function(t){return t.pitch.redTeam.score===t.pitch.blueTeam.score},isUserWinner:function(){if(this.currentGame.progress<1)return!1;var t=this.currentGame.aliases.f2,e=this.currentGame.data.userTeam,i=this.currentGame.data.teams[t?t.winner:this.currentGame.points[0].team];return e instanceof Array?e.indexOf(i)>=0:e===i},isMultiplayer:function(){return this.currentGame.data.userTeam instanceof Array&&this.currentGame.data.userTeam.length>1},win:function(t){this.isUserWinner()&&!this.isMultiplayer()&&u.onWin.send(this),o.current.game.save=void 0,o.current.save(),this.exitGame(t)},showCelebration:function(t,e,i,n,r,s){var o=require("modes/podium");t.states.change(o,e||this.options.redTeam,i||this.options.kits[0],n||this.options.blueTeam,r||this.options.kits[1],s||this.options.ai)},exit:function(t){n.prototype.exit.apply(this,arguments)}});return u.onEndMatch=new e,u.onWin=new e,u}),define("modes/podium",function(){"use strict";var t=require("menu"),e=require("nebula/states").State,i=(require("nebula/random"),require("teams")),n=require("profiles"),r=(require("users"),require("messages"),require("nebula/query"),require("renderers/podium")),s=require("controller"),o=(require("nebula/strings"),require("nebula/audio")),a=e.extend("Podium",{enter:function(t,e,i,n,r,o){this.exitRequested=!1,this.game=t,this.winners=e,this.losers=n,this.kits=[i,r],this.difficulty=o,this.game.onEnter.send(),s.onDown(this.controllerDown,this),this.loadResources(this.start.bind(this))},loadResources:function(e){var n=this;t.showLoadingScreen(),setTimeout(function(){function t(){r-=1,r||e&&e()}var r=2;i.loadResources(n.winners.id,t),i.loadResources(n.losers.id,t)},250)},start:function(){this.podium=new r(this.game,this.winners,this.kits[0],this.losers,this.kits[1],this.difficulty),this.game.stage.addChild(this.podium),this.game.stadium.visible=!1,this.podium.resize(this.game.viewportWidth,this.game.viewportHeight),this.game.entities.add(this.podium),t.showInGameMenu()},controllerDown:function(t,e){this.game.states.time>=1&&e&&("back"===e.name||"enter"===e.name)&&(this.exitRequested=!0)},update:function(){if(o.ctx.listener.setPosition(0,0,0),this.exitRequested){var t=require("modes/tournament");this.game.states.change(t,n.current.game.save,!1),this.game.onExit.send()}},exit:function(){s.onDown.disconnect(this.controllerDown,this),this.game.stage.removeChild(this.podium),this.game.stadium.visible=!0,this.game.entities.remove(this.podium),this.podium=null}});return a}),define("game_audio",function(){"use strict";function t(t){t.onEnter(function(){I=1,D=0}),t.onExit(function(){I=0,D=1})}function e(t){var e=I-L.matchSoundsGain.gain.value;e&&(Math.abs(e)<.01?L.matchSoundsGain.gain.value=I:L.matchSoundsGain.gain.value+=e*t*2);var e=D-L.musicToggle.gain.value;e&&(Math.abs(e)<.01?L.musicToggle.gain.value=D:L.musicToggle.gain.value+=e*t*2);for(var i=P.head;null!==i;)i.data.update(t),i=i.next;for(i=M.head;null!==i;)i.data.playbackRate=L.game.pitch.timeScale,i.data.update(t*L.game.pitch.timeScale),i=i.next}function i(t){g.SoundEmitter.onEmitted({sender:t,receiver:function(t,e){var i=E.createNode(e);M.appendNode(i)}}),P.append(t)}function n(t,e,n,r){var s=[];for(var o in t){var a=new g.SoundEmitter(t[o],e,r);s.push(a),n&&i(a)}return s}function r(t){for(var e=n(O.kick.regular,L.matchSoundsGain,!0),i=n(O.kick.lob,L.matchSoundsGain,!0),r=n(O.kick.strong,L.matchSoundsGain,!0),o=n(O.tackle.slide,L.matchSoundsGain,!0),a=n(O.tackle.hit,L.matchSoundsGain,!0),h=n(O.tackle.shouting,L.matchSoundsGain,!0),l=t.pitch.redTeam.allPlayers.concat(t.pitch.blueTeam.allPlayers),u=0;u<l.length;u++)s(t,l[u],e,i,r,o,a,h)}function s(t,e,i,n,r,s,o,a){var h=new m({target:e,parentAudioNode:L.matchSoundsGain});t.pitch.entities.add(h),h.panner.rolloffFactor=.5,b.onKick({sender:e,receiver:function(t,e,n,s){k>s?y.choice(i).playOnce(0,h.panner):y.choice(r).playOnce(0,h.panner)}}),b.onLob({sender:e,receiver:function(){y.choice(n).playOnce(0,h.panner)}}),w.Slide.onEnter({sender:e,receiver:function(){y.choice(s).playOnce(0,h.panner)}}),w.Hit.onEnter({sender:e,receiver:function(){y.choice(o).playOnce(0,h.panner),y.choice(a).playOnce(0,h.panner)}})}function o(t){var e=t.pitch.ball,i=new m({target:e,parentAudioNode:L.matchSoundsGain});t.pitch.entities.add(i);var r=n(O.ball_hit.goal,L.matchSoundsGain,!0),s=n(O.ball_land,L.matchSoundsGain,!0);_.onBounce(function(){y.choice(s).playOnce(0,void 0,v.clamp(Math.abs(e.velocity.z)/k,0,1))}),T.onCrossbarHit(function(){y.choice(r).playOnce(0,void 0,Math.pow(v.clamp(e.speed/k,0,1),2))}),T.onPostHit(function(){y.choice(r).playOnce(0,void 0,Math.pow(v.clamp(e.speed/k,0,1),2))})}function a(t){function e(){n.playOnce()}var n=new g.SoundEmitter(O.whistle.single,L.matchSoundsGain,0);i(n),x.states.BallOutOfPlay.onEnter(e)}function h(t,e,i,r){var s=new m({parentAudioNode:L.crowdGain});t.pitch.entities.add(s),s.position.x=(1+e)*t.pitch.width/2,s.position.y=(1+i)*t.pitch.height/2,s.panner.rolloffFactor=.25;var o=n(O.crowd.calm,s.panner,!0,0);L.matchSoundsGain.gain.value=0,y.choice(o).play(r)}function l(t){var e=n(O.crowd.ovation,L.crowdGain,!0),i=n(O.crowd.booing,L.crowdGain,!0),r=n(O.crowd.cheering,L.crowdGain,!0);x.goalScored(function(t,n){n.inControl?y.choice(e).playOnce():y.choice(i).playOnce()}),w.Hit.onEnter(function(){y.choice(r).playOnce()})}function u(t){var e=new g.SoundEmitter(O.slow_motion["01"],L.matchSoundsGain);P.append(e),w.HumanPreciseShot.onEnter(function(){e.playOnce()});var i=new g.SoundEmitter(O.powerups.supershot_prepare,L.matchSoundsGain);P.append(i);var n=new g.SoundEmitter(O.powerups.supershot_move,L.matchSoundsGain);P.append(n);var r=null;g.SoundEmitter.onEmitted({sender:n,receiver:function(t,e){r=e}}),w.Supershot.onEnter(function(){i.playOnce()}),_.states.SupershotKick.onEnter(function(){n.play()}),_.states.SupershotKick.onExit(function(){r.stop()})}function c(t){var e=n(O.menu_music,L.musicGain,!0),i=null;t.onExit(function(){i&&i.stop(),i=y.choice(e).play()}),f||(i=y.choice(e).play())}function p(t){var e=new g.SoundEmitter(O.menu_sounds.focus,L.fxGain),n=new g.SoundEmitter(O.menu_sounds.select,L.fxGain),r=new g.SoundEmitter(O.menu_sounds.select_invalid,L.fxGain);i(e),i(n),i(r),A.gui.onFocus(function(t){t instanceof C||e.playOnce()}),A.gui.onSelect(function(t){t.disabled||t.data&&t.data.locked?r.playOnce():n.playOnce()}),A.gui.onBack(function(t){e.playOnce()})}var d=require("settings"),f=d("DEBUG",!1),m=require("sound_entity"),g=require("nebula/audio"),y=require("nebula/random"),v=require("nebula/numbers"),x=require("pitch").Pitch,b=require("player").Player,w=require("players/states"),_=require("ball").Ball,T=require("goal").Goal,E=(require("renderers/sprite"),require("assets"),require("nebula/linked_list")),S=require("nebula/game"),A=(require("modes/match"),require("profiles"),require("menu")),C=require("nebula/gui/container"),P=(require("nebula/tweens"),new E),M=new E,O={ball_hit:{goal:{"01":"audio/ball_hit/goal/01.ogg","02":"audio/ball_hit/goal/02.ogg"}},ball_land:{"01":"audio/ball_land/01.ogg"},crowd:{booing:{"01":"audio/crowd/booing/01.ogg","02":"audio/crowd/booing/02.ogg"},calm:{"01":"audio/crowd/calm/01.ogg"},cheering:{"01":"audio/crowd/cheering/01.ogg","02":"audio/crowd/cheering/02.ogg","03":"audio/crowd/cheering/03.ogg","04":"audio/crowd/cheering/04.ogg","05":"audio/crowd/cheering/05.ogg"},ovation:{"01":"audio/crowd/ovation/01.ogg","02":"audio/crowd/ovation/02.ogg","03":"audio/crowd/ovation/03.ogg"}},kick:{lob:{"01":"audio/kick/lob/01.ogg","02":"audio/kick/lob/02.ogg","03":"audio/kick/lob/03.ogg"},regular:{"01":"audio/kick/regular/01.ogg","02":"audio/kick/regular/02.ogg","03":"audio/kick/regular/03.ogg","04":"audio/kick/regular/04.ogg","05":"audio/kick/regular/05.ogg","06":"audio/kick/regular/06.ogg","07":"audio/kick/regular/07.ogg","08":"audio/kick/regular/08.ogg"},strong:{"01":"audio/kick/strong/01.ogg","02":"audio/kick/strong/02.ogg","03":"audio/kick/strong/03.ogg"}},menu_music:{theme_3:"audio/menu_music/theme_3.ogg"},menu_sounds:{focus:"audio/menu_sounds/focus.ogg",select:"audio/menu_sounds/select.ogg",select_invalid:"audio/menu_sounds/select_invalid.ogg"},powerups:{supershot_move:"audio/powerups/supershot_move.ogg",supershot_prepare:"audio/powerups/supershot_prepare.ogg"},slow_motion:{"01":"audio/slow_motion/01.ogg"},tackle:{hit:{"01":"audio/tackle/hit/01.ogg","02":"audio/tackle/hit/02.ogg","03":"audio/tackle/hit/03.ogg"},shouting:{"01":"audio/tackle/shouting/01.ogg","02":"audio/tackle/shouting/02.ogg","03":"audio/tackle/shouting/03.ogg","04":"audio/tackle/shouting/04.ogg","05":"audio/tackle/shouting/05.ogg"},slide:{"01":"audio/tackle/slide/01.ogg","02":"audio/tackle/slide/02.ogg","03":"audio/tackle/slide/03.ogg"}},whistle:{"double":"audio/whistle/double.ogg",single:"audio/whistle/single.ogg"}};document.createElement("audio");if(!d("OGG_SUPPORT")){var R=function(t){for(var e in t)"string"==typeof t[e]?t[e]=t[e].replace(".ogg",".m4a"):"object"==typeof t[e]&&R(t[e])};R(O)}var k=d("MIN_SHOOTING_FORCE");g.Sound.onEnded(function(t){var e=M.getNode(t);e&&M.detachNode(e)}),S.onPause(function(){for(var t=M.head;null!==t;)t.data.pause(),t=t.next}),S.onResume(function(){for(var t=M.head;null!==t;)t.data.resume(),t=t.next});var I=0,D=1,L={};L.init=t,L.attachAllPlayerSounds=r,L.attachPlayerSounds=s,L.attachBallSounds=o,L.attachRefereeSounds=a,L.attachPannedCrowdSounds=h,L.attachCrowdSounds=l,L.attachMenuMusic=c,L.attachMenuSounds=p,L.attachPowerupSounds=u,L.update=e;var F=g.ctx.createGain(),B=g.ctx.createGain(),N=g.ctx.createGain(),G=g.ctx.createGain(),q=g.ctx.createGain();return F.connect(g.gainNode),B.connect(F),N.connect(g.gainNode),G.connect(N),q.connect(G),L.musicToggle=F,L.musicGain=B,L.fxGain=N,L.matchSoundsGain=G,L.crowdGain=q,L.playingSounds=M,L}),define("main",function(){"use strict";function t(){var t,e=function(){Y.states.change(k,M.current.game.save,!1);
},i="world_cup",n=g[i];n.teamSelectMenu.addChoices(w.all()),n.startGame=function(){if(this.find.teams1.value){var t=this.find.teams1.value,e=A.templates[i](),r=w.all();t.isRandom&&(t=s.choice(r)),r.splice(r.indexOf(t),1),e.teams=r.ids.slice(0,e.teams.length-1),e.teams=e.teams.concat(t.id),e.ai=0,e.userTeam=t.id,e.name=n.alias,e.time=4,s.shuffle(e.teams),Y.states.change(k,e,!0)}},n.find.startButton.addAction("enter",n.startGame.bind(n)),t=g.main.find.play;var r=t.actions.enter[t.actions.enter.length-1];t.actions.enter[t.actions.enter.length-1]=function(){if(!this.disabled){var n=M.current.game.save;if(n){var s=g[i+"Save"];s||(s=g[i+"Save"]=new S({label:t.label}),s.add(new E({label:"Continue",id:"continueGame",data:i,actions:{enter:e}})).add(new E({label:"Restart",actions:{enter:r}})).add(new E({label:"Back",actions:{enter:s.gui.back}}))),s.open()}else r.call(t)}}}function e(){m.call(this,{width:window.innerWidth,height:window.innerHeight,rendererOptions:r("RENDERER_OPTIONS",{}),assets:b.all}),document.body.appendChild(this.renderer.view),this.onEnter=new I,this.onExit=new I,this.resolution=1,this.viewportWidth=0,this.viewportHeight=0,this.pitch=new a({game:this,width:r("PITCH_WIDTH"),height:r("PITCH_HEIGHT"),goalWidth:r("GOAL_WIDTH"),goalHeight:r("GOAL_HEIGHT"),regionColumns:16,regionRows:9}),this.pitch.states.global(a.states.Global),this.pitch.ball=new o({game:this,pitch:this.pitch,gravity:{z:r("GRAVITY")}}),this.redGoalkeeper=this.makeGoalkeeper(0,4),this.red1=this.makePlayer(3,3,l.ROLE_DEFENDER,.97),this.red2=this.makePlayer(3,5,l.ROLE_DEFENDER,.97),this.red3=this.makePlayer(5,4,l.ROLE_MIDFIELDER,.97),this.red4=this.makePlayer(7,2,l.ROLE_ATTACKER,.97),this.red5=this.makePlayer(7,6,l.ROLE_ATTACKER,.97),this.blueGoalkeeper=this.makeGoalkeeper(0,4),this.blue1=this.makePlayer(3,3,l.ROLE_DEFENDER,.97),this.blue2=this.makePlayer(3,5,l.ROLE_DEFENDER,.97),this.blue3=this.makePlayer(5,4,l.ROLE_MIDFIELDER,.97),this.blue4=this.makePlayer(7,2,l.ROLE_ATTACKER,.97),this.blue5=this.makePlayer(7,6,l.ROLE_ATTACKER,.97),this.pitch.redTeam=new h({pitch:this.pitch,players:[this.redGoalkeeper,this.red1,this.red2,this.red3,this.red4,this.red5]}),this.pitch.blueTeam=new h({pitch:this.pitch,players:[this.blueGoalkeeper,this.blue1,this.blue2,this.blue3,this.blue4,this.blue5]}),this.pitch.redTeam.states.global(h.states.Global),this.pitch.blueTeam.states.global(h.states.Global),this.allPlayers=this.pitch.redTeam.allPlayers.concat(this.pitch.blueTeam.allPlayers),this.pitch.entities.add(x),this.entities.add(v),v.game=this,this.stadium=null,g.pause.find.exitToMenu.addAction("enter",this.endGame.bind(this)),g.pause.find.exitToMenu.addAction("enter",this.onExit.send.bind(this.onExit)),g.pause.find.backButton.addAction("enter",this.pitch.resume.bind(this.pitch)),g.pause.find.backButton.addAction("enter",this._resumeMatch.bind(this))}function i(t,e){t(function(t){e.send({receiver:Y,sender:t})})}var n=require("pixi"),r=require("settings"),s=require("nebula/random"),o=(require("nebula/objects"),require("ball").Ball),a=require("pitch").Pitch,h=require("team").Team,l=require("player").Player,u=require("players/states"),c=require("players/global"),p=require("goalkeeper").Goalkeeper,d=require("nebula/input/keyboard"),f=require("renderers/stadium"),m=require("nebula/game"),g=require("menu"),y=require("nebula/audio"),v=require("game_audio"),x=require("particle_manager"),b=require("assets"),w=require("teams"),_=require("races"),T=require("nebula/format"),E=require("nebula/gui/button"),S=require("nebula/gui/container"),A=require("tournament"),C=(require("gui/tournament"),require("gui/team_container")),E=require("nebula/gui/button"),P=require("users"),M=require("profiles"),O=require("messages"),R=require("modes/match"),k=require("modes/tournament"),I=require("nebula/signal"),D=require("controller"),L=require("gui/alert"),F=require("gui/confirm"),B=require("signs"),N=require("ui"),G=(require("nebula/query"),require("greenworks")),q=require("leaderboard_leagues"),z=require("fame"),U=r("DEBUG",!1);M.load(),Object.keys(M.all).length||M.createProfile("player1"),M.changeProfile("player1");var j=M.current;g.gui._controller=P.list[0].controller=new D(d,M.current.keyboardLayout);var H=r("FPS",!1);if(H){var W=document.getElementById("fps");W.style.display="block",m.onAfterFrame(function(t){W.innerHTML=T("<b>%.1f</b> ~%.1f <small>%.1f-%.1f</small>",t.fps.current,t.fps.average,t.fps.min,t.fps.max)})}y.ctx.listener.setOrientation(0,0,-1,0,1,0),function(){function t(){v.fxGain.gain.value=Number(s.value)*o.value,v.musicGain.gain.cancelScheduledValues(y.ctx.currentTime),v.musicGain.gain.setValueAtTime(Number(s.value)*a.value,y.ctx.currentTime),j.audio.enabled=s.value,j.audio.fxVolume=o.value,j.audio.musicVolume=a.value}function e(){Y&&Y.stadium&&(h.value?Y.stadium.addShadows():Y.stadium.removeShadows()),j.video.shadows=h.value}function i(){Y&&Y.stadium&&(l.value?Y.stadium.showParticles():Y.stadium.hideParticles()),j.video.particles=l.value}function n(t,e,i){function n(){var n=new Set([e.find.up.value,e.find.down.value,e.find.left.value,e.find.right.value,e.find.enter.value,e.find.back.value]);if(n.size<6)return void new L({text:"It seems that the same keys are assigned to different actions, you need to correct this before saving."}).open();for(var r in a){var s=e.find[r];s&&(M.current[t][r]=s.value)}P.list[i].controller&&P.list[i].controller.setActions(M.current[t]),e.gui.onControllerChange.send()}function s(){for(var i in a){M.current[t][i]=null;var r=e.find[i];r&&(r.value=M.current[t][i],r.updateWidget())}n()}function o(){for(var i in a){var n=e.find[i];n&&(n.value=M.current[t][i])}}var a=r("DEFAULT_OPTIONS",{})[t],h=new F({text:"Are you sure you want to reset to defaults?"}),l=new F({text:"Are you sure you want to save these settings?"});for(var u in a){var c=e.find[u];c&&(c.value=M.current[t][u])}h.find.ok.addAction("enter",s),l.find.ok.addAction("enter",n),e.find.save.addAction("enter",l.open.bind(l)),e.find.reset.addAction("enter",h.open.bind(h)),e.addAction("back",o),e.backButton.addAction("enter",o)}var s=g.audio.find.enabled,o=g.audio.find.fxVolume,a=g.audio.find.musicVolume;s.value=j.audio.enabled,o.value=j.audio.fxVolume,a.value=j.audio.musicVolume,t(),s.onChange(t),o.onChange(t),a.onChange(t);var h=g.graphics.find.shadows;h.value=j.video.shadows,e(),h.onChange(e);var l=g.graphics.find.particles;l.value=j.video.particles,i(),l.onChange(i),n("keyboardLayout",g.keyboard,0),n("gamepadLayout1",g.gamepad1,1),n("gamepadLayout2",g.gamepad2,2),n("gamepadLayout3",g.gamepad3,3),n("gamepadLayout4",g.gamepad4,4)}(),g.gui.onClose(function(t){t instanceof C&&M.current.save()}),e.prototype=Object.create(m.prototype),e.prototype._resumeMatch=function(){this.states.is(R)&&!this.states.current.playing||g.hide()},e.prototype.removePlayer=function(t){this.stadium.hidePlayer(t),this.pitch.removePlayer(t),c.forceIdle(t)},e.prototype.removeAllPlayers=function(){for(var t=this.pitch.players.length-1;t>=0;t--)this.removePlayer(this.pitch.players[t])},e.prototype.addPlayer=function(t){this.stadium.showPlayer(t),this.pitch.addPlayer(t)},e.prototype.reset=function(){P.detach(),this.pitch.ball.owner&&(O.releaseBall.sendTo(this.pitch.ball.owner),O.releaseBall.sendTo(this.pitch.ball)),this.pitch.ball.inHands&&this.pitch.ball.inHands.dropBall(),this.pitch.redTeam.states.idle(),this.pitch.blueTeam.states.idle(),this.pitch.states.idle(),this.pitch.resume(),this.pitch.pause(),this.pitch.ballOutOfPlay=!1,this.removeAllPlayers(),B.hide(),N.reset()},e.prototype.endGame=function(){M.current.save(),this.reset(),this.states.idle(),g.showInGameMenu(),document.body.classList.add("loading"),g.main.open()},e.prototype.makeGoalkeeper=function(t,e){var i=new p({pitch:this.pitch,home:this.pitch.regions[t][e].center});return i.states["default"]=u.Ready,i},e.prototype.makePlayer=function(t,e,i,n){var r=new l({pitch:this.pitch,accuracy:n,home:this.pitch.regions[t][e].center,role:i});return r.states["default"]=u.Ready,r},e.prototype.repositionUI=function(){N.resize(this.renderer.width,this.renderer.height),B.resize(this.renderer.width,this.renderer.height)},e.prototype.resize=function(){this.viewportWidth=window.innerWidth*this.resolution,this.viewportHeight=window.innerHeight*this.resolution,g.gui.scale=Math.min(window.innerWidth/1920,window.innerHeight/1080),g.gui.top.setScale(),m.prototype.resize.call(this,this.viewportWidth,this.viewportHeight,this.resolution),this.stadium&&(this.stadium.resize(this.viewportWidth,this.viewportHeight),this.repositionUI()),this.states.current&&this.states.current.podium&&this.states.current.podium.resize(this.viewportWidth,this.viewportHeight)},e.prototype._onStadiumChange=function(t){v.crowdGain.gain.value=Number("undefined"==typeof t._stadium.crowd?!0:t._stadium.crowd)},e.prototype._onLoad=function(){if(w.load(),_.load(),t(),this.stadium=new f({game:this,pitch:this.pitch,addShadows:g.graphics.find.shadows.value,showParticles:g.graphics.find.particles.value,players:this.pitch.redTeam.allPlayers.concat(this.pitch.blueTeam.allPlayers)}),this.stage.addChild(this.stadium),M.current.save(),g.showInGameMenu(),U){var e=require("modes/match");this.states.change(e,s.choice(w.all()),s.choice(w.all()),100,!0,0,!0)}else g.main.open();B.load(this),N.load(Y),v.init(this),v.attachAllPlayerSounds(this),v.attachBallSounds(this),v.attachRefereeSounds(this),v.attachCrowdSounds(this),v.attachPannedCrowdSounds(this,-1,0,30),v.attachPannedCrowdSounds(this,1,0,60),v.attachPowerupSounds(this),v.attachMenuMusic(this),v.attachMenuSounds(this),f.onChange(this._onStadiumChange.bind(this)),this.resize(),m.prototype._onLoad.call(this)};var Y=new e;i(a.matchStarted,O.beginMatch),i(a.goalScored,O.goal),i(a.halfEnded,O.changeSides),i(a.goldenGoal,O.goldenGoal),i(a.states.EndMatch.onEnter,O.endMatch),i(P.onConnect,O.userConnect),i(P.onDisconnect,O.userDisconnect);var X=new n.loaders.Loader;X.add(b.templates);var K=function(){function t(t){U?(g.showLoadingScreen(),setTimeout(Y.load.bind(Y),50)):(t?setTimeout(g.showLoadingScreen,t):g.showLoadingScreen(),setTimeout(Y.load.bind(Y),t+250))}for(var e in X.resources)n.loader.resources[e]=X.resources[e];document.body.classList.add("loaded"),g.inGame.open();var i=require("modes/global");Y.states.global(i),Y.start(),Y.resize(),window.addEventListener("resize",Y.resize.bind(Y)),G.loaded&&q.load(function(){q.getOrSetScore(function(t){var e=z.get();z.set(Math.max(t.score,e))})}),U||g.showIntroScreen(),t(3e3)};return X.on("complete",K),X.load(),Y});